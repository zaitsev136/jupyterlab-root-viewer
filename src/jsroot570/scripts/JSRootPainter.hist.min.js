var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,B,A){f!=Array.prototype&&f!=Object.prototype&&(f[B]=A.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(f,B,A,H){if(B){A=$jscomp.global;f=f.split(".");for(H=0;H<f.length-1;H++){var K=f[H];K in A||(A[K]={});A=A[K]}f=f[f.length-1];H=A[f];B=B(H);B!=H&&null!=B&&$jscomp.defineProperty(A,f,{configurable:!0,writable:!0,value:B})}};$jscomp.arrayIteratorImpl=function(f){var B=0;return function(){return B<f.length?{done:!1,value:f[B++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(f,B){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:B})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function f(A){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(A||"")+"_"+B++,A)}var B=0;return f}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.asyncIterator;f||(f=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};
$jscomp.iteratorFromArray=function(f,B){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var A=0,H={next:function(){if(A<f.length){var K=A++;return{value:B(K,f[K]),done:!1}}H.next=function(){return{done:!0,value:void 0}};return H.next()}};H[Symbol.iterator]=function(){return H};return H};$jscomp.polyfill("Array.prototype.entries",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f,A){return[f,A]})}},"es6","es3");
(function(f){if("function"===typeof define&&define.amd)define(["JSRootPainter","d3"],f);else if("object"===typeof exports&&"undefined"!==typeof module)f(require("./JSRootCore.js"),require("d3"));else{if("object"!=typeof d3)throw Error("This extension requires d3.js","JSRootPainter.hist.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.hist.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined","JSRootPainter.hist.js");f(JSROOT,d3)}})(function(f,
B){function A(a){f.TObjectPainter.call(this,a);this.UseContextMenu=this.Enabled=!0;this.UseTextColor=!1;this.FirstRun=1;this.AssignFinishPave()}function H(a,b,c){if("string"==typeof c&&0==c.indexOf("onpad:")){var d=c.substr(6);c=""}var e=new f.TPavePainter(b);e.SetDivId(a,2,d);if("title"===b.fName&&"TPaveText"===b._typename)if((a=e.FindPainterFor(null,"title"))&&a!==e)a.DeleteThis();else{if("postitle"==c||e.IsDummyPos(b)){var g=f.gStyle;a=e.frame_painter();if(g&&a){d=g.fTitleX;var l=g.fTitleY,h=g.fTitleW;
g=g.fTitleH;!g&&a&&(g=.7*(l-a.fY2NDC));!h&&a&&(h=a.fX2NDC-a.fX1NDC);if(!g||isNaN(g)||0>g)g=.06;if(!h||isNaN(h)||0>h)h=.44;b.fX1NDC=d-h/2;b.fY1NDC=l-g;b.fX2NDC=d+h/2;b.fY2NDC=l;b.fInit=1}}}else"TPaletteAxis"===b._typename&&(b.fBorderSize=1,b.fShadowColor=0,b.fAxis&&(b.fAxis.fChopt||(b.fAxis.fChopt="+"),b.fAxis.fNdiv||(b.fAxis.fNdiv=12),b.fAxis.fLabelOffset||(b.fAxis.fLabelOffset=.005)),e.z_handle=new f.TAxisPainter(b.fAxis,!0),e.z_handle.SetDivId(a,-1),e.UseContextMenu=!0);switch(b._typename){case "TPaveLabel":e.PaveDrawFunc=
e.DrawPaveLabel;break;case "TPaveStats":e.PaveDrawFunc=e.DrawPaveStats;e.$secondary=!0;break;case "TPaveText":case "TPavesText":case "TDiamond":e.PaveDrawFunc=e.DrawPaveText;break;case "TLegend":e.PaveDrawFunc=e.DrawPaveLegend;break;case "TPaletteAxis":e.PaveDrawFunc=e.DrawPaletteAxis}e.DrawPave(c);return e.PaveDrawFunc?e:e.DrawingReady()}function K(a){this.Reset()}function y(a){f.TObjectPainter.call(this,a);this.histo=a;this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=
!1;this.DecomposeTitle()}function G(a){y.call(this,a)}function F(a){y.call(this,a);this.fContour=null;this.fCustomContour=!1;this.fPalette=null;this.wheel_zoomy=!0}function W(a,b,c){b=new f.TH2Painter(b);b.SetDivId(a,1);b.DecodeOptions(c);b.IsTH2Poly()&&(b.options.Mode3D?b.options.Lego=12:b.options.Color||(b.options.Color=!0));b._show_empty_bins=!1;b._can_move_colz=!0;b.CheckPadRange(!b.options.Mode3D&&14!=b.options.Contour);b.ScanContent();b.CreateStat();b.CallDrawFunc(function(){this.DrawNextFunction(0,
function(){!this.Mode3D&&this.options.AutoZoom&&this.AutoZoom();this.FillToolbar();this.options.Project&&!this.mode3d&&this.ToggleProjection(this.options.Project);this.DrawingReady()}.bind(this))}.bind(b));return b}function X(a,b,c){var d=0,e=0,g=0;b||(d=a.fSave.length,e=Math.round(a.fSave[d-2]),g=Math.round(a.fSave[d-1]),d!==(e+1)*(g+1)+6&&(d=0));if(6<d){b=(a.fSave[d-5]-a.fSave[d-6])/e/2;var l=(a.fSave[d-3]-a.fSave[d-4])/g/2;c||(c=f.CreateHistogram("TH2F",e+1,g+1));c.fXaxis.fXmin=a.fSave[d-6]-b;
c.fXaxis.fXmax=a.fSave[d-5]+b;c.fYaxis.fXmin=a.fSave[d-4]-l;c.fYaxis.fXmax=a.fSave[d-3]+l;for(d=l=0;d<=g;++d)for(b=0;b<=e;++b)c.setBinContent(c.getBin(b+1,d+1),a.fSave[l++])}else for(e=Math.max(a.fNpx,2),g=Math.max(a.fNpy,2),c||(c=f.CreateHistogram("TH2F",e,g)),c.fXaxis.fXmin=a.fXmin,c.fXaxis.fXmax=a.fXmax,c.fYaxis.fXmin=a.fYmin,c.fYaxis.fXmax=a.fYmax,d=0;d<g;++d)for(b=0;b<e;++b){l=a.fXmin+(b+.5)*(a.fXmax-a.fXmin)/e;var h=a.fYmin+(d+.5)*(a.fYmax-a.fYmin)/g;c.setBinContent(c.getBin(b+1,d+1),a.evalPar(l,
h))}c.fName="Func";c.fTitle=a.fTitle;c.fMinimum=a.fMinimum;c.fMaximum=a.fMaximum;c.fLineColor=a.fLineColor;c.fLineStyle=a.fLineStyle;c.fLineWidth=a.fLineWidth;c.fFillColor=a.fFillColor;c.fFillStyle=a.fFillStyle;c.fMarkerColor=a.fMarkerColor;c.fMarkerStyle=a.fMarkerStyle;c.fMarkerSize=a.fMarkerSize;c.fBits|=f.TH1StatusBits.kNoStats;return c}function I(a,b){f.TObjectPainter.call(this,a,b);this.firstpainter=null;this.painters=[]}f.sources.push("hist");f.ToolbarIcons.th2color={recs:[{x:0,y:256,w:13,h:39,
f:"rgb(38,62,168)"},{x:13,y:371,w:39,h:39},{y:294,h:39},{y:256,h:39},{y:218,h:39},{x:51,y:410,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:90,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294},{y:256,h:39,f:"rgb(16,100,220)"},{y:218,h:39},{y:179,h:39,f:"rgb(22,82,205)"},{y:141,h:39},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:0,h:27},{x:128,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},
{y:294,f:"rgb(20,129,214)"},{y:256,h:39,f:"rgb(9,157,204)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(20,129,214)"},{y:141,h:39,f:"rgb(16,100,220)"},{y:102,h:39,f:"rgb(22,82,205)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{y:0,h:27},{x:166,y:486,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(82,186,146)"},{y:256,h:39,f:"rgb(179,189,101)"},{y:218,h:39,f:"rgb(116,189,129)"},{y:179,h:39,f:"rgb(82,186,146)"},{y:141,h:39,f:"rgb(14,143,209)"},
{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:205,y:486,w:39,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(16,100,220)"},{y:333,h:39,f:"rgb(9,157,204)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(244,198,59)"},{y:218,h:39},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(13,167,195)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(22,82,205)"},{y:26,h:39,f:"rgb(38,62,168)"},{x:243,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(30,175,179)"},
{y:294,f:"rgb(209,187,89)"},{y:256,h:39,f:"rgb(251,230,29)"},{y:218,h:39,f:"rgb(249,249,15)"},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(30,175,179)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:282,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(14,143,209)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(226,192,75)"},{y:218,h:39,f:"rgb(244,198,59)"},{y:179,h:39,f:"rgb(149,190,113)"},{y:141,h:39,f:"rgb(9,157,204)"},{y:102,h:39,f:"rgb(18,114,217)"},
{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:320,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(46,183,164)"},{y:256,h:39},{y:218,h:39,f:"rgb(82,186,146)"},{y:179,h:39,f:"rgb(9,157,204)"},{y:141,h:39,f:"rgb(20,129,214)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:358,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39},{y:294,f:"rgb(16,100,220)"},{y:256,h:39,f:"rgb(20,129,214)"},{y:218,h:39,f:"rgb(14,143,209)"},
{y:179,h:39,f:"rgb(18,114,217)"},{y:141,h:39,f:"rgb(22,82,205)"},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:26,h:39},{x:397,y:448,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294,f:"rgb(22,82,205)"},{y:256,h:39},{y:218,h:39},{y:179,h:39,f:"rgb(38,62,168)"},{y:141,h:39},{y:102,h:39},{y:64},{y:26,h:39},{x:435,y:410,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:474,y:256,h:39},{y:179,h:39}]};f.ToolbarIcons.th2colorz={recs:[{x:128,y:486,w:256,
h:26,f:"rgb(38,62,168)"},{y:461,f:"rgb(22,82,205)"},{y:435,f:"rgb(16,100,220)"},{y:410,f:"rgb(18,114,217)"},{y:384,f:"rgb(20,129,214)"},{y:358,f:"rgb(14,143,209)"},{y:333,f:"rgb(9,157,204)"},{y:307,f:"rgb(13,167,195)"},{y:282,f:"rgb(30,175,179)"},{y:256,f:"rgb(46,183,164)"},{y:230,f:"rgb(82,186,146)"},{y:205,f:"rgb(116,189,129)"},{y:179,f:"rgb(149,190,113)"},{y:154,f:"rgb(179,189,101)"},{y:128,f:"rgb(209,187,89)"},{y:102,f:"rgb(226,192,75)"},{y:77,f:"rgb(244,198,59)"},{y:51,f:"rgb(253,210,43)"},{y:26,
f:"rgb(251,230,29)"},{y:0,f:"rgb(249,249,15)"}]};f.ToolbarIcons.th2draw3d={path:"M172.768,0H51.726C23.202,0,0.002,23.194,0.002,51.712v89.918c0,28.512,23.2,51.718,51.724,51.718h121.042   c28.518,0,51.724-23.2,51.724-51.718V51.712C224.486,23.194,201.286,0,172.768,0z M177.512,141.63c0,2.611-2.124,4.745-4.75,4.745   H51.726c-2.626,0-4.751-2.134-4.751-4.745V51.712c0-2.614,2.125-4.739,4.751-4.739h121.042c2.62,0,4.75,2.125,4.75,4.739 L177.512,141.63L177.512,141.63z M460.293,0H339.237c-28.521,0-51.721,23.194-51.721,51.712v89.918c0,28.512,23.2,51.718,51.721,51.718h121.045   c28.521,0,51.721-23.2,51.721-51.718V51.712C512.002,23.194,488.802,0,460.293,0z M465.03,141.63c0,2.611-2.122,4.745-4.748,4.745   H339.237c-2.614,0-4.747-2.128-4.747-4.745V51.712c0-2.614,2.133-4.739,4.747-4.739h121.045c2.626,0,4.748,2.125,4.748,4.739 V141.63z M172.768,256.149H51.726c-28.524,0-51.724,23.205-51.724,51.726v89.915c0,28.504,23.2,51.715,51.724,51.715h121.042   c28.518,0,51.724-23.199,51.724-51.715v-89.915C224.486,279.354,201.286,256.149,172.768,256.149z M177.512,397.784   c0,2.615-2.124,4.736-4.75,4.736H51.726c-2.626-0.006-4.751-2.121-4.751-4.736v-89.909c0-2.626,2.125-4.753,4.751-4.753h121.042 c2.62,0,4.75,2.116,4.75,4.753L177.512,397.784L177.512,397.784z M460.293,256.149H339.237c-28.521,0-51.721,23.199-51.721,51.726v89.915c0,28.504,23.2,51.715,51.721,51.715h121.045   c28.521,0,51.721-23.199,51.721-51.715v-89.915C512.002,279.354,488.802,256.149,460.293,256.149z M465.03,397.784   c0,2.615-2.122,4.736-4.748,4.736H339.237c-2.614,0-4.747-2.121-4.747-4.736v-89.909c0-2.626,2.121-4.753,4.747-4.753h121.045 c2.615,0,4.748,2.116,4.748,4.753V397.784z"};
f.Painter.CreateDefaultPalette=function(){function a(a,b,c){if(1E-100>c)b=c=a=b;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a},e=.5>b?b*(1+c):b+c-b*c,g=2*b-e;b=d(g,e,a+1/3);c=d(g,e,a);a=d(g,e,a-1/3)}return"rgb("+Math.round(255*b)+","+Math.round(255*c)+","+Math.round(255*a)+")"}for(var b=[],c=0;50>c;++c){var d=a((280-5.6*(c+1))/360,.5,1);b.push(d)}return new f.ColorPalette(b)};f.Painter.CreateGrayPalette=function(){for(var a=[],b=0;50>b;++b){var c=
Math.round((b+2)/60*255);a.push("rgb("+c+","+c+","+c+")")}return new f.ColorPalette(a)};f.Painter.CreateGradientColorTable=function(a,b,c,d,e,g){g=[];for(var l=1;l<a.length;l++)for(var h=parseInt(Math.floor(e*a[l])-Math.floor(e*a[l-1])),r=0;r<h;r++)g.push("rgb("+(Math.round(b[l-1]+r*(b[l]-b[l-1])/h)+","+Math.round(c[l-1]+r*(c[l]-c[l-1])/h)+","+Math.round(d[l-1]+r*(d[l]-d[l-1])/h))+")");return new f.ColorPalette(g)};f.Painter.GetColorPalette=function(a,b){a=a||f.gStyle.Palette;if(0<a&&10>a)return f.Painter.CreateGrayPalette();
if(51>a)return f.Painter.CreateDefaultPalette();113<a&&(a=57);switch(a){case 51:a=[0,9,13,17,24,32,27,25,29];var c=[0,0,0,2,37,74,113,160,221];var d=[28,42,59,78,98,129,154,184,221];break;case 52:a=[0,32,64,96,128,160,192,224,255];c=[0,32,64,96,128,160,192,224,255];d=[0,32,64,96,128,160,192,224,255];break;case 53:a=[0,45,99,156,212,230,237,234,242];c=[0,0,0,45,101,168,238,238,243];d=[0,1,1,3,9,8,11,95,230];break;case 54:a=[0,22,44,68,93,124,160,192,237];c=[0,16,41,67,93,125,162,194,241];d=[97,100,
99,99,93,68,44,26,74];break;case 55:a=[0,5,15,35,102,196,208,199,110];c=[0,48,124,192,206,226,97,16,0];d=[99,142,198,201,90,22,13,8,2];break;case 56:a=[242,234,237,230,212,156,99,45,0];c=[243,238,238,168,101,45,0,0,0];d=[230,95,11,8,9,3,1,1,0];break;case 57:a=[53.091,15.096,19.89,.0232*255,45.951,135.1755,208.743,.9956*255,248.982];c=[.1664*255,91.7745,128.5455,163.6845,183.039,191.046,186.864,200.481,.9832*255];d=[134.9715,.8684*255,213.8175,201.807,.6425*255,118.881,.3499*255,50.184,13.7445];break;
case 58:a=[0,24.378,2.499,54.162,.6905*255,235.671,201.807,193.698,255];c=[0,29.2485,92.208,128.5455,116.7135,119.6205,.6905*255,235.5435,255];d=[0,68.0595,79.5855,33.609,57.018,171.8955,.9882*255,244.6215,255];break;case 59:a=[13,23,25,63,76,104,137,161,206];c=[95,67,37,21,0,12,35,52,79];d=[4,3,2,6,11,22,49,98,208];break;case 60:a=[0,61,89,122,143,160,185,204,231];c=[0,0,0,0,14,37,72,132,235];d=[0,140,224,144,4,5,6,9,13];break;case 61:a=[14,7,2,0,5,11,55,131,229];c=[105,56,26,1,42,74,131,171,229];
d=[2,21,35,60,92,113,160,185,229];break;case 62:a=[0,0,0,70,148,231,235,237,244];c=[0,0,0,0,0,69,67,216,244];d=[0,102,228,231,177,124,137,20,244];break;case 63:a=[50,56,63,68,93,121,165,192,241];c=[66,81,91,96,111,128,155,189,241];d=[97,91,75,65,77,103,143,167,217];break;case 64:a=[145,166,167,156,131,114,101,112,132];c=[158,178,179,181,163,154,144,152,159];d=[190,199,201,192,176,169,160,166,190];break;case 65:a=[93,91,99,108,130,125,132,155,174];c=[126,124,128,129,131,121,119,153,173];d=[103,94,
87,85,80,85,107,120,146];break;case 66:a=[24,40,69,90,104,114,120,132,103];c=[29,52,94,127,150,162,159,151,101];d=[29,52,96,132,162,181,184,186,131];break;case 67:a=[46,38,61,92,113,121,132,150,191];c=[46,36,40,69,110,135,131,92,34];d=[46,80,74,70,81,105,165,211,225];break;case 68:a=[0,4,12,30,52,101,142,190,237];c=[0,40,86,121,140,172,187,213,240];d=[0,9,14,18,21,23,27,35,101];break;case 69:a=[198,206,206,211,198,181,161,171,244];c=[103,133,150,172,178,174,163,175,244];d=[49,54,55,66,91,130,184,
224,244];break;case 70:a=[243,243,240,240,241,239,186,151,129];c=[0,46,99,149,194,220,183,166,147];d=[6,8,36,91,169,235,246,240,233];break;case 71:a=[22,19,19,25,35,53,88,139,210];c=[0,32,69,108,135,159,183,198,215];d=[77,96,110,116,110,100,90,78,70];break;case 72:a=[68,116,165,182,189,180,145,111,71];c=[37,82,135,178,204,225,221,202,147];d=[16,55,105,147,196,226,232,224,178];break;case 73:a=[61,99,136,181,213,225,198,136,24];c=[149,140,96,83,132,178,190,135,22];d=[214,203,168,135,110,100,111,113,
22];break;case 74:a=[76,120,156,183,197,180,162,154,140];c=[34,35,42,69,102,137,164,188,197];d=[64,69,78,105,142,177,205,217,198];break;case 75:a=[37,102,157,188,196,214,223,235,251];c=[37,29,25,37,67,91,132,185,251];d=[37,32,33,45,66,98,137,187,251];break;case 76:a=[79,100,119,137,153,172,192,205,250];c=[63,79,93,103,115,135,167,196,250];d=[51,59,66,61,62,70,110,160,250];break;case 77:a=[43,44,50,66,125,172,178,155,157];c=[63,63,85,101,138,163,122,51,39];d=[121,101,58,44,47,55,57,44,43];break;case 78:a=
[0,41,62,79,90,87,99,140,228];c=[0,57,81,93,85,70,71,125,228];d=[95,91,91,82,60,43,44,112,228];break;case 79:a=[49,59,72,88,114,141,176,205,222];c=[78,72,66,57,59,75,106,142,173];d=[78,55,46,40,39,39,40,41,47];break;case 80:a=[243,222,201,185,165,158,166,187,219];c=[94,108,132,135,125,96,68,51,61];d=[7,9,12,19,45,89,118,146,118];break;case 81:a=[19,44,74,105,137,166,194,206,220];c=[19,28,40,55,82,110,159,181,220];d=[19,42,68,96,129,157,188,203,220];break;case 82:a=[33,44,70,99,140,165,199,211,216];
c=[38,50,76,105,140,165,191,189,167];d=[55,67,97,124,140,166,163,129,52];break;case 83:a=[0,33,73,124,136,152,159,171,223];c=[0,43,92,124,134,126,121,144,223];d=[0,43,68,76,73,64,72,114,223];break;case 84:a=[5,18,45,124,193,223,205,128,49];c=[48,134,207,230,193,113,28,0,7];d=[6,15,41,121,193,226,208,130,49];break;case 85:a=[180,106,104,135,164,188,189,165,144];c=[72,126,154,184,198,207,205,190,179];d=[41,120,158,188,194,181,145,100,62];break;case 86:a=[57,72,94,117,136,154,174,192,215];c=[0,33,68,
109,140,171,192,196,209];d=[116,137,173,201,200,201,203,190,187];break;case 87:a=[31,71,123,160,210,222,214,199,183];c=[40,117,171,211,231,220,190,132,65];d=[234,214,228,222,210,160,105,60,34];break;case 88:a=[123,108,109,126,154,172,188,196,218];c=[184,138,130,133,154,175,188,196,218];d=[208,130,109,99,110,122,150,171,218];break;case 89:a=[105,106,122,143,159,172,176,181,207];c=[252,197,194,187,174,162,153,136,125];d=[146,133,144,155,163,167,166,162,174];break;case 90:a=[171,141,145,152,154,159,
163,158,177];c=[236,143,100,63,53,55,44,31,6];d=[59,48,46,44,42,54,82,112,179];break;case 91:a=[180,190,209,223,204,228,205,152,91];c=[93,125,147,172,181,224,233,198,158];d=[236,218,160,133,114,132,162,220,218];break;case 92:a=[225,183,162,135,115,111,119,145,211];c=[205,177,166,135,124,117,117,132,172];d=[186,165,155,135,126,130,150,178,226];break;case 93:a=[39,43,59,63,80,116,153,177,223];c=[39,43,59,74,91,114,139,165,223];d=[39,50,59,70,85,115,151,176,223];break;case 94:a=[0,38,60,76,84,89,101,
128,204];c=[0,10,15,23,35,57,83,123,199];d=[0,11,22,40,63,86,97,94,85];break;case 95:a=[94,112,141,165,167,140,91,49,27];c=[27,46,88,135,166,161,135,97,58];d=[42,52,81,106,139,158,155,137,116];break;case 96:a=[30,49,79,117,135,151,146,138,147];c=[63,60,72,90,94,94,68,46,16];d=[18,28,41,56,62,63,50,36,21];break;case 97:a=[0,30,63,101,143,152,169,187,230];c=[0,14,28,42,58,61,67,74,91];d=[39,26,21,18,15,14,14,13,13];break;case 98:a=[149,140,164,179,182,181,131,87,61];c=[62,70,107,136,144,138,117,87,
74];d=[40,38,45,49,49,49,38,32,34];break;case 99:a=[99,112,148,165,179,182,183,183,208];c=[39,40,57,79,104,127,148,161,198];d=[15,16,18,33,51,79,103,129,177];break;case 100:a=[99,116,154,174,200,196,201,201,230];c=[0,0,8,32,58,83,119,136,173];d=[5,6,7,9,9,14,17,19,24];break;case 101:a=[82,106,126,141,155,163,142,107,66];c=[62,44,69,107,135,152,149,132,119];d=[39,25,31,60,73,68,49,72,188];break;case 102:a=[18,29,44,72,116,158,184,208,221];c=[27,46,71,105,146,177,189,190,183];d=[39,55,80,108,130,133,
124,100,76];break;case 103:a=[0,48,119,173,212,224,228,228,245];c=[0,13,30,47,79,127,167,205,245];d=[0,68,75,43,16,22,55,128,245];break;case 104:a=[34,70,129,187,225,226,216,193,179];c=[48,91,147,194,226,229,196,110,12];d=[234,212,216,224,206,110,53,40,29];break;case 105:a=[30,55,103,147,174,203,188,151,105];c=[0,65,138,182,187,175,121,53,9];d=[191,202,212,208,171,140,97,57,30];break;case 106:a=[112,97,113,125,138,159,178,188,225];c=[16,17,24,37,56,81,110,136,189];d=[38,35,46,59,78,103,130,152,201];
break;case 107:a=[18,72,5,23,29,201,200,98,29];c=[0,0,43,167,211,117,0,0,0];d=[51,203,177,26,10,9,8,3,0];break;case 108:a=[19,42,64,88,118,147,175,187,205];c=[19,55,89,125,154,169,161,129,70];d=[19,32,47,70,100,128,145,130,75];break;case 109:a=[33,31,42,68,86,111,141,172,227];c=[255,175,145,106,88,55,15,0,0];d=[255,205,202,203,208,205,203,206,231];break;case 110:a=[0,25,50,79,110,145,181,201,254];c=[0,16,30,46,63,82,101,124,179];d=[0,12,21,29,39,49,61,74,103];break;case 111:a=[0,13,30,44,72,120,156,
200,247];c=[0,36,84,117,141,153,151,158,247];d=[0,94,100,82,56,66,76,131,247];break;case 112:a=[26,51,43,33,28,35,74,144,246];c=[9,24,55,87,118,150,180,200,222];d=[30,96,112,114,112,101,72,35,0];break;case 113:a=[0,5,65,97,124,156,189,224,255];c=[32,54,77,100,123,148,175,203,234];d=[77,110,107,111,120,119,111,94,70];break;default:return f.Painter.CreateDefaultPalette()}return f.Painter.CreateGradientColorTable([0,.125,.25,.375,.5,.625,.75,.875,1],a,c,d,255,b)};A.prototype=Object.create(f.TObjectPainter.prototype);
A.prototype.AssignFinishPave=function(){this.FinishPave=function(){0>=this.FirstRun||(this.FirstRun--,0===this.FirstRun&&(delete this.FinishPave,this.DrawingReady()))}.bind(this)};A.prototype.DrawPave=function(a){this.UseTextColor=!1;if(!this.Enabled)return this.RemoveDrawG();var b=this.GetObject(),c=b.fOption.toUpperCase();if(0===b.fInit){this.stored=f.extend({},b);b.fInit=1;var d=this.root_pad();if("TPaletteAxis"!=b._typename||b.fX1||b.fX2||b.fY1||b.fY2)0<=c.indexOf("NDC")?(b.fX1NDC=b.fX1,b.fX2NDC=
b.fX2,b.fY1NDC=b.fY1,b.fY2NDC=b.fY2):d?(d.fLogx&&(0<b.fX1&&(b.fX1=f.log10(b.fX1)),0<b.fX2&&(b.fX2=f.log10(b.fX2))),d.fLogy&&(0<b.fY1&&(b.fY1=f.log10(b.fY1)),0<b.fY2&&(b.fY2=f.log10(b.fY2))),b.fX1NDC=(b.fX1-d.fX1)/(d.fX2-d.fX1),b.fY1NDC=(b.fY1-d.fY1)/(d.fY2-d.fY1),b.fX2NDC=(b.fX2-d.fX1)/(d.fX2-d.fX1),b.fY2NDC=(b.fY2-d.fY1)/(d.fY2-d.fY1)):(b.fX1NDC=b.fY1NDC=.1,b.fX2NDC=b.fY2NDC=.9);else{var e=this.frame_painter();e?(b.fX1NDC=e.fX2NDC+.01,b.fX2NDC=Math.min(.96,e.fX2NDC+.06),b.fY1NDC=e.fY1NDC,b.fY2NDC=
e.fY2NDC):(b.fX2NDC=.8,b.fX1NDC=.9,b.fY1NDC=.1,b.fY2NDC=.9)}b.fX1NDC==b.fX2NDC&&b.fY1NDC==b.fY2NDC&&"TLegend"==b._typename&&(b.fX1NDC=Math.max(d?d.fLeftMargin:0,b.fX2NDC-.3),b.fX2NDC=Math.min(b.fX1NDC+.3,d?1-d.fRightMargin:1),e=Math.max(b.fPrimitives?.05*b.fPrimitives.arr.length:0,.2),b.fY2NDC=Math.min(d?1-d.fTopMargin:1,b.fY1NDC+e),b.fY1NDC=Math.max(b.fY2NDC-e,d?d.fBottomMargin:0))}var g=Math.round(b.fX1NDC*this.pad_width()),l=Math.round((1-b.fY2NDC)*this.pad_height());d=Math.round((b.fX2NDC-b.fX1NDC)*
this.pad_width());e=Math.round((b.fY2NDC-b.fY1NDC)*this.pad_height());var h=b.fBorderSize,r=0<=c.indexOf("L")?-1:0<=c.indexOf("R")?1:0;c=0<=c.indexOf("T")?-1:0<=c.indexOf("B")?1:0;this.CreateG();this.draw_g.attr("transform","translate("+g+","+l+")");this.createAttLine({attr:b,width:0<h?b.fLineWidth:0});this.createAttFill({attr:b});if("TDiamond"==b._typename){g=Math.round(e/2);l=Math.round(d/2);var m="l"+l+",-"+g+"l"+l+","+g+"l-"+l+","+g+"z";1<h&&0<b.fShadowColor&&(r||c)&&!this.fillatt.empty()&&this.draw_g.append("svg:path").attr("d",
"M0,"+(g+h)+m).style("fill",this.get_color(b.fShadowColor)).style("stroke",this.get_color(b.fShadowColor)).style("stroke-width","1px");this.draw_g.append("svg:path").attr("d","M0,"+g+m).call(this.fillatt.func).call(this.lineatt.func);b=this.draw_g.append("svg:g").attr("transform","translate("+Math.round(d/4)+","+Math.round(e/4)+")");this.DrawPaveText(l,g,a,b)}else{1<h&&0<b.fShadowColor&&!b.fNpaves&&(r||c)&&(m=this.get_color(b.fShadowColor),h=this.fillatt.empty()?0>r&&0>c?"M0,0v"+(e-h)+"h-"+h+"v-"+
e+"h"+d+"v"+h:"M0,"+e+"v-"+(e-h)+"h-"+h+"v"+e+"h"+d+"v-"+h:"M"+r*h+","+c*h+"v"+e+"h"+d+"v-"+e,this.draw_g.append("svg:path").attr("d",h+"z").style("fill",m).style("stroke",m).style("stroke-width","1px"));if(b.fNpaves)for(h=b.fNpaves-1;0<h;--h)this.draw_g.append("svg:path").attr("d","M"+4*r*h+","+4*c*h+"h"+d+"v"+e+"h-"+d+"z").call(this.fillatt.func).call(this.lineatt.func);r=this.draw_g.append("svg:path").attr("d","M0,0h"+d+"v"+e+"h-"+d+"z").call(this.fillatt.func).call(this.lineatt.func);"PaveDrawFunc"in
this&&this.PaveDrawFunc(d,e,a);if(!f.BatchMode&&"TPave"!=b._typename&&(r.style("pointer-events","visibleFill").on("mouseenter",this.ShowObjectStatus.bind(this)),this.draw_g.attr("x",g).attr("y",l).attr("width",d).attr("height",e),this.AddDrag({obj:b,minwidth:10,minheight:20,canselect:!0,redraw:this.DragRedraw.bind(this),ctxmenu:f.touches&&f.gStyle.ContextMenu&&this.UseContextMenu}),this.UseContextMenu&&f.gStyle.ContextMenu))this.draw_g.on("contextmenu",this.ShowContextMenu.bind(this))}};A.prototype.DragRedraw=
function(){this.InteractiveRedraw(!1,"pave_moved");this.DrawPave()};A.prototype.FillWebObjectOptions=function(a){if(!a){if(!this.snapid)return null;a={_typename:"TWebObjectOptions",snapid:this.snapid.toString(),opt:this.OptionsAsString(),fcust:"",fopt:[]}}var b=this.GetObject();b&&b.fInit&&(a.fcust="pave",a.fopt=[b.fX1NDC,b.fY1NDC,b.fX2NDC,b.fY2NDC]);return a};A.prototype.DrawPaveLabel=function(a,b){this.UseTextColor=!0;var c=this.GetObject();this.StartTextDrawing(c.fTextFont,b/1.2);this.DrawText({align:c.fTextAlign,
width:a,height:b,text:c.fLabel,color:this.get_color(c.fTextColor)});this.FinishTextDrawing(null,this.FinishPave)};A.prototype.DrawPaveStats=function(a,b){this.IsStats()&&this.FillStatistic();for(var c=this.GetObject(),d=[],e=this.get_color(c.fTextColor),g=0,l=0,h=0,f=0;f<c.fLines.arr.length;++f){var m=c.fLines.arr[f];"TText"!=m._typename&&"TLatex"!=m._typename||d.push(m.fTitle)}m=d.length;for(f=0;f<m;++f){var k=d[f];0<f&&(h=Math.max(h,k.length));if(!(0==f||0>k.indexOf("|"))){0===g&&(g=f);var p=k.split("|");
p.length>l&&(l=p.length)}}k=b/m;var n=!1,q=c.fMargin*a;this.StartTextDrawing(c.fTextFont,b/(1.2*m));this.UseTextColor=!0;if(1==m)this.DrawText({align:c.fTextAlign,width:a,height:b,text:d[0],color:e,latex:1});else for(f=0;f<m;++f){var u=f*k,t=e;this.UseTextColor=!0;if(g&&f>=g){p=d[f].split("|");for(var x=0;x<p.length;++x)this.DrawText({align:"middle",x:a*x/l,y:u,latex:0,width:a/l,height:k,text:p[x],color:t})}else if(0>d[f].indexOf("="))0==f&&(n=!0,d[f].length>h+5&&(d[f]=d[f].substr(0,h+2)+"...")),
this.DrawText({align:0==f?"middle":"start",x:q,y:u,width:a-2*q,height:k,text:d[f],color:t});else{p=d[f].split("=");var w=0;for(x=0;2>x;++x)w+=this.DrawText({align:0==x?"start":"end",x:q,y:u,width:a-2*q,height:k,text:p[x],color:t});this.TextScaleFactor(1.05*w/(a-2*q),this.draw_g)}}d="";0<c.fBorderSize&&n&&(d+="M0,"+Math.round(k)+"h"+a);if(0<g&&1<l){for(c=g;c<m;++c)d+="M0,"+Math.round(c*k)+"h"+a;for(c=0;c<l-1;++c)d+="M"+Math.round(a/l*(c+1))+","+Math.round(g*k)+"V"+b}d&&this.draw_g.append("svg:path").attr("d",
d).call(this.lineatt.func);this.FinishTextDrawing(void 0,this.FinishPave);this.draw_g.classed("most_upper_primitives",!0)};A.prototype.DrawPaveText=function(a,b,c,d){c=this.GetObject();var e=this.get_color(c.fTextColor),g=0,l=[],h=this.pad_height(),r=this.pad_painter(),m=!1,k=0<c.fLabel.length;k&&this.FirstRun++;d||(d=this.draw_g);for(var p=0;p<c.fLines.arr.length;++p){var n=c.fLines.arr[p];if("TText"==n._typename||"TLatex"==n._typename)if(g++,0<n.fX||0<n.fY)m=!0}r=1==g&&r&&r._fast_drawing;var q=
0;for(p=0;p<c.fLines.arr.length;++p){n=c.fLines.arr[p];var u=0<g?Math.round((1-(q-.5)/g)*b):0;switch(n._typename){case "TText":case "TLatex":q++;if(m){var t=n.fX,x=n.fY;t=0<t&&1>t?Math.round(t*a):c.fMargin*a;x=0<x&&1>x?Math.round((1-x)*b):u;u=n.fTextColor?this.get_color(n.fTextColor):"";u||(u=e,this.UseTextColor=!0);this.StartTextDrawing(c.fTextFont,(n.fTextSize||c.fTextSize)*h,d);this.DrawText({align:n.fTextAlign||c.fTextAlign,x:t,y:x,text:n.fTitle,color:u,latex:"TText"==n._typename?0:1,draw_g:d,
fast:r});this.FinishTextDrawing(d,this.FinishPave);this.FirstRun++}else l.push(n);break;case "TLine":case "TBox":t=n.fX1;x=n.fX2;var w=n.fY1,v=n.fY2;0!==t&&(t=Math.round(t*a));x=x?Math.round(x*a):a;w=w?Math.round((1-w)*b):u;v=v?Math.round((1-v)*b):u;"TLine"==n._typename?(n=new f.TAttLineHandler(n),d.append("svg:line").attr("x1",t).attr("y1",w).attr("x2",x).attr("y2",v).call(n.func)):(n=this.createAttFill(n),d.append("svg:rect").attr("x",t).attr("y",v).attr("width",x-t).attr("height",w-v).call(n.func))}}if(m)this.FinishPave&&
this.FinishPave();else{m=b/g;q=c.fMargin*a;p=0;1==g&&0<c.fTextSize&&(p=Math.round(c.fTextSize*h),3>p&&(p=3));this.StartTextDrawing(c.fTextFont,b/(1.2*g),d,p);for(p=0;p<g;++p)u=l[p],1==g?n={x:0,y:0,width:a,height:b}:(n={x:q,y:p*m,width:a-2*q,height:m},u.fTextColor&&(n.color=this.get_color(u.fTextColor)),u.fTextSize&&(n.font_size=Math.round(u.fTextSize*h))),n.align=c.fTextAlign,n.draw_g=d,n.latex="TText"==u._typename?0:1,n.text=u.fTitle,n.fast=r,n.color||(this.UseTextColor=!0,n.color=e),this.DrawText(n);
this.FinishTextDrawing(d,this.FinishPave)}k&&(g=Math.round(.25*a),l=Math.round(.02*-b),a=Math.round(.5*a),b=Math.round(.04*b),d=d.append("svg:g"),d.append("svg:path").attr("d","M"+g+","+l+"h"+a+"v"+b+"h-"+a+"z").call(this.fillatt.func).call(this.lineatt.func),this.StartTextDrawing(c.fTextFont,b/1.5,d),this.DrawText({align:22,x:g,y:l,width:a,height:b,text:c.fLabel,color:e,draw_g:d}),this.FinishTextDrawing(d,this.FinishPave),this.UseTextColor=!0)};A.prototype.Format=function(a,b){b||(b="stat");var c=
this.GetObject();switch(b){case "stat":b=c.fStatFormat||f.gStyle.fStatFormat;break;case "fit":b=c.fFitFormat||f.gStyle.fFitFormat;break;case "entries":if(1E9>Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);b="14.7g";break;case "last":b=this.lastformat}delete this.lastformat;a=f.FFormat(a,b||"6.4g");this.lastformat=f.lastFFormat;return a};A.prototype.DrawPaveLegend=function(a,b){function c(a){return!a.fObject&&!a.fOption&&(!a.fLabel||" "==a.fLabel)}var d=this.GetObject(),e=d.fPrimitives.arr.length,
g=d.fNColumns,l=e;if(2>g)g=1;else for(;(l-1)*g>=e;)l--;if(1==g)for(var h=0;h<e;++h)c(d.fPrimitives.arr[h])&&l--;1>l&&(l=1);var r=this.get_color(d.fTextColor),m=Math.round(a/g);a=Math.round(.03*a/g);var k=Math.round(.03*b);b=(b-2*k)/l;var p=.9*b,n=0,q=this.pad_height();l=!1;h=-1;d.fTextSize&&2<q*d.fTextSize&&q*d.fTextSize<p&&(p=n=Math.round(q*d.fTextSize));this.StartTextDrawing(d.fTextFont,p,this.draw_g,n);for(p=0;p<e;++p)if(n=d.fPrimitives.arr[p],!c(n)){1==g?++h:h=p;q=n.fOption.toLowerCase();var u=
h%g,t=(h-u)/g;u*=m;var x=u+Math.round(d.fMargin*m),w=Math.round(k+t*b);t=Math.round(k+(t+.5)*b);var v=n,z=n,y=n,J=n.fObject,E=null,D=!1;null!==J&&"object"==typeof J&&("fLineColor"in J&&(y=J),"fFillColor"in J&&(v=J),"fMarkerColor"in J&&(z=J),E=this.FindPainterFor(J));-1!=q.indexOf("f")&&(v=E&&E.fillatt?E.fillatt:this.createAttFill(v),this.draw_g.append("svg:rect").attr("x",u+a).attr("y",Math.round(w+.1*b)).attr("width",x-2*a-u).attr("height",Math.round(.8*b)).call(v.func),v.empty()||(D=!0));-1!=q.indexOf("l")&&
(y=E&&E.lineatt?E.lineatt:new f.TAttLineHandler(y),this.draw_g.append("svg:line").attr("x1",u+a).attr("y1",t).attr("x2",x-a).attr("y2",t).call(y.func),"none"!==y.color&&(D=!0));-1==q.indexOf("e")||-1!=q.indexOf("l")&&q.indexOf("f");-1!=q.indexOf("p")&&(z=E&&E.markeratt?E.markeratt:new f.TAttMarkerHandler(z),this.draw_g.append("svg:path").attr("d",z.create((u+x)/2,t)).call(z.func),"none"!==z.color&&(D=!0));!D&&E&&E.lineatt&&"none"!==E.lineatt.color&&this.draw_g.append("svg:rect").attr("x",u+a).attr("y",
Math.round(w+.1*b)).attr("width",x-2*a-u).attr("height",Math.round(.8*b)).attr("fill","none").call(E.lineatt.func);0<q.length?l=!0:l||(x=u+a);n.fLabel&&this.DrawText({align:"start",x:x,y:w,width:u+m-x-a,height:b,text:n.fLabel,color:r})}this.FinishTextDrawing(this.draw_g,this.FinishPave)};A.prototype.DrawPaletteAxis=function(a,b,c){function d(){if(E){B.event.preventDefault();var a=B.mouse(J);a[1]<D?D=a[1]:C=a[1];A.attr("y",D).attr("height",Math.abs(C-D))}}function e(){if(E){B.event.preventDefault();
B.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);A.remove();A=null;E=!1;var a=Math.min(z.invert(D),z.invert(C)),b=Math.max(z.invert(D),z.invert(C));l.frame_painter().Zoom("z",a,b)}}function g(){E||(E=!0,B.event.preventDefault(),J=this,D=C=B.mouse(J)[1],A=l.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",a).attr("y",D).attr("height",5),B.select(window).on("mousemove.colzoomRect",d).on("mouseup.colzoomRect",e,!0),B.event.stopPropagation())}
var l=this,h=this.GetObject(),r=h.fAxis,m="string"==typeof c&&0<c.indexOf("can_move"),k="string"==typeof c&&0<c.indexOf("postpone"),p=r.fNdiv%100;c=parseInt(this.draw_g.attr("x"));var n=parseInt(this.draw_g.attr("y")),q=this.pad_width();this.pad_height();var u=this.main_painter(),t=this.frame_painter(),x=0,w=100,v=u.fContour;0>=p&&(p=8);r.fTickSize=.6*a/q;v&&t?(x=Math.min(v[0],t.zmin),w=Math.max(v[v.length-1],t.zmax)):void 0!==u.gmaxbin&&void 0!==u.gminbin?(x=u.gminbin,w=u.gmaxbin):void 0!==u.hmin&&
void 0!==u.hmax&&(x=u.hmin,w=u.hmax);var z=null;r="normal";this.root_pad().fLogz?(z=B.scaleLog(),r="log"):z=B.scaleLinear();z.domain([x,w]).range([b,0]);this.draw_g.selectAll("rect").style("fill","white");if(!v||k)this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",a).attr("height",b).style("fill","white");else for(k=0;k<v.length-1;++k){p=z(v[k]);t=z(v[k+1]);var y=u.getContourColor((v[k]+v[k+1])/2);p=this.draw_g.append("svg:rect").attr("x",0).attr("y",Math.round(t)).attr("width",a).attr("height",
Math.round(p)-Math.round(t)).style("fill",y).style("stroke",y).property("fill0",y).property("fill1",B.rgb(y).darker(.5).toString());this.IsTooltipAllowed()&&p.on("mouseover",function(){B.select(this).transition().duration(100).style("fill",B.select(this).property("fill1"))}).on("mouseout",function(){B.select(this).transition().duration(100).style("fill",B.select(this).property("fill0"))}).append("svg:title").text(v[k].toFixed(2)+" - "+v[k+1].toFixed(2));if(f.gStyle.Zooming)p.on("dblclick",function(){l.frame_painter().Unzoom("z")})}this.z_handle.SetAxisConfig("zaxis",
r,z,x,w,x,w);this.z_handle.max_tick_size=Math.round(.7*a);this.z_handle.DrawAxis(!0,this.draw_g,a,b,"translate("+a+", 0)");m&&"getBoundingClientRect"in this.draw_g.node()&&(b=this.draw_g.node().getBoundingClientRect(),b=c+parseInt(b.width)-Math.round(.995*q)+3,0<b&&(this.draw_g.attr("x",c-b).attr("y",n).attr("transform","translate("+(c-b)+", "+n+")"),h.fX1NDC-=b/q,h.fX2NDC-=b/q));var J=null,E=!1,D=0,C=0,A=null;if(f.gStyle.Zooming)this.draw_g.select(".axis_zoom").on("mousedown",g).on("dblclick",function(){l.frame_painter().Unzoom("z")});
this.FinishPave&&this.FinishPave()};A.prototype.FillContextMenu=function(a){var b=this.GetObject();a.add("header: "+b._typename+"::"+b.fName);if(this.IsStats()){var c=function(c,e){var d=10>c?b.fOptStat:b.fOptFit;d=parseInt(parseInt(d)/parseInt(Math.pow(10,c%10)))%10;a.addchk(d,e,100*d+c,function(a){var c=10>a%100?b.fOptStat:b.fOptFit,d=parseInt(a/100);c-=(0<d?d:-1)*parseInt(Math.pow(10,a%10));10>a%100?(b.fOptStat=c,this.InteractiveRedraw(!0,"exec:SetOptStat("+c+")")):(b.fOptFit=c,this.InteractiveRedraw(!0,
"exec:SetOptFit("+c+")"))})};a.add("Default position",function(){b.fX2NDC=f.gStyle.fStatX;b.fX1NDC=b.fX2NDC-f.gStyle.fStatW;b.fY2NDC=f.gStyle.fStatY;b.fY1NDC=b.fY2NDC-f.gStyle.fStatH;b.fInit=1;this.InteractiveRedraw(!0,"pave_moved")});a.add("SetStatFormat",function(){var a=prompt("Enter StatFormat",b.fStatFormat);a&&(b.fStatFormat=a,this.InteractiveRedraw(!0,'exec:SetStatFormat("'+a+'")'))});a.add("SetFitFormat",function(){var a=prompt("Enter FitFormat",b.fFitFormat);a&&(b.fFitFormat=a,this.InteractiveRedraw(!0,
'exec:SetFitFormat("'+a+'")'))});a.add("separator");a.add("sub:SetOptStat",function(){var a=prompt("Enter OptStat",b.fOptStat);a&&(a=parseInt(a),!isNaN(a)&&0<=a&&(b.fOptStat=parseInt(a),this.InteractiveRedraw(!0,"exec:SetOptStat("+a+")")))});c(0,"Histogram name");c(1,"Entries");c(2,"Mean");c(3,"Std Dev");c(4,"Underflow");c(5,"Overflow");c(6,"Integral");c(7,"Skewness");c(8,"Kurtosis");a.add("endsub:");a.add("sub:SetOptFit",function(){var a=prompt("Enter OptStat",b.fOptFit);a&&(a=parseInt(a),!isNaN(a)&&
0<=a&&(b.fOptFit=a,this.InteractiveRedraw(!0,"exec:SetOptFit("+a+")")))});c(10,"Fit parameters");c(11,"Par errors");c(12,"Chi square / NDF");c(13,"Probability");a.add("endsub:");a.add("separator")}else"title"===b.fName&&a.add("Default position",function(){b.fX1NDC=.28;b.fY1NDC=.94;b.fX2NDC=.72;b.fY2NDC=.99;b.fInit=1;this.InteractiveRedraw(!0,"pave_moved")});this.UseTextColor&&this.TextAttContextMenu(a);this.FillAttContextMenu(a);return 0<a.size()};A.prototype.ShowContextMenu=function(a){if(this.z_handle)return this.frame_painter().ShowContextMenu("z",
a,this.GetObject().fAxis);a||(B.event.stopPropagation(),B.event.preventDefault(),a=B.event);this.ctx_menu_evnt=a;f.Painter.createMenu(this,function(a){a.painter.FillContextMenu(a);a.painter.FillObjectExecMenu(a,"title",function(){a.show(a.painter.ctx_menu_evnt)})})};A.prototype.IsStats=function(){return this.MatchObjectType("TPaveStats")};A.prototype.ClearPave=function(){this.GetObject().Clear()};A.prototype.AddText=function(a){this.GetObject().AddText(a)};A.prototype.FillFunctionStat=function(a,
b){if(!b||!a)return!1;var c=b%10,d=Math.floor(b/10)%10,e=Math.floor(b/1E3)%10;0<Math.floor(b/100)%10&&this.AddText("#chi^2 / ndf = "+this.Format(a.fChisquare,"fit")+" / "+a.fNDF);0<e&&this.AddText("Prob = "+("Math"in f?this.Format(f.Math.Prob(a.fChisquare,a.fNDF)):"<not avail>"));if(0<c)for(b=0;b<a.GetNumPars();++b){c=a.GetParName(b);e=a.GetParValue(b);var g=a.GetParError(b);e=void 0===e?"<not avail>":this.Format(Number(e),"fit");void 0!==g&&(g=this.Format(g,"last"),0===Number(g)&&0!=a.GetParError(b)&&
(g=this.Format(a.GetParError(b),"4.2g")));0<d&&g?this.AddText(c+" = "+e+" #pm "+g):this.AddText(c+" = "+e)}return!0};A.prototype.FillStatistic=function(){var a=this.pad_painter();if(a&&a._fast_drawing)return!1;a=this.GetObject();var b=a.$main_painter||this.main_painter();if("stats"!==a.fName||!b||"function"!==typeof b.FillStatistic)return!1;var c=parseInt(a.fOptStat),d=parseInt(a.fOptFit);isNaN(c)&&(c=f.gStyle.fOptStat);isNaN(d)&&(d=f.gStyle.fOptFit);if(!b.FillStatistic(this,c,d))return!1;b=a.fLines.arr.length;
c=b*f.gStyle.StatFontSize;if(0>=c||3===f.gStyle.StatFont%10)c=.25*b*f.gStyle.StatH,a.fY1NDC=a.fY2NDC-c;return!0};A.prototype.IsDummyPos=function(a){return a?!a.fInit&&!a.fX1&&!a.fX2&&!a.fY1&&!a.fY2&&!a.fX1NDC&&!a.fX2NDC&&!a.fY1NDC&&!a.fY2NDC:!0};A.prototype.UpdateObject=function(a){if(!this.MatchObjectType(a))return!1;var b=this.GetObject();b.modified_NDC||this.IsDummyPos(a)||(this.stored&&!a.fInit&&this.stored.fX1==a.fX1&&this.stored.fX2==a.fX2&&this.stored.fY1==a.fY1&&this.stored.fY2==a.fY2?(this.stored.fX1NDC!=
a.fX1NDC&&(b.fX1NDC=a.fX1NDC),this.stored.fX2NDC!=a.fX2NDC&&(b.fX2NDC=a.fX2NDC),this.stored.fY1NDC!=a.fY1NDC&&(b.fY1NDC=a.fY1NDC),this.stored.fY2NDC!=a.fY2NDC&&(b.fY2NDC=a.fY2NDC)):(b.fInit=a.fInit,b.fX1=a.fX1,b.fX2=a.fX2,b.fY1=a.fY1,b.fY2=a.fY2,b.fX1NDC=a.fX1NDC,b.fX2NDC=a.fX2NDC,b.fY1NDC=a.fY1NDC,b.fY2NDC=a.fY2NDC),this.stored=f.extend({},a));b.fOption=a.fOption;b.fBorderSize=a.fBorderSize;switch(a._typename){case "TPaveText":return b.fLines=f.clone(a.fLines),!0;case "TPavesText":return b.fLines=
f.clone(a.fLines),b.fNpaves=a.fNpaves,!0;case "TPaveLabel":return b.fLabel=a.fLabel,!0;case "TPaveStats":return b.fOptStat=a.fOptStat,b.fOptFit=a.fOptFit,!0;case "TLegend":var c=b.fPrimitives;b.fPrimitives=a.fPrimitives;b.fNColumns=a.fNColumns;if(c&&c.arr&&b.fPrimitives&&b.fPrimitives.arr&&c.arr.length==b.fPrimitives.arr.length)for(a=0;a<c.arr.length;++a){var d=c.arr[a].fObject,e=b.fPrimitives.arr[a].fObject;d&&e&&d._typename==e._typename&&d.fName==e.fName&&(b.fPrimitives.arr[a].fObject=d)}return!0;
case "TPaletteAxis":return b.fBorderSize=1,b.fShadowColor=0,!0}return!1};A.prototype.Redraw=function(){this.DrawPave()};A.prototype.Cleanup=function(){this.z_handle&&(this.z_handle.Cleanup(),delete this.z_handle);f.TObjectPainter.prototype.Cleanup.call(this)};K.prototype.Reset=function(){f.extend(this,{Axis:0,RevX:!1,RevY:!1,Bar:!1,BarStyle:0,Curve:!1,Hist:!0,Line:!1,Fill:!1,Error:!1,ErrorKind:-1,errorX:f.gStyle.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,Arrow:!1,Box:!1,BoxStyle:0,Text:!1,
TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:!1,Pie:!1,List:!1,Zscale:!1,PadPalette:!1,Candle:"",GLBox:0,GLColor:!1,Project:"",System:f.Painter.Coord.kCARTESIAN,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:!0,Palette:0,BaseLine:!1,Optimize:f.gStyle.OptimizeDraw,Mode3D:!1,FrontBox:!0,BackBox:!0,_pmc:!1,_plc:!1,_pfc:!1,need_fillcol:!1,minimum:-1111,maximum:-1111,ymin:0,ymax:0})};K.prototype.Decode=function(a,
b,c,d,e){this.orginal=a;a=new f.DrawOptions(a);var g="";if(1===b&&0<c.fSumw2.length)for(var l=0;l<c.fSumw2.length;++l)if(0<c.fSumw2[l]){this.Error=!0;this.Zero=this.Hist=!1;break}this.ndim=b||1;this.PadStats=a.check("USE_PAD_STATS");this.PadPalette=a.check("USE_PAD_PALETTE");this.PadTitle=a.check("USE_PAD_TITLE");a.check("PAL",!0)&&(this.Palette=a.partAsInt());a.check("MINIMUM:",!0)?this.minimum=parseFloat(a.part):this.minimum=c.fMinimum;a.check("MAXIMUM:",!0)?this.maximum=parseFloat(a.part):this.maximum=
c.fMaximum;a.check("YMIN:",!0)&&(this.ymin=parseFloat(a.part));a.check("YMAX:",!0)&&(this.ymax=parseFloat(a.part));a.check("NOOPTIMIZE")&&(this.Optimize=0);a.check("OPTIMIZE")&&(this.Optimize=2);a.check("AUTOCOL")&&(this.AutoColor=!0);a.check("AUTOZOOM")&&(this.AutoZoom=!0);a.check("OPTSTAT",!0)&&(this.optstat=a.partAsInt());a.check("OPTFIT",!0)&&(this.optfit=a.partAsInt());a.check("NOSTAT")&&(this.NoStat=!0);a.check("STAT")&&(this.ForceStat=!0);a.check("NOTOOLTIP")&&e&&e.SetTooltipAllowed(!1);a.check("TOOLTIP")&&
e&&e.SetTooltipAllowed(!0);a.check("LOGX")&&d&&(d.fLogx=1,d.fUxmin=0,d.fUxmax=1,d.fX1=0,d.fX2=1);a.check("LOGY")&&d&&(d.fLogy=1,d.fUymin=0,d.fUymax=1,d.fY1=0,d.fY2=1);a.check("LOGZ")&&d&&(d.fLogz=1);a.check("GRIDXY")&&d&&(d.fGridx=d.fGridy=1);a.check("GRIDX")&&d&&(d.fGridx=1);a.check("GRIDY")&&d&&(d.fGridy=1);a.check("TICKXY")&&d&&(d.fTickx=d.fTicky=1);a.check("TICKX")&&d&&(d.fTickx=1);a.check("TICKY")&&d&&(d.fTicky=1);if(a.check("FILL_",!0))if(0<a.partAsInt(1))this.histoFillColor=a.partAsInt();else for(c=
0;8>c;++c)f.Painter.root_colors[c].toUpperCase()===a.part&&(this.histoFillColor=c);if(a.check("LINE_",!0))if(0<a.partAsInt(1))this.histoLineColor=f.Painter.root_colors[a.partAsInt()];else for(c=0;8>c;++c)f.Painter.root_colors[c].toUpperCase()===a.part&&(this.histoLineColor=a.part);a.check("X+")&&(this.AxisPos=10);a.check("Y+")&&(this.AxisPos+=1);a.check("SAMES")&&(this.ForceStat=this.Same=!0);a.check("SAME")&&(this.Func=this.Same=!0);a.check("SPEC")&&(this.Spec=!0);a.check("BASE0")||a.check("MIN0")?
this.BaseLine=0:f.gStyle.fHistMinimumZero&&(this.BaseLine=0);a.check("PIE")&&(this.Pie=!0);a.check("CANDLE",!0)&&(this.Candle=a.part);a.check("GLBOX",!0)&&(this.GLBox=10+a.partAsInt());a.check("GLCOL")&&(this.GLColor=!0);a.check("GL");a.check("LEGO",!0)&&(this.Lego=1,0<=a.part.indexOf("0")&&(this.Zero=!1),0<=a.part.indexOf("1")&&(this.Lego=11),0<=a.part.indexOf("2")&&(this.Lego=12),0<=a.part.indexOf("3")&&(this.Lego=13),0<=a.part.indexOf("4")&&(this.Lego=14),g=a.part,0<=a.part.indexOf("Z")&&(this.Zscale=
!0));a.check("SURF",!0)&&(this.Surf=a.partAsInt(10,1),g=a.part,0<=a.part.indexOf("Z")&&(this.Zscale=!0));a.check("TF3",!0)&&(g=a.part);a.check("ISO",!0)&&(g=a.part);a.check("LIST")&&(this.List=!0);a.check("CONT",!0)&&1<b&&(this.Contour=1,0<=a.part.indexOf("Z")&&(this.Zscale=!0),0<=a.part.indexOf("1")?this.Contour=11:0<=a.part.indexOf("2")?this.Contour=12:0<=a.part.indexOf("3")?this.Contour=13:0<=a.part.indexOf("4")&&(this.Contour=14));a.check("HBAR",!0)?this.BarStyle=20:a.check("BAR",!0)&&(this.BarStyle=
10);0<this.BarStyle&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=a.partAsInt());a.check("ARR")&&(this.Arrow=!0);a.check("BOX",!0)&&(this.BoxStyle=10+a.partAsInt());this.Box=0<this.BoxStyle;a.check("COL")&&(this.Color=!0);a.check("CHAR")&&(this.Char=1);a.check("FUNC")&&(this.Func=!0,this.Hist=!1);a.check("AXIS")&&(this.Axis=1);a.check("AXIG")&&(this.Axis=2);a.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,this.TextAngle=Math.min(a.partAsInt(),90),0<=a.part.indexOf("N")&&(this.TextKind="N"),0<=
a.part.indexOf("E")&&(this.TextKind="E"));a.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(a.part),isNaN(this.ScatCoef)||0>=this.ScatCoef)&&(this.ScatCoef=1);a.check("SCAT")&&(this.Scat=!0);a.check("POL")&&(this.System=f.Painter.Coord.kPOLAR);a.check("CYL")&&(this.System=f.Painter.Coord.kCYLINDRICAL);a.check("SPH")&&(this.System=f.Painter.Coord.kSPHERICAL);a.check("PSR")&&(this.System=f.Painter.Coord.kRAPIDITY);a.check("TRI",!0)&&(this.Color=!1,this.Tri=1,g=a.part,0<=a.part.indexOf("ERR")&&
(this.Error=!0));a.check("AITOFF")&&(this.Proj=1);a.check("MERCATOR")&&(this.Proj=2);a.check("SINUSOIDAL")&&(this.Proj=3);a.check("PARABOLIC")&&(this.Proj=4);0<this.Proj&&(this.Contour=14);a.check("PROJX",!0)&&(this.Project="X"+a.partAsInt(0,1));a.check("PROJY",!0)&&(this.Project="Y"+a.partAsInt(0,1));g&&(0<=g.indexOf("FB")&&(this.FrontBox=!1),0<=g.indexOf("BB")&&(this.BackBox=!1));3==b&&a.check("FB")&&(this.FrontBox=!1);3==b&&a.check("BB")&&(this.BackBox=!1);this._pfc=a.check("PFC");this._plc=a.check("PLC")||
this.AutoColor;this._pmc=a.check("PMC");a.check("L")&&(this.Line=!0,this.Error=this.Hist=!1);a.check("F")&&(this.need_fillcol=this.Fill=!0);a.check("A")&&(this.Axis=-1);this.Axis&&a.check("RX")&&(this.RevX=!0);this.Axis&&a.check("RY")&&(this.RevY=!0);a.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0);a.check("B")&&(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0);a.check("C")&&(this.Curve=!0,this.Hist=!1);a.check("][")&&(this.Off=1,this.Hist=!0);a.check("HIST")&&
(this.Func=this.Hist=!0,this.Error=!1);this.Bar=0<this.BarStyle;delete this.MarkStyle;a.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0);a.check("P")&&(this.Mark=!0,this.Zero=this.Hist=!1);a.check("Z")&&(this.Zscale=!0);a.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1);a.check("H")&&(this.Hist=!0);if(a.check("E",!0)&&(this.Error=!0,1==b)){this.Hist=this.Zero=!1;isNaN(parseInt(a.part[0]))||(this.ErrorKind=parseInt(a.part[0]));if(3===this.ErrorKind||4===this.ErrorKind)this.need_fillcol=
!0;0===this.ErrorKind&&(this.Zero=!0);0<=a.part.indexOf("X0")&&(this.errorX=0)}a.check("9")&&(this.HighRes=1);a.check("0")&&(this.Zero=!1);this.Color&&a.check("1")&&(this.Zero=!1);if(0<this.Lego||3==b||0<this.Surf||this.Error&&2==b)this.Mode3D=!0};K.prototype.asString=function(a){a&&a.frame_painter();a="";this.Mode3D?(this.Lego?(a="LEGO",this.Zero||(a+="0"),10<this.Lego&&(a+=this.Lego-10),this.Zscale&&(a+="Z")):this.Surf&&(a="SURF"+(this.Surf-10),this.Zscale&&(a+="Z")),this.FrontBox||(a+="FB"),this.BackBox||
(a+="BB")):(this.Scat?a="SCAT":this.Color?(a="COL",this.Zero||(a+="0"),this.Zscale&&(a+="Z"),0>this.Axis&&(a+="A")):this.Contour?(a="CONT",10<this.Contour&&(a+=this.Contour-10),this.Zscale&&(a+="Z")):this.Bar?a=!1===this.BaseLine?"B":"B1":this.Mark?a=this.Zero?"P0":"P":this.Scat?a="SCAT":this.Error?(a="E",0<=this.ErrorKind&&(a+=this.ErrorKind)):this.Line&&(a+="L",this.Fill&&(a+="F")),this.Text&&(a+="TEXT",this.TextAngle&&(a+=this.TextAngle),a+=this.TextKind));return a};y.prototype=Object.create(f.TObjectPainter.prototype);
y.prototype.GetHisto=function(){return this.GetObject()};y.prototype.GetAxis=function(a){var b=this.GetObject();if(b)switch(a){case "x":return b.fXaxis;case "y":return b.fYaxis;case "z":return b.fZaxis}return null};y.prototype.IsTProfile=function(){return this.MatchObjectType("TProfile")};y.prototype.IsTH1K=function(){return this.MatchObjectType("TH1K")};y.prototype.IsTH2Poly=function(){return this.MatchObjectType(/^TH2Poly/)||this.MatchObjectType(/^TProfile2Poly/)};y.prototype.Clear3DScene=function(){var a=
this.frame_painter();a&&"function"===typeof a.Create3DScene&&a.Create3DScene(-1);this.mode3d=!1};y.prototype.Cleanup=function(){this.Clear3DScene();this.histo=null;delete this.fPalette;delete this.fContour;delete this.options;f.TObjectPainter.prototype.Cleanup.call(this)};y.prototype.Dimension=function(){var a=this.GetHisto();return a?a._typename.match(/^TH2/)||a._typename.match(/^TProfile2D/)?2:a._typename.match(/^TH3/)?3:1:0};y.prototype.DecodeOptions=function(a){var b=this.GetHisto(),c=this.Dimension(),
d=this.root_pad();this.options?this.options.Reset():this.options=new K;this.options.Decode(a||b.fOption,c,b,d,this);this.OptionsStore(a)};y.prototype.CopyOptionsFrom=function(a){if(a!==this){var b=this.options;a=a.options;b.Mode3D=a.Mode3D;b.Zero=a.Zero;a.Mode3D?(b.Lego=a.Lego,b.Surf=a.Surf):(b.Color=a.Color,b.Contour=a.Contour)}};y.prototype.CopyOptionsToOthers=function(){var a=this;this.ForEachPainter(function(b){b!==a&&"function"==typeof b.CopyOptionsFrom&&b.CopyOptionsFrom(a)},"objects")};y.prototype.ScanContent=
function(a){alert("HistPainter.prototype.ScanContent not implemented")};y.prototype.CheckPadRange=function(a){this.is_main_painter()&&(this.check_pad_range=a?"pad_range":!0)};y.prototype.CheckHistDrawAttributes=function(){var a=this.GetHisto(),b=this.pad_painter();b&&(this.options._pfc||this.options._plc||this.options._pmc)&&(b=b.CreateAutoColor(),this.options._pfc&&(a.fFillColor=b,delete this.fillatt),this.options._plc&&(a.fLineColor=b,delete this.lineatt),this.options._pmc&&(a.fMarkerColor=b,delete this.markeratt),
this.options._pfc=this.options._plc=this.options._pmc=!1);this.createAttFill({attr:a,color:this.options.histoFillColor,kind:1});this.createAttLine({attr:a,color0:this.options.histoLineColor})};y.prototype.UpdateObject=function(a,b){var c=this.GetHisto(),d=this.frame_painter();if(a!==c){var e=function(a,b){a.fTitle=b.fTitle;a.fLabels=b.fLabels;a.fXmin=b.fXmin;a.fXmax=b.fXmax;a.fTimeDisplay=b.fTimeDisplay;a.fTimeFormat=b.fTimeFormat;a.fAxisColor=b.fAxisColor;a.fLabelColor=b.fLabelColor;a.fLabelFont=
b.fLabelFont;a.fLabelOffset=b.fLabelOffset;a.fLabelSize=b.fLabelSize;a.fNdivisions=b.fNdivisions;a.fTickLength=b.fTickLength;a.fTitleColor=b.fTitleColor;a.fTitleFont=b.fTitleFont;a.fTitleOffset=b.fTitleOffset;a.fTitleSize=b.fTitleSize};if(!this.MatchObjectType(a))return!1;if(c.TestBit(f.TH1StatusBits.kNoStats)!=a.TestBit(f.TH1StatusBits.kNoStats)){c.fBits=a.fBits;var g=this.FindPainterFor(this.FindStat());g&&(g.Enabled=!c.TestBit(f.TH1StatusBits.kNoStats))}void 0!==this.snapid&&(c.fName=a.fName);
c.fFillColor=a.fFillColor;c.fFillStyle=a.fFillStyle;c.fLineColor=a.fLineColor;c.fLineStyle=a.fLineStyle;c.fLineWidth=a.fLineWidth;c.fEntries=a.fEntries;c.fTsumw=a.fTsumw;c.fTsumwx=a.fTsumwx;c.fTsumwx2=a.fTsumwx2;c.fXaxis.fNbins=a.fXaxis.fNbins;1<this.Dimension()&&(c.fTsumwy=a.fTsumwy,c.fTsumwy2=a.fTsumwy2,c.fTsumwxy=a.fTsumwxy,c.fYaxis.fNbins=a.fYaxis.fNbins,2<this.Dimension()&&(c.fTsumwz=a.fTsumwz,c.fTsumwz2=a.fTsumwz2,c.fTsumwxz=a.fTsumwxz,c.fTsumwyz=a.fTsumwyz,c.fZaxis.fNbins=a.fZaxis.fNbins));
c.fArray=a.fArray;c.fNcells=a.fNcells;c.fTitle=a.fTitle;c.fMinimum=a.fMinimum;c.fMaximum=a.fMaximum;e(c.fXaxis,a.fXaxis);e(c.fYaxis,a.fYaxis);e(c.fZaxis,a.fZaxis);d.zoom_changed_interactive||(d=function(a,b){a.fFirst=b.fFirst;a.fLast=b.fLast;a.fBits=b.fBits},d(c.fXaxis,a.fXaxis),d(c.fYaxis,a.fYaxis),d(c.fZaxis,a.fZaxis));c.fSumw2=a.fSumw2;this.IsTProfile()?c.fBinEntries=a.fBinEntries:this.IsTH1K()?(c.fNIn=a.fNIn,c.fReady=!1):this.IsTH2Poly()&&(c.fBins=a.fBins);this.DecomposeTitle();if(a.fFunctions&&
this.options.Func)for(d=0;d<a.fFunctions.arr.length;++d)(e=a.fFunctions.arr[d])&&e._typename&&((g=e.fName?this.FindPainterFor(null,e.fName,e._typename):null)?g.UpdateObject(e):"TPaletteAxis"!=e._typename&&"TPaveStats"!=e._typename&&console.log("Get "+e._typename+" in histogram functions list, need to use?"));d=c.fOption!=a.fOption;c.fOption=a.fOption;(void 0!==b&&this.options.original!==b||d)&&this.DecodeOptions(b||c.fOption)}this.ScanContent();return this.histogram_updated=!0};y.prototype.CreateAxisFuncs=
function(a,b){function c(a){a.fXbins.length>=a.fNbins?(a.regular=!1,a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fXmin;if(b>this.fNbins)return this.fXmax;if(b==a)return this.fXbins[b];var c=a<b?b-1:b+1;return this.fXbins[b]*Math.abs(a-c)+this.fXbins[c]*Math.abs(a-b)},a.FindBin=function(a,b){for(var c=1;c<this.fXbins.length;++c)if(a<this.fXbins[c])return Math.floor(c-1+b);return this.fNbins}):(a.regular=!0,a.binwidth=(a.fXmax-a.fXmin)/(a.fNbins||1),a.GetBinCoord=function(a){return this.fXmin+
a*this.binwidth},a.FindBin=function(a,b){return Math.floor((a-this.fXmin)/this.binwidth+b)})}var d=this.GetHisto();this.xmin=d.fXaxis.fXmin;this.xmax=d.fXaxis.fXmax;c(d.fXaxis);this.ymin=d.fYaxis.fXmin;this.ymax=d.fYaxis.fXmax;a&&0!=this.nbinsy&&(c(d.fYaxis),b&&0!=this.nbinsz&&c(d.fZaxis))};y.prototype.CreateXY=function(){if(this.is_main_painter()){var a=this.GetHisto(),b=this.frame_painter();if(!b)return console.warn("histogram drawn without frame - not supported");this.ymin===this.ymax&&(this.ymax+=
1);b.SetAxesRanges(a.fXaxis,this.xmin,this.xmax,a.fYaxis,this.ymin,this.ymax,a.fZaxis,0,0);b.CreateXY({ndim:this.Dimension(),check_pad_range:this.check_pad_range,create_canvas:this.create_canvas,zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,ymin_nz:this.ymin_nz,swap_xy:20<=this.options.BarStyle,reverse_x:this.options.RevX,reverse_y:this.options.RevY,Proj:this.options.Proj,extra_y_space:this.options.Text&&0<this.options.BarStyle});delete this.check_pad_range}};y.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};
y.prototype.DrawAxes=function(){if(this.is_main_painter()&&!this.options.Same){var a=this.frame_painter();a&&(a.DrawAxes(!1,0>this.options.Axis,this.options.AxisPos,this.options.Zscale),a.DrawGrids())}};y.prototype.ToggleTitle=function(a){var b=this.GetHisto();if(!this.is_main_painter()||!b)return!1;if("only-check"===a)return!b.TestBit(f.TH1StatusBits.kNoTitle);b.InvertBit(f.TH1StatusBits.kNoTitle);this.DrawTitle()};y.prototype.DecomposeTitle=function(){var a=this.GetHisto();if(a&&a.fTitle){var b=
a.fTitle.split(";");3===b.length&&(a.fTitle=b[0],a.fXaxis.fTitle=b[1],a.fYaxis.fTitle=b[2])}};y.prototype.DrawTitle=function(){if(this.is_main_painter()&&!this.options.Same){var a=this.GetHisto(),b=f.gStyle,c=this.FindPainterFor(null,"title"),d=c?c.GetObject():null;d||(d=this.FindInPrimitives("title"));d&&"TPaveText"!==d._typename&&(d=null);var e=!a.TestBit(f.TH1StatusBits.kNoTitle)&&0<b.fOptTitle;d?(d.Clear(),e&&d.AddText(a.fTitle),c&&c.Redraw()):e&&!c&&a.fTitle&&!this.options.PadTitle&&(d=f.Create("TPaveText"),
d.fName="title",d.fTextFont=b.fTitleFont,d.fTextSize=b.fTitleFontSize,d.fTextColor=b.fTitleTextColor,d.fTextAlign=b.fTitleAlign,d.fFillColor=b.fTitleColor,d.fFillStyle=b.fTitleStyle,d.fBorderSize=b.fTitleBorderSize,d.AddText(a.fTitle),c=f.Painter.drawPave(this.divid,d,"postitle"))&&(c.$secondary=!0)}};y.prototype.processTitleChange=function(a){var b=this.GetHisto(),c=this.FindPainterFor(null,"title");if(!b||!c)return null;if("check"===a)return!this.is_main_painter()||this.options.Same?null:b;a=c.GetObject();
a.Clear();a.AddText(b.fTitle);c.Redraw()};y.prototype.UpdateStatWebCanvas=function(){if(this.snapid){var a=this.FindStat();(a=this.FindPainterFor(a))&&!a.snapid&&a.Redraw()}};y.prototype.ToggleStat=function(a){var b=this.FindStat(),c=null;a||(a="");if(b)c=this.FindPainterFor(b);else{if(0<a.indexOf("-check"))return!1;b=this.CreateStat(!0)}if("only-check"==a)return c?c.Enabled:!1;if("fitpar-check"==a)return b?b.fOptFit:!1;if("fitpar-toggle"==a){if(!b)return!1;b.fOptFit=b.fOptFit?0:1111;c&&c.Redraw();
return!0}if(c)return c.Enabled=!c.Enabled,c.Redraw(),c.Enabled;f.draw(this.divid,b,"onpad:"+this.pad_name);return!0};y.prototype.GetSelectIndex=function(a,b,c){var d=this.frame_painter(),e=this["nbins"+a]||0,g=this.GetAxis(a),l=d?d["zoom_"+a+"min"]:0;a=d?d["zoom_"+a+"max"]:0;l!==a&&g?(c="left"==b?g.FindBin(l,c||0):g.FindBin(a,(c||0)+.5),0>c?c=0:c>e&&(c=e)):c="left"==b?0:e;g&&(g.fFirst===g.fLast||!g.TestBit(f.EAxisBits.kAxisRange)||1>=g.fFirst&&g.fLast>=e)&&(g=void 0);"left"==b?(0>c&&(c=0),g&&1<g.fFirst&&
c<g.fFirst&&(c=g.fFirst-1)):(c>e&&(c=e),g&&g.fLast<=e&&c>g.fLast&&(c=g.fLast));return c};y.prototype.FindFunction=function(a,b){var c=this.GetObject();c=c&&c.fFunctions?c.fFunctions.arr:null;if(!c)return null;for(var d=0;d<c.length;++d)if((!b||c[d].fName===b)&&c[d]._typename===a)return c[d];return null};y.prototype.FindStat=function(){if(this.options.PadStats){var a=this.FindPainterFor(null,"stats","TPaveStats");return a?a.GetObject():null}return this.FindFunction("TPaveStats","stats")};y.prototype.IgnoreStatsFill=
function(){return!this.GetObject()||!this.draw_content&&!this.create_stats||0<this.options.Axis};y.prototype.CreateStat=function(a){if(this.options.PadStats||!(a||this.options.ForceStat||!this.options.NoStat&&!this.histo.TestBit(f.TH1StatusBits.kNoStats)&&f.gStyle.AutoStat&&this.draw_content&&this.is_main_painter()))return null;a=this.FindStat();var b=f.gStyle,c=this.options.optstat,d=this.options.optfit;void 0!==c?(a&&(a.fOptStat=c),delete this.options.optstat):c=this.histo.$custom_stat||b.fOptStat;
void 0!==d?(a&&(a.fOptFit=d),delete this.options.optfit):d=b.fOptFit;if(!a&&!c&&!d)return null;this.create_stats=!0;if(a)return a;a=f.Create("TPaveStats");f.extend(a,{fName:"stats",fOptStat:c,fOptFit:d,fBorderSize:1});a.fX1NDC=b.fStatX-b.fStatW;a.fY1NDC=b.fStatY-b.fStatH;a.fX2NDC=b.fStatX;a.fY2NDC=b.fStatY;a.fFillColor=b.fStatColor;a.fFillStyle=b.fStatStyle;a.fTextAngle=0;a.fTextSize=b.fStatFontSize;a.fTextAlign=12;a.fTextColor=b.fStatTextColor;a.fTextFont=b.fStatFont;if(this.histo._typename.match(/^TProfile/)||
this.histo._typename.match(/^TH2/))a.fY1NDC=.67;a.AddText(this.histo.fName);this.AddFunction(a);return a};y.prototype.AddFunction=function(a,b){var c=this.GetObject();c&&a&&(c.fFunctions||(c.fFunctions=f.Create("TList")),b?c.fFunctions.AddFirst(a):c.fFunctions.Add(a))};y.prototype.DrawNextFunction=function(a,b){if(!this.options.Func||!this.histo.fFunctions||a>=this.histo.fFunctions.arr.length)return f.CallBack(b);var c=this.histo.fFunctions.arr[a],d=this.histo.fFunctions.opt[a],e=!1;null===this.FindPainterFor(c)&&
(e="TPaveText"===c._typename||"TPaveStats"===c._typename?!this.histo.TestBit(f.TH1StatusBits.kNoStats)&&!this.options.NoStat:"TF1"===c._typename?!c.TestBit(f.BIT(9)):"TPaletteAxis"!==c._typename);if(e)return f.draw(this.divid,c,d,this.DrawNextFunction.bind(this,a+1,b));this.DrawNextFunction(a+1,b)};y.prototype.UnzoomUserRange=function(a,b,c){function d(a){if(!a||!a.TestBit(f.EAxisBits.kAxisRange)||a.fFirst===a.fLast||1>=a.fFirst&&a.fLast>=a.fNbins)return!1;a.InvertBit(f.EAxisBits.kAxisRange);return!0}
function e(a,b){if(l.Dimension()!==a||-1111===l.options.minimum&&-1111===l.options.maximum||!l.draw_content)return!1;l.options.minimum=l.options.maximum=-1111;l.ScanContent(!0);return!0}if(!this.histo)return!1;var g=!1,l=this;a&&d(this.histo.fXaxis)&&(g=!0);b&&(d(this.histo.fYaxis)||e(1,this.histo))&&(g=!0);c&&(d(this.histo.fZaxis)||e(2,this.histo))&&(g=!0);return g};y.prototype.AllowDefaultYZooming=function(){if(1<this.Dimension())return!0;if(this.draw_content)return!1;var a=this.pad_painter();if(a&&
a.painters)for(var b=0;b<a.painters.length;++b){var c=a.painters[b];if(c!==this&&void 0!==c.wheel_zoomy)return c.wheel_zoomy}return!1};y.prototype.ShowAxisStatus=function(a){var b=this.GetShowStatusFunc();if(b){var c=this.histo?this.histo["f"+a.toUpperCase()+"axis"]:null,d=a,e="TAxis";c&&(d=c.fName,e=c.fTitle||"histogram TAxis object");c=B.mouse(this.svg_frame().node());var g="x"==a?0:1;this.swap_xy&&(g=1-g);g="x"==a?this.RevertX(c[g]):this.RevertY(c[g]);b(d,e,a+" : "+this.AxisAsText(a,g),c[0].toFixed(0)+
","+c[1].toFixed(0))}};y.prototype.AddInteractive=function(){if(this.is_main_painter()){var a=this.frame_painter();a&&a.AddInteractive()}};y.prototype.ShowContextMenu=function(a,b,c){var d=this,e=!1,g=null;if(!b&&(B.event.preventDefault(),B.event.stopPropagation(),b=B.event,void 0===a)){var l=B.mouse(this.svg_frame().node()),h=B.touches(this.svg_frame().node()),r=this.pad_painter(),m=null,k=null;g=this.frame_painter();1===h.length?m={x:h[0][0],y:h[0][1],touch:!0}:2===l.length&&(m={x:l[0],y:l[1],touch:!1});
if(null!==m&&null!==r)for(m.painters=!0,l=r.GetTooltips(m),h=1E3,r=0;r<l.length;++r)if(l[r]&&l[r].menu){var p="menu_dist"in l[r]?l[r].menu_dist:7;p<h&&(k=l[r].painter,h=p)}null!==k?d=k:null!==g&&(a="frame");null!==m&&(e=0<m.x&&20>m.x&&0<m.y&&20>m.y);g&&g.SetLastEventPos(m)}d.ctx_menu_evnt=b;f.Painter.createMenu(d,function(b){var d=b.painter.FillContextMenu(b,a,c);g&&(!d||e&&"frame"!==a)&&(d=g.FillContextMenu(b));d&&b.painter.FillObjectExecMenu(b,a,function(){b.painter.SwitchTooltip(!1);b.show(b.painter.ctx_menu_evnt,
b.painter.SwitchTooltip.bind(b.painter,!0))})})};y.prototype.ChangeUserRange=function(a){var b=this.histo["f"+a+"axis"];if(b){var c="[1,"+b.fNbins+"]";b.TestBit(f.EAxisBits.kAxisRange)&&(c="["+b.fFirst+","+b.fLast+"]");if(a=prompt("Enter user range for axis "+a+" like [1,"+b.fNbins+"]",c))!(a=JSON.parse(a))||2!=a.length||isNaN(a[0])||isNaN(a[1])||(b.fFirst=parseInt(a[0]),b.fLast=parseInt(a[1]),(b.fFirst<b.fLast&&1<=b.fFirst&&b.fLast<=b.fNbins)!=b.TestBit(f.EAxisBits.kAxisRange)&&b.InvertBit(f.EAxisBits.kAxisRange),
this.Redraw())}};y.prototype.FillContextMenu=function(a){var b=this.GetHisto(),c=this.frame_painter();if(b){a.add("header:"+b._typename+"::"+b.fName);this.draw_content&&(a.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()}),1==this.Dimension()?a.add("User range X","X",this.ChangeUserRange):(a.add("sub:User ranges"),a.add("X","X",this.ChangeUserRange),a.add("Y","Y",this.ChangeUserRange),2<this.Dimension()&&a.add("Z","Z",this.ChangeUserRange),a.add("endsub:")),"function"==
typeof this.FillHistContextMenu&&this.FillHistContextMenu(a));if(this.options.Mode3D){0<a.size()&&a.add("separator");var d=this.main_painter()||this;a.addchk(d.IsTooltipAllowed(),"Show tooltips",function(){d.SetTooltipAllowed("toggle")});a.addchk(c.enable_highlight,"Highlight bins",function(){c.enable_highlight=!c.enable_highlight;!c.enable_highlight&&c.BinHighlight3D&&c.mode3d&&c.BinHighlight3D(null)});c&&c.Render3D&&(a.addchk(d.options.FrontBox,"Front box",function(){d.options.FrontBox=!d.options.FrontBox;
c.Render3D()}),a.addchk(d.options.BackBox,"Back box",function(){d.options.BackBox=!d.options.BackBox;c.Render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.InteractiveRedraw("pad")}),12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()}),this.FillPaletteMenu&&this.FillPaletteMenu(a));d.control&&"function"===typeof d.control.reset&&a.add("Reset camera",function(){d.control.reset()})}this.FillAttContextMenu(a);
this.histogram_updated&&c.zoom_changed_interactive&&a.add("Let update zoom",function(){c.zoom_changed_interactive=0});return!0}};y.prototype.ButtonClick=function(a){var b=this.frame_painter();if(!this.is_main_painter()||!b)return!1;switch(a){case "ToggleZoom":if(b.zoom_xmin!==b.zoom_xmax||b.zoom_ymin!==b.zoom_ymax||b.zoom_zmin!==b.zoom_zmax)return b.Unzoom(),b.zoom_changed_interactive=0,!0;if(this.draw_content&&"function"===typeof this.AutoZoom)return this.AutoZoom(),!0;break;case "ToggleLogX":b.ToggleLog("x");
break;case "ToggleLogY":b.ToggleLog("y");break;case "ToggleLogZ":b.ToggleLog("z");break;case "ToggleStatBox":return this.ToggleStat(),!0}return!1};y.prototype.FillToolbar=function(a){var b=this.pad_painter();b&&(b.AddButton(f.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),b.AddButton(f.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown"),b.AddButton(f.ToolbarIcons.arrow_up,"Toggle log y","ToggleLogY","PageUp"),1<this.Dimension()&&b.AddButton(f.ToolbarIcons.arrow_diag,
"Toggle log z","ToggleLogZ"),this.draw_content&&b.AddButton(f.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox"),a||b.ShowButtons())};y.prototype.Get3DToolTip=function(a){var b={bin:a,name:this.GetObject().fName,title:this.GetObject().fTitle};switch(this.Dimension()){case 1:b.ix=a;b.iy=1;b.value=this.histo.getBinContent(b.ix);b.error=this.histo.getBinError(a);b.lines=this.GetBinTips(a-1);break;case 2:b.ix=a%(this.nbinsx+2);b.iy=(a-b.ix)/(this.nbinsx+2);b.value=this.histo.getBinContent(b.ix,b.iy);
b.error=this.histo.getBinError(a);b.lines=this.GetBinTips(b.ix-1,b.iy-1);break;case 3:b.ix=a%(this.nbinsx+2),b.iy=(a-b.ix)/(this.nbinsx+2)%(this.nbinsy+2),b.iz=(a-b.ix-b.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),b.value=this.GetObject().getBinContent(b.ix,b.iy,b.iz),b.error=this.histo.getBinError(a),b.lines=this.GetBinTips(b.ix-1,b.iy-1,b.iz-1)}return b};y.prototype.CreateContour=function(a,b,c,d){1>a&&(a=f.gStyle.fNumberContours);this.fContour=[];this.colzmin=b;this.colzmax=c;if(this.root_pad().fLogz){0>=
this.colzmax&&(this.colzmax=1);0>=this.colzmin&&(this.colzmin=void 0===d||0>=d?1E-4*this.colzmax:3>d||100<d?.3*d:1);this.colzmin>=this.colzmax&&(this.colzmin=1E-4*this.colzmax);b=Math.log(this.colzmin)/Math.log(10);c=(Math.log(this.colzmax)/Math.log(10)-b)/a;this.fContour.push(this.colzmin);for(d=1;d<a;d++)this.fContour.push(Math.exp((b+c*d)*Math.log(10)));this.fContour.push(this.colzmax);this.fCustomContour=!0}else for(this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),
this.colzmin-=.01*Math.abs(this.colzmin)),c=(this.colzmax-this.colzmin)/a,d=0;d<=a;d++)this.fContour.push(this.colzmin+c*d);a=this.frame_painter();3>this.Dimension()&&a&&(a.zmin=this.colzmin,a.zmax=this.colzmax);return this.fContour};y.prototype.GetContour=function(){if(this.fContour)return this.fContour;var a=this.main_painter(),b=this.frame_painter();if(a&&a!==this&&a.fContour)return this.fContour=a.fContour,this.fCustomContour=a.fCustomContour,this.colzmin=a.colzmin,this.colzmax=a.colzmax,this.fContour;
a=this.GetObject();var c=f.gStyle.fNumberContours,d=this.minbin,e=this.maxbin,g=this.minposbin;d===e&&(d=this.gminbin,e=this.gmaxbin,g=this.gminposbin);a.fContour&&(c=a.fContour.length);-1111!==this.options.minimum&&-1111!=this.options.maximum&&(d=this.options.minimum,e=this.options.maximum);b&&b.zoom_zmin!=b.zoom_zmax&&(d=b.zoom_zmin,e=b.zoom_zmax);if(a.fContour&&1<a.fContour.length&&a.TestBit(f.TH1StatusBits.kUserContour))return this.fContour=f.clone(a.fContour),this.fCustomContour=!0,this.colzmin=
d,this.colzmax=e,e>this.fContour[this.fContour.length-1]&&this.fContour.push(e),3>this.Dimension()&&b&&(b.zmin=this.colzmin,b.zmax=this.colzmax),this.fContour;this.fCustomContour=!1;return this.CreateContour(c,d,e,g)};y.prototype.getContourIndex=function(a){var b=this.GetContour();if(this.fCustomContour){var c=0,d=b.length-1;if(a<b[0])return-1;if(a>=b[d])return d;for(;c<d-1;){var e=Math.round((c+d)/2);b[e]>a?d=e:c=e}return c}return a<this.colzmin?this.options.Zero?-1:0:a===this.colzmin?0!=this.colzmin||
!this.options.Zero||this.IsTH2Poly()?0:-1:Math.floor(.01+(a-this.colzmin)*(b.length-1)/(this.colzmax-this.colzmin))};y.prototype.getContourColor=function(a,b){var c=this.getContourIndex(a);if(0>c)return null;var d=this.GetContour();a=this.GetPalette();c=a.calcColorIndex(c,d.length);return b?c:a.getColor(c)};y.prototype.GetPalette=function(a){if(!this.fPalette||a)this.fPalette=this.get_palette(!0,this.options.Palette);return this.fPalette};y.prototype.FillPaletteMenu=function(a){function b(a){e.options.Palette=
parseInt(a);e.GetPalette(!0);e.Redraw()}function c(c,e,h){a.addchk(c===d||h,"<nobr>"+e+"</nobr>",c,b)}var d=this.options.Palette,e=this;if(null===d||0===d)d=f.gStyle.Palette;a.add("sub:Palette");c(50,"ROOT 5",10<=d&&51>d);c(51,"Deep Sea");c(52,"Grayscale",0<d&&10>d);c(53,"Dark body radiator");c(54,"Two-color hue");c(55,"Rainbow");c(56,"Inverted dark body radiator");c(57,"Bird",113<d);c(58,"Cubehelix");c(59,"Green Red Violet");c(60,"Blue Red Yellow");c(61,"Ocean");c(62,"Color Printable On Grey");c(63,
"Alpine");c(64,"Aquamarine");c(65,"Army");c(66,"Atlantic");a.add("endsub:")};y.prototype.DrawColorPalette=function(a,b,c){if(!this.is_main_painter())return null;var d=this.FindFunction("TPaletteAxis"),e=this.FindPainterFor(d);this._can_move_colz&&(c=!0,delete this._can_move_colz);e||d||!(e=this.FindPainterFor(void 0,void 0,"TPaletteAxis"))||(d=e.GetObject(),this.AddFunction(d,!0));if(!a)return e&&(e.Enabled=!1,e.RemoveDrawG()),null;if(!d){if(this.options.PadPalette)return null;d=f.Create("TPave");
f.extend(d,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:f.Create("TGaxis"),fX1NDC:.91,fX2NDC:.95,fY1NDC:.1,fY2NDC:.9,fInit:1});c=this.GetHisto().fZaxis;f.extend(d.fAxis,{fTitle:c.fTitle,fTitleSize:c.fTitleSize,fChopt:"+",fLineColor:c.fAxisColor,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:c.fLabelSize,fTextAlign:11,fTextColor:c.fLabelColor,fTextFont:c.fLabelFont});this.AddFunction(d,!0);c=!0}a=this.frame_painter();c&&a&&(d.fX2NDC=a.fX2NDC+.01+(d.fX2NDC-d.fX1NDC),d.fX1NDC=a.fX2NDC+.01,
d.fY1NDC=a.fY1NDC,d.fY2NDC=a.fY2NDC);var g="";b&&(g+=";postpone");c&&!this.do_redraw_palette&&(g+=";can_move");if(e)e.Enabled=!0,e.DrawPave(g);else{var l=this.CurrentPadName(this.pad_name);e=f.draw(this.divid,d,g);this.CurrentPadName(l)}e.$secondary=!0;e.Redraw=function(){};c&&a&&d.fX1NDC-.005<a.fX2NDC&&!this.do_redraw_palette&&(this.do_redraw_palette=!0,a.fX2NDC=d.fX1NDC-.01,a.Redraw(),b||this.Redraw(),delete this.do_redraw_palette);return e};y.prototype.ToggleColz=function(){if(this.options.Mode3D?
12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=!this.options.Zscale,this.DrawColorPalette(this.options.Zscale,!1,!0)};y.prototype.ToggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=
!1);this.CopyOptionsToOthers();this.InteractiveRedraw("pad","drawopt")};y.prototype.PrepareColorDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===a.extra&&(a.extra=0);void 0===a.middle&&(a.middle=0);var b=this.GetHisto(),c=b.fXaxis,d=b.fYaxis,e=this.frame_painter(),g=this.Dimension(),l,h={i1:this.GetSelectIndex("x","left",0-a.extra),i2:this.GetSelectIndex("x","right",1+a.extra),j1:1===g?0:this.GetSelectIndex("y","left",0-a.extra),j2:1===g?1:this.GetSelectIndex("y","right",1+a.extra),
min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};h.grx=new Float32Array(h.i2+1);h.gry=new Float32Array(h.j2+1);"number"!=typeof b.fBarOffset||"number"!=typeof b.fBarWidth||!b.fBarOffset&&1E3===b.fBarWidth||(1E3>=b.fBarOffset?h.xbar1=h.ybar1=.001*b.fBarOffset:3E3>=b.fBarOffset?h.xbar1=.001*(b.fBarOffset-2E3):5E3>=b.fBarOffset&&(h.ybar1=.001*(b.fBarOffset-4E3)),1E3>=b.fBarWidth?(h.xbar2=Math.min(1,h.xbar1+.001*b.fBarWidth),h.ybar2=Math.min(1,h.ybar1+.001*b.fBarWidth)):3E3>=b.fBarWidth?h.xbar2=Math.min(1,
h.xbar1+.001*(b.fBarWidth-2E3)):5E3>=b.fBarWidth&&(h.ybar2=Math.min(1,h.ybar1+.001*(b.fBarWidth-4E3))));a.original&&(h.original=!0,h.origx=new Float32Array(h.i2+1),h.origy=new Float32Array(h.j2+1));a.pixel_density&&(a.rounding=!0);if(!e)return console.warn("cannot draw histogram without frame"),h;for(l=h.i1;l<=h.i2;++l){var f=c.GetBinCoord(l+a.middle);e.logx&&0>=f?h.i1=l+1:(h.origx&&(h.origx[l]=f),h.grx[l]=e.grx(f),a.rounding&&(h.grx[l]=Math.round(h.grx[l])),a.use3d&&(h.grx[l]<-e.size_xy3d&&(h.i1=
l,h.grx[l]=-e.size_xy3d),h.grx[l]>e.size_xy3d&&(h.i2=l,h.grx[l]=e.size_xy3d)))}if(1===g)h.gry[0]=e.gry(0),h.gry[1]=e.gry(1);else for(c=h.j1;c<=h.j2;++c)l=d.GetBinCoord(c+a.middle),e.logy&&0>=l?h.j1=c+1:(h.origy&&(h.origy[c]=l),h.gry[c]=e.gry(l),a.rounding&&(h.gry[c]=Math.round(h.gry[c])),a.use3d&&(h.gry[c]<-e.size_xy3d&&(h.j1=c,h.gry[c]=-e.size_xy3d),h.gry[c]>e.size_xy3d&&(h.j2=c,h.gry[c]=e.size_xy3d)));b.getBinContent(h.i1+1,h.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(l=h.i1;l<h.i2;++l)for(c=
h.j1;c<h.j2;++c){d=b.getBinContent(l+1,c+1);h.sumz+=d;if(a.pixel_density){e=(h.grx[l+1]-h.grx[l])*(h.gry[c]-h.gry[c+1]);if(0>=e)continue;h.max=Math.max(h.max,d);0<d&&(d<h.min||0===h.min)&&(h.min=d);d/=e}null===this.maxbin?this.maxbin=this.minbin=d:(this.maxbin=Math.max(this.maxbin,d),this.minbin=Math.min(this.minbin,d));0<d&&(null===this.minposbin||d<this.minposbin)&&(this.minposbin=d)}this.fContour=null;this.fCustomContour=!1;return h};G.prototype=Object.create(y.prototype);G.prototype.ConvertTH1K=
function(){var a=this.GetObject();if(!a.fReady){var b=a.fArray;a.fNcells=a.fXaxis.fNbins+2;a.fArray=new Float64Array(a.fNcells);for(var c=0;c<a.fNcells;++c)a.fArray[c]=0;for(c=0;c<a.fNIn;++c)a.Fill(b[c]);a.fReady=!0}};G.prototype.ScanContent=function(a){a&&!this.nbinsx&&(a=!1);this.IsTH1K()&&this.ConvertTH1K();a||(this.nbinsx=this.histo.fXaxis.fNbins,this.nbinsy=0,this.CreateAxisFuncs(!1));var b=this.GetSelectIndex("x","left"),c=this.GetSelectIndex("x","right");if(!a||b!==this.scan_xleft||c!==this.scan_xright){this.draw_content=
!(0<this.options.Axis);this.scan_xleft=b;this.scan_xright=c;for(var d=0,e=0,g=0,l=0,h=!0,f=this.IsTProfile(),m,k,p=0;p<this.nbinsx;++p)m=this.histo.getBinContent(p+1),l+=f?this.histo.fBinEntries[p+1]:m,p<b||p>=c||(0<m&&(0==e||m<e)&&(e=m),h&&(d=g=m,h=!1),k=this.options.Error?this.histo.getBinError(p+1):0,d=Math.min(d,m-k),g=Math.max(g,m+k));this.stat_entries=l=f?l+(this.histo.fBinEntries[0]+this.histo.fBinEntries[this.nbinsx+1]):l+(this.histo.getBinContent(0)+this.histo.getBinContent(this.nbinsx+1));
1<this.histo.fEntries&&(this.stat_entries=this.histo.fEntries);this.hmin=d;this.hmax=g;this.ymin_nz=e;if(0==this.nbinsx||1E-300>Math.abs(d)&&1E-300>Math.abs(g))this.draw_content=!1;c=b=!1;this.draw_content?d>=g?0==d?(this.ymin=0,this.ymax=1):0>d?(this.ymin=2*d,this.ymax=0):(this.ymin=0,this.ymax=2*d):(e=.05*(g-d),this.ymin=d-e,0>this.ymin&&0<=d&&(this.ymin=0),this.ymax=g+e):this.options.ymin!==this.options.ymax&&(this.ymin=this.options.ymin,this.ymax=this.options.ymax,c=!0);d=this.options.minimum;
g=this.options.maximum;d===g&&-1111!==d&&(0>d?(d*=2,g=0):(d=0,(g*=2)||(g=1)));-1111==d||-1111==g||this.draw_content||c?(-1111!=d&&(d<this.ymin?this.ymin=d:b=!0),-1111!=g&&(g>this.ymax?this.ymax=g:b=!0)):(this.ymin=d,this.ymax=g);a||(b&&(this.draw_content||c)?(this.zoom_ymin=-1111==d?this.ymin:d,this.zoom_ymax=-1111==g?this.ymax:g):(delete this.zoom_ymin,delete this.zoom_ymax));1<this.Dimension()?this.wheel_zoomy=!0:this.draw_content&&(this.wheel_zoomy=!1)}};G.prototype.CountStat=function(a){for(var b=
this.IsTProfile(),c=this.GetHisto(),d=c.fXaxis,e=this.GetSelectIndex("x","left"),g=this.GetSelectIndex("x","right"),l=0,h=0,f=0,m=0,k=0,p,n,q=null,u=null,t=this.frame_painter(),x={name:c.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};e<g;++e)if(p=d.GetBinCoord(e+.5),!a||a(p)){b?(n=c.fBinEntries[e+1],m+=c.fArray[e+1],k+=c.fSumw2[e+1]):n=c.getBinContent(e+1);if(null===q||n>u)q=p,u=n;l+=n;h+=n*p;f+=n*p*p}!t.IsAxisZoomed("x")&&0<c.fTsumw&&(l=c.fTsumw,h=c.fTsumwx,
f=c.fTsumwx2);x.integral=l;0<l&&(x.meanx=h/l,x.meany=m/l,x.rmsx=Math.sqrt(Math.abs(f/l-x.meanx*x.meanx)),x.rmsy=Math.sqrt(Math.abs(k/l-x.meany*x.meany)));null!==q&&(x.xmax=q,x.wmax=u);return x};G.prototype.FillStatistic=function(a,b,c){if(this.IgnoreStatsFill())return!1;var d=this.CountStat(),e=b%10,g=Math.floor(b/10)%10,l=Math.floor(b/100)%10,h=Math.floor(b/1E3)%10,f=Math.floor(b/1E4)%10,m=Math.floor(b/1E5)%10,k=Math.floor(b/1E6)%10,p=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.ClearPave();0<e&&
a.AddText(d.name);this.IsTProfile()?(0<g&&a.AddText("Entries = "+a.Format(d.entries,"entries")),0<l&&(a.AddText("Mean = "+a.Format(d.meanx)),a.AddText("Mean y = "+a.Format(d.meany))),0<h&&(a.AddText("Std Dev = "+a.Format(d.rmsx)),a.AddText("Std Dev y = "+a.Format(d.rmsy)))):(0<g&&a.AddText("Entries = "+a.Format(d.entries,"entries")),0<l&&a.AddText("Mean = "+a.Format(d.meanx)),0<h&&a.AddText("Std Dev = "+a.Format(d.rmsx)),0<f&&a.AddText("Underflow = "+a.Format(0<this.histo.fArray.length?this.histo.fArray[0]:
0,"entries")),0<m&&a.AddText("Overflow = "+a.Format(0<this.histo.fArray.length?this.histo.fArray[this.histo.fArray.length-1]:0,"entries")),0<k&&a.AddText("Integral = "+a.Format(d.integral,"entries")),0<p&&a.AddText("Skew = <not avail>"),0<b&&a.AddText("Kurt = <not avail>"));c&&a.FillFunctionStat(this.FindFunction("TF1"),c);return!0};G.prototype.DrawBars=function(a,b){this.CreateG(!0);var c=this.GetSelectIndex("x","left",-1);a=this.GetSelectIndex("x","right",1);var d=this.frame_painter();this.root_pad();
var e=this.GetHisto(),g=e.fXaxis,l=this.options.Text,h="",r="",m="",k=10<this.options.BarStyle?this.options.BarStyle%10:0;4<k&&(k=4);var p=d.swap_xy?0:b;!1===this.options.BaseLine||isNaN(this.options.BaseLine)||this.options.BaseLine>=d.scale_ymin&&(p=Math.round(d.gry(this.options.BaseLine)));if(l){var n=this.get_color(e.fMarkerColor);var q=-1*this.options.TextAngle;var u=20;1!==e.fMarkerSize&&q&&(u=.02*b*e.fMarkerSize);this.StartTextDrawing(42,u,this.draw_g,u)}for(b=c;b<a;++b){c=g.GetBinLowEdge(b+
1);var t=g.GetBinLowEdge(b+2);if(!(d.logx&&0>=t)){c=Math.round(d.grx(c));var x=Math.round(d.grx(t));var w=e.getBinContent(b+1);if(!(d.logy&&w<d.scale_ymin)){t=Math.round(d.gry(w));var v=x-c;c+=Math.round(e.fBarOffset/1E3*v);v=Math.round(e.fBarWidth/1E3*v);h=d.swap_xy?h+("M"+p+","+c+"h"+(t-p)+"v"+v+"h"+(p-t)+"z"):h+("M"+c+","+t+"h"+v+"v"+(p-t)+"h"+-v+"z");0<k&&(x=c+v,v=Math.round(v*k/10),d.swap_xy?(r+="M"+p+","+c+"h"+(t-p)+"v"+v+"h"+(p-t)+"z",m+="M"+p+","+x+"h"+(t-p)+"v"+-v+"h"+(p-t)+"z"):(r+="M"+
c+","+t+"h"+v+"v"+(p-t)+"h"+-v+"z",m+="M"+x+","+t+"h"+-v+"v"+(p-t)+"h"+v+"z"));l&&w&&(x=w===Math.round(w)?w.toString():f.FFormat(w,f.gStyle.fPaintTextFormat),d.swap_xy?this.DrawText({align:12,x:Math.round(t+u/2),y:Math.round(c+.1),height:Math.round(.8*v),text:x,color:n,latex:0}):q?this.DrawText({align:12,x:c+v/2,y:Math.round(t-2-u/5),width:0,height:0,rotate:q,text:x,color:n,latex:0}):this.DrawText({align:22,x:Math.round(c+.1*v),y:Math.round(t-2-u),width:Math.round(.8*v),height:u,text:x,color:n,latex:0}))}}}h&&
this.draw_g.append("svg:path").attr("d",h).call(this.fillatt.func);r&&this.draw_g.append("svg:path").attr("d",r).call(this.fillatt.func).style("fill",B.rgb(this.fillatt.color).brighter(.5).toString());m&&this.draw_g.append("svg:path").attr("d",m).call(this.fillatt.func).style("fill",B.rgb(this.fillatt.color).darker(.5).toString());l&&this.FinishTextDrawing(this.draw_g)};G.prototype.DrawFilledErrors=function(a,b){this.CreateG(!0);var c=this.GetSelectIndex("x","left",-1),d=this.GetSelectIndex("x","right",
1),e=this.frame_painter(),g=this.GetHisto(),l=g.fXaxis;b=[];for(a=[];c<d;++c){var h=l.GetBinCoord(c+.5);if(!(e.logx&&0>=h)){h=Math.round(e.grx(h));var r=g.getBinContent(c+1);var m=g.getBinError(c+1);if(!(e.logy&&r-m<e.scale_ymin)){var k=Math.round(e.gry(r+m));r=Math.round(e.gry(r-m));b.push({grx:h,gry:k});a.unshift({grx:h,gry:r})}}}d=4===this.options.ErrorKind?"bezier":"line";b=f.Painter.BuildSvgPath(d,b);a=f.Painter.BuildSvgPath("L"+d,a);this.draw_g.append("svg:path").attr("d",b.path+a.path+"Z").style("stroke",
"none").call(this.fillatt.func)};G.prototype.DrawBins=function(){function a(a){U=r.getBinContent(a+1);if(y&&0===U)return!1;N=Math.round(h.grx(m.GetBinLowEdge(a+1)));O=Math.round(h.grx(m.GetBinLowEdge(a+2)));P=Math.round((N+O)/2);M=Math.round(h.gry(U));S=Y=20;J&&(ca=r.getBinError(a+1),S=Math.round(M-h.gry(U+ca)),Y=Math.round(h.gry(U-ca)-M));return!0}function b(a){0<k.options.errorX&&(da=Math.round(P-(O-N)*k.options.errorX),W=Math.round(P+(O-N)*k.options.errorX),F+="M"+(da+Z)+","+M+ea+"h"+(W-da-2*Z)+
ea);F+="M"+P+","+(M-S+Z)+fa+"v"+(S+Y-2*Z)+fa}function c(c){if(a(c)){if(C){var d=B?r.fBinEntries[c+1]:U;0!==d&&(d=d===Math.round(d)?d.toString():f.FFormat(d,f.gStyle.fPaintTextFormat),aa?k.DrawText({align:12,x:P,y:Math.round(M-2-Q/5),width:0,height:0,rotate:aa,text:d,color:X,latex:0}):k.DrawText({align:22,x:Math.round(N+.1*(O-N)),y:Math.round(M-2-Q),width:Math.round(.8*(O-N)),height:Q,text:d,color:X,latex:0}))}D&&null!==H&&(H+=(0===H.length?"M":"L")+P+","+M);ha&&M>=-S&&M<=e+Y&&(null!==A&&(A+="M"+N+
","+(M-S)+"h"+(O-N)+"v"+(S+Y+1)+"h-"+(O-N)+"z"),null!==G&&I&&(G+=k.markeratt.create(P,M)),null!==F&&K&&b(c))}}this.CheckHistDrawAttributes();var d=this.frame_width(),e=this.frame_height();if(!this.draw_content||0>=d||0>=e)return this.RemoveDrawG();if(this.options.Bar)return this.DrawBars(d,e);if(3===this.options.ErrorKind||4===this.options.ErrorKind)return this.DrawFilledErrors(d,e);var g=this.GetSelectIndex("x","left",-1),l=this.GetSelectIndex("x","right",2),h=this.frame_painter();this.root_pad();
var r=this.GetHisto(),m=r.fXaxis,k=this,p="",n=!1,q,u,t,x,w,v,z,y=!this.options.Zero,J=this.options.Error,E=this.options.Mark,D=this.options.Line||this.options.Curve,C=this.options.Text,B=C&&"E"==this.options.TextKind&&this.IsTProfile()&&r.fBinEntries,A=null,F=null,G=null,H=null,I=!1,K=!1,ea="",fa="",Z=0,M,S,Y,U,ca,N,O,P,da,W;J&&!E&&1<r.fMarkerStyle&&(E=!0);2===this.options.ErrorKind?this.fillatt.empty()?E=!0:A="":this.options.Error&&(F="",K=!0);D&&(H="");E&&(this.createAttMarker({attr:r,style:this.options.MarkStyle}),
0<this.markeratt.size?(G="",I=!0,this.markeratt.reset_pos()):E=!1);var ha=J||E,ia=ha||C||D;E=this.options.Hist&&(!this.lineatt.empty()||!this.fillatt.empty());if(!E&&!ia)return this.RemoveDrawG();this.CreateG(!0);if(C){var X=this.get_color(r.fMarkerColor);var aa=-1*this.options.TextAngle;var Q=20;1!==r.fMarkerSize&&aa&&(Q=.02*e*r.fMarkerSize);aa||this.options.TextKind||(n=d/(l-g+1),n<3*Q&&(aa=270,Q=Math.round(.7*n)));this.StartTextDrawing(42,Q,this.draw_g,Q)}d=l-g>3*d;1===this.options.ErrorKind&&
(n=this.lineatt.width+f.gStyle.fEndErrorSize,ea="m0,"+n+"v-"+2*n+"m0,"+n,fa="m"+n+",0h-"+2*n+"m"+n+",0",Z=Math.floor((this.lineatt.width-1)/2));ia&&(d=!0);if(I||K)if(!f.gStyle.OptimizeDraw||5E4>l-g&&1==f.gStyle.OptimizeDraw){for(v=g;v<l;++v)a(v)&&(null!==G&&(G+=k.markeratt.create(P,M)),null!==F&&b(v));K=I=!1}for(v=g;v<=l;++v)if(n=m.GetBinLowEdge(v+1),!(this.logx&&0>=n)){var R=Math.round(h.grx(n));if((n=v===l)&&g<l)var L=t;else L=r.getBinContent(v+1),L=Math.round(h.gry(L));if(0===p.length){var T=z=
v;var ba=q=u=R;var V=x=w=t=L;p="M"+u+","+t}else if(d)R!==u||n?(ia&&(T===z?c(T):T<z?(c(T),c(z)):(c(z),c(T))),!E||x===w&&V===x||(ba!==u&&(p+="h"+(u-ba)),t===x?(w!==V&&(p+="v"+(w-V)),x!==w&&(p+="v"+(x-w))):(x!==V&&(p+="v"+(x-V)),w!==x&&(p+="v"+(w-x)),t!==w&&(p+="v"+(t-w))),ba=u,V=t),n&&ba!==R&&(p+="h"+(R-ba)),T=z=v,x=w=t=L,u=R):(L<x?z=v:L>w&&(T=v),x=Math.min(x,L),w=Math.max(w,L),t=L);else if(L!==t||n)R!==u&&(p+="h"+(R-u)),L!==t&&(p+="v"+(L-t)),t=L,u=R}g="";this.fillatt.empty()||(g=e+3,l=Math.round(h.gry(0)),
0>=l?g=-3:l<e&&(g=l),g="L"+u+","+g+"L"+q+","+g+"Z",0<p.length&&(p+=g));if(ha||D)null!==A&&0<A.length&&this.draw_g.append("svg:path").attr("d",A).call(this.fillatt.func),null!==F&&0<F.length&&this.draw_g.append("svg:path").attr("d",F).call(this.lineatt.func),null!==H&&0<H.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",this.options.Fill?H+g:p).attr("stroke","none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",H).attr("fill","none").call(this.lineatt.func)),
null!==G&&0<G.length&&this.draw_g.append("svg:path").attr("d",G).call(this.markeratt.func);0<p.length&&E&&this.draw_g.append("svg:path").attr("d",p).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func);C&&this.FinishTextDrawing(this.draw_g)};G.prototype.GetBinTips=function(a){var b=[],c=this.GetTipName(),d=this.frame_painter(),e=this.GetHisto(),g=e.fXaxis.GetBinLowEdge(a+1),l=e.fXaxis.GetBinLowEdge(a+2),h=e.getBinContent(a+1),r=!1;0<c.length&&b.push(c);"labels"===d.x_kind?
c=d.AxisAsText("x",g):"time"===d.x_kind?c=d.AxisAsText("x",(g+l)/2):(r=!0,c="["+d.AxisAsText("x",g)+", "+d.AxisAsText("x",l)+")");this.options.Error||this.options.Mark?(b.push("x = "+c),b.push("y = "+d.AxisAsText("y",h)),this.options.Error&&(r&&b.push("error x = "+((l-g)/2).toPrecision(4)),b.push("error y = "+e.getBinError(a+1).toPrecision(4)))):(b.push("bin = "+(a+1)),b.push("x = "+c),e.$baseh&&(h-=e.$baseh.getBinContent(a+1)),h===Math.round(h)?b.push("entries = "+h):b.push("entries = "+f.FFormat(h,
f.gStyle.fStatFormat)));return b};G.prototype.ProcessTooltip=function(a){function b(a){a=l.fXaxis.GetBinLowEdge(a+1);return g.logx&&0>=a?null:g.grx(a)}function c(a){a=l.getBinContent(a+1);return g.logy&&a<g.scale_ymin?g.swap_xy?-1E3:10*e:Math.round(g.gry(a))}if(null===a||!this.draw_content||!this.draw_g||this.options.Mode3D)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var d=this.frame_width(),e=this.frame_height(),g=this.frame_painter();this.root_pad();var l=this.GetHisto(),
h=null,f=!0,m,k=2,p=this.GetSelectIndex("x","left",-1),n=this.GetSelectIndex("x","right",2);var q=p;var u=n;var t=a.x,x=a.y;if(g.swap_xy){var w=a.x;t=x;x=w;w=e;e=d;d=w}for(;q<u-1;){var v=Math.round(.5*(q+u));h=b(v);null===h||h<t-.5?g.swap_xy?u=v:q=v:h>t+.5?g.swap_xy?q=v:u=v:(q++,u--)}h=u=q;v=b(h);if(g.swap_xy){for(;q>p&&b(q-1)<v+2;)--q;for(;u<n&&b(u+1)>v-2;)++u}else{for(;q>p&&b(q-1)>v-2;)--q;for(;u<n&&b(u+1)<v+2;)++u}if(q<u){f=e;for(v=q;v<=u;v++){var z=Math.abs(c(v)-x);z<f&&(f=z,h=v)}f>e/10&&(h=Math.round(q+
(u-q)/e*x));v=b(h)}v=Math.round(v);var y=Math.round(b(h+1));this.options.Bar&&(q=y-v,v+=Math.round(l.fBarOffset/1E3*q),y=v+Math.round(l.fBarWidth/1E3*q));v>y&&(w=v,v=y,y=w);q=Math.round((v+y)/2);u=z=m=c(h);if(this.options.Bar)f=!0,k=0,z=Math.round(g.gry(!1!==this.options.BaseLine&&this.options.BaseLine>g.scale_ymin?this.options.BaseLine:g.scale_ymin)),z>m&&(w=z,z=m,m=w),!a.touch&&1===a.nproc&&(x<z||x>m)&&(h=null);else if(this.options.Error||this.options.Mark||this.options.Line||this.options.Curve)f=
!0,d=3,this.markeratt&&(d=Math.max(d,this.markeratt.GetFullSize())),this.options.Error&&(w=l.getBinContent(h+1),m=l.getBinError(h+1),z=Math.round(g.gry(w+m)),m=Math.round(g.gry(w-m)),0==w&&this.IsTProfile()&&(h=null),y=(y-v)*this.options.errorX,v=Math.round(q-y),y=Math.round(q+y)),y-v<2*d&&(v=q-d,y=q+d),z=Math.min(z,u-d),m=Math.max(m,u+d),!a.touch&&1===a.nproc&&(x<z||x>m)&&(h=null);else if(f=1===a.nproc&&n-p<d)m=e,this.fillatt.empty()||(m=Math.round(g.gry(0)),0>m?m=0:m>e&&(m=e),m<z&&(w=z,z=m,m=w)),
(a.y<z||a.y>m)&&!a.touch&&(h=null);null!==h&&(h===p&&v>t+k?h=null:h===n-1&&y<t-k?h=null:t<v-k||t>y+k?h=null:this.options.Zero||0!==this.histo.getBinContent(h+1)||(h=null));k=this.draw_g.select(".tooltip_bin");if(null===h||0>=m||z>=e)return k.remove(),null;p={name:l.fName,title:l.fTitle,x:q,y:u,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(h)};a.disabled?(k.remove(),p.changed=!0):f?(k.empty()&&(k=this.draw_g.append("svg:rect").attr("class",
"tooltip_bin h1bin").style("pointer-events","none")),p.changed=k.property("current_bin")!==h,p.changed&&k.attr("x",g.swap_xy?z:v).attr("width",g.swap_xy?m-z:y-v).attr("y",g.swap_xy?v:z).attr("height",g.swap_xy?y-v:m-z).style("opacity","0.3").property("current_bin",h),p.exact=5>=Math.abs(u-x)||x>=z&&x<=m,p.menu=!0,p.menu_dist=Math.sqrt((q-t)*(q-t)+(u-x)*(u-x))):(t=this.lineatt.width+3,k.empty()&&(k=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",
t).call(this.lineatt.func).call(this.fillatt.func)),p.exact=Math.abs(q-a.x)<=t&&Math.abs(u-a.y)<=t,p.menu=p.exact,p.menu_dist=Math.sqrt((q-a.x)*(q-a.x)+(u-a.y)*(u-a.y)),p.changed=k.property("current_bin")!==h,p.changed&&k.attr("cx",q).attr("cy",u).property("current_bin",h));p.changed&&(p.user_info={obj:this.histo,name:this.histo.fName,bin:h,cont:this.histo.getBinContent(h+1),grx:q,gry:u});return p};G.prototype.FillHistContextMenu=function(a){a.add("Auto zoom-in",this.AutoZoom);var b=f.getDrawSettings("ROOT."+
this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.Change(5,1001);this.InteractiveRedraw("pad","drawopt")})};G.prototype.AutoZoom=function(){var a=this.GetSelectIndex("x","left",-1),b=this.GetSelectIndex("x","right",1),c=b-a,d=this.GetHisto();if(0!=c&&d){for(var e=d.getBinContent(a+1),g=a;g<b;++g)e=Math.min(e,d.getBinContent(g+
1));if(!(0<e)){for(;a<b&&d.getBinContent(a+1)<=e;)++a;for(;a<b&&d.getBinContent(b)<=e;)--b;a===b-1&&2<a&&b<this.nbinsx-2&&(--a,++b);b-a<c&&a<b&&this.frame_painter().Zoom(d.fXaxis.GetBinLowEdge(a+1),d.fXaxis.GetBinLowEdge(b+1))}}};G.prototype.CanZoomIn=function(a,b,c){var d=this.GetHisto();return"x"==a&&d&&1<d.fXaxis.FindBin(c,.5)-d.fXaxis.FindBin(b,0)||"y"==a&&Math.abs(c-b)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};G.prototype.CallDrawFunc=function(a,b){var c=this.main_painter(),d=this.frame_painter();
c!==this&&d&&d.mode3d!==this.options.Mode3D&&this.CopyOptionsFrom(c);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,b)};G.prototype.Draw2D=function(a){this.Clear3DScene();this.mode3d=!1;this.ScanContent(!0);this.CreateXY();"function"===typeof this.DrawColorPalette&&this.DrawColorPalette(!1);this.DrawAxes();this.DrawBins();this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();f.CallBack(a)};G.prototype.Draw3D=function(a,b){this.mode3d=!0;f.AssertPrerequisites("hist3d",function(){this.Draw3D(a,
b)}.bind(this))};G.prototype.Redraw=function(a){this.CallDrawFunc(null,a)};F.prototype=Object.create(y.prototype);F.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;y.prototype.Cleanup.call(this)};F.prototype.ToggleProjection=function(a,b){if("Projections"==a||"Off"==a)a="";"string"==typeof a&&1<a.length&&(b=parseInt(a.substr(1)),a=a[0]);b||(b=1);if(a&&this.is_projection==a)if(this.projection_width===b)a="";else{this.projection_width=b;return}delete this.proj_hist;a=this.is_projection===
a?"":a;this.is_projection="";this.projection_width=b;(b=this.canv_painter())&&b.ToggleProjection(a,this.RedrawProjection.bind(this,"toggling",a))};F.prototype.RedrawProjection=function(a,b,c,d){"toggling"===a&&(this.is_projection=b,a=b=void 0);if(this.is_projection){if(void 0==d){if(!this.tt_handle)return;a=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2);b=a+1;c=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2);d=c+1}var e=this.canv_painter();if(e&&!e._readonly&&void 0!==this.snapid){var g=
"EXECANDSEND:D"+this.is_projection+"PROJ:"+this.snapid+":";g="X"==this.is_projection?g+('ProjectionX("_projx",'+(c+1)+","+d+',"")'):g+('ProjectionY("_projy",'+(a+1)+","+b+',"")');e.SendWebsocket(g)}else{this.proj_hist||("X"==this.is_projection?(this.proj_hist=f.CreateHistogram("TH1D",this.nbinsx),f.extend(this.proj_hist.fXaxis,this.histo.fXaxis),this.proj_hist.fName="xproj",this.proj_hist.fTitle="X projection"):(this.proj_hist=f.CreateHistogram("TH1D",this.nbinsy),f.extend(this.proj_hist.fXaxis,this.histo.fYaxis),
this.proj_hist.fName="yproj",this.proj_hist.fTitle="Y projection"));if("X"==this.is_projection)for(g=0;g<this.nbinsx;++g){for(var l=0,h=c;h<d;++h)l+=this.histo.getBinContent(g+1,h+1);this.proj_hist.setBinContent(g+1,l)}else for(h=0;h<this.nbinsy;++h){l=0;for(g=a;g<b;++g)l+=this.histo.getBinContent(g+1,h+1);this.proj_hist.setBinContent(h+1,l)}return e.DrawProjection(this.is_projection,this.proj_hist)}}};F.prototype.ExecuteMenuCommand=function(a,b){return y.prototype.ExecuteMenuCommand.call(this,a,
b)?!0:"SetShowProjectionX"==a.fName||"SetShowProjectionY"==a.fName?(this.ToggleProjection(a.fName[17],b&&parseInt(b)?parseInt(b):1),!0):!1};F.prototype.FillHistContextMenu=function(a){if(!this.IsTH2Poly()){a.add("sub:Projections",this.ToggleProjection);var b=this.is_projection||"";b&&(b+=this.projection_width);var c="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" ");this.is_projection&&c.push("Off");for(var d=0;d<c.length;++d)a.addchk(b==c[d],c[d],c[d],this.ToggleProjection);a.add("endsub:");a.add("Auto zoom-in",
this.AutoZoom)}b=f.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.InteractiveRedraw("pad","drawopt")});this.options.Color&&this.FillPaletteMenu(a)};F.prototype.ButtonClick=function(a){if(y.prototype.ButtonClick.call(this,a))return!0;if(this!==this.main_painter())return!1;switch(a){case "ToggleColor":this.ToggleColor();break;case "ToggleColorZ":this.ToggleColz();break;
case "Toggle3D":this.ToggleMode3D();break;default:return!1}return!0};F.prototype.FillToolbar=function(){y.prototype.FillToolbar.call(this,!0);var a=this.pad_painter();a&&(this.IsTH2Poly()||a.AddButton(f.ToolbarIcons.th2color,"Toggle color","ToggleColor"),a.AddButton(f.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ"),a.AddButton(f.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D"),a.ShowButtons())};F.prototype.ToggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=
!0):this.options.Color=!this.options.Color;this._can_move_colz=!0;this.CopyOptionsToOthers();this.RedrawPad()};F.prototype.AutoZoom=function(){if(!this.IsTH2Poly()){var a=this.GetSelectIndex("x","left",-1),b=this.GetSelectIndex("x","right",1),c=this.GetSelectIndex("y","left",-1),d=this.GetSelectIndex("y","right",1),e,g,l=this.GetObject();if(a!=b&&c!=d){var h=l.getBinContent(a+1,c+1);for(e=a;e<b;++e)for(g=c;g<d;++g)h=Math.min(h,l.getBinContent(e+1,g+1));if(!(0<h)){var f=b,m=a,k=d,p=c;for(e=a;e<b;++e)for(g=
c;g<d;++g)l.getBinContent(e+1,g+1)>h&&(e<f&&(f=e),e>=m&&(m=e+1),g<k&&(k=g),g>=p&&(p=g+1));e=!1;f===m-1&&f>a+1&&m<b-1&&(f--,m++);k===p-1&&k>c+1&&p<d-1&&(k--,p++);if((f>a||m<b)&&f<m-1){var n=l.fXaxis.GetBinLowEdge(f+1);var q=l.fXaxis.GetBinLowEdge(m+1);e=!0}if((k>c||p<d)&&k<p-1){var u=l.fYaxis.GetBinLowEdge(k+1);var t=l.fYaxis.GetBinLowEdge(p+1);e=!0}e&&this.frame_painter().Zoom(n,q,u,t)}}}};F.prototype.ScanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var b;a=this.GetObject();this.nbinsx=
a.fXaxis.fNbins;this.nbinsy=a.fYaxis.fNbins;this.CreateAxisFuncs(!0);if(this.IsTH2Poly()){this.gminposbin=null;var c=this.gminbin=this.gmaxbin=0;for(b=a.fBins.arr.length;c<b;++c){var d=a.fBins.arr[c].fContent;0===c&&(this.gminbin=this.gmaxbin=d);d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d);0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d)}}else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,c=0;c<this.nbinsx;++c)for(b=0;b<this.nbinsy;++b)d=
a.getBinContent(c+1,b+1),d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d),0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d);null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.IsTH2Poly()&&(this.draw_content=!0,this.options.Line=1))}};F.prototype.CountStat=function(a){var b=this.GetHisto(),c=b.fXaxis,d=b.fYaxis,e=0,g=0,l=0,h=0,f=0,m,k,p=this.frame_painter(),
n={name:b.fName,entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){c=b.fBins.arr.length;var q,u,t,x=this.frame_painter();for(d=0;d<c;++d){var w=b.fBins.arr[d];var v=m=1;w.fXmin>x.scale_xmax?m=2:w.fXmax<x.scale_xmin&&(m=0);w.fYmin>x.scale_ymax?v=2:w.fYmax<x.scale_ymin&&(v=0);var z=k=t=0;var y=w.fPoly;var A=1;"TMultiGraph"===y._typename&&(A=w.fPoly.fGraphs.arr.length,y=null);for(u=0;u<A;++u){if(!y||0<u)y=w.fPoly.fGraphs.arr[u];
for(q=0;q<y.fNpoints;++q)++t,z+=y.fX[q],k+=y.fY[q]}1<t&&(z/=t,k/=t);w=w.fContent;n.entries+=w;n.matrix[3*v+m]+=w;if(1==m&&1==v&&(!a||a(z,k))){if(null===n.wmax||w>n.wmax)n.wmax=w,n.xmax=z,n.ymax=k;e+=w;g+=z*w;l+=k*w;h+=z*z*w;f+=k*k*w}}}else for(x=this.GetSelectIndex("x","left"),q=this.GetSelectIndex("x","right"),y=this.GetSelectIndex("y","left"),u=this.GetSelectIndex("y","right"),A=0;A<=this.nbinsx+1;++A)for(m=A<=x?0:A>q?2:1,z=c.GetBinCoord(A-.5),t=0;t<=this.nbinsy+1;++t)if(v=t<=y?0:t>u?2:1,k=d.GetBinCoord(t-
.5),w=b.getBinContent(A,t),n.entries+=w,n.matrix[3*v+m]+=w,1==m&&1==v&&(null==a||a(z,k))){if(null===n.wmax||w>n.wmax)n.wmax=w,n.xmax=z,n.ymax=k;e+=w;g+=z*w;l+=k*w;h+=z*z*w;f+=k*k*w}!p.IsAxisZoomed("x")&&!p.IsAxisZoomed("y")&&0<b.fTsumw&&(e=b.fTsumw,g=b.fTsumwx,h=b.fTsumwx2,l=b.fTsumwy,f=b.fTsumwy2);0<e&&(n.meanx=g/e,n.meany=l/e,n.rmsx=Math.sqrt(Math.abs(h/e-n.meanx*n.meanx)),n.rmsy=Math.sqrt(Math.abs(f/e-n.meany*n.meany)));null===n.wmax&&(n.wmax=0);n.integral=e;1<b.fEntries&&(n.entries=b.fEntries);
return n};F.prototype.FillStatistic=function(a,b,c){if(this.IgnoreStatsFill())return!1;var d=this.CountStat(),e=Math.floor(b%10),g=Math.floor(b/10)%10,l=Math.floor(b/100)%10,h=Math.floor(b/1E3)%10,f=Math.floor(b/1E4)%10,m=Math.floor(b/1E5)%10,k=Math.floor(b/1E6)%10,p=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.ClearPave();0<e&&a.AddText(d.name);0<g&&a.AddText("Entries = "+a.Format(d.entries,"entries"));0<l&&(a.AddText("Mean x = "+a.Format(d.meanx)),a.AddText("Mean y = "+a.Format(d.meany)));0<h&&
(a.AddText("Std Dev x = "+a.Format(d.rmsx)),a.AddText("Std Dev y = "+a.Format(d.rmsy)));0<k&&a.AddText("Integral = "+a.Format(d.matrix[4],"entries"));0<p&&(a.AddText("Skewness x = <undef>"),a.AddText("Skewness y = <undef>"));0<b&&a.AddText("Kurt = <undef>");if(0<f||0<m)d=d.matrix,a.AddText(""+d[6].toFixed(0)+" | "+d[7].toFixed(0)+" | "+d[7].toFixed(0)),a.AddText(""+d[3].toFixed(0)+" | "+d[4].toFixed(0)+" | "+d[5].toFixed(0)),a.AddText(""+d[0].toFixed(0)+" | "+d[1].toFixed(0)+" | "+d[2].toFixed(0));
c&&a.FillFunctionStat(this.FindFunction("TF1"),c);return!0};F.prototype.DrawBinsColor=function(a,b){a=this.GetHisto();b=this.PrepareColorDraw();var c=[],d=[],e=[],g,l;for(g=b.i1;g<b.i2;++g){var h=b.grx[g+1]-b.grx[g];var f=Math.round(b.grx[g]+h*b.xbar1);h=Math.round(h*(b.xbar2-b.xbar1));for(l=b.j1;l<b.j2;++l){var m=a.getBinContent(g+1,l+1);var k=this.getContourColor(m,!0);if(0===m){if(!this.options.Zero)continue;null===k&&this._show_empty_bins&&(k=0)}if(null!==k){var p=b.gry[l]-b.gry[l+1];var n=Math.round(b.gry[l+
1]+p*b.ybar1);p=Math.round(p*(b.ybar2-b.ybar1));m="M"+f+","+n;if(void 0===c[k])c[k]=m;else{var q="m"+(f-d[k])+","+(n-e[k]);c[k]+=q.length<m.length?q:m}d[k]=f;e[k]=n;c[k]+="v"+p+"h"+h+"v"+-p+"z"}}}for(k=0;k<c.length;++k)void 0!==c[k]&&this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",this.fPalette.getColor(k)).attr("d",c[k]);return b};F.prototype.BuildContour=function(a,b,c,d){function e(a){for(var c=0;c<b.length;++c)if(a<b[c])return c-1;return b.length-1}function g(a,c,d,e,g,l,f,
n){var p=d===f;f=p?n-e:f-d;c+=1;g-=a;n=k-1;for(var q=999+k,t=0,u;c<=l&&n<=q;)u=b[c],u-=a,u/=g,u*=f,p?(h[n]=d,r[n]=e+u):(h[n]=d+u,r[n]=e),m[n]=c,t++,n+=2,c++;return t}var l=this.GetObject(),h=new Float32Array(4008),r=new Float32Array(4008),m=new Int32Array(4008),k=0,p=[],n=0,q=[0,0,0,0],u=[0,0,0,0],t=[0,0,0,0],x=[0,0,0,0],w,v,z,y,A=a.original?a.origx:a.grx,E=a.original?a.origy:a.gry;for(v=a.j1;v<a.j2-1;++v)for(u[1]=u[0]=(E[v]+E[v+1])/2,u[3]=u[2]=(E[v+1]+E[v+2])/2,w=a.i1;w<a.i2-1;++w){t[0]=l.getBinContent(w+
1,v+1);t[1]=l.getBinContent(w+2,v+1);t[2]=l.getBinContent(w+2,v+2);t[3]=l.getBinContent(w+1,v+2);for(z=0;4>z;z++)x[z]=e(t[z]);if(x[0]!==x[1]||x[1]!==x[2]||x[2]!==x[3]||x[3]!==x[0]){q[3]=q[0]=(A[w]+A[w+1])/2;q[2]=q[1]=(A[w+1]+A[w+2])/2;var D=t[0]<=t[1]?0:1;var C=t[2]<=t[3]?2:3;t[D]>t[C]&&(D=C);D++;for(z=k=1;4>=z;z++)C=D%4+1,D=g(t[D-1],x[D-1],q[D-1],u[D-1],t[C-1],x[C-1],q[C-1],u[C-1]),k+=2*D,D=C;D=t[0]<=t[1]?0:1;C=t[2]<=t[3]?2:3;t[D]>t[C]&&(D=C);D++;k=2;for(z=1;4>=z;z++)C=1==D?4:D-1,D=g(t[D-1],x[D-
1],q[D-1],u[D-1],t[C-1],x[C-1],q[C-1],u[C-1]),k+=2*D,D=C;C=0;for(z=1;z<=k-5;z+=2)for(;m[z-1]!=m[z];){D=h[z];var B=r[z];var F=m[z];for(y=z;y<=k-5;y+=2)h[y]=h[y+2],r[y]=r[y+2],m[y]=m[y+2];h[k-3]=D;r[k-3]=B;m[k-3]=F;if(2E3<C)break;C++}if(!(2E3<C))for(z=1;z<=k-2;z+=2)C=m[z-1],0<=C&&C<b.length&&((B=p[C])||(B=p[C]=f.CreateTPolyLine(8016,!0)),D=B.fLastPoint,D<B.fN-2&&(B.fX[D+1]=Math.round(h[z-1]),B.fY[D+1]=Math.round(r[z-1]),B.fX[D+2]=Math.round(h[z]),B.fY[D+2]=Math.round(r[z]),B.fLastPoint=D+2,n=Math.max(n,
B.fLastPoint+1)))}}a=new Int32Array(b.length);for(C=w=0;C<b.length;C++)if(0<=b[C]){w=C;break}z=0;for(C=w-1;0<=C;C--)a[z]=C,z++;for(C=w;C<b.length;C++)a[z]=C,z++;l=new Float32Array(2*n);q=new Float32Array(2*n);for(z=0;z<b.length;++z)if(C=a[z],B=p[C])for(u=c.calcColorIndex(C,b.length),t=B.fX,x=B.fY,D=B.fLastPoint+1,E=0;;){v=n;A=v+1;l[v]=t[E];q[v]=x[E];l[A]=t[E+1];q[A]=x[E+1];t[E]=t[E+1]=0;for(x[E]=x[E+1]=0;;){E=0;for(w=2;w<D;w+=2)A<2*n-1&&t[w]===l[A]&&x[w]===q[A]&&(A++,l[A]=t[w+1],q[A]=x[w+1],t[w]=
t[w+1]=0,x[w]=x[w+1]=0,E++),0<v&&t[w+1]===l[v]&&x[w+1]===q[v]&&(v--,l[v]=t[w],q[v]=x[w],t[w]=t[w+1]=0,x[w]=x[w+1]=0,E++);if(0==E)break}v+1<A&&0<=v&&d(u,l,q,v,A,C);E=0;for(w=2;w<D;w+=2)if(0!==t[w]&&0!==x[w]){E=w;break}if(0===E)break}};F.prototype.DrawBinsContour=function(a,b){function c(a,b,c,d){var e="",g=null,f;for(f=c;f<=d;++f){c=null;switch(h.projection){case 1:c=h.ProjectAitoff2xy(a[f],b[f]);break;case 2:c=h.ProjectMercator2xy(a[f],b[f]);break;case 3:c=h.ProjectSinusoidal2xy(a[f],b[f]);break;
case 4:c=h.ProjectParabolic2xy(a[f],b[f])}c?(c.x=h.grx(c.x),c.y=h.gry(c.y)):c={x:a[f],y:b[f]};c.x=Math.round(c.x);c.y=Math.round(c.y);e?c.x!=g.x&&c.y!=g.y?e+="l"+(c.x-g.x)+","+(c.y-g.y):c.x!=g.x?e+="h"+(c.x-g.x):c.y!=g.y&&(e+="v"+(c.y-g.y)):e="M"+c.x+","+c.y;g=c}return e}var d=this.PrepareColorDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),e=this.GetContour(),g=this.GetPalette(),l=this,h=this.frame_painter();if(14===this.options.Contour){a="M0,0h"+a+"v"+b+"h-"+a;if(this.options.Proj){a=
d.j2-d.j1;b=new Float32Array(2*a);for(var r=new Float32Array(2*a),m=0;m<a;++m)b[m]=d.origx[d.i1],r[m]=(d.origy[d.j1]*(m+.5)+d.origy[d.j2]*(a-.5-m))/a,b[m+a]=d.origx[d.i2],r[m+a]=(d.origy[d.j2]*(m+.5)+d.origy[d.j1]*(a-.5-m))/a;a=c(b,r,0,2*a-1)}this.draw_g.append("svg:path").attr("d",a+"z").style("stroke","none").style("fill",g.calcColor(0,e.length))}this.BuildContour(d,e,g,function(a,b,d,e,h){var k=g.getColor(a),m=k,n=null;switch(l.options.Contour){case 11:m="none";n=new f.TAttLineHandler({color:k});
break;case 12:m="none";n=new f.TAttLineHandler({color:1,style:a%5+1,width:1});break;case 13:m="none",n=l.lineatt}a=l.draw_g.append("svg:path").attr("class","th2_contour").attr("d",c(b,d,e,h)+("none"==m?"":"z")).style("fill",m);null!==n?a.call(n.func):a.style("stroke","none")});d.hide_only_zeros=!0;return d};F.prototype.CreatePolyBin=function(a,b,c){function d(a,c,d,e){var g=Math.sqrt((a-d)*(a-d)+(c-e)*(c-e));b._sumx+=(a+d)*g/2;b._sumy+=(c+e)*g/2;b._suml+=g}var e="",g,f=1,h=null;"TMultiGraph"==b.fPoly._typename?
f=b.fPoly.fGraphs.arr.length:h=b.fPoly;c&&(b._sumx=b._sumy=b._suml=0);for(g=0;g<f;++g){if(!h||0<g)h=b.fPoly.fGraphs.arr[g];var r=h.fNpoints,m,k=h.fX,p=h.fY,n=Math.round(a.grx(k[0])),q=Math.round(a.gry(p[0]));2<r&&k[0]==k[r-1]&&p[0]==p[r-1]&&r--;e+="M"+n+","+q;for(m=1;m<r;++m){var u=Math.round(a.grx(k[m]));var t=Math.round(a.gry(p[m]));c&&d(n,q,u,t);if(n!==u||q!==t)e=n===u?e+("v"+(t-q)):q===t?e+("h"+(u-n)):e+("l"+(u-n)+","+(t-q));n=u;q=t}c&&d(n,q,Math.round(a.grx(k[0])),Math.round(a.gry(p[0])));e+=
"z"}c&&(0<b._suml?(b._midx=Math.round(b._sumx/b._suml),b._midy=Math.round(b._sumy/b._suml)):(b._midx=Math.round(a.grx((b.fXmin+b.fXmax)/2)),b._midy=Math.round(a.gry((b.fYmin+b.fYmax)/2))));return e};F.prototype.DrawPolyBinsColor=function(a,b){var c=this.GetObject(),d=this.frame_painter(),e=[];a=[];var g,l=c.fBins.arr.length;this.fContour=null;this.fCustomContour=!1;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(g=0;g<l;++g){var h=c.fBins.arr[g];var r=this.getContourColor(h.fContent,
!0);if(null!==r){if(0===h.fContent){if(!this.options.Zero||!this.options.Line)continue;r=0}if(!(h.fXmin>d.scale_xmax||h.fXmax<d.scale_xmin||h.fYmin>d.scale_ymax||h.fYmax<d.scale_ymin)){var m=this.CreatePolyBin(d,h,this.options.Text&&h.fContent);e[r]=void 0===e[r]?m:e[r]+m;this.options.Text&&h.fContent&&a.push(h)}}}for(r=0;r<e.length;++r)e[r]&&(h=this.draw_g.append("svg:path").attr("palette-index",r).attr("fill",r?this.fPalette.getColor(r):"none").attr("d",e[r]),this.options.Line&&h.call(this.lineatt.func));
if(0<a.length){e=this.get_color(c.fMarkerColor);r=-1*this.options.TextAngle;d=this.draw_g.append("svg:g").attr("class","th2poly_text");h=12;1!==c.fMarkerSize&&r&&(h=Math.round(.02*b*c.fMarkerSize));this.StartTextDrawing(42,h,d,h);for(g=0;g<a.length;++g)h=a[g],b="",this.options.TextKind?(h.fPoly&&(b=h.fPoly.fName),"Graph"===b&&(b=""),b||(b=h.fNumber)):b=Math.round(h.fContent)===h.fContent?h.fContent.toString():f.FFormat(h.fContent,f.gStyle.fPaintTextFormat),this.DrawText({align:22,x:h._midx,y:h._midy,
rotate:r,text:b,color:e,latex:0,draw_g:d});this.FinishTextDrawing(d,null)}return{poly:!0}};F.prototype.DrawBinsText=function(a,b,c){a=this.GetObject();var d=this.get_color(a.fMarkerColor),e=-1*this.options.TextAngle,g=this.draw_g.append("svg:g").attr("class","th2_text");var l=20;var h=0,r="E"==this.options.TextKind&&this.MatchObjectType("TProfile2D")&&"function"==typeof a.getBinEntries;null===c&&(c=this.PrepareColorDraw({rounding:!1}));1!==a.fMarkerSize&&e&&(l=Math.round(.02*b*a.fMarkerSize));0!==
a.fBarOffset&&(h=.001*a.fBarOffset);this.StartTextDrawing(42,l,g,l);for(b=c.i1;b<c.i2;++b)for(l=c.j1;l<c.j2;++l){var m=a.getBinContent(b+1,l+1);if(0!==m||this._show_empty_bins){var k=c.grx[b+1]-c.grx[b];var p=c.gry[l]-c.gry[l+1];r&&(m=a.getBinEntries(b+1,l+1));m=m===Math.round(m)?m.toString():f.FFormat(m,f.gStyle.fPaintTextFormat);if(e){var n=Math.round(c.grx[b]+.5*k);var q=Math.round(c.gry[l+1]+p*(.5+h));p=k=0}else n=Math.round(c.grx[b]+.1*k),q=Math.round(c.gry[l+1]+p*(.1+h)),k=Math.round(.8*k),
p=Math.round(.8*p);this.DrawText({align:22,x:n,y:q,width:k,height:p,rotate:e,text:m,color:d,latex:0,draw_g:g})}}this.FinishTextDrawing(g,null);c.hide_only_zeros=!0;return c};F.prototype.DrawBinsArrow=function(a,b){a=this.GetObject();b="";var c,d,e,g=1E-30,f=this.PrepareColorDraw({rounding:!1}),h=(f.grx[f.i2]-f.grx[f.i1])/(f.i2-f.i1+1-.03)/2,r=(f.gry[f.j2]-f.gry[f.j1])/(f.j2-f.j1+1-.03)/2;for(e=0;2>e;++e)for(c=f.i1;c<f.i2;++c)for(d=f.j1;d<f.j2;++d){var m=c===f.i1?a.getBinContent(c+2,d+1)-a.getBinContent(c+
1,d+1):c===f.i2-1?a.getBinContent(c+1,d+1)-a.getBinContent(c,d+1):.5*(a.getBinContent(c+2,d+1)-a.getBinContent(c,d+1));var k=d===f.j1?a.getBinContent(c+1,d+2)-a.getBinContent(c+1,d+1):d===f.j2-1?a.getBinContent(c+1,d+1)-a.getBinContent(c+1,d):.5*(a.getBinContent(c+1,d+2)-a.getBinContent(c+1,d));if(0===e)g=Math.max(g,Math.abs(m),Math.abs(k));else{var p=(f.grx[c]+f.grx[c+1])/2;var n=(f.gry[d]+f.gry[d+1])/2;var q=h*m/g;m=r*k/g;var u=p-q;k=p+q;p=n-m;n+=m;m=Math.round(k-u);k=Math.round(n-p);if(0!==m||
0!==k)if(b+="M"+Math.round(u)+","+Math.round(p)+"l"+m+","+k,5<Math.abs(m)||5<Math.abs(k))n=Math.sqrt(2/(m*m+k*k)),u=Math.round(n*(m+k)),m=Math.round(n*(m-k)),0!==u&&0!==m&&(b+="l"+-u+","+m+"m"+u+","+-m+"l"+-m+","+-u)}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",b).style("fill","none").call(this.lineatt.func);return f};F.prototype.DrawBinsBox=function(a,b){var c=this.GetObject();a=this.PrepareColorDraw({rounding:!1});var d=this.main_painter();d===this&&(d.maxbin===d.minbin&&
(d.maxbin=d.gmaxbin,d.minbin=d.gminbin,d.minposbin=d.gminposbin),d.maxbin===d.minbin&&(d.minbin=Math.min(0,d.maxbin-1)));var e=Math.max(Math.abs(d.maxbin),Math.abs(d.minbin)),g=Math.max(0,d.minbin),f="",h=b="",r="",m=!1,k=0;if(this.root_pad().fLogz&&0<e){m=!0;e=Math.log(e);k=0<g?Math.log(g):1<=d.minposbin&&100>d.minposbin?Math.log(.7):0<d.minposbin?Math.log(.7*d.minposbin):e-10;k>=e&&(k=e-10);var p=1/(e-k)}else p=1/(e-g);for(d=a.i1;d<a.i2;++d)for(e=a.j1;e<a.j2;++e){var n=c.getBinContent(d+1,e+1);
var q=Math.abs(n);if(!(0===q||q<g)){var u=m?0<q?Math.log(q)-k:0:q-g;u=.5*(0>u?1:1-Math.sqrt(u*p));0>u&&(u=0);q=a.grx[d+1]-a.grx[d];var t=a.gry[e]-a.gry[e+1];var x=u*q;var w=u*t;u=Math.round(a.grx[d]+x);var v=Math.round(a.gry[e+1]+w);q=Math.max(Math.round(q-2*x),1);t=Math.max(Math.round(t-2*w),1);f+="M"+u+","+v+"v"+t+"h"+q+"v-"+t+"z";0>n&&10===this.options.BoxStyle&&(b+="M"+u+","+v+"l"+q+","+t+"M"+(u+q)+","+v+"l-"+q+","+t);if(11===this.options.BoxStyle&&5<q&&5<t){w=Math.round(.1*q);var y=Math.round(.1*
t);x="M"+u+","+v+"h"+q+"l"+-w+","+y+"h"+(2*w-q)+"v"+(t-2*y)+"l"+-w+","+y+"z";q="M"+(u+q)+","+(v+t)+"v"+-t+"l"+-w+","+y+"v"+(t-2*y)+"h"+(2*w-q)+"l"+-w+","+y+"z";0>n?(r+=x,h+=q):(h+=x,r+=q)}}}0<f.length&&(c=this.draw_g.append("svg:path").attr("d",f).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?c.call(this.lineatt.func):c.style("stroke","none"));0<h.length&&"none"!==this.fillatt.color&&this.draw_g.append("svg:path").attr("d",h).style("stroke","none").call(this.fillatt.func).style("fill",
B.rgb(this.fillatt.color).brighter(.5).toString());0<r.length&&this.draw_g.append("svg:path").attr("d",r).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":B.rgb(this.fillatt.color).darker(.5).toString());0<b.length&&(c=this.draw_g.append("svg:path").attr("d",b).style("fill","none"),"none"!==this.lineatt.color?c.call(this.lineatt.func):c.style("stroke","black"));return a};F.prototype.DrawCandle=function(a,b){b=this.GetHisto();var c=this.PrepareColorDraw(),
d=this.frame_painter(),e,g,f,h,r="",m="";1===b.fMarkerColor&&(b.fMarkerColor=b.fLineColor);this.createAttMarker({attr:b,style:5});this.markeratt.reset_pos();c.candle=[];for(e=c.i1;e<c.i2;++e){for(a=f=h=g=0;a<this.nbinsy;++a)h+=b.getBinContent(e+1,a+1);var k={bin:e,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(a=0;a<this.nbinsy;++a){var p=b.getBinContent(e+1,a+1);var n=b.fYaxis.GetBinCenter(a+1);.001>f/h&&.001<=(f+p)/h&&(k.whiskerm=n);.25>f/h&&.25<=(f+p)/h&&(k.m25y=n);.5>f/h&&.5<=
(f+p)/h&&(k.median=n);.75>f/h&&.75<=(f+p)/h&&(k.p25y=n);.999>f/h&&.999<=(f+p)/h&&(k.whiskerp=n);f+=p;g+=p*n}0<f&&(k.meany=g/f);k.iqr=k.p25y-k.m25y;k.m25y-1.5*k.iqr>k.whsikerm&&(k.whiskerm=k.m25y-1.5*k.iqr);k.p25y+1.5*k.iqr<k.whiskerp&&(k.whiskerp=k.p25y+1.5*k.iqr);if(!(d.logy&&0>=k.whiskerm)){a=c.grx[e+1]-c.grx[e];a*=.66;g=(c.grx[e+1]+c.grx[e])/2+b.fBarOffset/1E3*a;0<b.fBarWidth&&(a=a*b.fBarWidth/1E3);k.x1=Math.round(g-a/2);k.x2=Math.round(g+a/2);g=Math.round(g);k.y0=Math.round(d.gry(k.median));r+=
"M"+k.x1+","+k.y0+"h"+(k.x2-k.x1);k.y1=Math.round(d.gry(k.p25y));k.y2=Math.round(d.gry(k.m25y));r+="M"+k.x1+","+k.y1+"v"+(k.y2-k.y1)+"h"+(k.x2-k.x1)+"v-"+(k.y2-k.y1)+"z";k.yy1=Math.round(d.gry(k.whiskerp));k.yy2=Math.round(d.gry(k.whiskerm));r+="M"+g+","+k.y1+"v"+(k.yy1-k.y1);r+="M"+k.x1+","+k.yy1+"h"+(k.x2-k.x1);r+="M"+g+","+k.y2+"v"+(k.yy2-k.y2);r+="M"+k.x1+","+k.yy2+"h"+(k.x2-k.x1);for(a=0;a<this.nbinsy;++a)p=b.getBinContent(e+1,a+1),n=b.fYaxis.GetBinCenter(a+1),0<p&&n<k.whiskerm&&(m+=this.markeratt.create(g,
n)),0<p&&n>k.whiskerp&&(m+=this.markeratt.create(g,n));c.candle.push(k)}}0<r.length&&this.draw_g.append("svg:path").attr("d",r).call(this.lineatt.func).call(this.fillatt.func);0<m.length&&this.draw_g.append("svg:path").attr("d",m).call(this.markeratt.func);return c};F.prototype.DrawBinsScatter=function(a,b){var c=this.GetObject();a=this.PrepareColorDraw({rounding:!0,pixel_density:!0});b=[];var d=[],e=[],g=[],l=[],h,r,m=1;var k=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);f.seed(a.sumz);
if(1E5>k*a.sumz){this.createAttMarker({attr:c});this.markeratt.reset_pos();d="";for(h=a.i1;h<a.i2;++h){var p=a.grx[h+1]-a.grx[h];for(r=a.j1;r<a.j2;++r){var n=a.gry[r]-a.gry[r+1];var q=c.getBinContent(h+1,r+1);e=Math.round(k*q);if(!(0>=e))for(b=0;b<e;++b)d+=this.markeratt.create(Math.round(a.grx[h]+p*f.random()),Math.round(a.gry[r+1]+n*f.random()))}}this.draw_g.append("svg:path").attr("d",d).call(this.markeratt.func);return a}.7<this.maxbin&&(m=.7/this.maxbin);k=Math.round(a.max-a.min);this.CreateContour(50<
k?50:k,this.minposbin,this.maxbin,this.minposbin);for(h=a.i1;h<a.i2;++h)for(r=a.j1;r<a.j2;++r)if(q=c.getBinContent(h+1,r+1),!(0>=q||q<this.minbin||(p=a.grx[h+1]-a.grx[h],n=a.gry[r]-a.gry[r+1],0>=p*n||(k=this.getContourIndex(q/p/n),0>k)))){q="M"+a.grx[h]+","+a.gry[r+1];if(void 0===b[k])b[k]=q,g[k]=p,l[k]=n;else{var u="m"+(a.grx[h]-d[k])+","+(a.gry[r+1]-e[k]);b[k]+=u.length<q.length?u:q;g[k]=Math.max(g[k],p);l[k]=Math.max(l[k],n)}d[k]=a.grx[h];e[k]=a.gry[r+1];b[k]+="v"+n+"h"+p+"v-"+n+"z"}k=this.svg_frame().select(".main_layer");
h=k.select("defs");h.empty()&&0<b.length&&(h=k.insert("svg:defs",":first-child"));this.createAttMarker({attr:c});for(k=0;k<b.length;++k)if(void 0!==b[k]&&k<this.fContour.length){d="scatter_"+k;c=h.select("."+d);c.empty()?c=h.append("svg:pattern").attr("class",d).attr("id","jsroot_scatter_pattern_"+f.id_counter++).attr("patternUnits","userSpaceOnUse"):c.selectAll("*").remove();e=Math.round(m*this.fContour[k]*g[k]*l[k]);1>e&&(e=1);r=new Float32Array(e);p=new Float32Array(e);if(1===e)r[0]=p[0]=.5;else for(n=
0;n<e;++n)r[n]=f.random(),p[n]=f.random();this.markeratt.reset_pos();d="";for(n=0;n<e;++n)d+=this.markeratt.create(r[n]*g[k],p[n]*l[k]);c.attr("width",g[k]).attr("height",l[k]).append("svg:path").attr("d",d).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",k).attr("fill","url(#"+c.attr("id")+")").attr("d",b[k])}return a};F.prototype.DrawBins=function(){if(!this.draw_content)return this.RemoveDrawG();this.CheckHistDrawAttributes();this.CreateG(!0);var a=this.frame_width(),
b=this.frame_height(),c=null;this.IsTH2Poly()?c=this.DrawPolyBinsColor(a,b):(this.options.Scat?c=this.DrawBinsScatter(a,b):this.options.Color?c=this.DrawBinsColor(a,b):this.options.Box?c=this.DrawBinsBox(a,b):this.options.Arrow?c=this.DrawBinsArrow(a,b):this.options.Contour?c=this.DrawBinsContour(a,b):this.options.Candle&&(c=this.DrawCandle(a,b)),this.options.Text&&(c=this.DrawBinsText(a,b,c)),c||(c=this.DrawBinsScatter(a,b)));this.tt_handle=c};F.prototype.GetBinTips=function(a,b){var c=[],d=this.frame_painter(),
e=this.GetHisto(),g=e.getBinContent(a+1,b+1);c.push(this.GetTipName());"labels"==d.x_kind?c.push("x = "+d.AxisAsText("x",e.fXaxis.GetBinLowEdge(a+1))):c.push("x = ["+d.AxisAsText("x",e.fXaxis.GetBinLowEdge(a+1))+", "+d.AxisAsText("x",e.fXaxis.GetBinLowEdge(a+2))+")");"labels"==d.y_kind?c.push("y = "+d.AxisAsText("y",e.fYaxis.GetBinLowEdge(b+1))):c.push("y = ["+d.AxisAsText("y",e.fYaxis.GetBinLowEdge(b+1))+", "+d.AxisAsText("y",e.fYaxis.GetBinLowEdge(b+2))+")");c.push("bin = "+a+", "+b);e.$baseh&&
(g-=e.$baseh.getBinContent(a+1,b+1));g===Math.round(g)?c.push("entries = "+g):c.push("entries = "+f.FFormat(g,f.gStyle.fStatFormat));return c};F.prototype.GetCandleTips=function(a){var b=[],c=this.frame_painter(),d=this.GetHisto();b.push(this.GetTipName());b.push("x = "+c.AxisAsText("x",d.fXaxis.GetBinLowEdge(a.bin+1)));b.push("mean y = "+f.FFormat(a.meany,f.gStyle.fStatFormat));b.push("m25 = "+f.FFormat(a.m25y,f.gStyle.fStatFormat));b.push("p25 = "+f.FFormat(a.p25y,f.gStyle.fStatFormat));return b};
F.prototype.ProvidePolyBinHints=function(a,b,c){a=this.GetHisto().fBins.arr[a];var d=this.frame_painter(),e=a.fPoly.fName,g=[],l=0;"Graph"===e&&(e="");0===e.length&&(e=a.fNumber);if(void 0===b&&void 0===c){b=c=0;var h=a.fPoly,r=1;"TMultiGraph"===h._typename&&(r=a.fPoly.fGraphs.arr.length,h=null);for(var m=0;m<r;++m){if(!h||0<m)h=a.fPoly.fGraphs.arr[m];for(var k=0;k<h.fNpoints;++k)++l,b+=h.fX[k],c+=h.fY[k]}1<l&&(b/=l,c/=l)}g.push(this.GetTipName());g.push("x = "+d.AxisAsText("x",b));g.push("y = "+
d.AxisAsText("y",c));0<l&&g.push("npnts = "+l);g.push("bin = "+e);a.fContent===Math.round(a.fContent)?g.push("content = "+a.fContent):g.push("content = "+f.FFormat(a.fContent,f.gStyle.fStatFormat));return g};F.prototype.ProcessTooltip=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var b=this.GetHisto(),c=this.tt_handle,d=this.draw_g.select(".tooltip_bin");if(c.poly){c=this.frame_painter();
var e,g,f=-1;c.grx===c.x&&(e=c.x.invert(a.x));c.gry===c.y&&(g=c.y.invert(a.y));if(void 0!==e&&void 0!==g){var h,r=b.fBins.arr.length;for(h=0;h<r&&0>f;++h){var m=b.fBins.arr[h];if(!(e<m.fXmin||e>m.fXmax||g<m.fYmin||g>m.fYmax||0===m.fContent&&!this.options.Zero)){var k=m.fPoly,p=1;"TMultiGraph"===k._typename&&(p=m.fPoly.fGraphs.arr.length,k=null);for(var n=0;n<p;++n){if(!k||0<n)k=m.fPoly.fGraphs.arr[n];if(k.IsInside(e,g)){f=h;break}}}}}if(0>f)return d.remove(),null;e={name:b.fName,title:b.fTitle,x:a.x,
y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",exact:!0,menu:!0,lines:this.ProvidePolyBinHints(f,e,g)};a.disabled?(d.remove(),e.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),e.changed=d.property("current_bin")!==f,e.changed&&d.attr("d",this.CreatePolyBin(c,m)).style("opacity","0.7").property("current_bin",f));e.changed&&(e.user_info={obj:b,name:b.fName,bin:f,
cont:m.fContent,grx:a.x,gry:a.y});return e}if(c.candle){for(h=0;h<c.candle.length;++h){var q=c.candle[h];if(q.x1<=a.x&&a.x<=q.x2&&q.yy1<=a.y&&a.y<=q.yy2)break}if(h>=c.candle.length)return d.remove(),null;e={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetCandleTips(q),exact:!0,menu:!0};a.disabled?(d.remove(),e.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events",
"none")),e.changed=d.property("current_bin")!==h,e.changed&&d.attr("x",q.x1).attr("width",q.x2-q.x1).attr("y",q.yy1).attr("height",q.yy2-q.yy1).style("opacity","0.7").property("current_bin",h));e.changed&&(e.user_info={obj:b,name:b.fName,bin:h+1,cont:q.median,binx:h+1,biny:1,grx:a.x,gry:a.y});return e}g=0;q=null;for(h=c.i1;h<c.i2&&!(a.x>=c.grx[h]&&a.x<=c.grx[h+1]);++h);for(m=c.j1;m<c.j2&&!(a.y>=c.gry[m+1]&&a.y<=c.gry[m]);++m);if(h<c.i2&&m<c.j2){f=h;r=h+1;k=m;p=m+1;n=c.grx[f];var u=c.grx[r];var t=
c.gry[p];var x=c.gry[k];e=!0;this.options.Color&&(g=u-n,q=x-t,u=Math.round(n+g*c.xbar2),n=Math.round(n+g*c.xbar1),x=Math.round(t+q*c.ybar2),t=Math.round(t+q*c.ybar1),a.x<n||a.x>=u||a.y<t||a.y>=x)&&(e=!1);g=b.getBinContent(h+1,m+1);this.is_projection?q=0:e?c.hide_only_zeros?q=0!==g||this._show_empty_bins?0:null:(q=this.getContourColor(g,!0),null===q&&0===g&&this._show_empty_bins&&(q=0)):q=null}if(null===q)return d.remove(),null;e={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:
"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(h,m),exact:!0,menu:!0};this.options.Color&&(e.color2=this.GetPalette().getColor(q));a.disabled&&!this.is_projection?(d.remove(),e.changed=!0):(d.empty()&&(d=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),q=1E4*h+m,"X"==this.is_projection?(n=0,u=this.frame_width(),1<this.projection_width&&(q=(this.projection_width-1)/2,p+q>=c.j2?(p=Math.min(Math.round(p+q),c.j2),
k=Math.max(p-this.projection_width,c.j1)):(k=Math.max(Math.round(k-q),c.j1),p=Math.min(k+this.projection_width,c.j2))),t=c.gry[p],x=c.gry[k],q=777*k+333*p):"Y"==this.is_projection&&(t=0,x=this.frame_height(),1<this.projection_width&&(q=(this.projection_width-1)/2,r+q>=c.i2?(r=Math.min(Math.round(r+q),c.i2),f=Math.max(r-this.projection_width,c.i1)):(f=Math.max(Math.round(f-q),c.i1),r=Math.min(f+this.projection_width,c.i2))),n=c.grx[f],u=c.grx[r],q=777*f+333*r),e.changed=d.property("current_bin")!==
q,e.changed&&d.attr("x",n).attr("width",u-n).attr("y",t).attr("height",x-t).style("opacity","0.7").property("current_bin",q),this.is_projection&&e.changed&&this.RedrawProjection(f,r,k,p));e.changed&&(e.user_info={obj:b,name:b.fName,bin:b.getBin(h+1,m+1),cont:g,binx:h+1,biny:m+1,grx:a.x,gry:a.y});return e};F.prototype.CanZoomIn=function(a,b,c){if("z"==a)return!0;var d=this.GetHisto();d&&(d="y"==a?d.fYaxis:d.fXaxis);return!d||1<d.FindBin(c,.5)-d.FindBin(b,0)};F.prototype.Draw2D=function(a,b){this.Clear3DScene();
this.mode3d=!1;this.CreateXY();b=this.DrawColorPalette(this.options.Zscale&&(this.options.Color||this.options.Contour),!0);this.DrawAxes();this.DrawBins();b&&b.DrawPave();this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();f.CallBack(a)};F.prototype.Draw3D=function(a,b){this.mode3d=!0;f.AssertPrerequisites("hist3d",function(){this.Draw3D(a,b)}.bind(this))};F.prototype.CallDrawFunc=function(a,b){var c=this.main_painter(),d=this.frame_painter();c!==this&&d&&d.mode3d!==this.options.Mode3D&&
this.CopyOptionsFrom(c);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,b)};F.prototype.Redraw=function(a){this.CallDrawFunc(null,a)};I.prototype=Object.create(f.TObjectPainter.prototype);I.prototype.Cleanup=function(){var a=this.pad_painter();a&&a.CleanPrimitives(this.Selector.bind(this,!0));delete this.firstpainter;delete this.painters;f.TObjectPainter.prototype.Cleanup.call(this)};I.prototype.HasErrors=function(a){if(a.fSumw2&&0<a.fSumw2.length)for(var b=0;b<a.fSumw2.length;++b)if(0<a.fSumw2[b])return!0;
return!1};I.prototype.BuildStack=function(a){if(!a.fHists)return!1;var b=a.fHists.arr.length;if(0>=b)return!1;var c=f.Create("TList");c.Add(f.clone(a.fHists.arr[0]),a.fHists.opt[0]);for(var d=1;d<b;++d){var e=f.clone(a.fHists.arr[d]),g=a.fHists.opt[d],l=c.arr[d-1];if(e.fNbins!=l.fNbins||e.fXaxis.fXmin!=l.fXaxis.fXmin||e.fXaxis.fXmax!=l.fXaxis.fXmax)return f.console("When drawing THStack, cannot sum-up histograms "+e.fName+" and "+l.fName),c.Clear(),!1;for(var h=0;h<e.fArray.length;++h)e.fArray[h]+=
l.fArray[h];c.Add(e,g)}a.fStack=c;return!0};I.prototype.GetHistMinMax=function(a,b){var c={min:0,max:0},d=!0,e=!0;-1111!==a.fMinimum&&(c.min=a.fMinimum,d=!1);-1111!==a.fMaximum&&(c.max=a.fMaximum,e=!1);if(!d&&!e)return c;var g=1,l=a.fXaxis.fNbins,h=1,r=1,m=!0;a.fXaxis.TestBit(f.EAxisBits.kAxisRange)&&(g=a.fXaxis.fFirst,l=a.fXaxis.fLast);0===a._typename.indexOf("TH2")&&(r=a.fYaxis.fNbins,a.fYaxis.TestBit(f.EAxisBits.kAxisRange)&&(h=a.fYaxis.fFirst,r=a.fYaxis.fLast));for(;h<=r;++h)for(var k=g;k<=l;++k){var p=
a.getBinContent(k,h),n=b?a.getBinError(a.getBin(k,h)):0;d&&(m||p-n<c.min)&&(c.min=p-n);e&&(m||p+n>c.max)&&(c.max=p+n);m=!1}return c};I.prototype.GetMinMax=function(a,b){var c={min:0,max:0},d=this.GetObject();if(this.options.nostack)for(var e=0;e<d.fHists.arr.length;++e){var g=this.GetHistMinMax(d.fHists.arr[e],a);0==e?c=g:(c.min=Math.min(c.min,g.min),c.max=Math.max(c.max,g.max))}else c.min=this.GetHistMinMax(d.fStack.arr[0],a).min,c.max=this.GetHistMinMax(d.fStack.arr[d.fStack.arr.length-1],a).max;
-1111!=d.fMaximum&&(c.max=d.fMaximum);c.max*=1.05;-1111!=d.fMinimum&&(c.min=d.fMinimum);b&&(1==this.options.ndim?b.fLogy:b.fLogz)?(0>=c.max&&(c.max=1),0>=c.min&&(c.min=1E-4*c.max),a=1/(1+.5*f.log10(c.max/c.min)),b=1+.2*f.log10(c.max/c.min),c.min*=a,c.max*=b):0<c.min&&c.min<.05*c.max&&(c.min=0);return c};I.prototype.DrawNextHisto=function(a,b,c,d){"callback"===b&&(b=null,0>a?this.firstpainter=c:this.painters.push(c),a++);var e=this.GetObject(),g=e.fHistogram,l=(e=this.options.nostack?e.fHists:e.fStack)&&
e.arr?e.arr.length:0,h=0;if(a>=l)return this.DrawingReady();if(499===a%500&&!d)return setTimeout(this.DrawNextHisto.bind(this,a,b,c,!0),0);if(0<=a){if(h=this.options.horder?a:l-a-1,g=e.arr[h],c=e.opt[h]||g.fOption||this.options.hopt,0>c.toUpperCase().indexOf(this.options.hopt)&&(c+=this.options.hopt),this.options.draw_errors&&!c&&(c="E"),c+=" same nostat",this.options._pfc||this.options._plc||this.options._pmc)!this.pallette&&f.Painter.GetColorPalette&&(this.palette=f.Painter.GetColorPalette()),this.palette&&
(b=this.palette.calcColor(h,l+1),b=this.add_color(b),this.options._pfc&&(g.fFillColor=b),this.options._plc&&(g.fLineColor=b),this.options._pmc&&(g.fMarkerColor=b))}else c=this.options.hopt+" axis",b&&(c+=";minimum:"+b.min+";maximum:"+b.max);0<h&&!this.options.nostack&&(g.$baseh=e.arr[h-1]);f.draw(this.divid,g,c,this.DrawNextHisto.bind(this,a,"callback"))};I.prototype.DecodeOptions=function(a){this.options||(this.options={});f.extend(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,
draw_errors:!1,hopt:""});var b=this.GetObject(),c=b.fHistogram||(b.fHists?b.fHists.arr[0]:null)||(b.fStack?b.fStack.arr[0]:null);c&&0==c._typename.indexOf("TH2")&&(this.options.ndim=2);2!=this.options.ndim||a||(a="lego1");if(b.fHists&&!this.options.nostack)for(c=0;c<b.fHists.arr.length;++c)this.options.has_errors=this.options.has_errors||this.HasErrors(b.fHists.arr[c]);a=new f.DrawOptions(a);this.options.nostack=a.check("NOSTACK");a.check("STACK")&&(this.options.nostack=!1);this.options.same=a.check("SAME");
this.options._pfc=a.check("PFC");this.options._plc=a.check("PLC");this.options._pmc=a.check("PMC");this.options.hopt=a.remain();b=a.check("LEGO");this.options.errors=a.check("E");!this.options.nostack&&this.options.has_errors&&!b&&!a.check("HIST")&&0>this.options.hopt.indexOf("E")&&(this.options.draw_errors=!0);this.options.horder=this.options.nostack||b};I.prototype.CreateHistogram=function(a){var b=a.fHists,c=b?b.arr.length:0;if(!c){var d=f.CreateHistogram("TH1I",100);d.fTitle=a.fTitle;return d}var e=
b.arr[0];d=f.CreateHistogram(1==this.options.ndim?"TH1I":"TH2I",e.fXaxis.fNbins,e.fYaxis.fNbins);d.fName="axis_hist";f.extend(d.fXaxis,e.fXaxis);2==this.options.ndim&&f.extend(d.fYaxis,e.fYaxis);for(e=1;e<c;++e){var g=b.arr[e];d.fXaxis.fLabels||(d.fXaxis.fXmin=Math.min(d.fXaxis.fXmin,g.fXaxis.fXmin),d.fXaxis.fXmax=Math.max(d.fXaxis.fXmax,g.fXaxis.fXmax));2!=this.options.ndim||d.fYaxis.fLabels||(d.fYaxis.fXmin=Math.min(d.fYaxis.fXmin,g.fYaxis.fXmin),d.fYaxis.fXmax=Math.max(d.fYaxis.fXmax,g.fYaxis.fXmax))}d.fTitle=
a.fTitle;return d};I.prototype.drawStack=function(){var a=this.GetObject();this.options.nostack||(this.options.nostack=!this.BuildStack(a));a.fHistogram||this.options.same||(a.fHistogram=this.CreateHistogram(a));a=this.GetMinMax(this.options.errors||this.options.draw_errors,this.root_pad());this.DrawNextHisto(this.options.same?0:-1,a);return this};I.prototype.UpdateObject=function(a){if(!this.MatchObjectType(a))return!1;var b=this.GetObject();b.fHists=a.fHists;b.fStack=a.fStack;this.options.nostack||
(this.options.nostack=!this.BuildStack(b));var c=!1;this.firstpainter&&(c=a.fHistogram,c||(c=b.fHistogram=this.CreateHistogram(b)),this.firstpainter.UpdateObject(c),b=this.GetMinMax(this.options.errors||this.options.draw_errors,this.root_pad()),this.firstpainter.options.minimum=b.min,this.firstpainter.options.maximum=b.max,1==this.options.ndim&&(this.firstpainter.ymin=b.min,this.firstpainter.ymax=b.max),c=!0);(b=this.pad_painter())&&b.CleanPrimitives(this.Selector.bind(this,!1));this.painters=[];
return this.did_update=c};I.prototype.Selector=function(a,b){return a&&b===this.firstpainter?!0:0<=this.painters.indexOf(b)};I.prototype.Redraw=function(){this.did_update&&(delete this.did_update,this.firstpainter&&this.firstpainter.Redraw(),this.DrawNextHisto(0,null))};f.Painter.drawLegend=H;f.Painter.drawPaveText=H;f.Painter.drawPave=H;f.Painter.produceLegend=function(a,b){var c=f.GetMainPainter(a);if(c){var d=c.pad_painter();c=c.root_pad();if(d&&c){for(var e=f.Create("TLegend"),g=0;g<d.painters.length;++g){var l=
d.painters[g],h=l.GetObject();if(h){var r=f.Create("TLegendEntry");r.fObject=h;r.fLabel="all"==b?h.fName:l.GetItemName();r.fOption="";r.fLabel&&(l.lineatt&&l.lineatt.used&&(r.fOption+="l"),l.fillatt&&l.fillatt.used&&(r.fOption+="f"),l.markeratt&&l.markeratt.used&&(r.fOption+="m"),r.fOption||(r.fOption="l"),e.fPrimitives.Add(r))}}if(b=e.fPrimitives.arr.length)return 8<b&&(b=8),b*=.1,f.extend(e,{fX1NDC:.4*c.fLeftMargin+.6*(1-c.fRightMargin),fY1NDC:(1-b)*(1-c.fTopMargin)+b*c.fBottomMargin,fX2NDC:.99-
c.fRightMargin,fY2NDC:.99-c.fTopMargin}),e.fFillStyle=1001,H(a,e)}}};f.Painter.drawHistogram1D=function(a,b,c){var d=new G(b);d.SetDivId(a,1);d.DecodeOptions(c);d.CheckPadRange(!d.options.Mode3D);d.ScanContent();d.CreateStat();d.CallDrawFunc(function(){d.DrawNextFunction(0,function(){!d.options.Mode3D&&d.options.AutoZoom&&d.AutoZoom();d.FillToolbar();d.DrawingReady()})});return d};f.Painter.drawHistogram2D=W;f.Painter.drawTF2=function(a,b,c){var d=new f.DrawOptions(c),e=X(b,d.check("NOSAVE"));c=d.empty()?
"cont3":"SAME"===d.opt?"cont2 same":d.opt;a=W(a,e,c);a.tf2_typename=b._typename;a.tf2_nosave=d.check("NOSAVE");a.UpdateObject=function(a,b){if(!a||this.tf2_typename!=a._typename)return!1;X(a,this.tf2_nosave,this.GetHisto());return!0};return a};f.Painter.drawHStack=function(a,b,c){var d=new I(b,c);d.SetDivId(a,-1);d.DecodeOptions(c);if(!b.fHists||0==b.fHists.arr.length)return d.DrawingReady();d.drawStack();d.SetDivId(a);return d};f.TPavePainter=A;f.THistPainter=y;f.TH1Painter=G;f.TH2Painter=F;f.THStackPainter=
I;return f});
