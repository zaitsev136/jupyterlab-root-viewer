(function(e){if("function"===typeof define&&define.amd)define(["JSRootPainter","d3"],e);else if("object"===typeof exports&&"undefined"!==typeof module)e(require("./JSRootCore.js"),require("d3"));else{if("object"!=typeof d3)throw Error("This extension requires d3.js","JSRootPainter.v7.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.v7.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined","JSRootPainter.v7.js");e(JSROOT,d3)}})(function(e,
k){function z(a,b){e.TObjectPainter.call(this,a);this.embedded=b;this.name="yaxis";this.kind="normal";this.func=null;this.full_min=this.order=0;this.full_max=1;this.scale_min=0;this.scale_max=1;this.ticks=[];this.lbls_both_sides=this.invert_side=!1}function m(a){e.TooltipHandler.call(this,a);this.shrink_frame_left=0;this.y_kind=this.x_kind="normal";this.ymin=this.ymax=this.xmin=this.xmax=0;this.axes_drawn=!1;this.keys_handler=null;this.mode3d=!1}function l(a,b){e.TObjectPainter.call(this,a);this.pad=
a;this.iscan=b;this.this_pad_name="";this.iscan||null===a||(this.this_pad_name=a.fObjectID?"pad"+a.fObjectID:"ppp"+e.id_counter++);this.painters=[];this.has_canvas=!0}function u(a){l.call(this,a,!0);this._websocket=null;this.tooltip_allowed=0<e.gStyle.Tooltip}e.sources.push("v7");e.v7={};e.TObjectPainter.prototype.GetCoordinate=function(a){function b(a,b,c){var d=a.fNormal.fVal*c+a.fPixel.fVal;a.fUser.fVal&&(d+=(a.fUser.fVal-b.fBegin)/(b.fEnd-b.fBegin)*c);return d}var c={x:0,y:0};if(!a)return c;var d=
this.pad_width(),f=this.pad_height(),e=this.pad_painter();e.pad_frame?(c.x=b(a.fHoriz,e.pad_frame.fUserCoord[0],d),c.y=f-b(a.fVert,e.pad_frame.fUserCoord[1],f)):(c.x=a.fHoriz.fNormal.fVal*d,c.y=f-a.fVert.fNormal.fVal*f);return c};z.prototype=Object.create(e.TObjectPainter.prototype);z.prototype.Cleanup=function(){this.ticks=[];this.func=null;delete this.format;e.TObjectPainter.prototype.Cleanup.call(this)};z.prototype.SetAxisConfig=function(a,b,c,d,f,e,h){this.name=a;this.kind=b;this.func=c;this.full_min=
d;this.full_max=f;this.scale_min=e;this.scale_max=h};z.prototype.format10Exp=function(a,b){var c="";b&&(b=Math.round(b/Math.pow(10,a)),0!=b&&1!=b&&(c=b.toString()+(e.gStyle.Latex?"#times":"x")));c+="10";if(1<e.gStyle.Latex)return c+"^{"+a+"}";b={0:"\u2070",1:"\u00b9",2:"\u00b2",3:"\u00b3",4:"\u2074",5:"\u2075",6:"\u2076",7:"\u2077",8:"\u2078",9:"\u2079","-":"\u207b"};a=a.toString();for(var d=0;d<a.length;++d)c+=b[a[d]];return c};z.prototype.CreateFormatFuncs=function(){var a=this.GetObject(),b=a&&
"TGaxis"===a._typename;delete this.format;var c=508;b?c=a.fNdiv:a&&(c=Math.max(a.fNdivisions,4));this.nticks=c%100;this.nticks2=(c%1E4-this.nticks)/100;this.nticks3=Math.floor(c/1E4);a&&!b&&7<this.nticks&&(this.nticks=7);c=Math.abs(this.func.range()[1]-this.func.range()[0]);0>=c&&(c=100);if("time"==this.kind){8<this.nticks&&(this.nticks=8);b=this.scale_max-this.scale_min;a=e.Painter.getTimeFormat(a);c=e.Painter.chooseTimeFormat(b/c,!1);if(0==a.length||b<.1*(this.full_max-this.full_min))a=e.Painter.chooseTimeFormat(b/
this.nticks,!0);this.tfunc1=this.tfunc2=k.timeFormat(a);c!==a&&(this.tfunc2=k.timeFormat(c));this.format=function(a,b){return b?this.tfunc1(a):this.tfunc2(a)}}else"log"==this.kind?(1<this.nticks2&&(this.nticks*=this.nticks2,this.nticks2=1),this.noexp=a?a.TestBit(e.EAxisBits.kNoExponent):!1,300>this.scale_max&&.3<this.scale_min&&(this.noexp=!0),this.moreloglabels=a?a.TestBit(e.EAxisBits.kMoreLogLabels):!1,this.format=function(a,b,c){a=parseFloat(a);var d=Math.round(a);if(!b)return d===a&&1E9>Math.abs(d)?
d.toString():e.FFormat(a,c||e.gStyle.fStatFormat);if(0>=a)return null;b=e.log10(a);return this.moreloglabels||.001>Math.abs(b-Math.round(b))?this.noexp||c?0>b?a.toFixed(Math.round(-b+.5)):a.toFixed(0):this.format10Exp(Math.floor(b+.01),a):null}):"labels"==this.kind?(this.nticks=50,b=this.scale_max-this.scale_min,this.nticks>b&&(this.nticks=Math.round(b)),this.nticks2=1,this.regular_labels=!0,a&&a.fNbins&&a.fLabels&&(a.fNbins!=Math.round(a.fXmax-a.fXmin)||0!=a.fXmin||a.fXmax!=a.fNbins)&&(this.regular_labels=
!1),this.axis=a,this.format=function(a){a=parseFloat(a);this.regular_labels||(a=(a-this.axis.fXmin)/(this.axis.fXmax-this.axis.fXmin)*this.axis.fNbins);a=Math.round(a);if(0>a||a>=this.axis.fNbins)return null;for(var b=0;b<this.axis.fLabels.arr.length;++b){var c=this.axis.fLabels.arr[b];if(c.fUniqueID===a+1)return c.fString}return null}):(this.ndig=this.order=0,this.format=function(a,b,c){a=parseFloat(a);b&&this.order&&(a/=Math.pow(10,this.order));return a===Math.round(a)?1E9>Math.abs(a)?a.toFixed(0):
a.toExponential(4):b?10<this.ndig?a.toExponential(this.ndig-11):a.toFixed(this.ndig):e.FFormat(a,c||e.gStyle.fStatFormat)})};z.prototype.ProduceTicks=function(a,b){if(!this.noticksopt)return this.func.ticks(a*(b||1));b&&(a=(a-1)*b);b=this.func.domain();for(var c=[],d=0;d<=a;++d)c.push((b[0]*(a-d)+b[1]*d)/a);return c};z.prototype.CreateTicks=function(a,b,c,d){c&&this.nticks&&"normal"==this.kind&&(this.noticksopt=!0);c={nminor:0,nmiddle:0,nmajor:0,func:this.func};c.minor=c.middle=c.major=this.ProduceTicks(this.nticks);
if(a)return d=c.major,c=1E-5*(this.scale_max-this.scale_min),d[0]>this.scale_min+c&&d.unshift(this.scale_min),d[d.length-1]<this.scale_max-c&&d.push(this.scale_max),d;if("labels"==this.kind&&!this.regular_labels)for(c.lbl_pos=[],a=0;a<this.axis.fNbins;++a){var f=this.axis.fXmin+a/this.axis.fNbins*(this.axis.fXmax-this.axis.fXmin);f>=this.scale_min&&f<this.scale_max&&c.lbl_pos.push(f)}1<this.nticks2&&((c.minor=c.middle=this.ProduceTicks(c.major.length,this.nticks2),a=Math.abs(this.func.range()[1]-
this.func.range()[0]),c.middle.length<=c.major.length||c.middle.length>a/3.5)?c.minor=c.middle=c.major:1<this.nticks3&&"log"!==this.kind&&(c.minor=this.ProduceTicks(c.middle.length,this.nticks3),c.minor.length<=c.middle.length||c.minor.length>a/1.7)&&(c.minor=c.middle));c.reset=function(){this.nminor=this.nmiddle=this.nmajor=0};c.next=function(a){if(this.nminor>=this.minor.length)return!1;this.tick=this.minor[this.nminor++];this.grpos=this.func(this.tick);a&&(this.grpos=Math.round(this.grpos));this.kind=
3;this.nmiddle<this.middle.length&&1>Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))&&(this.nmiddle++,this.kind=2);this.nmajor<this.major.length&&1>Math.abs(this.grpos-this.func(this.major[this.nmajor]))&&(this.nmajor++,this.kind=1);return!0};c.last_major=function(){return 1!==this.kind?!1:this.nmajor==this.major.length};c.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])};this.ndig=this.order=0;if("normal"==this.kind&&0<c.major.length){var g=
a=0;f=!1;if(!b){b=Math.max(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-1]));var h=Math.min(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-1])),t=0<b?3*Math.round(e.log10(b)/3):0,n=0<h?3*Math.round(e.log10(h)/3):0;f=2E4>b;if(b||h)a=Math.max(t,n)+3,g=Math.min(t,n)-3}b=0;h=this.ndig;for(t=1E10;g<=a;g+=3)if(!f||3!==g){this.order=g;this.ndig=0;n=[];for(var p=0,q=0;p<c.major.length;){var r=this.format(c.major[p],!0);if(0>n.indexOf(r))n.push(r),q+=r.length,p++;else{if(11<++this.ndig)break;
n=[];q=p=0}}!g&&4>this.ndig&&(q-=2*c.major.length+3);q<t&&(t=q,b=this.order,h=this.ndig)}this.order=b;this.ndig=h;d&&(this.order&&console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable"),this.ndig&&console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required"),this.order=this.ndig=0)}return c};z.prototype.IsCenterLabels=function(){if("labels"===this.kind)return!0;if("log"===this.kind)return!1;var a=this.GetObject();
return a&&a.TestBit(e.EAxisBits.kCenterLabels)};z.prototype.AddTitleDrag=function(a,b,c,d,f){if(e.gStyle.MoveResize){var g=this,h=null,t="",n,p,q,r,m,v;if(3===e._test_d3_){t="drag";var l=k.behavior.drag().origin(Object)}else l=k.drag().subject(Object);l.on(t+"start",function(){k.event.sourceEvent.preventDefault();k.event.sourceEvent.stopPropagation();var c=a.node().getBBox(),t=g.GetObject();q=n=a.property("shift_x");r=p=a.property("shift_y");m=b?0<n:0<p;v=t.TestBit(e.EAxisBits.kCenterTitle)?d===b?
f:0:Math.round(f/2);h=a.append("rect").classed("zoom",!0).attr("x",c.x).attr("y",c.y).attr("width",c.width).attr("height",c.height).style("cursor","move")}).on("drag",function(){if(h){k.event.sourceEvent.preventDefault();k.event.sourceEvent.stopPropagation();n+=k.event.dx;p+=k.event.dy;var c=a.property("shift_x"),d=a.property("shift_y");b?(c=n,Math.abs(p-d)>Math.abs(p-v)&&(d=v)):(d=p,Math.abs(n-c)>Math.abs(n-v)&&(c=v));m===(b?0<c:0<d)&&(q=c,r=d,a.attr("transform","translate("+q+","+r+")"))}}).on(t+
"end",function(){if(h){k.event.sourceEvent.preventDefault();k.event.sourceEvent.stopPropagation();a.property("shift_x",q).property("shift_y",r);var d=g.GetObject();d.fTitleOffset=(b?q:r)/c;(b?r:q)===v&&d.InvertBit(e.EAxisBits.kCenterTitle);h.remove();h=null}});a.style("cursor","move").call(l)}};z.prototype.DrawAxis=function(a,b,c,d,f,g,h,t,n){function p(a,b){return a&&!b||!a&&b}var q=this.GetObject(),r="",m=q&&"TGaxis"===q._typename,v=b,l=.03,u=100,z=!0,R=this.pad_width()||10,S=this.pad_height()||
10;this.vertical=a;h?this.invert_side&&(h=-h):h=0;m?(this.createAttLine({attr:q}),z=0!=q.fLineColor,r=q.fChopt,l=q.fTickSize,u=a?1.7*d:.6*c):(this.createAttLine({color:q.fAxisColor,width:1,style:1}),r=p(a,this.invert_side)?"-S":"+S",l=q.fTickLength,u=a?R:S);m&&"zaxis"!==this.name?!t&&z&&v.append("svg:line").attr("x1",0).attr("y1",0).attr("x1",a?0:c).attr("y1",a?d:0).call(this.lineatt.func):(v=b.select("."+this.name+"_container"),v.empty()?v=b.append("svg:g").attr("class",this.name+"_container"):v.selectAll("*").remove());
v.attr("transform",f||null);var w=1;f=0;b=Math.min(R,S);var B=0<=r.indexOf("+"),E=0<=r.indexOf("-"),F=0<=r.indexOf("S");r.indexOf("Y");r.indexOf("0");r.indexOf("O");var I=0<=r.indexOf("U"),y=0<=r.indexOf("N");r=0<=r.indexOf("I");var C=q.TestBit(e.EAxisBits.kNoExponent);m&&q.TestBit(e.EAxisBits.kTickPlus)&&(B=!0);m&&q.TestBit(e.EAxisBits.kTickMinus)&&(E=!0);B&&E?f=w=1:E?w=p(g,a)?1:-1:B&&(w=p(g,a)?-1:1);l=Math.round((F?l:.03)*u);this.max_tick_size&&l>this.max_tick_size&&(l=this.max_tick_size);this.CreateFormatFuncs();
E=B="";F=u=0;this.ticks=[];for(var x=this.CreateTicks(!1,C,y,r);x.next(!0);)y=Math.round(l/4),r=0,3>x.kind&&(y=Math.round(l/2)),1==x.kind&&("format"in this&&null===this.format(x.tick,!0)||(y=l),this.ticks.push(x.grpos)),0<f?r=-y:0>w?(r=-y,y=0):r=0,0==B.length?(B=a?"M"+y+","+x.grpos:"M"+x.grpos+","+-y,E=a?"M"+(h-y)+","+x.grpos:"M"+x.grpos+","+(h+y)):(B+=a?"m"+(y-F)+","+(x.grpos-u):"m"+(x.grpos-u)+","+(F-y),E+=a?"m"+(F-y)+","+(x.grpos-u):"m"+(x.grpos-u)+","+(y-F)),B+=a?"h"+(r-y):"v"+(y-r),E+=a?"h"+
(y-r):"v"+(r-y),u=x.grpos,F=r;0<B.length&&!t&&z&&v.append("svg:path").attr("d",B).call(this.lineatt.func);0!==h&&0<E.length&&!t&&z&&v.append("svg:path").attr("d",E).call(this.lineatt.func);h=Math.round(1>q.fLabelSize?q.fLabelSize*b:q.fLabelSize);if(0>=h||1.1<Math.abs(q.fLabelOffset))I=!0;if(!t&&!I){z=this.get_color(q.fLabelColor);I=Math.round(q.fLabelOffset*b);y=this.IsCenterLabels();r=q.TestBit(e.EAxisBits.kLabelsVert);C=1;B=0;E=!1;F=null;var H=[v.append("svg:g").attr("class","axis_labels")];x=x.lbl_pos||
x.major;this.lbls_both_sides&&H.push(v.append("svg:g").attr("class","axis_labels").attr("transform",a?"translate("+c+",0)":"translate(0,"+-d+")"));for(var D=0;D<H.length;++D){0<D&&(w=-w);u=0;var T=a?-I*w:(I+2)*w+f*l;F=e.Painter.getFontDetails(q.fLabelFont,h);this.StartTextDrawing(F,"font",H[D]);for(var J=0;J<x.length;++J){var K=this.format(x[J],!0);if(null!==K){var G=Math.round(this.func(x[J])),N=0<J?Math.abs(Math.round(G-this.func(x[J-1]))):0,O=J<x.length-1?Math.abs(Math.round(this.func(x[J+1])-
G)):0;if(y){var A=O||N;G=Math.round(G-(a?.5*A:-.5*A));if(-5>G||G>(a?d:c)+5)continue}A={text:K,color:z,latex:1,draw_g:H[D]};B=Math.max(B,K.length);a?(A.x=T,A.y=G,A.align=r?0>w?23:20:0>w?12:32):(A.x=G,A.y=T,A.align=r?0>w?12:32:0>w?20:23);r&&(A.rotate=270);(K=this.DrawText(A))&&(!a&&!r||a&&r)&&"log"!=this.kind?(A=.45*N+.45*O,N?O||(A=.9*N):A=.9*O,C=Math.min(C,A/K)):a&&n&&!D&&20<n-I&&K>n-I&&(C=Math.min(C,(n-I)/K));u&&G!=u&&(a&&!r||!a&&r)&&(C=Math.min(C,.9*Math.abs(G-u)/h));u=G}}this.order&&this.DrawText({color:z,
x:a?5*w:c+5,y:this.has_obstacle?T:a?-3:-3*w,align:a?0>w?30:10:p(this.has_obstacle,0>w)?13:10,latex:1,text:"#times"+this.format10Exp(this.order),draw_g:H[D]})}.01<C&&.7>C&&!a&&!r&&5<B&&!this.lbls_both_sides&&(E=!0,C*=3);for(D=0;D<H.length;++D).01<C&&1>C&&this.TextScaleFactor(1/C,H[D]),this.FinishTextDrawing(H[D]),E&&H[D].selectAll("text").each(function(){var a=k.select(this),b=a.attr("transform");a.attr("transform",b+" rotate(25)").style("text-anchor","start")});1<H.length&&(w=-w);F&&(h=F.size)}e.gStyle.Zooming&&
!this.disable_zooming&&(n=v.append("svg:rect").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair"),a?n.attr("x",0<w?-2*h-3:3).attr("y",0).attr("width",2*h+3).attr("height",d):n.attr("x",0).attr("y",0<w?0:-h-3).attr("width",c).attr("height",h+3));if(0<q.fTitle.length&&!t){var L=v.append("svg:g").attr("class","axis_title"),U=1<=q.fTitleSize?q.fTitleSize:Math.round(q.fTitleSize*b);t=1.6*(1>q.fTitleSize?q.fTitleSize:q.fTitleSize/(this.pad_height("")||10));n=q.TestBit(e.EAxisBits.kCenterTitle);
b=q.TestBit(e.EAxisBits.kRotateTitle)?-1:1;f=this.get_color(q.fTitleColor);var M=0,P=0;this.StartTextDrawing(q.fTitleFont,U,L);u=0>b&&!g||0<=b&&g;a?(t*=-w*R,M=Math.round(t*q.fTitleOffset),"zaxis"==this.name&&m&&"getBoundingClientRect"in v.node()&&(m=v.node().getBoundingClientRect(),M<m.width-l&&(M=Math.round(m.width-l))),P=Math.round(n?d/2:g?d:0),this.DrawText({align:(n?"middle":u?"begin":"end")+";middle",rotate:0>b?90:270,text:q.fTitle,color:f,draw_g:L})):(t*=w*S,M=Math.round(n?c/2:g?0:c),P=Math.round(t*
q.fTitleOffset),this.DrawText({align:(n?"middle":u?"begin":"end")+";middle",rotate:0>b?180:0,text:q.fTitle,color:f,draw_g:L}));var Q=null;a&&0==q.fTitleOffset&&"getBoundingClientRect"in v.node()&&(Q=v.node().getBoundingClientRect());this.FinishTextDrawing(L,function(){if(Q){var a=L.node().getBoundingClientRect();M=0<w?Math.round(Q.left-a.right-.3*U):Math.round(Q.right-a.left+.3*U)}L.attr("transform","translate("+M+","+P+")").property("shift_x",M).property("shift_y",P)});this.AddTitleDrag(L,a,t,g,
a?d:c)}this.position=0;"getBoundingClientRect"in v.node()&&(a=v.node().getBoundingClientRect(),c=this.svg_pad().node().getBoundingClientRect(),this.position=a.left-c.left)};z.prototype.Redraw=function(){var a=this.GetObject(),b=this.AxisToSvg("x",a.fX1,"pad"),c=this.AxisToSvg("y",a.fY1,"pad"),d=this.AxisToSvg("x",a.fX2,"pad"),f=this.AxisToSvg("y",a.fY2,"pad"),g=d-b,h=c-f,t=Math.abs(g)<Math.abs(h),n=!1,p=a.fWmin,q=a.fWmax,r=p,m=q;if(0<=a.fChopt.indexOf("t")){var l=k.scaleTime();var u="time";this.toffset=
e.Painter.getTimeOffset(a);r=new Date(this.toffset+1E3*p);m=new Date(this.toffset+1E3*q)}else 0<=a.fChopt.indexOf("G")?(l=k.scaleLog(),u="log"):(l=k.scaleLinear(),u="normal");l.domain([r,m]);t?0<h?l.range([h,0]):(f=c,h=-h,n=!0,l.range([0,h])):0<g?l.range([0,g]):(b=d,g=-g,n=!0,l.range([g,0]));this.SetAxisConfig(t?"yaxis":"xaxis",u,l,p,q,p,q);this.CreateG();this.DrawAxis(t,this.draw_g,g,h,"translate("+b+","+f+")",n)};m.prototype=Object.create(e.TooltipHandler.prototype);m.prototype.frame_painter=function(){return this};
m.prototype.SetActive=function(a){};m.prototype.GetTipName=function(a){var b=e.TooltipHandler.prototype.GetTipName.call(this)||"TFrame";a&&(b+=a);return b};m.prototype.Shrink=function(a,b){this.fX1NDC+=a;this.fX2NDC-=b};m.prototype.SetLastEventPos=function(a){this.fLastEventPnt=a};m.prototype.GetLastEventPos=function(){return this.fLastEventPnt};m.prototype.UpdateAttributes=function(a){var b=this.GetObject();if(void 0===this.fX1NDC||a&&!this.modified_NDC)e.extend(this,e.gStyle.FrameNDC),b&&b.fPos&&
b.fSize&&(this.fX1NDC=b.fPos.fHoriz.fNormal.fVal,this.fX2NDC=this.fX1NDC+b.fSize.fHoriz.fNormal.fVal,this.fY1NDC=b.fPos.fVert.fNormal.fVal,this.fY2NDC=this.fY1NDC+b.fSize.fVert.fNormal.fVal);void 0===this.fillatt&&(this.createAttFill({pattern:1001,color:0}),a="white",b&&b.fFillColor&&(a=this.canv_painter().GetOldColor(b.fFillColor,!0)),this.fillatt.SetSolidColor(a));this.createAttLine({color:"black"})};m.prototype.ProjectAitoff2xy=function(a,b){var c=Math.PI/180;a=a/2*c;b*=c;var d=Math.sqrt(2),f=
2*d/Math.PI,e=Math.cos(b),h=Math.sqrt(1+e*Math.cos(a));return{x:e*Math.sin(a)*2*d/h/f/c,y:Math.sin(b)*d/h/f/c}};m.prototype.ProjectMercator2xy=function(a,b){return{x:a,y:Math.log(Math.tan((Math.PI/2+b/180*Math.PI)/2))}};m.prototype.ProjectSinusoidal2xy=function(a,b){return{x:a*Math.cos(b/180*Math.PI),y:b}};m.prototype.ProjectParabolic2xy=function(a,b){return{x:a*(2*Math.cos(2*b/180*Math.PI/3)-1),y:180*Math.sin(b/180*Math.PI/3)}};m.prototype.RecalculateRange=function(a){if(a){var b=[];if(1==a)b.push(this.ProjectAitoff2xy(this.scale_xmin,
this.scale_ymin)),b.push(this.ProjectAitoff2xy(this.scale_xmin,this.scale_ymax)),b.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymax)),b.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymin)),0>this.scale_ymin&&0<this.scale_ymax&&(b.push(this.ProjectAitoff2xy(.9999*this.scale_xmin,0)),b.push(this.ProjectAitoff2xy(.9999*this.scale_xmax,0))),0>this.scale_xmin&&0<this.scale_xmax&&(b.push(this.ProjectAitoff2xy(0,this.scale_ymin)),b.push(this.ProjectAitoff2xy(0,this.scale_ymax)));else if(2==
a){if(-90>=this.scale_ymin||90<=this.scale_ymax){console.warn("Mercator Projection","Latitude out of range",this.scale_ymin,this.scale_ymax);this.options.Proj=0;return}b.push(this.ProjectMercator2xy(this.scale_xmin,this.scale_ymin));b.push(this.ProjectMercator2xy(this.scale_xmax,this.scale_ymax))}else 3==a?(b.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymin)),b.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymax)),b.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymax)),
b.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymin)),0>this.scale_ymin&&0<this.scale_ymax&&(b.push(this.ProjectSinusoidal2xy(this.scale_xmin,0)),b.push(this.ProjectSinusoidal2xy(this.scale_xmax,0))),0>this.scale_xmin&&0<this.scale_xmax&&(b.push(this.ProjectSinusoidal2xy(0,this.scale_ymin)),b.push(this.ProjectSinusoidal2xy(0,this.scale_ymax)))):4==a&&(b.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymin)),b.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymax)),b.push(this.ProjectParabolic2xy(this.scale_xmax,
this.scale_ymax)),b.push(this.ProjectParabolic2xy(this.scale_xmax,this.scale_ymin)),0>this.scale_ymin&&0<this.scale_ymax&&(b.push(this.ProjectParabolic2xy(this.scale_xmin,0)),b.push(this.ProjectParabolic2xy(this.scale_xmax,0))),0>this.scale_xmin&&0<this.scale_xmax&&(b.push(this.ProjectParabolic2xy(0,this.scale_ymin)),b.push(this.ProjectParabolic2xy(0,this.scale_ymax))));this.original_xmin=this.scale_xmin;this.original_xmax=this.scale_xmax;this.original_ymin=this.scale_ymin;this.original_ymax=this.scale_ymax;
this.scale_xmin=this.scale_xmax=b[0].x;this.scale_ymin=this.scale_ymax=b[0].y;for(a=1;a<b.length;++a)this.scale_xmin=Math.min(this.scale_xmin,b[a].x),this.scale_xmax=Math.max(this.scale_xmax,b[a].x),this.scale_ymin=Math.min(this.scale_ymin,b[a].y),this.scale_ymax=Math.max(this.scale_ymax,b[a].y)}};m.prototype.DrawGrids=function(){var a=this.svg_frame().select(".grid_layer");a.selectAll(".xgrid").remove();a.selectAll(".ygrid").remove();var b=this.frame_height(),c=this.frame_width(),d=e.gStyle.fGridStyle,
f=0<e.gStyle.fGridColor?this.get_color(e.gStyle.fGridColor):"black";if(0>d||d>=e.Painter.root_line_styles.length)d=11;if(this.x_handle){var g="";for(var h=0;h<this.x_handle.ticks.length;++h)g=this.swap_xy?g+("M0,"+this.x_handle.ticks[h]+"h"+c):g+("M"+this.x_handle.ticks[h]+",0v"+b);0<g.length&&a.append("svg:path").attr("class","xgrid").attr("d",g).style("stroke",f).style("stroke-width",e.gStyle.fGridWidth).style("stroke-dasharray",e.Painter.root_line_styles[d])}if(this.y_handle){g="";for(h=0;h<this.y_handle.ticks.length;++h)g=
this.swap_xy?g+("M"+this.y_handle.ticks[h]+",0v"+b):g+("M0,"+this.y_handle.ticks[h]+"h"+c);0<g.length&&a.append("svg:path").attr("class","ygrid").attr("d",g).style("stroke",f).style("stroke-width",e.gStyle.fGridWidth).style("stroke-dasharray",e.Painter.root_line_styles[d])}};m.prototype.AxisAsText=function(a,b){if("x"==a){if("time"==this.x_kind&&(b=this.ConvertX(b)),this.x_handle&&"format"in this.x_handle)return this.x_handle.format(b,!1,e.gStyle.XValuesFormat)}else if("y"==a){if("time"==this.y_kind&&
(b=this.ConvertY(b)),this.y_handle&&"format"in this.y_handle)return this.y_handle.format(b,!1,e.gStyle.YValuesFormat)}else if(this.z_handle&&"format"in this.z_handle)return this.z_handle.format(b,!1,e.gStyle.ZValuesFormat);return b.toPrecision(4)};m.prototype.SetAxesRanges=function(a,b,c,d){this.axes_drawn||(this.xmin==this.xmax&&a!==b&&(this.xmin=a,this.xmax=b),this.ymin==this.ymax&&c!==d&&(this.ymin=c,this.ymax=d))};m.prototype.DrawAxes=function(a){if(this.axes_drawn)return!0;if(this.xmin==this.xmax||
this.ymin==this.ymax)return!1;this.CleanupAxes();this.CleanXY();this.CreateXY();var b=this.svg_frame().select(".axis_layer"),c=this.frame_width(),d=this.frame_height(),f=e.Create("TAxis"),g=e.Create("TAxis");this.x_handle=new e.TAxisPainter(f,!0);this.x_handle.SetDivId(this.divid,-1);this.x_handle.pad_name=this.pad_name;this.x_handle.SetAxisConfig("xaxis",this.logx&&"time"!==this.x_kind?"log":this.x_kind,this.x,this.xmin,this.xmax,this.scale_xmin,this.scale_xmax);this.x_handle.invert_side=!1;this.x_handle.lbls_both_sides=
!1;this.x_handle.has_obstacle=!1;this.y_handle=new e.TAxisPainter(g,!0);this.y_handle.SetDivId(this.divid,-1);this.y_handle.pad_name=this.pad_name;this.y_handle.SetAxisConfig("yaxis",this.logy&&"time"!==this.y_kind?"log":this.y_kind,this.y,this.ymin,this.ymax,this.scale_ymin,this.scale_ymax);this.y_handle.invert_side=!1;this.y_handle.lbls_both_sides=!1;g=this.swap_xy?this.y_handle:this.x_handle;f=this.swap_xy?this.x_handle:this.y_handle;var h=!1;if(!h){var t=this.pad_painter();t&&t._fast_drawing&&
(h=!0)}h||(g.DrawAxis(!1,b,c,d,g.invert_side?void 0:"translate(0,"+d+")",!1,0,h),f.DrawAxis(!0,b,c,d,f.invert_side?"translate("+c+",0)":void 0,!1,0,h,f.invert_side?0:this.frame_x()),this.DrawGrids());a||!e.gStyle.CanAdjustFrame||h||(a=0,b=f.position,-.2*c<b&&0>b?(a=-b/c+.001,this.shrink_frame_left+=a):0<b&&b<.3*c&&0<this.shrink_frame_left&&b/c>this.shrink_frame_left&&(a=-this.shrink_frame_left,this.shrink_frame_left=0),0!=a&&(this.Shrink(a,0),this.Redraw(),this.DrawAxes(!0)));return this.axes_drawn=
!0};m.prototype.SizeChanged=function(){this.RedrawPad()};m.prototype.CleanXY=function(){delete this.x;delete this.grx;delete this.ConvertX;delete this.RevertX;delete this.y;delete this.gry;delete this.ConvertY;delete this.RevertY;delete this.z;delete this.grz};m.prototype.CleanupAxes=function(){this.x_handle&&(this.x_handle.Cleanup(),delete this.x_handle);this.y_handle&&(this.y_handle.Cleanup(),delete this.y_handle);this.z_handle&&(this.z_handle.Cleanup(),delete this.z_handle);this.draw_g&&(this.draw_g.select(".grid_layer").selectAll("*").remove(),
this.draw_g.select(".axis_layer").selectAll("*").remove());this.axes_drawn=!1};m.prototype.CleanDrawings=function(){"function"===typeof this.Create3DScene&&this.Create3DScene(-1);this.CleanupAxes();this.CleanXY();this.scale_zmin=this.scale_zmax=this.scale_ymin=this.scale_ymax=this.scale_xmin=this.scale_xmax=this.zoom_zmin=this.zoom_zmax=this.zoom_ymin=this.zoom_ymax=this.zoom_xmin=this.zoom_xmax=this.zmin=this.zmax=this.ymin=this.ymax=this.xmin=this.xmax=0;this.draw_g&&(this.draw_g.select(".main_layer").selectAll("*").remove(),
this.draw_g.select(".upper_layer").selectAll("*").remove())};m.prototype.Cleanup=function(){this.CleanDrawings();this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",null));this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null);this.draw_g=null;delete this._click_handler;delete this._dblclick_handler;e.TooltipHandler.prototype.Cleanup.call(this)};
m.prototype.Redraw=function(){var a=this.pad_painter();a&&(a.frame_painter_ref=this);if(!this.mode3d){this.UpdateAttributes();var b=this.pad_width(),c=this.pad_height(),d=Math.round(b*this.fX1NDC);b=Math.round(b*(this.fX2NDC-this.fX1NDC));var f=Math.round(c*(1-this.fY2NDC));c=Math.round(c*(this.fY2NDC-this.fY1NDC));var g=!1,h=!1;a&&a.options&&(a.options.RotateFrame&&(g=!0),a.options.FixFrame&&(h=!0));this.draw_g=this.svg_layer("primitives_layer").select(".root_frame");if(this.draw_g.empty()){this.draw_g=
this.svg_layer("primitives_layer").append("svg:g").attr("class","root_frame");this.draw_g.append("svg:title").text("");var t=this.draw_g.append("svg:rect");this.draw_g.append("svg:g").attr("class","grid_layer");var n=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden");this.draw_g.append("svg:g").attr("class","axis_layer");this.draw_g.append("svg:g").attr("class","upper_layer")}else t=this.draw_g.select("rect"),n=this.draw_g.select(".main_layer");
this.axes_drawn=!1;var p="translate("+d+","+f+")";if(g){p+=" rotate(-90) translate("+-c+",0)";var q=b;b=c;c=q}this._frame_x=d;this._frame_y=f;this._frame_width=b;this._frame_height=c;this.draw_g.attr("transform",p);t.attr("x",0).attr("y",0).attr("width",b).attr("height",c).call(this.fillatt.func).call(this.lineatt.func);n.attr("width",b).attr("height",c).attr("viewBox","0 0 "+b+" "+c);t=this.draw_g.select(".interactive_rect");if(e.BatchMode)return t.remove();this.draw_g.attr("x",d).attr("y",f).attr("width",
b).attr("height",c);g||h||this.AddDrag({obj:this,only_resize:!0,minwidth:20,minheight:20,redraw:this.SizeChanged.bind(this)});t.empty()&&(t=this.draw_g.append("rect").attr("class","interactive_rect").style("opacity",0).style("fill","none").style("pointer-events","visibleFill").property("handlers_set",0));d=a&&a._fast_drawing?0:1;t.property("handlers_set")!=d&&(a=d?this.ProcessTooltipEvent.bind(this,null):null,f=d?this.ProcessTooltipEvent.bind(this,{handler:!0,touch:!1}):null,t.property("handlers_set",
d).on("mouseenter",f).on("mousemove",f).on("mouseleave",a),e.touches&&(d=d?this.ProcessTooltipEvent.bind(this,{handler:!0,touch:!0}):null,t.on("touchstart",d).on("touchmove",d).on("touchend",a).on("touchcancel",a)));t.attr("x",0).attr("y",0).attr("width",b).attr("height",c);b=this.hints_layer().select(".objects_hints");!b.empty()&&this.IsTooltipAllowed()&&b.property("hints_pad")==this.pad_name&&setTimeout(this.ProcessTooltipEvent.bind(this,b.property("last_point")),10)}};m.prototype.GetFrameRect=
function(){return{x:this.frame_x(),y:this.frame_y(),width:this.frame_width(),height:this.frame_height(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}};m.prototype.ProcessFrameClick=function(a,b){var c=this.pad_painter();if(c){a.painters=!0;a.disabled=!0;for(var d=c.GetTooltips(a),f=null,e=0;e<d.length&&!f;++e)d[e]&&d[e].exact&&(f=d[e]);var h;f&&(d=b?this._dblclick_handler:this._click_handler)&&(h=d(f.user_info,a));b||c.SelectObjectPainter(f?f.painter:this,{x:a.x+
(this._frame_x||0),y:a.y+(this._frame_y||0)});return h}};m.prototype.ConfigureUserClickHandler=function(a){this._click_handler=a&&"function"==typeof a?a:null};m.prototype.ConfigureUserDblclickHandler=function(a){this._dblclick_handler=a&&"function"==typeof a?a:null};m.prototype.Zoom=function(a,b,c,d,f,e){if(this.options&&this.options.Proj)return!1;"x"===a?(a=b,b=c,c=void 0):"y"===a?(d=c,c=b,a=b=void 0):"z"===a&&(f=b,e=c,a=b=c=void 0);var h=a!==b,g=c!==d,n=f!==e,p=!1,q=!1,r=!1;if(h){var k=0;a<=this.xmin&&
(a=this.xmin,k++);b>=this.xmax&&(b=this.xmax,k++);2===k&&(h=!1,p=!0)}else p=a===b&&0===a;g?(k=0,c<=this.ymin&&(c=this.ymin,k++),d>=this.ymax&&(d=this.ymax,k++),2===k&&(g=!1,q=!0)):q=c===d&&0===c;n?(k=0,f<=this.zmin&&(f=this.zmin,k++),e>=this.zmax&&(e=this.zmax,k++),2===k&&(n=!1,r=!0)):r=f===e&&0===f;var l=!1,m=this;(h||g||n)&&this.ForEachPainter(function(p){h&&p.CanZoomIn("x",a,b)&&(m.zoom_xmin=a,m.zoom_xmax=b,l=!0,h=!1);g&&p.CanZoomIn("y",c,d)&&(m.zoom_ymin=c,m.zoom_ymax=d,l=!0,g=!1);n&&p.CanZoomIn("z",
f,e)&&(m.zoom_zmin=f,m.zoom_zmax=e,l=!0,n=!1)});if(p||q||r)p&&(this.zoom_xmin!==this.zoom_xmax&&(l=!0),this.zoom_xmin=this.zoom_xmax=0),q&&(this.zoom_ymin!==this.zoom_ymax&&(l=!0),this.zoom_ymin=this.zoom_ymax=0),r&&(this.zoom_zmin!==this.zoom_zmax&&(l=!0),this.zoom_zmin=this.zoom_zmax=0);l&&this.RedrawPad();return l};m.prototype.IsAxisZoomed=function(a){return this["zoom_"+a+"min"]!==this["zoom_"+a+"max"]};m.prototype.Unzoom=function(a,b,c){"undefined"===typeof a?c=b=a=!0:"string"===typeof a&&(c=
0<=a.indexOf("z"),b=0<=a.indexOf("y"),a=0<=a.indexOf("x"));var d=this.zoom_changed_interactive;if(a||b||c)this.zoom_changed_interactive=2;var f=this.Zoom(a?0:void 0,a?0:void 0,b?0:void 0,b?0:void 0,c?0:void 0,c?0:void 0);(a||b||c)&&!f&&(this.zoom_changed_interactive=!isNaN(d)&&0<d?d-1:0);return f};m.prototype.clearInteractiveElements=function(){e.Painter.closeMenu();this.zoom_rect&&(this.zoom_rect.remove(),this.zoom_rect=null);this.zoom_kind=0;this.SwitchTooltip(!0)};m.prototype.mouseDoubleClick=
function(){k.event.preventDefault();var a=k.mouse(this.svg_frame().node());this.clearInteractiveElements();var b=0<=a[0]&&a[0]<=this.frame_width(),c=0<=a[1]&&a[1]<=this.frame_height();b&&c&&this._dblclick_handler&&this.ProcessFrameClick({x:a[0],y:a[1]},!0)||(a="xyz",b?c||(a=this.swap_xy?"y":"x"):a=this.swap_xy?"x":"y",this.Unzoom(a))};m.prototype.FindAlternativeClickHandler=function(a){var b=this.pad_painter();if(!b)return!1;a=b.GetTooltips({x:a[0],y:a[1],painters:!0,disabled:!0,click_handler:!0});
for(b=0;b<a.length;++b)if(a[b]&&"function"==typeof a[b].click_handler)return a[b].click_handler(a[b]),!0;return!1};m.prototype.startRectSel=function(){if(!(100<this.zoom_kind)&&1===(k.event.which||k.event.button)){k.event.preventDefault();var a=k.mouse(this.svg_frame().node());if(!this.FindAlternativeClickHandler(a)){this.clearInteractiveElements();this.zoom_origin=a;a=this.frame_width();var b=this.frame_height();this.zoom_curr=[Math.max(0,Math.min(a,this.zoom_origin[0])),Math.max(0,Math.min(b,this.zoom_origin[1]))];
0>this.zoom_origin[0]||this.zoom_origin[0]>a?(this.zoom_kind=3,this.zoom_origin[0]=0,this.zoom_origin[1]=this.zoom_curr[1],this.zoom_curr[0]=a,this.zoom_curr[1]+=1):0>this.zoom_origin[1]||this.zoom_origin[1]>b?(this.zoom_kind=2,this.zoom_origin[0]=this.zoom_curr[0],this.zoom_origin[1]=0,this.zoom_curr[0]+=1,this.zoom_curr[1]=b):(this.zoom_kind=1,this.zoom_origin[0]=this.zoom_curr[0],this.zoom_origin[1]=this.zoom_curr[1]);k.select(window).on("mousemove.zoomRect",this.moveRectSel.bind(this)).on("mouseup.zoomRect",
this.endRectSel.bind(this),!0);this.zoom_rect=null;this.SwitchTooltip(!1);k.event.stopPropagation()}}};m.prototype.moveRectSel=function(){if(!(0==this.zoom_kind||100<this.zoom_kind)){k.event.preventDefault();var a=k.mouse(this.svg_frame().node());a[0]=Math.max(0,Math.min(this.frame_width(),a[0]));a[1]=Math.max(0,Math.min(this.frame_height(),a[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=a[0];this.zoom_curr[1]=a[1];break;case 2:this.zoom_curr[0]=a[0];break;case 3:this.zoom_curr[1]=a[1]}null===
this.zoom_rect&&(this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("pointer-events","none"));this.zoom_rect.attr("x",Math.min(this.zoom_origin[0],this.zoom_curr[0])).attr("y",Math.min(this.zoom_origin[1],this.zoom_curr[1])).attr("width",Math.abs(this.zoom_curr[0]-this.zoom_origin[0])).attr("height",Math.abs(this.zoom_curr[1]-this.zoom_origin[1]))}};m.prototype.endRectSel=function(){if(!(0==this.zoom_kind||100<this.zoom_kind)){k.event.preventDefault();k.select(window).on("mousemove.zoomRect",
null).on("mouseup.zoomRect",null);var a=k.mouse(this.svg_frame().node()),b=[!0,!0];a[0]=Math.max(0,Math.min(this.frame_width(),a[0]));a[1]=Math.max(0,Math.min(this.frame_height(),a[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=a[0];this.zoom_curr[1]=a[1];break;case 2:this.zoom_curr[0]=a[0];b[1]=!1;break;case 3:this.zoom_curr[1]=a[1],b[0]=!1}a=!1;var c=this.swap_xy?1:0,d=1-c;if(b[c]&&10<Math.abs(this.zoom_curr[c]-this.zoom_origin[c])){var f=Math.min(this.RevertX(this.zoom_origin[c]),this.RevertX(this.zoom_curr[c]));
var e=Math.max(this.RevertX(this.zoom_origin[c]),this.RevertX(this.zoom_curr[c]));a=!0}if(b[d]&&10<Math.abs(this.zoom_curr[d]-this.zoom_origin[d])){var h=Math.min(this.RevertY(this.zoom_origin[d]),this.RevertY(this.zoom_curr[d]));var t=Math.max(this.RevertY(this.zoom_origin[d]),this.RevertY(this.zoom_curr[d]));a=!0}c=this.zoom_kind;b=1===c?{x:this.zoom_origin[0],y:this.zoom_origin[1]}:null;this.clearInteractiveElements();if(a)this.zoom_changed_interactive=2,this.Zoom(f,e,h,t);else switch(c){case 1:(f=
this.frame_painter())&&f.ProcessFrameClick(b);break;case 2:(f=this.pad_painter())&&f.SelectObjectPainter(this.x_handle);break;case 3:(f=this.pad_painter())&&f.SelectObjectPainter(this.y_handle)}this.zoom_kind=0}};m.prototype.startTouchZoom=function(){if(0!=this.zoom_kind)k.event.preventDefault(),k.event.stopPropagation();else{var a=k.touches(this.svg_frame().node());this.touch_cnt+=1;if(1==a.length){var b=new Date,c=b.getTime()-this.last_touch.getTime();this.last_touch=b;300>c&&this.zoom_curr&&30>
Math.abs(this.zoom_curr[0]-a[0][0])&&30>Math.abs(this.zoom_curr[1]-a[0][1])?(k.event.preventDefault(),k.event.stopPropagation(),this.clearInteractiveElements(),this.Unzoom("xyz"),this.last_touch=new Date(0),this.svg_frame().on("touchcancel",null).on("touchend",null,!0)):e.gStyle.ContextMenu&&(this.zoom_curr=a[0],this.svg_frame().on("touchcancel",this.endTouchSel.bind(this)).on("touchend",this.endTouchSel.bind(this)),k.event.preventDefault(),k.event.stopPropagation())}if(2==a.length&&e.gStyle.Zooming&&
e.gStyle.ZoomTouch){k.event.preventDefault();k.event.stopPropagation();this.clearInteractiveElements();this.svg_frame().on("touchcancel",null).on("touchend",null);b=a[0];a=a[1];c=this.frame_width();var d=this.frame_height();this.zoom_curr=[Math.min(b[0],a[0]),Math.min(b[1],a[1])];this.zoom_origin=[Math.max(b[0],a[0]),Math.max(b[1],a[1])];0>this.zoom_curr[0]||this.zoom_curr[0]>c?(this.zoom_kind=103,this.zoom_curr[0]=0,this.zoom_origin[0]=c):this.zoom_origin[1]>d||0>this.zoom_origin[1]?(this.zoom_kind=
102,this.zoom_curr[1]=0,this.zoom_origin[1]=d):this.zoom_kind=101;this.SwitchTooltip(!1);this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);k.select(window).on("touchmove.zoomRect",this.moveTouchSel.bind(this)).on("touchcancel.zoomRect",this.endTouchSel.bind(this)).on("touchend.zoomRect",this.endTouchSel.bind(this))}}};
m.prototype.moveTouchSel=function(){if(!(100>this.zoom_kind)){k.event.preventDefault();var a=k.touches(this.svg_frame().node());if(2!=a.length)return this.clearInteractiveElements();var b=a[0];a=a[1];103!=this.zoom_kind&&(this.zoom_curr[0]=Math.min(b[0],a[0]),this.zoom_origin[0]=Math.max(b[0],a[0]));102!=this.zoom_kind&&(this.zoom_curr[1]=Math.min(b[1],a[1]),this.zoom_origin[1]=Math.max(b[1],a[1]));this.zoom_rect.attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-
this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);(10<this.zoom_origin[0]-this.zoom_curr[0]||10<this.zoom_origin[1]-this.zoom_curr[1])&&this.SwitchTooltip(!1);k.event.stopPropagation()}};m.prototype.endTouchSel=function(){this.svg_frame().on("touchcancel",null).on("touchend",null);if(0===this.zoom_kind){k.event.preventDefault();var a=(new Date).getTime()-this.last_touch.getTime();500<a&&2E3>a&&!this.frame_painter().IsTooltipShown()?(this.ShowContextMenu("main",{clientX:this.zoom_curr[0],
clientY:this.zoom_curr[1]}),this.last_touch=new Date(0)):this.clearInteractiveElements()}if(!(100>this.zoom_kind)){k.event.preventDefault();k.select(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);a=!1;var b=this.swap_xy?1:0,c=1-b,d=[!0,!0];102===this.zoom_kind&&(d[1]=!1);103===this.zoom_kind&&(d[0]=!1);if(d[b]&&10<Math.abs(this.zoom_curr[b]-this.zoom_origin[b])){var f=Math.min(this.RevertX(this.zoom_origin[b]),this.RevertX(this.zoom_curr[b]));var e=
Math.max(this.RevertX(this.zoom_origin[b]),this.RevertX(this.zoom_curr[b]));a=!0}if(d[c]&&10<Math.abs(this.zoom_curr[c]-this.zoom_origin[c])){var h=Math.min(this.RevertY(this.zoom_origin[c]),this.RevertY(this.zoom_curr[c]));var t=Math.max(this.RevertY(this.zoom_origin[c]),this.RevertY(this.zoom_curr[c]));a=!0}this.clearInteractiveElements();this.last_touch=new Date(0);a&&(this.zoom_changed_interactive=2,this.Zoom(f,e,h,t));k.event.stopPropagation()}};m.prototype.ShowContextMenu=function(a,b,c){if(!("zoom_kind"in
this&&100<this.zoom_kind)){var d=this,f=!1,g=this;if(!b&&(k.event.preventDefault(),k.event.stopPropagation(),b=k.event,void 0===a)){var h=k.mouse(this.svg_frame().node()),t=k.touches(this.svg_frame().node()),n=this.pad_painter(),p=null,q=null;1===t.length?p={x:t[0][0],y:t[0][1],touch:!0}:2===h.length&&(p={x:h[0],y:h[1],touch:!1});if(null!==p&&null!==n)for(p.painters=!0,h=n.GetTooltips(p),t=1E3,n=0;n<h.length;++n)if(h[n]&&h[n].menu){var r="menu_dist"in h[n]?h[n].menu_dist:7;r<t&&(q=h[n].painter,t=
r)}null!==q&&(d=q);null!==p&&(f=0<p.x&&20>p.x&&0<p.y&&20>p.y);this.SetLastEventPos(p)}d.ctx_menu_evnt=b;e.Painter.createMenu(d,function(b){var d=b.painter.FillContextMenu(b,a,c);g&&(!d||f&&"frame"!==a&&g!=b.painter)&&(d=g.FillContextMenu(b));d&&b.painter.FillObjectExecMenu(b,a,function(){b.painter.SwitchTooltip(!1);b.show(b.painter.ctx_menu_evnt,b.painter.SwitchTooltip.bind(b.painter,!0))})})}};m.prototype.FillContextMenu=function(a,b,c){this.clearInteractiveElements();if("x"==b||"y"==b)return a.add("header: "+
b.toUpperCase()+" axis"),a.add("Unzoom",this.Unzoom.bind(this,b)),"normal"==this[b+"_kind"]&&a.addchk(this["log"+b],"SetLog"+b,this.ToggleLog.bind(this,b)),!0;(b=0==a.size())?a.add("header:Frame"):a.add("separator");this.zoom_xmin!==this.zoom_xmax&&a.add("Unzoom X",this.Unzoom.bind(this,"x"));this.zoom_ymin!==this.zoom_ymax&&a.add("Unzoom Y",this.Unzoom.bind(this,"y"));this.zoom_zmin!==this.zoom_zmax&&a.add("Unzoom Z",this.Unzoom.bind(this,"z"));a.add("Unzoom all",this.Unzoom.bind(this,"xyz"));a.addchk(this.logx,
"SetLogx",this.ToggleLog.bind(this,"x"));a.addchk(this.logy,"SetLogy",this.ToggleLog.bind(this,"y"));a.add("separator");a.addchk(this.IsTooltipAllowed(),"Show tooltips",function(){this.SetTooltipAllowed("toggle")});this.FillAttContextMenu(a,b?"":"Frame ");a.add("separator");a.add("Save as frame.png",function(){this.pad_painter().SaveAs("png","frame","frame.png")});a.add("Save as frame.svg",function(){this.pad_painter().SaveAs("svg","frame","frame.svg")});return!0};m.prototype.ShowAxisStatus=function(a){var b=
this.GetShowStatusFunc();if(b){var c=k.mouse(this.svg_frame().node()),d="x"==a?0:1;this.swap_xy&&(d=1-d);d="x"==a?this.RevertX(c[d]):this.RevertY(c[d]);b(a,"TAxis",a+" : "+this.AxisAsText(a,d),c[0].toFixed(0)+","+c[1].toFixed(0))}};m.prototype.AddInteractive=function(){if(!e.BatchMode&&(e.gStyle.Zooming||e.gStyle.ContextMenu)){var a=this.pad_painter();if(!a||!a._fast_drawing)if(a=this.svg_frame(),!a.empty()){var b=a.selectAll(".xaxis_container"),c=a.selectAll(".yaxis_container");a.property("interactive_set")||
(this.AddKeysHandler(),this.last_touch=new Date(0),this.zoom_kind=0,this.zoom_curr=this.zoom_origin=this.zoom_rect=null,this.touch_cnt=0);if(e.gStyle.Zooming&&(!this.options||!this.options.Proj)&&(e.gStyle.ZoomMouse&&(a.on("mousedown",this.startRectSel.bind(this)),a.on("dblclick",this.mouseDoubleClick.bind(this))),e.gStyle.ZoomWheel))a.on("wheel",this.mouseWheel.bind(this));if(e.touches&&(e.gStyle.Zooming&&e.gStyle.ZoomTouch||e.gStyle.ContextMenu))a.on("touchstart",this.startTouchZoom.bind(this));
e.gStyle.ContextMenu&&(e.touches&&(b.on("touchstart",this.startTouchMenu.bind(this,"x")),c.on("touchstart",this.startTouchMenu.bind(this,"y"))),a.on("contextmenu",this.ShowContextMenu.bind(this)),b.on("contextmenu",this.ShowContextMenu.bind(this,"x")),c.on("contextmenu",this.ShowContextMenu.bind(this,"y")));b.on("mousemove",this.ShowAxisStatus.bind(this,"x"));c.on("mousemove",this.ShowAxisStatus.bind(this,"y"));a.property("interactive_set",!0)}}};m.prototype.mouseWheel=function(){k.event.stopPropagation();
k.event.preventDefault();this.clearInteractiveElements();var a={name:"x",ignore:!1},b={name:"y",ignore:!this.AllowDefaultYZooming()},c=k.mouse(this.svg_frame().node()),d=this.frame_width(),e=this.frame_height();this.AnalyzeMouseWheelEvent(k.event,this.swap_xy?b:a,c[0]/d,0<=c[1]&&c[1]<=e);this.AnalyzeMouseWheelEvent(k.event,this.swap_xy?a:b,1-c[1]/e,0<=c[0]&&c[0]<=d);this.Zoom(a.min,a.max,b.min,b.max);if(a.changed||b.changed)this.zoom_changed_interactive=2};m.prototype.AllowDefaultYZooming=function(){var a=
this.pad_painter();if(a&&a.painters)for(var b=0;b<a.painters.length;++b){var c=a.painters[b];if(c&&void 0!==c.wheel_zoomy)return c.wheel_zoomy}return!1};m.prototype.AnalyzeMouseWheelEvent=function(a,b,c,d){b.min=b.max=void 0;b.changed=!1;if(!d||!b.ignore){var f=0,g=d=1;"dleft"in b&&(d=b.dleft,f=1);"dright"in b&&(g=b.dright,f=1);"delta"in b?f=b.delta:a&&void 0!==a.wheelDelta?f=-a.wheelDelta:a&&void 0!==a.deltaY?f=a.deltaY:a&&void 0!==a.detail&&(f=a.detail);if(0!==f){f=0>f?-.2:.2;d*=f;g*=f;a=b.min=
this["scale_"+b.name+"min"];var h=b.max=this["scale_"+b.name+"max"],t=this[b.name+"min"],k=this[b.name+"max"];b.min===b.max&&0>f&&(b.min=t,b.max=k);if(!(b.min>=b.max)){if(0<c&&1>c){if(this["log"+b.name])f=0<b.min?e.log10(b.max/b.min):2,10<f?f=10:.01>f&&(f=.01),b.min/=Math.pow(10,f*d*c),b.max*=Math.pow(10,f*g*(1-c));else{var p=f=b.max-b.min;0<d&&(f=1.001*f/(1-d));b.min+=-d*c*f;0<g&&(p=1.001*p/(1-g));b.max-=-g*(1-c)*p}b.min>=b.max?b.min=b.max=void 0:d!==g&&(b.min<t&&a===t||b.max>k&&h==k)&&(b.min=b.max=
void 0)}else b.min=b.max=void 0;b.changed=void 0!==b.min&&void 0!==b.max}}}};m.prototype.AddKeysHandler=function(){this.keys_handler||e.BatchMode||"undefined"==typeof window||(this.keys_handler=this.ProcessKeyPress.bind(this),window.addEventListener("keydown",this.keys_handler,!1))};m.prototype.ProcessKeyPress=function(a){if(!this.select_main().empty()){switch(a.keyCode){case 33:var b="PageUp";break;case 34:b="PageDown";break;case 37:b="ArrowLeft";break;case 38:b="ArrowUp";break;case 39:b="ArrowRight";
break;case 40:b="ArrowDown";break;case 42:b="PrintScreen";break;case 106:b="*";break;default:return!1}a.shiftKey&&(b="Shift "+b);a.altKey&&(b="Alt "+b);a.ctrlKey&&(b="Ctrl "+b);var c={name:"x",dleft:0,dright:0};switch(b){case "ArrowLeft":c.dleft=-1;c.dright=1;break;case "ArrowRight":c.dleft=1;c.dright=-1;break;case "Ctrl ArrowLeft":c.dleft=c.dright=-1;break;case "Ctrl ArrowRight":c.dleft=c.dright=1;break;case "ArrowUp":c.name="y";c.dleft=1;c.dright=-1;break;case "ArrowDown":c.name="y";c.dleft=-1;
c.dright=1;break;case "Ctrl ArrowUp":c.name="y";c.dleft=c.dright=1;break;case "Ctrl ArrowDown":c.name="y",c.dleft=c.dright=-1}if(c.dleft||c.dright){if(!e.gStyle.Zooming||this.mode3d&&0!==b.indexOf("Ctrl"))return!1;this.AnalyzeMouseWheelEvent(null,c,.5);this.Zoom(c.name,c.min,c.max);c.changed&&(this.zoom_changed_interactive=2);a.stopPropagation();a.preventDefault()}else if(b=(c=this.pad_painter())?c.FindButton(b):"")c.PadButtonClick(b),a.stopPropagation(),a.preventDefault();return!0}};m.prototype.CreateXY=
function(){this.logx=this.logy=this.reverse_y=this.reverse_x=this.swap_xy=!1;var a=this.frame_width(),b=this.frame_height();this.scale_xmin=this.xmin;this.scale_xmax=this.xmax;this.scale_ymin=this.ymin;this.scale_ymax=this.ymax;this._xaxis_timedisplay?(this.x_kind="time",this.timeoffsetx=e.Painter.getTimeOffset(this.histo.fXaxis),this.ConvertX=function(a){return new Date(this.timeoffsetx+1E3*a)},this.RevertX=function(a){return(this.x.invert(a)-this.timeoffsetx)/1E3}):(this.x_kind="normal",this.ConvertX=
function(a){return a},this.RevertX=function(a){return this.x.invert(a)});this.zoom_xmin!=this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax);if("time"==this.x_kind)this.x=k.scaleTime();else if(this.logx){0>=this.scale_xmax&&(this.scale_xmax=1);if(0>=this.scale_xmin||this.scale_xmin>=this.scale_xmax)this.scale_xmin=1E-4*this.scale_xmax;this.x=k.scaleLog()}else this.x=k.scaleLinear();a=this.reverse_x?[a,0]:[0,a];b=this.reverse_y?[0,b]:[b,0];this.x.domain([this.ConvertX(this.scale_xmin),
this.ConvertX(this.scale_xmax)]).range(this.swap_xy?b:a);this.grx="time"==this.x_kind?function(a){return this.x(this.ConvertX(a))}:this.logx?function(a){return a<this.scale_xmin?this.swap_xy?this.x.range()[0]+5:-5:this.x(a)}:this.x;this.zoom_ymin!=this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);this._yaxis_timedisplay?(this.y_kind="time",this.timeoffsety=e.Painter.getTimeOffset(this.histo.fYaxis),this.ConvertY=function(a){return new Date(this.timeoffsety+1E3*a)},this.RevertY=
function(a){return(this.y.invert(a)-this.timeoffsety)/1E3}):(this.y_kind="normal",this.ConvertY=function(a){return a},this.RevertY=function(a){return this.y.invert(a)});if(this.logy){0>=this.scale_ymax&&(this.scale_ymax=1);if(0>=this.scale_ymin||this.scale_ymin>=this.scale_ymax)this.scale_ymin=3E-4*this.scale_ymax;this.y=k.scaleLog()}else this.y="time"==this.y_kind?k.scaleTime():k.scaleLinear();this.y.domain([this.ConvertY(this.scale_ymin),this.ConvertY(this.scale_ymax)]).range(this.swap_xy?a:b);
this.gry="time"==this.y_kind?function(a){return this.y(this.ConvertY(a))}:this.logy?function(a){return a<this.scale_ymin?this.swap_xy?-5:this.y.range()[0]+5:this.y(a)}:this.y};m.prototype.SetRootPadRange=function(a,b){};m.prototype.ToggleLog=function(a){var b=this.main_painter()||this,c=this.root_pad(),d=c["fLog"+a];if(!d){var e=this[a+"_kind"];this.swap_xy&&"x"===a?e=this.y_kind:this.swap_xy&&"y"===a&&(e=this.x_kind);if("labels"===e)return}e=this.pad_painter();var g=this.canv_painter();e&&e.snapid&&
g&&g._websocket?console.warn("Change log scale on server here!!!!"):(c["fLog"+a]=d?0:1,b.RedrawPad())};l.prototype=Object.create(e.TObjectPainter.prototype);l.prototype.Cleanup=function(){for(var a=0;a<this.painters.length;++a)this.painters[a].Cleanup();a=this.svg_pad(this.this_pad_name);a.empty()||(a.property("pad_painter",null),a.property("mainpainter",null),this.iscan||a.remove());delete this.frame_painter_ref;delete this.pads_cache;this.painters=[];this.pad_frame=this.draw_object=this.pad=null;
this.this_pad_name="";this.has_canvas=!1;e.Painter.SelectActivePad({pp:this,active:!1});e.TObjectPainter.prototype.Cleanup.call(this)};l.prototype.CleanPrimitives=function(a){if(a&&"function"===typeof a)for(var b=this.painters.length-1;0<=b;--b)a(this.painters[b])&&(this.painters[b].Cleanup(),this.painters.splice(b,1))};l.prototype.ForEachPainterInPad=function(a,b){b||(b="all");"objects"!=b&&a(this);for(var c=0;c<this.painters.length;++c){var d=this.painters[c];"function"===typeof d.ForEachPainterInPad?
"objects"!=b&&d.ForEachPainterInPad(a,b):"pads"!=b&&a(d)}};l.prototype.ButtonSize=function(a){return Math.round((a?a:1)*(this.iscan||!this.has_canvas?16:12))};l.prototype.RegisterForPadEvents=function(a){this.pad_events_receiver=a};l.prototype.SelectObjectPainter=function(a,b){var c=this.iscan||!this.has_canvas,d=c?this:this.canv_painter(),f=a instanceof l?a:a.pad_painter();b&&!c&&this.CalcAbsolutePosition(this.svg_pad(this.this_pad_name),b);e.Painter.SelectActivePad({pp:f,active:!0});"function"==
typeof d.SelectActivePad&&d.SelectActivePad(f,a,b);d.pad_events_receiver&&d.pad_events_receiver({what:"select",padpainter:f,painter:a,position:b})};l.prototype.SetActive=function(a){var b=this.frame_painter();b&&"function"==typeof b.SetActive&&b.SetActive(a)};l.prototype.CreateCanvasSvg=function(a,b){if(0<a){if(this._fixed_size)return 1<a;var c=this.svg_canvas();if(c.empty())return!1;var d=c.property("height_factor");b=this.check_main_resize(a,null,d);if(!b.changed)return!1;a=this.svg_layer("btns_layer")}else{var f=
this.select_main();"static"==f.style("position")&&f.style("position","relative");c=f.append("svg").attr("class","jsroot root_canvas").property("pad_painter",this).property("mainpainter",null).property("current_pad","").property("redraw_by_resize",!1);c.append("svg:title").text("ROOT canvas");d=c.append("svg:rect").attr("class","canvas_fillrect").attr("x",0).attr("y",0);if(!e.BatchMode)d.style("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,
this)).on("mouseenter",this.ShowObjectStatus.bind(this));c.append("svg:g").attr("class","primitives_layer");c.append("svg:g").attr("class","info_layer");a=c.append("svg:g").attr("class","btns_layer").property("leftside","left"==e.gStyle.ToolBarSide).property("vertical",e.gStyle.ToolBarVert);if(e.gStyle.ContextMenu)c.select(".canvas_fillrect").on("contextmenu",this.ShowContextMenu.bind(this));d=.66;this.pad&&this.pad.fCw&&this.pad.fCh&&0<this.pad.fCw&&(d=this.pad.fCh/this.pad.fCw,.1>d||10<d)&&(d=.66);
this._fixed_size?(f.style("overflow","auto"),b={width:this.pad.fCw,height:this.pad.fCh}):b=this.check_main_resize(2,b,d)}5>=b.width||5>=b.height?(c.style("display","none"),console.warn("Hide canvas while geometry too small w=",b.width," h=",b.height),b.width=200,b.height=100):c.style("display",null);this._fixed_size?c.attr("x",0).attr("y",0).attr("width",b.width).attr("height",b.height).style("position","absolute"):c.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position",
"absolute").style("left",0).style("top",0).style("right",0).style("bottom",0);c.attr("viewBox","0 0 "+b.width+" "+b.height).attr("preserveAspectRatio","none").property("height_factor",d).property("draw_x",0).property("draw_y",0).property("draw_width",b.width).property("draw_height",b.height);this._fast_drawing=e.gStyle.SmallPad&&(b.width<e.gStyle.SmallPad.width||b.height<e.gStyle.SmallPad.height);this.AlignBtns(a,b.width,b.height,c);return!0};l.prototype.EnlargePad=function(){k.event&&(k.event.preventDefault(),
k.event.stopPropagation());var a=this.svg_canvas(),b=a.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(b||this.HasObjectsToDraw()||this.painters))b?b===this.pad?(this.enlarge_main(!1),a.property("pad_enlarged",null)):console.error("missmatch with pad double click events"):(this.enlarge_main(!0,!0),a.property("pad_enlarged",this.pad));else{if(this._fixed_size||!this.enlarge_main("toggle"))return;"off"==this.enlarge_main("state")&&a.property("pad_enlarged",null)}a=this._fast_drawing;this.CheckResize({force:!0});
this._fast_drawing!=a&&this.ShowButtons()};l.prototype.CreatePadSvg=function(a){if(!this.has_canvas)return this.CreateCanvasSvg(a?2:0),!0;var b=this.svg_pad(),c=this.svg_canvas(),d=b.property("draw_width"),f=b.property("draw_height"),g=c.property("pad_enlarged");c=!g||g===this.pad;var h=d,k=f,n=0,p=0;this.pad&&this.pad.fDrawOpts&&this.pad.fSize&&(h=Math.round(d*this.pad.fSize.fHoriz.fNormal.fVal),k=Math.round(f*this.pad.fSize.fVert.fNormal.fVal),n=Math.round(d*this.pad.fDrawOpts.fPos.fAttr.fHoriz.fNormal.fVal),
p=Math.round(f*this.pad.fDrawOpts.fPos.fAttr.fVert.fNormal.fVal));g===this.pad&&(h=d,k=f,n=p=0);if(a)a=this.svg_pad(this.this_pad_name),b=a.select(".root_pad_border"),d=this.svg_layer("btns_layer",this.this_pad_name);else{a=b.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this).property("mainpainter",null);b=a.append("svg:rect").attr("class","root_pad_border");a.append("svg:g").attr("class","primitives_layer");
d=a.append("svg:g").attr("class","btns_layer").property("leftside","left"!=e.gStyle.ToolBarSide).property("vertical",e.gStyle.ToolBarVert);if(e.gStyle.ContextMenu)b.on("contextmenu",this.ShowContextMenu.bind(this));if(!e.BatchMode)b.attr("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,this)).on("mouseenter",this.ShowObjectStatus.bind(this))}this.createAttFill({attr:this.pad});this.createAttLine({attr:this.pad,color0:0==this.pad.fBorderMode?
"none":""});a.attr("display",c?null:"none").attr("viewBox","0 0 "+h+" "+k).attr("preserveAspectRatio","none").attr("x",n).attr("y",p).attr("width",h).attr("height",k).property("draw_x",n).property("draw_y",p).property("draw_width",h).property("draw_height",k);b.attr("x",0).attr("y",0).attr("width",h).attr("height",k).call(this.fillatt.func).call(this.lineatt.func);this._fast_drawing=e.gStyle.SmallPad&&(h<e.gStyle.SmallPad.width||k<e.gStyle.SmallPad.height);1===a.property("can3d")&&this.select_main().select(".draw3d_"+
this.this_pad_name).style("display",c?"":"none");this.AlignBtns(d,h,k);return c};l.prototype.RemovePrimitive=function(a){this.pad&&this.pad.fPrimitives&&(a=this.pad.fPrimitives.arr.indexOf(a),0<=a&&this.pad.fPrimitives.RemoveAt(a))};l.prototype.FindPrimitive=function(a,b,c){if(!this.pad||!this.pad.fPrimitives)return null;for(var d=0;d<this.pad.fPrimitives.arr.length;d++){var e=this.pad.fPrimitives.arr[d];if(null===a||e===a)if(void 0===b||null===b||e._typename===b)if(void 0===c||null===c||e.fName===
c)return e}return null};l.prototype.HasObjectsToDraw=function(){var a=this.pad?this.pad.fPrimitives:null;if(a)for(var b=0;b<a.length;++b)if(a[b]&&"ROOT::Experimental::RPadDisplayItem"!=a[b]._typename)return!0;return!1};l.prototype.DrawPrimitives=function(a,b,c){0===a&&(this._doing_pad_draw=!0,this.iscan&&(this._start_tm=this._lasttm_tm=(new Date).getTime()),this._num_primitives=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.length:0);for(;;){c&&"object"==typeof c&&(c._primitive=!0);if(!this.pad||
a>=this.pad.fPrimitives.length)return delete this._doing_pad_draw,delete this._current_primitive_indx,this._start_tm&&(a=(new Date).getTime()-this._start_tm,3E3<a&&console.log("Canvas drawing took "+(.001*a).toFixed(2)+"s"),delete this._start_tm,delete this._lasttm_tm),e.CallBack(b);var d={func:this.DrawPrimitives.bind(this,a+1,b)};this._current_primitive_indx=a;c=e.draw(this.divid,this.pad.fPrimitives[a],"",d);a++;if(!d.completed)break;if(!e.BatchMode&&this.iscan){var f=(new Date).getTime();if(f>
this._lasttm_tm+500)return this._lasttm_tm=f,c._primitive=!0,requestAnimationFrame(d.func)}}};l.prototype.GetTooltips=function(a){var b=[],c=[];null!==this.painters&&this.painters.forEach(function(a){"ProcessTooltip"in a&&b.push(a)});a&&(a.nproc=b.length);b.forEach(function(b){var d=b.ProcessTooltip(a);d||(d={user_info:null});c.push(d);d&&a&&a.painters&&(d.painter=b)});return c};l.prototype.FillContextMenu=function(a){this.pad?a.add("header: "+this.pad._typename+"::"+this.pad.fName):a.add("header: Canvas");
a.addchk(this.IsTooltipAllowed(),"Show tooltips",this.SetTooltipAllowed.bind(this,"toggle"));if(!this._websocket){var b=function(a){this.pad[a.substr(1)]=parseInt(a[0]);(a=this.svg_pad(this.this_pad_name).property("mainpainter"))&&"function"==typeof a.DrawAxes&&a.DrawAxes()},c=function(a){this.pad[a]=this.pad[a]?0:1;(a=this.svg_pad(this.this_pad_name).property("mainpainter"))&&"function"==typeof a.DrawGrids&&a.DrawGrids()};a.addchk(this.pad.fGridx,"Grid x","fGridx",c);a.addchk(this.pad.fGridy,"Grid y",
"fGridy",c);a.add("sub:Ticks x");a.addchk(0==this.pad.fTickx,"normal","0fTickx",b);a.addchk(1==this.pad.fTickx,"ticks on both sides","1fTickx",b);a.addchk(2==this.pad.fTickx,"labels up","2fTickx",b);a.add("endsub:");a.add("sub:Ticks y");a.addchk(0==this.pad.fTicky,"normal","0fTicky",b);a.addchk(1==this.pad.fTicky,"ticks on both side","1fTicky",b);a.addchk(2==this.pad.fTicky,"labels right","2fTicky",b);a.add("endsub:");this.FillAttContextMenu(a)}a.add("separator");this.ToggleEventStatus&&a.addchk(this.HasEventStatus(),
"Event status",this.ToggleEventStatus.bind(this));(this.enlarge_main()||this.has_canvas&&this.HasObjectsToDraw())&&a.addchk("on"==this.enlarge_main("state"),"Enlarge "+(this.iscan?"canvas":"pad"),this.EnlargePad.bind(this));b=this.this_pad_name;0===b.length&&(b=this.iscan?"canvas":"pad");a.add("Save as "+b+".png",b+".png",this.SaveAs.bind(this,"png",!1));a.add("Save as "+b+".svg",b+".svg",this.SaveAs.bind(this,"svg",!1));return!0};l.prototype.ShowContextMenu=function(a){if(!a){var b=k.mouse(this.svg_pad(this.this_pad_name).node());
if(b&&2==b.length&&0<b[0]&&10>b[0]&&0<b[1]&&10>b[1])return;k.event.stopPropagation();k.event.preventDefault();a=k.event;(b=this.frame_painter())&&b.SetLastEventPos()}e.Painter.createMenu(this,function(b){b.painter.FillContextMenu(b);b.painter.FillObjectExecMenu(b,"",function(){b.show(a)})})};l.prototype.Redraw=function(a){if(this._doing_pad_draw)return console.log("Prevent redrawing",this.pad.fName);var b=!0;this.iscan?this.CreateCanvasSvg(2):b=this.CreatePadSvg(!0);for(var c=0;c<this.painters.length;++c){var d=
this.painters[c];(b||d.this_pad_name)&&d.Redraw(a)}};l.prototype.NumDrawnSubpads=function(){if(void 0===this.painters)return 0;for(var a=0,b=0;b<this.painters.length;++b){var c=this.painters[b].GetObject();c&&"TPad"===c._typename&&a++}return a};l.prototype.RedrawByResize=function(){if(1===this.access_3d_kind())return!0;for(var a=0;a<this.painters.length;++a)if("function"===typeof this.painters[a].RedrawByResize&&this.painters[a].RedrawByResize())return!0;return!1};l.prototype.CheckCanvasResize=function(a,
b){if(!this.iscan&&this.has_canvas)return!1;if(!0===a||!1===a)b=a,a=null;a&&"object"===typeof a&&a.force&&(b=!0);b||(b=this.RedrawByResize());if(a=this.CreateCanvasSvg(b?2:1,a))for(var c=0;c<this.painters.length;++c)this.painters[c].Redraw(b?!1:!0);return a};l.prototype.UpdateObject=function(a){if(!a)return!1;this.pad.fCw=a.fCw;this.pad.fCh=a.fCh;this.pad.fTitle=a.fTitle;return!0};l.prototype.DrawNextSnap=function(a,b,c,d){-1===b&&(this._doing_pad_draw=!0,this._snaps_map={},this._num_primitives=a?
a.length:0);"workaround"===d&&(--b,d=null);for(;;){d&&a&&a[b]&&void 0===d.snapid&&(0>this.painters.indexOf(d)&&this.painters.push(d),d.snapid=a[b].fObjectID);d=null;++b;if(!a||b>=a.length)return delete this._doing_pad_draw,delete this._snaps_map,delete this._current_primitive_indx,e.CallBack(c,this);var f=a[b],g=f.fObjectID,h=this._snaps_map[g];h?h++:h=1;this._snaps_map[g]=h;this._current_primitive_indx=b;for(var k=0;k<this.painters.length;++k)if(this.painters[k].snapid===g&&0===--h){d=this.painters[k];
break}var n=this.DrawNextSnap.bind(this,a,b,c);if(d){if("ROOT::Experimental::RPadDisplayItem"==f._typename)return d.RedrawPadSnap(f,n);d.UpdateObject(f.fObject,f.fOption||"")&&d.Redraw()}else{if("ROOT::Experimental::RPadDisplayItem"==f._typename){var p=new l(f,!1);p.DecodeOptions("");p.SetDivId(this.divid);p.snapid=f.fObjectID;p.CreatePadSvg();f.fPrimitives&&0<f.fPrimitives.length&&(p.AddButton(e.ToolbarIcons.camera,"Create PNG","PadSnapShot"),p.AddButton(e.ToolbarIcons.circle,"Enlarge pad","EnlargePad"),
e.gStyle.ContextMenu&&p.AddButton(e.ToolbarIcons.question,"Access context menus","PadContextMenus"));var q=p.CurrentPadName(p.this_pad_name);p.DrawNextSnap(f.fPrimitives,-1,function(){p.CurrentPadName(q);n(p)});break}var r={func:n};if("ROOT::Experimental::RObjectDisplayItem"===f._typename&&!this.frame_painter())return e.draw(this.divid,{_typename:"TFrame",$dummy:!0},"",function(){r.func("workaround")});d=e.draw(this.divid,f.fObject,f.fOption||"",r);if(!r.completed)break}}};l.prototype.FindSnap=function(a){if(this.snapid===
a)return this;if(!this.painters)return null;for(var b=0;b<this.painters.length;++b){var c=this.painters[b];"function"===typeof c.FindSnap?c=c.FindSnap(a):c.snapid!==a&&(c=null);if(c)return c}return null};l.prototype.AddOnlineButtons=function(){this.AddButton(e.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");e.gStyle.ContextMenu&&this.AddButton(e.ToolbarIcons.question,"Access context menus","PadContextMenus");this.enlarge_main("verify")&&this.AddButton(e.ToolbarIcons.circle,"Enlarge canvas",
"EnlargePad")};l.prototype.RedrawPadSnap=function(a,b){if(a&&a.fPrimitives){var c={fCw:a.fWinSize[0].fVal,fCh:a.fWinSize[1].fVal,fTitle:a.fTitle};!this.batch_mode||!this.iscan||c.fCw&&c.fCh||(c.fCw=900,c.fCh=700);this.iscan&&a.fTitle&&document&&(document.title=a.fTitle);this.iscan&&a.fTitle&&document&&(document.title=a.fTitle);if(void 0===this.snapid)this.snapid=a.fObjectID,this.pad=this.draw_object=c,this.pad_frame=a.fFrame,this.batch_mode&&this.iscan&&(this._fixed_size=!0),this.CreateCanvasSvg(0),
this.SetDivId(this.divid),this.AddOnlineButtons(),this.DrawNextSnap(a.fPrimitives,-1,b);else{this.UpdateObject(c);this.iscan?this.CreateCanvasSvg(2):this.CreatePadSvg(!0);var d=!1,e=!1;for(c=0;c<this.painters.length;++c){var g=this.painters[c];if(void 0!==g.snapid){for(var h=0;h<a.fPrimitives.length;++h)if(a.fPrimitives[h].fObjectID===g.snapid){g=null;d=!0;break}g&&(this.painters.splice(c--,1),g.Cleanup(),e=!0)}}e&&delete this.pads_cache;if(!d){c=this.svg_pad(this.this_pad_name);d=this.frame_painter();
c&&!c.empty()&&c.property("mainpainter",null);for(c=0;c<this.painters.length;++c)d!==this.painters[c]&&this.painters[c].Cleanup();this.painters=[];d&&(this.painters.push(d),d.CleanDrawings());this.RemoveButtons();this.AddOnlineButtons()}var k=this,n=k.CurrentPadName(k.this_pad_name);k.DrawNextSnap(a.fPrimitives,-1,function(){k.CurrentPadName(n);b(k)})}}};l.prototype.CreateImage=function(a,b){"pdf"==a?e.CallBack(b,btoa("dummy PDF file")):"png"==a||"jpeg"==a||"svg"==a?this.ProduceImage(!0,a,function(c){if("svg"==
a||!c)return e.CallBack(b,c);var d=c.indexOf("base64,");e.CallBack(b,0<d?c.substr(d+7):"")}):e.CallBack(b,"")};l.prototype.ItemContextMenu=function(a){var b=this.svg_pad(this.this_pad_name).node().getBoundingClientRect(),c={clientX:b.left+10,clientY:b.top+10};if("pad"==a)return setTimeout(this.ShowContextMenu.bind(this,c),50);var d=null;switch(a){case "xaxis":case "yaxis":case "zaxis":d=this.main_painter();var f=a[0];break;case "frame":d=this.frame_painter();break;default:a=parseInt(a),isNaN(a)||
(d=this.painters[a])}d&&"function"===typeof d.FillContextMenu&&e.Painter.createMenu(d,function(a){d.FillContextMenu(a,f)&&setTimeout(a.show.bind(a,c),50)})};l.prototype.SaveAs=function(a,b,c){c||(c=this.this_pad_name,0===c.length&&(c=this.iscan?"canvas":"pad"),c+="."+a);this.ProduceImage(b,a,function(b){var d=document.createElement("a");d.download=c;d.href="svg"!=a?b:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(b);document.body.appendChild(d);d.addEventListener("click",function(a){d.parentNode.removeChild(d)});
d.click()})};l.prototype.ProduceImage=function(a,b,c){function d(a){for(var b=0;b<h.length;++b){var d=h[b];d.img&&d.img.remove();var f=d.prnt.select(".primitives_layer");d.foreign&&d.prnt.node().insertBefore(d.foreign.node(),f.node());d.frame_node&&f.node().insertBefore(d.frame_node,d.frame_next);d.btns_node&&d.btns_prnt.insertBefore(d.btns_node,d.btns_next)}e.CallBack(c,a)}var f="frame"===a,g=f?this.svg_frame():a?this.svg_canvas():this.svg_pad(this.this_pad_name);if(g.empty())return e.CallBack(c);
a=a&&!f?this.canv_painter():this;var h=[];f||a.ForEachPainterInPad(function(a){var b={prnt:a.svg_pad(a.this_pad_name)};h.push(b);var c=a.svg_layer("btns_layer",a.this_pad_name);b.btns_node=c.node();b.btns_node&&(b.btns_prnt=b.btns_node.parentNode,b.btns_next=b.btns_node.nextSibling,c.remove());if((c=a.frame_painter_ref)&&"function"===typeof c.Render3D){var d=c.access_3d_kind();if(1===d||2===d){a=c.size_for_3d(2);var e=2==d?e:c.size_for_3d(1);e=c.renderer.domElement;c.Render3D(0);var f=e.toDataURL("image/png");
2==d&&(b.foreign=b.prnt.select("."+a.clname),b.foreign.remove());c=c.svg_frame();b.frame_node=c.node();b.frame_node&&(b.frame_next=b.frame_node.nextSibling,c.remove());b.img=b.prnt.insert("image",".primitives_layer").attr("x",a.x).attr("y",a.y).attr("width",e.width).attr("height",e.height).attr("href",f)}}},"pads");a=g.property("draw_width");var k=g.property("draw_height");f&&(a=this.frame_width(),k=this.frame_height());f='<svg width="'+a+'" height="'+k+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+
g.node().innerHTML+"</svg>";if("svg"==b)return d(f);var n=new Image;n.onload=function(){var a=document.createElement("canvas");a.width=n.width;a.height=n.height;a.getContext("2d").drawImage(n,0,0);d(a.toDataURL("image/"+b))};n.onerror=function(a){console.log("IMAGE ERROR",a);d(null)};n.src="data:image/svg+xml;base64,"+window.btoa(function(a){a=encodeURIComponent(a);a=a.replace(/%([0-9A-F]{2})/g,function(a,b){a=String.fromCharCode("0x"+b);return"%"===a?"%25":a});return decodeURIComponent(a)}('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+
f))};l.prototype.PadButtonClick=function(a){if("CanvasSnapShot"==a)return this.SaveAs("png",!0);if("EnlargePad"==a)return this.EnlargePad();if("PadSnapShot"==a)return this.SaveAs("png",!1);if("PadContextMenus"==a){if(k.event.preventDefault(),k.event.stopPropagation(),!e.Painter.closeMenu()){var b=this,c=k.event;e.Painter.createMenu(b,function(a){a.add("header:Menus");b.iscan?a.add("Canvas","pad",b.ItemContextMenu):a.add("Pad","pad",b.ItemContextMenu);b.frame_painter()&&a.add("Frame","frame",b.ItemContextMenu);
var d=b.main_painter();d&&(a.add("X axis","xaxis",b.ItemContextMenu),a.add("Y axis","yaxis",b.ItemContextMenu),"function"===typeof d.Dimension&&1<d.Dimension()&&a.add("Z axis","zaxis",b.ItemContextMenu));if(b.painters&&0<b.painters.length){a.add("separator");d=[];for(var e=0;e<b.painters.length;++e){var f=b.painters[e];if((f=f?f.GetObject():null)&&!(0<=d.indexOf(f))){var g="_typename"in f?f._typename+"::":"";"fName"in f&&(g+=f.fName);0==g.length&&(g="item"+e);a.add(g,e,b.ItemContextMenu)}}}a.show(c)})}}else for(var d=
!1,f=0;f<this.painters.length;++f){var g=this.painters[f];"function"==typeof g.PadButtonClick&&g.PadButtonClick(a);d||"function"!=typeof g.ButtonClick||(d=g.ButtonClick(a))}};l.prototype.FindButton=function(a){var b=this.svg_layer("btns_layer",this.this_pad_name),c="";b.empty()||b.selectAll("svg").each(function(){k.select(this).attr("key")===a&&(c=k.select(this).attr("name"))});return c};l.prototype.toggleButtonsVisibility=function(a){var b=this.svg_layer("btns_layer",this.this_pad_name),c=b.select("[name='Toggle']");
if(!c.empty()){var d=c.property("buttons_state");c.property("timout_handler")&&("timeout"!==a&&clearTimeout(c.property("timout_handler")),c.property("timout_handler",null));var e=!1;switch(a){case "enable":e=!0;break;case "enterbtn":return;case "timeout":e=!1;break;case "toggle":d=!d;c.property("buttons_state",d);e=d;break;case "disable":case "leavebtn":d||c.property("timout_handler",setTimeout(this.toggleButtonsVisibility.bind(this,"timeout"),500));return}b.selectAll("svg").each(function(){this!==
c.node()&&k.select(this).style("display",e?"":"none")})}};l.prototype.RemoveButtons=function(){var a=this.svg_layer("btns_layer",this.this_pad_name);a.empty()||(a.selectAll("*").remove(),a.property("nextx",null))};l.prototype.RemoveButtons=function(){var a=this.svg_layer("btns_layer",this.this_pad_name);a.empty()||(a.selectAll("*").remove(),a.property("nextx",null))};l.prototype.AddButton=function(a,b,c,d){if(e.gStyle.ToolBar){this._buttons||(this._buttons=[]);for(var f=0;f<this._buttons.length;++f)if(this._buttons[f].funcname==
c)return;this._buttons.push({btn:a,tooltip:b,funcname:c,keyname:d});!this.iscan&&this.has_canvas&&0!=c.indexOf("Pad")&&"EnlargePad"!==c&&(d=this.canv_painter())&&d!==this&&d.AddButton(a,b,c)}};l.prototype.ShowButtons=function(){if(this._buttons){var a=this.svg_layer("btns_layer",this.this_pad_name);if(!a.empty()){a.selectAll("*").remove();var b=this.iscan||!this.has_canvas,c=a.property("leftside")?this.ButtonSize(1.25):0;if(this._fast_drawing){var d=e.ToolbarIcons.CreateSVG(a,e.ToolbarIcons.circle,
this.ButtonSize(),"EnlargePad");d.attr("name","Enlarge").attr("x",0).attr("y",0).on("click",this.PadButtonClick.bind(this,"EnlargePad"))}else{d=e.ToolbarIcons.CreateSVG(a,e.ToolbarIcons.rect,this.ButtonSize(),"Toggle tool buttons");d.attr("name","Toggle").attr("x",0).attr("y",0).property("buttons_state","popup"!==e.gStyle.ToolBar).on("click",this.toggleButtonsVisibility.bind(this,"toggle")).on("mouseenter",this.toggleButtonsVisibility.bind(this,"enable")).on("mouseleave",this.toggleButtonsVisibility.bind(this,
"disable"));for(var f=0;f<this._buttons.length;++f){var g=this._buttons[f],h=e.ToolbarIcons.CreateSVG(a,g.btn,this.ButtonSize(),g.tooltip+(b?"":" on pad "+this.this_pad_name)+(g.keyname?" (keyshortcut "+g.keyname+")":""));a.property("vertical")?h.attr("x",0).attr("y",c):h.attr("x",c).attr("y",0);h.attr("name",g.funcname).style("display",d.property("buttons_state")?"":"none").on("mouseenter",this.toggleButtonsVisibility.bind(this,"enterbtn")).on("mouseleave",this.toggleButtonsVisibility.bind(this,
"leavebtn"));g.keyname&&h.attr("key",g.keyname);h.on("click",this.PadButtonClick.bind(this,g.funcname));c+=this.ButtonSize(1.25)}}a.property("nextx",c);this.AlignBtns(a,this.pad_width(this.this_pad_name),this.pad_height(this.this_pad_name));a.property("vertical")?d.attr("y",c):a.property("leftside")||d.attr("x",c)}}};l.prototype.AlignBtns=function(a,b,c,d){d=this.ButtonSize(1.25);var e=(a.property("nextx")||0)+d;a.property("vertical")?(b=a.property("leftside")?2:b-d,c-=e):(b=a.property("leftside")?
2:b-e,c-=d);a.attr("transform","translate("+b+","+c+")")};l.prototype.DecodeOptions=function(a){var b=this.GetObject();if(b){a=new e.DrawOptions(a);a.check("WEBSOCKET")&&this.OpenWebsocket();this.options||(this.options={});e.extend(this.options,{GlobalColors:!0,LocalColors:!1,IgnorePalette:!1,RotateFrame:!1,FixFrame:!1});if(a.check("NOCOLORS")||a.check("NOCOL"))this.options.GlobalColors=this.options.LocalColors=!1;if(a.check("LCOLORS")||a.check("LCOL"))this.options.GlobalColors=!1,this.options.LocalColors=
!0;if(a.check("NOPALETTE")||a.check("NOPAL"))this.options.IgnorePalette=!0;a.check("ROTATE")&&(this.options.RotateFrame=!0);a.check("FIXFRAME")&&(this.options.FixFrame=!0);a.check("WHITE")&&(b.fFillColor=0);a.check("LOGX")&&(b.fLogx=1);a.check("LOGY")&&(b.fLogy=1);a.check("LOGZ")&&(b.fLogz=1);a.check("LOG")&&(b.fLogx=b.fLogy=b.fLogz=1);a.check("GRIDX")&&(b.fGridx=1);a.check("GRIDY")&&(b.fGridy=1);a.check("GRID")&&(b.fGridx=b.fGridy=1);a.check("TICKX")&&(b.fTickx=1);a.check("TICKY")&&(b.fTicky=1);
a.check("TICK")&&(b.fTickx=b.fTicky=1)}};u.prototype=Object.create(l.prototype);u.prototype.ChangeLayout=function(a,b){if(this.get_layout_kind()==a)return e.CallBack(b,!0);for(var c=this.select_main("origin"),d=c.select(".side_panel"),f=this.select_main(),g=[];f.node().firstChild;)g.push(f.node().removeChild(f.node().firstChild));d.empty()||e.cleanup(d.node());this.set_layout_kind("simple");c.html("");if("simple"==a){f=c;for(var h=0;h<g.length;++h)f.node().appendChild(g[h]);this.set_layout_kind(a);
e.resize(f.node());return e.CallBack(b,!0)}var l=this;e.AssertPrerequisites("jq2d",function(){var h=new e.GridDisplay(c.node(),a);0==a.indexOf("vert")?(f=k.select(h.GetFrame(0)),d=k.select(h.GetFrame(1))):(f=k.select(h.GetFrame(1)),d=k.select(h.GetFrame(0)));f.classed("central_panel",!0).style("position","relative");d.classed("side_panel",!0).style("position","relative");for(h=0;h<g.length;++h)f.node().appendChild(g[h]);l.set_layout_kind(a,".central_panel");c.property("mdi",null);e.resize(f.node());
e.CallBack(b,!0)})};u.prototype.ToggleProjection=function(a,b){delete this.proj_painter;a&&(this.proj_painter=1);if(this.ShowUI5ProjectionArea)return this.ShowUI5ProjectionArea(a,b);var c="simple";"X"==a?c="vert2_31":"Y"==a&&(c="horiz2_13");this.ChangeLayout(c,b)};u.prototype.DrawProjection=function(a,b){if(this.proj_painter)if(1===this.proj_painter){var c=e.Create("TCanvas"),d=this,f=this.root_pad(),g=this.main_painter();"X"==a?(c.fLeftMargin=f.fLeftMargin,c.fRightMargin=f.fRightMargin,c.fLogx=g.logx?
1:0,c.fUxmin=g.logx?e.log10(g.scale_xmin):g.scale_xmin,c.fUxmax=g.logx?e.log10(g.scale_xmax):g.scale_xmax,a="fixframe"):(c.fBottomMargin=f.fBottomMargin,c.fTopMargin=f.fTopMargin,c.fLogx=g.logy?1:0,c.fUxmin=g.logy?e.log10(g.scale_ymin):g.scale_ymin,c.fUxmax=g.logy?e.log10(g.scale_ymax):g.scale_ymax,a="rotate");c.fPrimitives.Add(b,"hist");this.DrawInUI5ProjectionArea?this.DrawInUI5ProjectionArea(c,a,function(a){d.proj_painter=a}):this.DrawInSidePanel(c,a,function(a){d.proj_painter=a})}else(c=this.proj_painter.main_painter())&&
c.UpdateObject(b,"hist"),this.proj_painter.RedrawPad()};u.prototype.DrawInSidePanel=function(a,b,c){var d=this.select_main("origin").select(".side_panel");if(d.empty())return e.CallBack(c,null);e.draw(d.node(),a,b,c)};u.prototype.ShowMessage=function(a){e.progress(a,7E3)};u.prototype.SaveCanvasAsFile=function(a){var b=this,c=a.indexOf(".");this.CreateImage(a.substr(c+1),function(c){b.SendWebsocket("SAVE:"+a+":"+c)})};u.prototype.SendSaveCommand=function(a){this.SendWebsocket("PRODUCE:"+a)};u.prototype.SendWebsocket=
function(a,b){this._websocket&&this._websocket.Send(a,b)};u.prototype.CloseWebsocket=function(a){this._websocket&&(this._websocket.Close(a),this._websocket.Cleanup(),delete this._websocket)};u.prototype.OpenWebsocket=function(a){this.CloseWebsocket();this._websocket=new e.WebWindowHandle(a);this._websocket.SetReceiver(this);this._websocket.Connect()};u.prototype.UseWebsocket=function(a){this.CloseWebsocket();this._websocket=a;console.log("Use websocket",this._websocket.key);this._websocket.SetReceiver(this);
this._websocket.Connect()};u.prototype.WindowBeforeUnloadHanlder=function(){this.CloseWebsocket(!0)};u.prototype.OnWebsocketOpened=function(a){};u.prototype.OnWebsocketClosed=function(a){e.CloseCurrentWindow()};u.prototype.OnWebsocketMsg=function(a,b){console.log("GET MSG "+b.substr(0,30));if("CLOSE"==b)this.OnWebsocketClosed(),this.CloseWebsocket(!0);else if("SNAP:"==b.substr(0,5)){b=b.substr(5);var c=b.indexOf(":"),d=b.substr(0,c);b=e.parse(b.substr(c+1));this.RedrawPadSnap(b,function(){a.Send("SNAPDONE:"+
d)})}else if("JSON"==b.substr(0,4))b=e.parse(b.substr(4)),this.RedrawObject(b);else if("MENU:"==b.substr(0,5))b=e.parse(b.substr(5)),"function"==typeof this._getmenu_callback&&this._getmenu_callback(b);else if("CMD:"==b.substr(0,4)){b=b.substr(4);c=b.indexOf(":");var f=b.substr(0,c);b=b.substr(c+1);var g="REPLY:"+f+":";if("SVG"==b||"PNG"==b||"JPEG"==b)this.CreateImage(b.toLowerCase(),function(b){a.Send(g+b)});else if(0==b.indexOf("ADDPANEL:"))if(b=b.substr(9),console.log("request panel = "+b),this.ShowUI5Panel){f=
new e.WebWindowHandle(a.kind);f.SetReceiver({cpainter:this,OnWebsocketOpened:function(a){console.log("Panel socket connected")},OnWebsocketMsg:function(b,c){var d=0==c.indexOf("SHOWPANEL:")?c.substr(10):"";console.log("Panel get message "+c+" show "+d);this.cpainter.ShowUI5Panel(d,b,function(b){a.Send(g+(b?"true":"false"))})},OnWebsocketClosed:function(b){a.Send(g+"false")},OnWebsocketError:function(b){a.Send(g+"false")}});c=a.href;if(0==b.indexOf("../")){var h=c.lastIndexOf("/",c.length-2);c=c.substr(0,
h)+b.substr(2)}else c+=b;f.Connect(c)}else a.Send(g+"false");else console.log("Unrecognized command "+b),a.Send(g)}else"DXPROJ:"==b.substr(0,7)||"DYPROJ:"==b.substr(0,7)?(f=b[1],b=e.parse(b.substr(7)),this.DrawProjection(f,b)):"SHOW:"==b.substr(0,5)?(b=b.substr(5),f="1"==b[b.length-1],this.ShowSection(b.substr(0,b.length-2),f)):console.log("unrecognized msg len:"+b.length+" msg:"+b.substr(0,20))};u.prototype.ShowSection=function(a,b){switch(a){case "ToolTips":this.SetTooltipAllowed(b)}};e.TCanvasStatusBits=
{kShowEventStatus:e.BIT(15),kAutoExec:e.BIT(16),kMenuBar:e.BIT(17),kShowToolBar:e.BIT(18),kShowEditor:e.BIT(19),kMoveOpaque:e.BIT(20),kResizeOpaque:e.BIT(21),kIsGrayscale:e.BIT(22),kShowToolTips:e.BIT(23)};u.prototype.CompeteCanvasSnapDrawing=function(){this.pad&&(document&&(document.title=this.pad.fTitle),this._all_sections_showed||(this._all_sections_showed=!0,this.ShowSection("Menu",this.pad.TestBit(e.TCanvasStatusBits.kMenuBar)),this.ShowSection("StatusBar",this.pad.TestBit(e.TCanvasStatusBits.kShowEventStatus)),
this.ShowSection("ToolBar",this.pad.TestBit(e.TCanvasStatusBits.kShowToolBar)),this.ShowSection("Editor",this.pad.TestBit(e.TCanvasStatusBits.kShowEditor)),this.ShowSection("ToolTips",this.pad.TestBit(e.TCanvasStatusBits.kShowToolTips))))};u.prototype.HasEventStatus=function(){return this.has_event_status};u.prototype.GetOldColor=function(a,b){if(a)return a=b?a:a.fAttr,a.fKind?col:"rgb("+Math.round(255*a.fRedOrPalettePos)+","+Math.round(255*a.fGreen)+","+Math.round(255*a.fBlue)+")"};u.prototype.GetNewOpt=
function(a,b,c){if(!a||!a.fHolderIO||!b)return c;a=a.fHolderIO.fAttrNameVals;if(!a||!a.length)return c;for(var d=0;d<a.length;++d)if(a[d].first===b)return a[d].second;return c};u.prototype.GetNewColor=function(a,b,c){return this.GetNewOpt(a,b,c)};e.addDrawFunc({name:"ROOT::Experimental::RHistDrawable<1>",icon:"img_histo1d",prereq:"v7hist",func:"JSROOT.v7.drawHist1",opt:""});e.addDrawFunc({name:"ROOT::Experimental::RHistDrawable<2>",icon:"img_histo2d",prereq:"v7hist",func:"JSROOT.v7.drawHist2",opt:""});
e.addDrawFunc({name:"ROOT::Experimental::RText",icon:"img_text",prereq:"v7more",func:"JSROOT.v7.drawText",opt:"",direct:!0});e.addDrawFunc({name:"ROOT::Experimental::RLine",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawLine",opt:"",direct:!0});e.addDrawFunc({name:"ROOT::Experimental::RBox",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawBox",opt:"",direct:!0});e.addDrawFunc({name:"ROOT::Experimental::RMarker",icon:"img_graph",prereq:"v7more",func:"JSROOT.v7.drawMarker",opt:"",direct:!0});
e.v7.TAxisPainter=z;e.v7.TFramePainter=m;e.v7.TPadPainter=l;e.v7.TCanvasPainter=u;e.v7.drawFrame=function(a,b,c){b=new m(b);"3d"==c&&(b.mode3d=!0);b.SetDivId(a,2);b.Redraw();return b.DrawingReady()};e.v7.drawPad=function(a,b,c){var d=new l(b,!1);d.DecodeOptions(c);d.SetDivId(a);d.svg_canvas().empty()&&(d.has_canvas=!1,d.this_pad_name="");d.CreatePadSvg();!d.MatchObjectType("TPad")||d.has_canvas&&!d.HasObjectsToDraw()||(d.AddButton(e.ToolbarIcons.camera,"Create PNG","PadSnapShot"),(d.has_canvas&&d.HasObjectsToDraw()||
d.enlarge_main("verify"))&&d.AddButton(e.ToolbarIcons.circle,"Enlarge pad","EnlargePad"),e.gStyle.ContextMenu&&d.AddButton(e.ToolbarIcons.question,"Access context menus","PadContextMenus"));var f=d.has_canvas?d.CurrentPadName(d.this_pad_name):void 0;e.Painter.SelectActivePad({pp:d,active:!1});d.DrawPrimitives(0,function(){d.ShowButtons();d.CurrentPadName(f);d.DrawingReady()});return d};e.v7.drawCanvas=function(a,b,c){if(c=!b)return console.log("No canvas specified"),null;var d=new u(b);d.normal_canvas=
!c;d.SetDivId(a,-1);d.CreateCanvasSvg(0);d.SetDivId(a);d.AddButton(e.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");e.gStyle.ContextMenu&&d.AddButton(e.ToolbarIcons.question,"Access context menus","PadContextMenus");d.enlarge_main("verify")&&d.AddButton(e.ToolbarIcons.circle,"Enlarge canvas","EnlargePad");e.Painter.SelectActivePad({pp:d,active:!1});d.DrawPrimitives(0,function(){d.ShowButtons();d.DrawingReady()});return d};return e});
