(function(f){if("function"===typeof define&&define.amd)define(["JSRootPainter","d3"],f);else if("object"===typeof exports&&"undefined"!==typeof module)f(require("./JSRootCore.js"),require("d3"));else{if("object"!=typeof d3)throw Error("This extension requires d3.js","JSRootPainter.v6.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.v6.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined","JSRootPainter.v6.js");f(JSROOT,d3)}})(function(f,
l){function z(a,b){f.TObjectPainter.call(this,a);this.embedded=b;this.name="yaxis";this.kind="normal";this.func=null;this.full_min=this.order=0;this.full_max=1;this.scale_min=0;this.scale_max=1;this.ticks=[];this.lbls_both_sides=this.invert_side=!1}function m(a){a&&a.$dummy&&(a=null);f.TooltipHandler.call(this,a);this.zoom_kind=0;this.mode3d=!1;this.shrink_frame_left=0;this.y_kind=this.x_kind="normal";this.ymin=this.ymax=this.xmin=this.xmax=0;this.axes_drawn=this.ranges_set=!1;this.keys_handler=null;
this.projection=0}function p(a,b){f.TObjectPainter.call(this,a);this.pad=a;this.iscan=b;this.this_pad_name="";!this.iscan&&null!==a&&"fName"in a&&(this.this_pad_name=a.fName.replace(" ","_"),/^[A-Za-z][A-Za-z0-9_]*$/.test(this.this_pad_name)||(this.this_pad_name="jsroot_pad_"+f.id_counter++));this.painters=[];this.has_canvas=!0}function u(a){p.call(this,a,!0);this._websocket=null;this.tooltip_allowed=0<f.gStyle.Tooltip}f.sources.push("v6");f.WebSnapIds={kNone:0,kObject:1,kSVG:2,kSubPad:3,kColors:4,
kStyle:5};z.prototype=Object.create(f.TObjectPainter.prototype);z.prototype.Cleanup=function(){this.ticks=[];this.func=null;delete this.format;f.TObjectPainter.prototype.Cleanup.call(this)};z.prototype.SetAxisConfig=function(a,b,c,d,e,f,h){this.name=a;this.kind=b;this.func=c;this.full_min=d;this.full_max=e;this.scale_min=f;this.scale_max=h};z.prototype.format10Exp=function(a,b){var c="";b&&(b=Math.round(b/Math.pow(10,a)),0!=b&&1!=b&&(c=b.toString()+(f.gStyle.Latex?"#times":"x")));c+="10";if(1<f.gStyle.Latex)return c+
"^{"+a+"}";b={0:"\u2070",1:"\u00b9",2:"\u00b2",3:"\u00b3",4:"\u2074",5:"\u2075",6:"\u2076",7:"\u2077",8:"\u2078",9:"\u2079","-":"\u207b"};a=a.toString();for(var d=0;d<a.length;++d)c+=b[a[d]];return c};z.prototype.CreateFormatFuncs=function(){var a=this.GetObject(),b=a&&"TGaxis"===a._typename;delete this.format;var c=508;b?c=a.fNdiv:a&&(c=Math.max(a.fNdivisions,4));this.nticks=c%100;this.nticks2=(c%1E4-this.nticks)/100;this.nticks3=Math.floor(c/1E4);a&&!b&&7<this.nticks&&(this.nticks=7);c=Math.abs(this.func.range()[1]-
this.func.range()[0]);0>=c&&(c=100);if("time"==this.kind){8<this.nticks&&(this.nticks=8);b=this.scale_max-this.scale_min;a=f.Painter.getTimeFormat(a);c=f.Painter.chooseTimeFormat(b/c,!1);if(0==a.length||b<.1*(this.full_max-this.full_min))a=f.Painter.chooseTimeFormat(b/this.nticks,!0);this.tfunc1=this.tfunc2=l.timeFormat(a);c!==a&&(this.tfunc2=l.timeFormat(c));this.format=function(a,b){return b?this.tfunc1(a):this.tfunc2(a)}}else"log"==this.kind?(1<this.nticks2&&(this.nticks*=this.nticks2,this.nticks2=
1),this.noexp=a?a.TestBit(f.EAxisBits.kNoExponent):!1,300>this.scale_max&&.3<this.scale_min&&(this.noexp=!0),this.moreloglabels=a?a.TestBit(f.EAxisBits.kMoreLogLabels):!1,this.format=function(a,b,c){a=parseFloat(a);var d=Math.round(a);if(!b)return d===a&&1E9>Math.abs(d)?d.toString():f.FFormat(a,c||f.gStyle.fStatFormat);if(0>=a)return null;b=f.log10(a);return this.moreloglabels||.001>Math.abs(b-Math.round(b))?this.noexp||c?0>b?a.toFixed(Math.round(-b+.5)):a.toFixed(0):this.format10Exp(Math.floor(b+
.01),a):null}):"labels"==this.kind?(this.nticks=50,b=this.scale_max-this.scale_min,this.nticks>b&&(this.nticks=Math.round(b)),this.regular_labels=!0,a&&a.fNbins&&a.fLabels&&(a.fNbins!=Math.round(a.fXmax-a.fXmin)||0!=a.fXmin||a.fXmax!=a.fNbins)&&(this.regular_labels=!1),this.nticks2=1,this.axis=a,this.format=function(a){a=parseFloat(a);this.regular_labels||(a=(a-this.axis.fXmin)/(this.axis.fXmax-this.axis.fXmin)*this.axis.fNbins);a=Math.round(a);if(0>a||a>=this.axis.fNbins)return null;for(var b=0;b<
this.axis.fLabels.arr.length;++b){var c=this.axis.fLabels.arr[b];if(c.fUniqueID===a+1)return c.fString}return null}):(this.ndig=this.order=0,this.format=function(a,b,c){a=parseFloat(a);b&&this.order&&(a/=Math.pow(10,this.order));return a===Math.round(a)?1E9>Math.abs(a)?a.toFixed(0):a.toExponential(4):b?10<this.ndig?a.toExponential(this.ndig-11):a.toFixed(this.ndig):f.FFormat(a,c||f.gStyle.fStatFormat)})};z.prototype.ProduceTicks=function(a,b){if(!this.noticksopt)return this.func.ticks(a*(b||1));b&&
(a=(a-1)*b);b=this.func.domain();for(var c=[],d=0;d<=a;++d)c.push((b[0]*(a-d)+b[1]*d)/a);return c};z.prototype.CreateTicks=function(a,b,c,d){c&&this.nticks&&"normal"==this.kind&&(this.noticksopt=!0);c={nminor:0,nmiddle:0,nmajor:0,func:this.func};c.minor=c.middle=c.major=this.ProduceTicks(this.nticks);if(a)return d=c.major,c=1E-5*(this.scale_max-this.scale_min),d[0]>this.scale_min+c&&d.unshift(this.scale_min),d[d.length-1]<this.scale_max-c&&d.push(this.scale_max),d;if("labels"==this.kind&&!this.regular_labels)for(c.lbl_pos=
[],a=0;a<this.axis.fNbins;++a){var e=this.axis.fXmin+a/this.axis.fNbins*(this.axis.fXmax-this.axis.fXmin);e>=this.scale_min&&e<this.scale_max&&c.lbl_pos.push(e)}1<this.nticks2&&((c.minor=c.middle=this.ProduceTicks(c.major.length,this.nticks2),a=Math.abs(this.func.range()[1]-this.func.range()[0]),c.middle.length<=c.major.length||c.middle.length>a/3.5)?c.minor=c.middle=c.major:1<this.nticks3&&"log"!==this.kind&&(c.minor=this.ProduceTicks(c.middle.length,this.nticks3),c.minor.length<=c.middle.length||
c.minor.length>a/1.7)&&(c.minor=c.middle));c.reset=function(){this.nminor=this.nmiddle=this.nmajor=0};c.next=function(a){if(this.nminor>=this.minor.length)return!1;this.tick=this.minor[this.nminor++];this.grpos=this.func(this.tick);a&&(this.grpos=Math.round(this.grpos));this.kind=3;this.nmiddle<this.middle.length&&1>Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))&&(this.nmiddle++,this.kind=2);this.nmajor<this.major.length&&1>Math.abs(this.grpos-this.func(this.major[this.nmajor]))&&(this.nmajor++,
this.kind=1);return!0};c.last_major=function(){return 1!==this.kind?!1:this.nmajor==this.major.length};c.next_major_grpos=function(){return this.nmajor>=this.major.length?null:this.func(this.major[this.nmajor])};this.ndig=this.order=0;if("normal"==this.kind&&0<c.major.length){var g=a=0;e=!1;if(!b){b=Math.max(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-1]));var h=Math.min(Math.abs(c.major[0]),Math.abs(c.major[c.major.length-1])),k=0<b?3*Math.round(f.log10(b)/3):0,n=0<h?3*Math.round(f.log10(h)/
3):0;e=2E4>b;if(b||h)a=Math.max(k,n)+3,g=Math.min(k,n)-3}b=0;h=this.ndig;for(k=1E10;g<=a;g+=3)if(!e||3!==g){this.order=g;this.ndig=0;n=[];for(var t=0,q=0;t<c.major.length;){var r=this.format(c.major[t],!0);if(0>n.indexOf(r))n.push(r),q+=r.length,t++;else{if(15<++this.ndig)break;n=[];q=t=0}}!g&&4>this.ndig&&(q-=2*c.major.length+3);q<k&&(k=q,b=this.order,h=this.ndig)}this.order=b;this.ndig=h;d&&(this.order&&console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable"),
this.ndig&&console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required"),this.order=this.ndig=0)}return c};z.prototype.IsCenterLabels=function(){if("labels"===this.kind)return!0;if("log"===this.kind)return!1;var a=this.GetObject();return a&&a.TestBit(f.EAxisBits.kCenterLabels)};z.prototype.AddTitleDrag=function(a,b,c,d,e){if(f.gStyle.MoveResize){var g=this,h=null,k="",n,t,q,r,m,v;if(3===f._test_d3_){k="drag";var p=l.behavior.drag().origin(Object)}else p=
l.drag().subject(Object);p.on(k+"start",function(){l.event.sourceEvent.preventDefault();l.event.sourceEvent.stopPropagation();var c=a.node().getBBox(),k=g.GetObject();q=n=a.property("shift_x");r=t=a.property("shift_y");m=b?0<n:0<t;v=k.TestBit(f.EAxisBits.kCenterTitle)?d===b?e:0:Math.round(e/2);h=a.append("rect").classed("zoom",!0).attr("x",c.x).attr("y",c.y).attr("width",c.width).attr("height",c.height).style("cursor","move")}).on("drag",function(){if(h){l.event.sourceEvent.preventDefault();l.event.sourceEvent.stopPropagation();
n+=l.event.dx;t+=l.event.dy;var c=a.property("shift_x"),d=a.property("shift_y");b?(c=n,Math.abs(t-d)>Math.abs(t-v)&&(d=v)):(d=t,Math.abs(n-c)>Math.abs(n-v)&&(c=v));m===(b?0<c:0<d)&&(q=c,r=d,a.attr("transform","translate("+q+","+r+")"))}}).on(k+"end",function(){if(h){l.event.sourceEvent.preventDefault();l.event.sourceEvent.stopPropagation();a.property("shift_x",q).property("shift_y",r);var d=g.GetObject();d.fTitleOffset=(b?q:r)/c;(b?r:q)===v&&d.InvertBit(f.EAxisBits.kCenterTitle);h.remove();h=null}});
a.style("cursor","move").call(p)}};z.prototype.DrawAxis=function(a,b,c,d,e,g,h,k,n){function t(a,b){return a&&!b||!a&&b}var q=this.GetObject(),r="",m=q&&"TGaxis"===q._typename,v=b,p=.03,u=100,K=!0,z=this.pad_width()||10,S=this.pad_height()||10;this.vertical=a;h?this.invert_side&&(h=-h):h=0;m?(this.createAttLine({attr:q}),K=0!=q.fLineColor,r=q.fChopt,p=q.fTickSize,u=a?1.7*d:.6*c):(this.createAttLine({color:q.fAxisColor,width:1,style:1}),r=t(a,this.invert_side)?"-S":"+S",p=q.fTickLength,u=a?z:S);m&&
"zaxis"!==this.name||(v=b.select("."+this.name+"_container"),v.empty()?v=b.append("svg:g").attr("class",this.name+"_container"):v.selectAll("*").remove());!k&&K&&v.append("svg:line").attr("x1",0).attr("y1",0).attr("x2",a?0:c).attr("y2",a?d:0).call(this.lineatt.func);v.attr("transform",e||null);var w=1;e=0;b=Math.min(z,S);var B=0<=r.indexOf("+"),E=0<=r.indexOf("-"),F=0<=r.indexOf("S");r.indexOf("Y");r.indexOf("0");r.indexOf("O");var I=0<=r.indexOf("U"),y=0<=r.indexOf("N");r=0<=r.indexOf("I");var C=
q.TestBit(f.EAxisBits.kNoExponent);m&&q.TestBit(f.EAxisBits.kTickPlus)&&(B=!0);m&&q.TestBit(f.EAxisBits.kTickMinus)&&(E=!0);B&&E?e=w=1:E?w=t(g,a)?1:-1:B&&(w=t(g,a)?-1:1);p=Math.round((F?p:.03)*u);this.max_tick_size&&p>this.max_tick_size&&(p=this.max_tick_size);this.CreateFormatFuncs();E=B="";F=u=0;this.ticks=[];for(var x=this.CreateTicks(!1,C,y,r);x.next(!0);)y=Math.round(p/4),r=0,3>x.kind&&(y=Math.round(p/2)),1==x.kind&&("format"in this&&null===this.format(x.tick,!0)||(y=p),this.ticks.push(x.grpos)),
0<e?r=-y:0>w?(r=-y,y=0):r=0,0==B.length?(B=a?"M"+y+","+x.grpos:"M"+x.grpos+","+-y,E=a?"M"+(h-y)+","+x.grpos:"M"+x.grpos+","+(h+y)):(B+=a?"m"+(y-F)+","+(x.grpos-u):"m"+(x.grpos-u)+","+(F-y),E+=a?"m"+(F-y)+","+(x.grpos-u):"m"+(x.grpos-u)+","+(y-F)),B+=a?"h"+(r-y):"v"+(y-r),E+=a?"h"+(y-r):"v"+(r-y),u=x.grpos,F=r;0<B.length&&!k&&K&&v.append("svg:path").attr("d",B).call(this.lineatt.func);0!==h&&0<E.length&&!k&&K&&v.append("svg:path").attr("d",E).call(this.lineatt.func);h=Math.round(1>q.fLabelSize?q.fLabelSize*
b:q.fLabelSize);if(0>=h||1.1<Math.abs(q.fLabelOffset))I=!0;if(!k&&!I){K=this.get_color(q.fLabelColor);I=Math.round(Math.abs(q.fLabelOffset)*b);y=this.IsCenterLabels();r=q.TestBit(f.EAxisBits.kLabelsVert);C=1;B=0;E=!1;F=null;var H=[v.append("svg:g").attr("class","axis_labels")];x=x.lbl_pos||x.major;this.lbls_both_sides&&H.push(v.append("svg:g").attr("class","axis_labels").attr("transform",a?"translate("+c+",0)":"translate(0,"+-d+")"));for(var D=0;D<H.length;++D){0<D&&(w=-w);u=0;var T=a?-I*w:(I+2)*
w+e*p;F=f.Painter.getFontDetails(q.fLabelFont,h);this.StartTextDrawing(F,"font",H[D]);for(var J=0;J<x.length;++J){var L=this.format(x[J],!0);if(null!==L){var G=Math.round(this.func(x[J])),O=0<J?Math.abs(Math.round(G-this.func(x[J-1]))):0,P=J<x.length-1?Math.abs(Math.round(this.func(x[J+1])-G)):0;if(y){var A=P||O;G=Math.round(G-(a?.5*A:-.5*A));if(-5>G||G>(a?d:c)+5)continue}A={text:L,color:K,latex:1,draw_g:H[D]};B=Math.max(B,L.length);a?(A.x=T,A.y=G,A.align=r?0>w?23:20:0>w?12:32):(A.x=G,A.y=T,A.align=
r?0>w?12:32:0>w?20:23);r&&(A.rotate=270);(L=this.DrawText(A))&&(!a&&!r||a&&r)&&"log"!=this.kind?(A=.45*O+.45*P,O?P||(A=.9*O):A=.9*P,C=Math.min(C,A/L)):a&&n&&!D&&20<n-I&&L>n-I&&(C=Math.min(C,(n-I)/L));u&&G!=u&&(a&&!r||!a&&r)&&(C=Math.min(C,.9*Math.abs(G-u)/h));u=G}}this.order&&this.DrawText({color:K,x:a?5*w:c+5,y:this.has_obstacle?T:a?-3:-3*w,align:a?0>w?30:10:t(this.has_obstacle,0>w)?13:10,latex:1,text:"#times"+this.format10Exp(this.order),draw_g:H[D]})}.01<C&&.7>C&&!a&&!r&&5<B&&!this.lbls_both_sides&&
(E=!0,C*=3);for(D=0;D<H.length;++D).01<C&&1>C&&this.TextScaleFactor(1/C,H[D]),this.FinishTextDrawing(H[D]),E&&H[D].selectAll("text").each(function(){var a=l.select(this),b=a.attr("transform");a.attr("transform",b+" rotate(25)").style("text-anchor","start")});1<H.length&&(w=-w);F&&(h=F.size)}f.gStyle.Zooming&&!this.disable_zooming&&(n=v.append("svg:rect").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair"),a?n.attr("x",0<w?-2*h-3:3).attr("y",0).attr("width",2*h+3).attr("height",
d):n.attr("x",0).attr("y",0<w?0:-h-3).attr("width",c).attr("height",h+3));if(0<q.fTitle.length&&!k){var M=v.append("svg:g").attr("class","axis_title"),U=1<=q.fTitleSize?q.fTitleSize:Math.round(q.fTitleSize*b);n=1.6*(1>q.fTitleSize?q.fTitleSize:q.fTitleSize/(this.pad_height("")||10));b=q.TestBit(f.EAxisBits.kCenterTitle);e=q.TestBit(f.EAxisBits.kRotateTitle)?-1:1;u=this.get_color(m?q.fTextColor:q.fTitleColor);var N=0,Q=0;this.StartTextDrawing(q.fTitleFont,U,M);h=0>e&&!g||0<=e&&g;a?(n*=-w*z,N=Math.round(n*
q.fTitleOffset),"zaxis"==this.name&&m&&"getBoundingClientRect"in v.node()&&(m=v.node().getBoundingClientRect(),N<m.width-p&&(N=Math.round(m.width-p))),Q=Math.round(b?d/2:g?d:0),this.DrawText({align:(b?"middle":h?"begin":"end")+";middle",rotate:0>e?90:270,text:q.fTitle,color:u,draw_g:M})):(n*=w*S,N=Math.round(b?c/2:g?0:c),Q=Math.round(n*q.fTitleOffset),this.DrawText({align:(b?"middle":h?"begin":"end")+";middle",rotate:0>e?180:0,text:q.fTitle,color:u,draw_g:M}));var R=null;a&&0==q.fTitleOffset&&"getBoundingClientRect"in
v.node()&&(R=v.node().getBoundingClientRect());this.FinishTextDrawing(M,function(){if(R){var a=M.node().getBoundingClientRect();N=0<w?Math.round(R.left-a.right-.3*U):Math.round(R.right-a.left+.3*U)}M.attr("transform","translate("+N+","+Q+")").property("shift_x",N).property("shift_y",Q)});this.AddTitleDrag(M,a,n,g,a?d:c)}this.position=0;!k&&"getBoundingClientRect"in v.node()&&(a=v.node().getBoundingClientRect(),c=this.svg_pad().node().getBoundingClientRect(),this.position=a.left-c.left)};z.prototype.Redraw=
function(){var a=this.GetObject(),b=this.AxisToSvg("x",a.fX1,"pad"),c=this.AxisToSvg("y",a.fY1,"pad"),d=this.AxisToSvg("x",a.fX2,"pad"),e=this.AxisToSvg("y",a.fY2,"pad"),g=d-b,h=c-e,k=Math.abs(g)<Math.abs(h),n=!1,t=a.fWmin,q=a.fWmax,r=t,p=q;if(0<=a.fChopt.indexOf("t")){var m=l.scaleTime();var u="time";this.toffset=f.Painter.getTimeOffset(a);r=new Date(this.toffset+1E3*t);p=new Date(this.toffset+1E3*q)}else 0<=a.fChopt.indexOf("G")?(m=l.scaleLog(),u="log"):(m=l.scaleLinear(),u="normal");m.domain([r,
p]);k?0<h?m.range([h,0]):(e=c,h=-h,n=!0,m.range([0,h])):0<g?m.range([0,g]):(b=d,g=-g,n=!0,m.range([g,0]));this.SetAxisConfig(k?"yaxis":"xaxis",u,m,t,q,t,q);this.CreateG();this.DrawAxis(k,this.draw_g,g,h,"translate("+b+","+e+")",n)};f.Painter.drawGaxis=function(a,b,c){b=new f.TAxisPainter(b,!1);b.SetDivId(a);b.disable_zooming=!0;b.Redraw();return b.DrawingReady()};m.prototype=Object.create(f.TooltipHandler.prototype);m.prototype.frame_painter=function(){return this};m.prototype.SetActive=function(a){};
m.prototype.GetTipName=function(a){var b=f.TooltipHandler.prototype.GetTipName.call(this)||"TFrame";a&&(b+=a);return b};m.prototype.Shrink=function(a,b){this.fX1NDC+=a;this.fX2NDC-=b};m.prototype.SetLastEventPos=function(a){this.fLastEventPnt=a};m.prototype.GetLastEventPos=function(){return this.fLastEventPnt};m.prototype.ProjectAitoff2xy=function(a,b){var c=Math.PI/180;a=a/2*c;b*=c;var d=Math.sqrt(2),e=2*d/Math.PI,f=Math.cos(b),h=Math.sqrt(1+f*Math.cos(a));return{x:f*Math.sin(a)*2*d/h/e/c,y:Math.sin(b)*
d/h/e/c}};m.prototype.ProjectMercator2xy=function(a,b){return{x:a,y:Math.log(Math.tan((Math.PI/2+b/180*Math.PI)/2))}};m.prototype.ProjectSinusoidal2xy=function(a,b){return{x:a*Math.cos(b/180*Math.PI),y:b}};m.prototype.ProjectParabolic2xy=function(a,b){return{x:a*(2*Math.cos(2*b/180*Math.PI/3)-1),y:180*Math.sin(b/180*Math.PI/3)}};m.prototype.RecalculateRange=function(a){if(this.projection=a||0){a=[];if(1==this.projection)a.push(this.ProjectAitoff2xy(this.scale_xmin,this.scale_ymin)),a.push(this.ProjectAitoff2xy(this.scale_xmin,
this.scale_ymax)),a.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymax)),a.push(this.ProjectAitoff2xy(this.scale_xmax,this.scale_ymin)),0>this.scale_ymin&&0<this.scale_ymax&&(a.push(this.ProjectAitoff2xy(.9999*this.scale_xmin,0)),a.push(this.ProjectAitoff2xy(.9999*this.scale_xmax,0))),0>this.scale_xmin&&0<this.scale_xmax&&(a.push(this.ProjectAitoff2xy(0,this.scale_ymin)),a.push(this.ProjectAitoff2xy(0,this.scale_ymax)));else if(2==this.projection){if(-90>=this.scale_ymin||90<=this.scale_ymax){console.warn("Mercator Projection",
"Latitude out of range",this.scale_ymin,this.scale_ymax);this.projection=0;return}a.push(this.ProjectMercator2xy(this.scale_xmin,this.scale_ymin));a.push(this.ProjectMercator2xy(this.scale_xmax,this.scale_ymax))}else 3==this.projection?(a.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymin)),a.push(this.ProjectSinusoidal2xy(this.scale_xmin,this.scale_ymax)),a.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymax)),a.push(this.ProjectSinusoidal2xy(this.scale_xmax,this.scale_ymin)),
0>this.scale_ymin&&0<this.scale_ymax&&(a.push(this.ProjectSinusoidal2xy(this.scale_xmin,0)),a.push(this.ProjectSinusoidal2xy(this.scale_xmax,0))),0>this.scale_xmin&&0<this.scale_xmax&&(a.push(this.ProjectSinusoidal2xy(0,this.scale_ymin)),a.push(this.ProjectSinusoidal2xy(0,this.scale_ymax)))):4==this.projection&&(a.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymin)),a.push(this.ProjectParabolic2xy(this.scale_xmin,this.scale_ymax)),a.push(this.ProjectParabolic2xy(this.scale_xmax,this.scale_ymax)),
a.push(this.ProjectParabolic2xy(this.scale_xmax,this.scale_ymin)),0>this.scale_ymin&&0<this.scale_ymax&&(a.push(this.ProjectParabolic2xy(this.scale_xmin,0)),a.push(this.ProjectParabolic2xy(this.scale_xmax,0))),0>this.scale_xmin&&0<this.scale_xmax&&(a.push(this.ProjectParabolic2xy(0,this.scale_ymin)),a.push(this.ProjectParabolic2xy(0,this.scale_ymax))));this.original_xmin=this.scale_xmin;this.original_xmax=this.scale_xmax;this.original_ymin=this.scale_ymin;this.original_ymax=this.scale_ymax;this.scale_xmin=
this.scale_xmax=a[0].x;this.scale_ymin=this.scale_ymax=a[0].y;for(var b=1;b<a.length;++b)this.scale_xmin=Math.min(this.scale_xmin,a[b].x),this.scale_xmax=Math.max(this.scale_xmax,a[b].x),this.scale_ymin=Math.min(this.scale_ymin,a[b].y),this.scale_ymax=Math.max(this.scale_ymax,a[b].y)}};m.prototype.SetAxesRanges=function(a,b,c,d,e,f,h,k,n){this.ranges_set=!0;this.xaxis=a;this.xmin=b;this.xmax=c;this.yaxis=d;this.ymin=e;this.ymax=f;this.zaxis=h;this.zmin=k;this.zmax=n};m.prototype.GetAxis=function(a){switch(a){case "x":return this.xaxis;
case "y":return this.yaxis;case "z":return this.zaxis}return null};m.prototype.CheckAxisZoom=function(a){var b=this.GetAxis(a);b&&b.TestBit(f.EAxisBits.kAxisRange)&&b.fFirst!==b.fLast&&(1<b.fFirst||b.fLast<b.fNbins)&&(this["zoom_"+a+"min"]=1<b.fFirst?b.GetBinLowEdge(b.fFirst):b.fXmin,this["zoom_"+a+"max"]=b.fLast<b.fNbins?b.GetBinLowEdge(b.fLast+1):b.fXmax,b.InvertBit(f.EAxisBits.kAxisRange),b.fFirst=1,b.fLast=b.fNbins)};m.prototype.CheckPadUserRange=function(a,b){if(a){var c=a["fU"+b+"min"],d=a["fU"+
b+"max"],e=1E-7;if("x"==b){if(Math.abs(a.fX1)>e||Math.abs(a.fX2-1)>e)d=a.fX2-a.fX1,c=a.fX1+d*a.fLeftMargin,d=a.fX2-d*a.fRightMargin}else if(Math.abs(a.fY1)>e||Math.abs(a.fY2-1)>e)d=a.fY2-a.fY1,c=a.fY1+d*a.fBottomMargin,d=a.fY2-d*a.fTopMargin;if(!(c>=d||Math.abs(c)<e&&Math.abs(d-1)<e)){0<a["fLog"+b]&&(c=Math.exp(c*Math.log(10)),d=Math.exp(d*Math.log(10)));a=b;this.swap_xy&&(a="x"==b?"y":"x");b="scale_"+a+"min";var f="scale_"+a+"max";e=1E-7*(this[f]-this[b]);if(Math.abs(c-this[b])>e||Math.abs(d-this[f])>
e)this["zoom_"+a+"min"]=c,this["zoom_"+a+"max"]=d}}};m.prototype.CreateXY=function(a){this.CleanXY();a||(a={});this.swap_xy=a.swap_xy||!1;this.reverse_x=a.reverse_x||!1;this.reverse_y=a.reverse_y||!1;this.logx=this.logy=!1;var b=this.frame_width(),c=this.frame_height(),d=this.root_pad();this.scale_xmin=this.xmin;this.scale_xmax=this.xmax;this.scale_ymin=this.ymin;this.scale_ymax=this.ymax;a.extra_y_space&&(this.scale_ymax=(this.swap_xy?d.fLogx:d.fLogy)&&0<this.scale_ymax?Math.exp(1.1*Math.log(this.scale_ymax)):
this.scale_ymax+.1*(this.scale_ymax-this.scale_ymin));if(a.check_pad_range&&(this.zoom_zmin=this.zoom_zmax=this.zoom_ymin=this.zoom_ymax=this.zoom_xmin=this.zoom_xmax=0,this.CheckAxisZoom("x"),a.ndim&&1<a.ndim&&this.CheckAxisZoom("y"),a.ndim&&2<a.ndim&&this.CheckAxisZoom("z"),"pad_range"===a.check_pad_range)){var e=this.canv_painter();e&&e.online_canvas||(this.CheckPadUserRange(d,"x"),this.CheckPadUserRange(d,"y"))}this.zoom_ymin!=this.zoom_ymax||a.zoom_ymin==a.zoom_ymax||this.zoom_changed_interactive||
(this.zoom_ymin=a.zoom_ymin,this.zoom_ymax=a.zoom_ymax);this.zoom_xmin!=this.zoom_xmax&&(this.scale_xmin=this.zoom_xmin,this.scale_xmax=this.zoom_xmax);this.zoom_ymin!=this.zoom_ymax&&(this.scale_ymin=this.zoom_ymin,this.scale_ymax=this.zoom_ymax);this.RecalculateRange(a.Proj);this.xaxis.fTimeDisplay?(this.x_kind="time",this.timeoffsetx=f.Painter.getTimeOffset(this.xaxis),this.ConvertX=function(a){return new Date(this.timeoffsetx+1E3*a)},this.RevertX=function(a){return(this.x.invert(a)-this.timeoffsetx)/
1E3}):(this.x_kind=this.xaxis.fLabels?"labels":"normal",this.ConvertX=function(a){return a},this.RevertX=function(a){return this.x.invert(a)});if("time"==this.x_kind)this.x=l.scaleTime();else if(this.swap_xy?d.fLogy:d.fLogx){this.logx=!0;0>=this.scale_xmax&&(this.scale_xmax=0);if(0>=this.scale_xmin&&this.xaxis&&!this.swap_xy)for(e=0;e<this.xaxis.fNbins&&!(this.scale_xmin=Math.max(this.scale_xmin,this.xaxis.GetBinLowEdge(e+1)),0<this.scale_xmin);++e);if(0>=this.scale_xmin||this.scale_xmin>=this.scale_xmax)this.scale_xmin=
1E-4*this.scale_xmax;this.x=l.scaleLog()}else this.x=l.scaleLinear();b=this.reverse_x?[b,0]:[0,b];c=this.reverse_y?[0,c]:[c,0];this.x.domain([this.ConvertX(this.scale_xmin),this.ConvertX(this.scale_xmax)]).range(this.swap_xy?c:b);this.grx="time"==this.x_kind?function(a){return this.x(this.ConvertX(a))}:this.logx?function(a){return a<this.scale_xmin?this.swap_xy?this.x.range()[0]+5:-5:this.x(a)}:this.x;this.yaxis.fTimeDisplay?(this.y_kind="time",this.timeoffsety=f.Painter.getTimeOffset(this.yaxis),
this.ConvertY=function(a){return new Date(this.timeoffsety+1E3*a)},this.RevertY=function(a){return(this.y.invert(a)-this.timeoffsety)/1E3}):(this.y_kind=this.yaxis.fLabels?"labels":"normal",this.ConvertY=function(a){return a},this.RevertY=function(a){return this.y.invert(a)});if(this.swap_xy?d.fLogx:d.fLogy){this.logy=!0;0>=this.scale_ymax?this.scale_ymax=1:this.zoom_ymin===this.zoom_ymax&&1==a.ndim&&this.draw_content&&(this.scale_ymax*=1.8);if(0>=this.scale_ymin&&this.yaxis&&1<a.ndim&&!this.swap_xy)for(e=
0;e<this.yaxis.fNbins&&!(this.scale_ymin=Math.max(this.scale_ymin,this.yaxis.GetBinLowEdge(e+1)),0<this.scale_ymin);++e);0>=this.scale_ymin&&a.ymin_nz&&a.ymin_nz<.01*this.ymax&&(this.scale_ymin=.3*a.ymin_nz);if(0>=this.scale_ymin||this.scale_ymin>=this.scale_ymax)this.scale_ymin=3E-4*this.scale_ymax;this.y=l.scaleLog()}else this.y="time"==this.y_kind?l.scaleTime():l.scaleLinear();this.y.domain([this.ConvertY(this.scale_ymin),this.ConvertY(this.scale_ymax)]).range(this.swap_xy?b:c);this.gry="time"==
this.y_kind?function(a){return this.y(this.ConvertY(a))}:this.logy?function(a){return a<this.scale_ymin?this.swap_xy?-5:this.y.range()[0]+5:this.y(a)}:this.y;this.SetRootPadRange(d)};m.prototype.SetRootPadRange=function(a,b){if(a&&this.ranges_set){b?(a.fUxmin=a.fUymin=-.9,a.fUxmax=a.fUymax=.9):(a.fLogx=(this.swap_xy?this.logy:this.logx)?1:0,a.fUxmin=a.fLogx?f.log10(this.scale_xmin):this.scale_xmin,a.fUxmax=a.fLogx?f.log10(this.scale_xmax):this.scale_xmax,a.fLogy=(this.swap_xy?this.logx:this.logy)?
1:0,a.fUymin=a.fLogy?f.log10(this.scale_ymin):this.scale_ymin,a.fUymax=a.fLogy?f.log10(this.scale_ymax):this.scale_ymax);b=a.fUxmax-a.fUxmin;var c=1-a.fLeftMargin-a.fRightMargin,d=a.fUymax-a.fUymin,e=1-a.fBottomMargin-a.fTopMargin;0>=c&&(c=.01);0>=e&&(e=.01);a.fX1=a.fUxmin-b/c*a.fLeftMargin;a.fX2=a.fUxmax+b/c*a.fRightMargin;a.fY1=a.fUymin-d/e*a.fBottomMargin;a.fY2=a.fUymax+d/e*a.fTopMargin}};m.prototype.DrawGrids=function(){var a=this.svg_frame().select(".grid_layer");a.selectAll(".xgrid").remove();
a.selectAll(".ygrid").remove();var b=this.root_pad(),c=this.frame_height(),d=this.frame_width(),e=f.gStyle.fGridStyle;if(0>e||e>=f.Painter.root_line_styles.length)e=11;if(b&&b.fGridx&&this.x_handle){for(var g="",h=0;h<this.x_handle.ticks.length;++h)g=this.swap_xy?g+("M0,"+this.x_handle.ticks[h]+"h"+d):g+("M"+this.x_handle.ticks[h]+",0v"+c);h=0<f.gStyle.fGridColor?f.gStyle.fGridColor:this.GetAxis("x")?this.GetAxis("x").fAxisColor:1;h=this.get_color(h)||"black";0<g.length&&a.append("svg:path").attr("class",
"xgrid").attr("d",g).style("stroke",h).style("stroke-width",f.gStyle.fGridWidth).style("stroke-dasharray",f.Painter.root_line_styles[e])}if(b&&b.fGridy&&this.y_handle){b="";for(h=0;h<this.y_handle.ticks.length;++h)b=this.swap_xy?b+("M"+this.y_handle.ticks[h]+",0v"+c):b+("M0,"+this.y_handle.ticks[h]+"h"+d);h=0<f.gStyle.fGridColor?f.gStyle.fGridColor:this.GetAxis("y")?this.GetAxis("y").fAxisColor:1;h=this.get_color(h)||"black";0<b.length&&a.append("svg:path").attr("class","ygrid").attr("d",b).style("stroke",
h).style("stroke-width",f.gStyle.fGridWidth).style("stroke-dasharray",f.Painter.root_line_styles[e])}};m.prototype.AxisAsText=function(a,b){if("x"==a){if("time"==this.x_kind&&(b=this.ConvertX(b)),this.x_handle&&"format"in this.x_handle)return this.x_handle.format(b,!1,f.gStyle.XValuesFormat)}else if("y"==a){if("time"==this.y_kind&&(b=this.ConvertY(b)),this.y_handle&&"format"in this.y_handle)return this.y_handle.format(b,!1,!1,f.gStyle.YValuesFormat)}else if(this.z_handle&&"format"in this.z_handle)return this.z_handle.format(b,
!1,!1,f.gStyle.ZValuesFormat);return b.toPrecision(4)};m.prototype.DrawAxes=function(a,b,c,d){this.CleanupAxes();if(this.xmin==this.xmax||this.ymin==this.ymax)return!1;void 0===c&&(c=0);var e=this.svg_frame().select(".axis_layer"),g=this.frame_width(),h=this.frame_height(),k=this.root_pad();this.x_handle=new f.TAxisPainter(this.xaxis,!0);this.x_handle.SetDivId(this.divid,-1);this.x_handle.pad_name=this.pad_name;this.x_handle.SetAxisConfig("xaxis",this.logx&&"time"!==this.x_kind?"log":this.x_kind,
this.x,this.xmin,this.xmax,this.scale_xmin,this.scale_xmax);this.x_handle.invert_side=10<=c;this.x_handle.lbls_both_sides=!this.x_handle.invert_side&&1<k.fTickx;this.x_handle.has_obstacle=d;this.y_handle=new f.TAxisPainter(this.yaxis,!0);this.y_handle.SetDivId(this.divid,-1);this.y_handle.pad_name=this.pad_name;this.y_handle.SetAxisConfig("yaxis",this.logy&&"time"!==this.y_kind?"log":this.y_kind,this.y,this.ymin,this.ymax,this.scale_ymin,this.scale_ymax);this.y_handle.invert_side=1===c%10;this.y_handle.lbls_both_sides=
!this.y_handle.invert_side&&1<k.fTicky;d=this.swap_xy?this.y_handle:this.x_handle;c=this.swap_xy?this.x_handle:this.y_handle;if(!b){var n=this.pad_painter();n&&n._fast_drawing&&(b=!0)}b||(d.DrawAxis(!1,e,g,h,d.invert_side?void 0:"translate(0,"+h+")",!1,k.fTickx?-h:0,b),c.DrawAxis(!0,e,g,h,c.invert_side?"translate("+g+",0)":void 0,!1,k.fTicky?g:0,b,c.invert_side?0:this.frame_x()),this.DrawGrids());a||!f.gStyle.CanAdjustFrame||b||(a=0,b=c.position,-.2*g<b&&0>b?(a=-b/g+.001,this.shrink_frame_left+=a):
0<b&&b<.3*g&&0<this.shrink_frame_left&&b/g>this.shrink_frame_left&&(a=-this.shrink_frame_left,this.shrink_frame_left=0),0!=a&&(this.Shrink(a,0),this.Redraw(),this.DrawAxes(!0)));return this.axes_drawn=!0};m.prototype.UpdateAttributes=function(a){var b=this.root_pad(),c=this.GetObject();if(void 0===this.fX1NDC||a&&!this.modified_NDC)b&&void 0!==b.fLeftMargin?f.extend(this,{fX1NDC:b.fLeftMargin,fX2NDC:1-b.fRightMargin,fY1NDC:b.fBottomMargin,fY2NDC:1-b.fTopMargin}):f.extend(this,f.gStyle.FrameNDC);void 0===
this.fillatt&&(c?this.createAttFill({attr:c}):b&&b.fFrameFillColor?this.createAttFill({pattern:b.fFrameFillStyle,color:b.fFrameFillColor}):b?this.createAttFill({attr:b}):this.createAttFill({pattern:1001,color:0}),!c&&this.fillatt.empty()&&this.pad_painter()&&this.pad_painter().iscan&&this.fillatt.SetSolidColor("white"));!c&&b&&void 0!==b.fFrameLineColor?this.createAttLine({color:b.fFrameLineColor,width:b.fFrameLineWidth,style:b.fFrameLineStyle}):this.createAttLine({attr:c,color:"black"})};m.prototype.SizeChanged=
function(){var a=this.root_pad();a&&(a.fLeftMargin=this.fX1NDC,a.fRightMargin=1-this.fX2NDC,a.fBottomMargin=this.fY1NDC,a.fTopMargin=1-this.fY2NDC,this.SetRootPadRange(a));this.InteractiveRedraw("pad","frame")};m.prototype.CleanXY=function(){delete this.x;delete this.grx;delete this.ConvertX;delete this.RevertX;delete this.y;delete this.gry;delete this.ConvertY;delete this.RevertY;delete this.z;delete this.grz};m.prototype.CleanupAxes=function(){this.x_handle&&(this.x_handle.Cleanup(),delete this.x_handle);
this.y_handle&&(this.y_handle.Cleanup(),delete this.y_handle);this.z_handle&&(this.z_handle.Cleanup(),delete this.z_handle);this.draw_g&&(this.draw_g.select(".grid_layer").selectAll("*").remove(),this.draw_g.select(".axis_layer").selectAll("*").remove());this.axes_drawn=!1};m.prototype.CleanFrameDrawings=function(){"function"===typeof this.Create3DScene&&this.Create3DScene(-1);this.CleanupAxes();this.CleanXY();this.ranges_set=!1;this.scale_zmin=this.scale_zmax=this.scale_ymin=this.scale_ymax=this.scale_xmin=
this.scale_xmax=this.zoom_zmin=this.zoom_zmax=this.zoom_ymin=this.zoom_ymax=this.zoom_xmin=this.zoom_xmax=this.zmin=this.zmax=this.ymin=this.ymax=this.xmin=this.xmax=0;this.draw_g&&(this.draw_g.select(".main_layer").selectAll("*").remove(),this.draw_g.select(".upper_layer").selectAll("*").remove());this.zaxis=this.yaxis=this.xaxis=null;this.draw_g&&(this.draw_g.selectAll("*").remove(),this.draw_g.on("mousedown",null).on("dblclick",null).on("wheel",null).on("contextmenu",null).property("interactive_set",
null),this.draw_g.remove());this.draw_g=null;this.keys_handler&&(window.removeEventListener("keydown",this.keys_handler,!1),this.keys_handler=null)};m.prototype.Cleanup=function(){this.CleanFrameDrawings();delete this._click_handler;delete this._dblclick_handler;f.TooltipHandler.prototype.Cleanup.call(this)};m.prototype.Redraw=function(){var a=this.pad_painter();a&&(a.frame_painter_ref=this);if(!this.mode3d){this.UpdateAttributes();var b=this.pad_width(),c=this.pad_height(),d=Math.round(b*this.fX1NDC);
b=Math.round(b*(this.fX2NDC-this.fX1NDC));var e=Math.round(c*(1-this.fY2NDC));c=Math.round(c*(this.fY2NDC-this.fY1NDC));var g=!1,h=!1;a&&a.options&&(a.options.RotateFrame&&(g=!0),a.options.FixFrame&&(h=!0));this.draw_g=this.svg_layer("primitives_layer").select(".root_frame");if(this.draw_g.empty()){this.draw_g=this.svg_layer("primitives_layer").append("svg:g").attr("class","root_frame");this.draw_g.append("svg:title").text("");var k=this.draw_g.append("svg:rect");this.draw_g.append("svg:g").attr("class",
"grid_layer");var n=this.draw_g.append("svg:svg").attr("class","main_layer").attr("x",0).attr("y",0).attr("overflow","hidden");this.draw_g.append("svg:g").attr("class","axis_layer");this.draw_g.append("svg:g").attr("class","upper_layer")}else k=this.draw_g.select("rect"),n=this.draw_g.select(".main_layer");this.axes_drawn=!1;var t="translate("+d+","+e+")";if(g){t+=" rotate(-90) translate("+-c+",0)";var q=b;b=c;c=q}this._frame_x=d;this._frame_y=e;this._frame_width=b;this._frame_height=c;this.draw_g.attr("transform",
t);k.attr("x",0).attr("y",0).attr("width",b).attr("height",c).call(this.fillatt.func).call(this.lineatt.func);n.attr("width",b).attr("height",c).attr("viewBox","0 0 "+b+" "+c);k=this.draw_g.select(".interactive_rect");if(f.BatchMode)return k.remove();this.draw_g.attr("x",d).attr("y",e).attr("width",b).attr("height",c);g||h||this.AddDrag({obj:this,only_resize:!0,minwidth:20,minheight:20,redraw:this.SizeChanged.bind(this)});k.empty()&&(k=this.draw_g.append("rect").attr("class","interactive_rect").style("opacity",
0).style("fill","none").style("pointer-events","visibleFill").property("handlers_set",0));d=a&&a._fast_drawing?0:1;k.property("handlers_set")!=d&&(a=d?this.ProcessTooltipEvent.bind(this,null):null,e=d?this.ProcessTooltipEvent.bind(this,{handler:!0,touch:!1}):null,k.property("handlers_set",d).on("mouseenter",e).on("mousemove",e).on("mouseleave",a),f.touches&&(d=d?this.ProcessTooltipEvent.bind(this,{handler:!0,touch:!0}):null,k.on("touchstart",d).on("touchmove",d).on("touchend",a).on("touchcancel",
a)));k.attr("x",0).attr("y",0).attr("width",b).attr("height",c);b=this.hints_layer().select(".objects_hints");!b.empty()&&this.IsTooltipAllowed()&&b.property("hints_pad")==this.pad_name&&setTimeout(this.ProcessTooltipEvent.bind(this,b.property("last_point")),10)}};m.prototype.ToggleLog=function(a){var b=this.root_pad();if(b){if(!b["fLog"+a]){var c=this[a+"_kind"];this.swap_xy&&"x"===a?c=this.y_kind:this.swap_xy&&"y"===a&&(c=this.x_kind);if("labels"===c)return}b["fLog"+a]=b["fLog"+a]?0:1;this.InteractiveRedraw("pad",
"log"+a)}};m.prototype.FillContextMenu=function(a,b,c){var d=this.main_painter(),e=this.root_pad();if("x"==b||"y"==b||"z"==b){var g=c||this[b+"axis"];a.add("header: "+b.toUpperCase()+" axis");a.add("Unzoom",this.Unzoom.bind(this,b));a.addchk(e["fLog"+b],"SetLog"+b,this.ToggleLog.bind(this,b));a.addchk(g.TestBit(f.EAxisBits.kMoreLogLabels),"More log",function(){g.InvertBit(f.EAxisBits.kMoreLogLabels);this.RedrawPad()});a.addchk(g.TestBit(f.EAxisBits.kNoExponent),"No exponent",function(){g.InvertBit(f.EAxisBits.kNoExponent);
this.RedrawPad()});"z"===b&&d&&d.options&&d.options.Zscale&&"function"==typeof d.FillPaletteMenu&&d.FillPaletteMenu(a);g&&(a.add("sub:Labels"),a.addchk(g.TestBit(f.EAxisBits.kCenterLabels),"Center",function(){g.InvertBit(f.EAxisBits.kCenterLabels);this.RedrawPad()}),a.addchk(g.TestBit(f.EAxisBits.kLabelsVert),"Rotate",function(){g.InvertBit(f.EAxisBits.kLabelsVert);this.RedrawPad()}),this.AddColorMenuEntry(a,"Color",g.fLabelColor,function(a){g.fLabelColor=parseInt(a);this.InteractiveRedraw("pad",
this.GetColorExec(parseInt(a),"SetLabelColor"),b)}.bind(d||this)),this.AddSizeMenuEntry(a,"Offset",0,.1,.01,g.fLabelOffset,function(a){g.fLabelOffset=parseFloat(a);this.RedrawPad()}),this.AddSizeMenuEntry(a,"Size",.02,.11,.01,g.fLabelSize,function(a){g.fLabelSize=parseFloat(a);this.RedrawPad()}),a.add("endsub:"),a.add("sub:Title"),a.add("SetTitle",function(){var a=prompt("Enter axis title",g.fTitle);null!==a&&(g.fTitle=a,this.RedrawPad())}),a.addchk(g.TestBit(f.EAxisBits.kCenterTitle),"Center",function(){g.InvertBit(f.EAxisBits.kCenterTitle);
this.RedrawPad()}),a.addchk(g.TestBit(f.EAxisBits.kRotateTitle),"Rotate",function(){g.InvertBit(f.EAxisBits.kRotateTitle);this.RedrawPad()}),this.AddColorMenuEntry(a,"Color",g.fTitleColor,function(a){g.fTitleColor=parseInt(a);this.InteractiveRedraw("pad",this.GetColorExec(parseInt(a),"SetTitleColor"),b)}.bind(d||this)),this.AddSizeMenuEntry(a,"Offset",0,3,.2,g.fTitleOffset,function(a){g.fTitleOffset=parseFloat(a);this.RedrawPad()}),this.AddSizeMenuEntry(a,"Size",.02,.11,.01,g.fTitleSize,function(a){g.fTitleSize=
parseFloat(a);this.RedrawPad()}),a.add("endsub:"),a.add("sub:Ticks"),"TGaxis"==g._typename?(this.AddColorMenuEntry(a,"Color",g.fLineColor,function(a){g.fLineColor=parseInt(a);this.RedrawPad()}),this.AddSizeMenuEntry(a,"Size",-.05,.055,.01,g.fTickSize,function(a){g.fTickSize=parseFloat(a);this.RedrawPad()})):(this.AddColorMenuEntry(a,"Color",g.fAxisColor,function(a){g.fAxisColor=parseInt(a);this.InteractiveRedraw("pad",this.GetColorExec(parseInt(a),"SetAxisColor"),b)}.bind(d||this)),this.AddSizeMenuEntry(a,
"Size",-.05,.055,.01,g.fTickLength,function(a){g.fTickLength=parseFloat(a);this.RedrawPad()})),a.add("endsub:"));return!0}(c=0==a.size())?a.add("header:Frame"):a.add("separator");this.zoom_xmin!==this.zoom_xmax&&a.add("Unzoom X",this.Unzoom.bind(this,"x"));this.zoom_ymin!==this.zoom_ymax&&a.add("Unzoom Y",this.Unzoom.bind(this,"y"));this.zoom_zmin!==this.zoom_zmax&&a.add("Unzoom Z",this.Unzoom.bind(this,"z"));a.add("Unzoom all",this.Unzoom.bind(this,"xyz"));e&&(a.addchk(e.fLogx,"SetLogx",this.ToggleLog.bind(this,
"x")),a.addchk(e.fLogy,"SetLogy",this.ToggleLog.bind(this,"y")),d&&"function"===typeof d.Dimension&&1<d.Dimension()&&a.addchk(e.fLogz,"SetLogz",this.ToggleLog.bind(this,"z")),a.add("separator"));a.addchk(this.IsTooltipAllowed(),"Show tooltips",function(){this.SetTooltipAllowed("toggle")});this.FillAttContextMenu(a,c?"":"Frame ");a.add("separator");a.add("Save as frame.png",function(){this.pad_painter().SaveAs("png","frame","frame.png")});a.add("Save as frame.svg",function(){this.pad_painter().SaveAs("svg",
"frame","frame.svg")});return!0};m.prototype.FillWebObjectOptions=function(a){a.fcust="frame";a.fopt=[this.scale_xmin||0,this.scale_ymin||0,this.scale_xmax||0,this.scale_ymax||0];return a};m.prototype.GetFrameRect=function(){return{x:this.frame_x(),y:this.frame_y(),width:this.frame_width(),height:this.frame_height(),transform:this.draw_g?this.draw_g.attr("transform"):"",hint_delta_x:0,hint_delta_y:0}};m.prototype.ProcessFrameClick=function(a,b){var c=this.pad_painter();if(c){a.painters=!0;a.disabled=
!0;for(var d=c.GetTooltips(a),e=null,f=0;f<d.length&&!e;++f)d[f]&&d[f].exact&&(e=d[f]);var h;e&&(d=b?this._dblclick_handler:this._click_handler)&&(h=d(e.user_info,a));b||c.SelectObjectPainter(e?e.painter:this,{x:a.x+(this._frame_x||0),y:a.y+(this._frame_y||0)});return h}};m.prototype.AddKeysHandler=function(){this.keys_handler||f.BatchMode||"undefined"==typeof window||(this.keys_handler=this.ProcessKeyPress.bind(this),window.addEventListener("keydown",this.keys_handler,!1))};m.prototype.ProcessKeyPress=
function(a){if(!this.select_main().empty()){switch(a.keyCode){case 33:var b="PageUp";break;case 34:b="PageDown";break;case 37:b="ArrowLeft";break;case 38:b="ArrowUp";break;case 39:b="ArrowRight";break;case 40:b="ArrowDown";break;case 42:b="PrintScreen";break;case 106:b="*";break;default:return!1}var c=this.pad_painter();if(f.Painter.GetActivePad()===c){a.shiftKey&&(b="Shift "+b);a.altKey&&(b="Alt "+b);a.ctrlKey&&(b="Ctrl "+b);var d={name:"x",dleft:0,dright:0};switch(b){case "ArrowLeft":d.dleft=-1;
d.dright=1;break;case "ArrowRight":d.dleft=1;d.dright=-1;break;case "Ctrl ArrowLeft":d.dleft=d.dright=-1;break;case "Ctrl ArrowRight":d.dleft=d.dright=1;break;case "ArrowUp":d.name="y";d.dleft=1;d.dright=-1;break;case "ArrowDown":d.name="y";d.dleft=-1;d.dright=1;break;case "Ctrl ArrowUp":d.name="y";d.dleft=d.dright=1;break;case "Ctrl ArrowDown":d.name="y",d.dleft=d.dright=-1}if(d.dleft||d.dright){if(!f.gStyle.Zooming||this.mode3d&&0!==b.indexOf("Ctrl"))return!1;this.AnalyzeMouseWheelEvent(null,d,
.5);this.Zoom(d.name,d.min,d.max);d.changed&&(this.zoom_changed_interactive=2);a.stopPropagation();a.preventDefault()}else if(b=c?c.FindButton(b):"")c.PadButtonClick(b),a.stopPropagation(),a.preventDefault();return!0}}};m.prototype.FindAlternativeClickHandler=function(a){var b=this.pad_painter();if(!b)return!1;a=b.GetTooltips({x:a[0],y:a[1],painters:!0,disabled:!0,click_handler:!0});for(b=0;b<a.length;++b)if(a[b]&&"function"==typeof a[b].click_handler)return a[b].click_handler(a[b]),!0;return!1};
m.prototype.clearInteractiveElements=function(){f.Painter.closeMenu();this.zoom_rect&&(this.zoom_rect.remove(),this.zoom_rect=null);this.zoom_kind=0;this.SwitchTooltip(!0)};m.prototype.startRectSel=function(){if(!(100<this.zoom_kind)&&1===(l.event.which||l.event.button)){l.event.preventDefault();var a=l.mouse(this.svg_frame().node());if(!this.FindAlternativeClickHandler(a)){this.clearInteractiveElements();this.zoom_origin=a;a=this.frame_width();var b=this.frame_height();this.zoom_curr=[Math.max(0,
Math.min(a,this.zoom_origin[0])),Math.max(0,Math.min(b,this.zoom_origin[1]))];0>this.zoom_origin[0]||this.zoom_origin[0]>a?(this.zoom_kind=3,this.zoom_origin[0]=0,this.zoom_origin[1]=this.zoom_curr[1],this.zoom_curr[0]=a,this.zoom_curr[1]+=1):0>this.zoom_origin[1]||this.zoom_origin[1]>b?(this.zoom_kind=2,this.zoom_origin[0]=this.zoom_curr[0],this.zoom_origin[1]=0,this.zoom_curr[0]+=1,this.zoom_curr[1]=b):(this.zoom_kind=1,this.zoom_origin[0]=this.zoom_curr[0],this.zoom_origin[1]=this.zoom_curr[1]);
l.select(window).on("mousemove.zoomRect",this.moveRectSel.bind(this)).on("mouseup.zoomRect",this.endRectSel.bind(this),!0);this.zoom_rect=null;this.SwitchTooltip(!1);l.event.stopPropagation()}}};m.prototype.moveRectSel=function(){if(!(0==this.zoom_kind||100<this.zoom_kind)){l.event.preventDefault();var a=l.mouse(this.svg_frame().node());a[0]=Math.max(0,Math.min(this.frame_width(),a[0]));a[1]=Math.max(0,Math.min(this.frame_height(),a[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=a[0];this.zoom_curr[1]=
a[1];break;case 2:this.zoom_curr[0]=a[0];break;case 3:this.zoom_curr[1]=a[1]}null===this.zoom_rect&&(this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("pointer-events","none"));this.zoom_rect.attr("x",Math.min(this.zoom_origin[0],this.zoom_curr[0])).attr("y",Math.min(this.zoom_origin[1],this.zoom_curr[1])).attr("width",Math.abs(this.zoom_curr[0]-this.zoom_origin[0])).attr("height",Math.abs(this.zoom_curr[1]-this.zoom_origin[1]))}};m.prototype.endRectSel=function(){if(!(0==this.zoom_kind||
100<this.zoom_kind)){l.event.preventDefault();l.select(window).on("mousemove.zoomRect",null).on("mouseup.zoomRect",null);var a=l.mouse(this.svg_frame().node()),b=[!0,!0];a[0]=Math.max(0,Math.min(this.frame_width(),a[0]));a[1]=Math.max(0,Math.min(this.frame_height(),a[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=a[0];this.zoom_curr[1]=a[1];break;case 2:this.zoom_curr[0]=a[0];b[1]=!1;break;case 3:this.zoom_curr[1]=a[1],b[0]=!1}a=!1;var c=this.swap_xy?1:0,d=1-c;if(b[c]&&10<Math.abs(this.zoom_curr[c]-
this.zoom_origin[c])){var e=Math.min(this.RevertX(this.zoom_origin[c]),this.RevertX(this.zoom_curr[c]));var f=Math.max(this.RevertX(this.zoom_origin[c]),this.RevertX(this.zoom_curr[c]));a=!0}if(b[d]&&10<Math.abs(this.zoom_curr[d]-this.zoom_origin[d])){var h=Math.min(this.RevertY(this.zoom_origin[d]),this.RevertY(this.zoom_curr[d]));var k=Math.max(this.RevertY(this.zoom_origin[d]),this.RevertY(this.zoom_curr[d]));a=!0}c=this.zoom_kind;b=1===c?{x:this.zoom_origin[0],y:this.zoom_origin[1]}:null;this.clearInteractiveElements();
if(a)this.zoom_changed_interactive=2,this.Zoom(e,f,h,k);else switch(c){case 1:(e=this.frame_painter())&&e.ProcessFrameClick(b);break;case 2:(e=this.pad_painter())&&e.SelectObjectPainter(this.x_handle);break;case 3:(e=this.pad_painter())&&e.SelectObjectPainter(this.y_handle)}this.zoom_kind=0}};m.prototype.mouseDoubleClick=function(){l.event.preventDefault();var a=l.mouse(this.svg_frame().node());this.clearInteractiveElements();var b=0<=a[0]&&a[0]<=this.frame_width(),c=0<=a[1]&&a[1]<=this.frame_height();
if(!(b&&c&&this._dblclick_handler&&this.ProcessFrameClick({x:a[0],y:a[1]},!0))){var d="xyz";b?c||(d=this.swap_xy?"y":"x"):d=this.swap_xy?"x":"y";this.Unzoom(d)||(b=this.pad_painter())&&b.SelectObjectPainter(b,{x:a[0]+this.frame_x(),y:a[1]+this.frame_y(),dbl:!0})}};m.prototype.ConfigureUserClickHandler=function(a){this._click_handler=a&&"function"==typeof a?a:null};m.prototype.ConfigureUserDblclickHandler=function(a){this._dblclick_handler=a&&"function"==typeof a?a:null};m.prototype.Zoom=function(a,
b,c,d,e,f){if(this.projection)return!1;"x"===a?(a=b,b=c,c=void 0):"y"===a?(d=c,c=b,a=b=void 0):"z"===a&&(e=b,f=c,a=b=c=void 0);var g=a!==b,k=c!==d,n=e!==f,t=!1,q=!1,r=!1;if(g){var l=0;a<=this.xmin&&(a=this.xmin,l++);b>=this.xmax&&(b=this.xmax,l++);2===l&&(g=!1,t=!0)}else t=a===b&&0===a;k?(l=0,c<=this.ymin&&(c=this.ymin,l++),d>=this.ymax&&(d=this.ymax,l++),2===l&&(k=!1,q=!0)):q=c===d&&0===c;n?(l=0,e<=this.zmin&&(e=this.zmin,l++),f>=this.zmax&&(f=this.zmax,l++),2===l&&(n=!1,r=!0)):r=e===f&&0===e;var m=
!1,p=this;(g||k||n)&&p.ForEachPainter(function(h){g&&h.CanZoomIn("x",a,b)&&(p.zoom_xmin=a,p.zoom_xmax=b,m=!0,g=!1);k&&h.CanZoomIn("y",c,d)&&(p.zoom_ymin=c,p.zoom_ymax=d,m=!0,k=!1);n&&h.CanZoomIn("z",e,f)&&(p.zoom_zmin=e,p.zoom_zmax=f,m=!0,n=!1)});if(t||q||r)t&&(this.zoom_xmin!==this.zoom_xmax&&(m=!0),this.zoom_xmin=this.zoom_xmax=0),q&&(this.zoom_ymin!==this.zoom_ymax&&(m=!0),this.zoom_ymin=this.zoom_ymax=0),r&&(this.zoom_zmin!==this.zoom_zmax&&(m=!0),this.zoom_zmin=this.zoom_zmax=0),m||(l=this.pad_painter())&&
l.painters&&l.painters.forEach(function(a){a&&"function"==typeof a.UnzoomUserRange&&a.UnzoomUserRange(t,q,r)&&(m=!0)});m&&this.InteractiveRedraw("pad","zoom");return m};m.prototype.IsAxisZoomed=function(a){return this["zoom_"+a+"min"]!==this["zoom_"+a+"max"]};m.prototype.Unzoom=function(a,b,c){"undefined"===typeof a?c=b=a=!0:"string"===typeof a&&(c=0<=a.indexOf("z"),b=0<=a.indexOf("y"),a=0<=a.indexOf("x"));var d=this.zoom_changed_interactive;if(a||b||c)this.zoom_changed_interactive=1;var e=this.Zoom(a?
0:void 0,a?0:void 0,b?0:void 0,b?0:void 0,c?0:void 0,c?0:void 0);(a||b||c)&&!e&&(this.zoom_changed_interactive=!isNaN(d)&&0<d?d-1:0);return e};m.prototype.AnalyzeMouseWheelEvent=function(a,b,c,d){b.min=b.max=void 0;b.changed=!1;if(!d||!b.ignore){var e=0,g=d=1;"dleft"in b&&(d=b.dleft,e=1);"dright"in b&&(g=b.dright,e=1);"delta"in b?e=b.delta:a&&void 0!==a.wheelDelta?e=-a.wheelDelta:a&&void 0!==a.deltaY?e=a.deltaY:a&&void 0!==a.detail&&(e=a.detail);if(0!==e){e=0>e?-.2:.2;d*=e;g*=e;a=b.min=this["scale_"+
b.name+"min"];var h=b.max=this["scale_"+b.name+"max"],k=this[b.name+"min"],n=this[b.name+"max"];b.min===b.max&&0>e&&(b.min=k,b.max=n);if(!(b.min>=b.max)){if(0<c&&1>c){if(this["log"+b.name])e=0<b.min?f.log10(b.max/b.min):2,10<e?e=10:.01>e&&(e=.01),b.min/=Math.pow(10,e*d*c),b.max*=Math.pow(10,e*g*(1-c));else{var t=e=b.max-b.min;0<d&&(e=1.001*e/(1-d));b.min+=-d*c*e;0<g&&(t=1.001*t/(1-g));b.max-=-g*(1-c)*t}b.min>=b.max?b.min=b.max=void 0:d!==g&&(b.min<k&&a===k||b.max>n&&h==n)&&(b.min=b.max=void 0)}else b.min=
b.max=void 0;b.changed=void 0!==b.min&&void 0!==b.max}}}};m.prototype.AllowDefaultYZooming=function(){var a=this.pad_painter();if(a&&a.painters)for(var b=0;b<a.painters.length;++b){var c=a.painters[b];if(c&&void 0!==c.wheel_zoomy)return c.wheel_zoomy}return!1};m.prototype.mouseWheel=function(){l.event.stopPropagation();l.event.preventDefault();this.clearInteractiveElements();var a={name:"x",ignore:!1},b={name:"y",ignore:!this.AllowDefaultYZooming()},c=l.mouse(this.svg_frame().node()),d=this.frame_width(),
e=this.frame_height();this.AnalyzeMouseWheelEvent(l.event,this.swap_xy?b:a,c[0]/d,0<=c[1]&&c[1]<=e);this.AnalyzeMouseWheelEvent(l.event,this.swap_xy?a:b,1-c[1]/e,0<=c[0]&&c[0]<=d);this.Zoom(a.min,a.max,b.min,b.max);if(a.changed||b.changed)this.zoom_changed_interactive=2};m.prototype.startTouchZoom=function(){if(0!=this.zoom_kind)l.event.preventDefault(),l.event.stopPropagation();else{var a=l.touches(this.svg_frame().node());this.touch_cnt+=1;if(1==a.length){var b=new Date,c=b.getTime()-this.last_touch.getTime();
this.last_touch=b;300>c&&this.zoom_curr&&30>Math.abs(this.zoom_curr[0]-a[0][0])&&30>Math.abs(this.zoom_curr[1]-a[0][1])?(l.event.preventDefault(),l.event.stopPropagation(),this.clearInteractiveElements(),this.Unzoom("xyz"),this.last_touch=new Date(0),this.svg_frame().on("touchcancel",null).on("touchend",null,!0)):f.gStyle.ContextMenu&&(this.zoom_curr=a[0],this.svg_frame().on("touchcancel",this.endTouchSel.bind(this)).on("touchend",this.endTouchSel.bind(this)),l.event.preventDefault(),l.event.stopPropagation())}if(2==
a.length&&f.gStyle.Zooming&&f.gStyle.ZoomTouch){l.event.preventDefault();l.event.stopPropagation();this.clearInteractiveElements();this.svg_frame().on("touchcancel",null).on("touchend",null);b=a[0];a=a[1];c=this.frame_width();var d=this.frame_height();this.zoom_curr=[Math.min(b[0],a[0]),Math.min(b[1],a[1])];this.zoom_origin=[Math.max(b[0],a[0]),Math.max(b[1],a[1])];0>this.zoom_curr[0]||this.zoom_curr[0]>c?(this.zoom_kind=103,this.zoom_curr[0]=0,this.zoom_origin[0]=c):this.zoom_origin[1]>d||0>this.zoom_origin[1]?
(this.zoom_kind=102,this.zoom_curr[1]=0,this.zoom_origin[1]=d):this.zoom_kind=101;this.SwitchTooltip(!1);this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);l.select(window).on("touchmove.zoomRect",this.moveTouchSel.bind(this)).on("touchcancel.zoomRect",this.endTouchSel.bind(this)).on("touchend.zoomRect",
this.endTouchSel.bind(this))}}};m.prototype.moveTouchSel=function(){if(!(100>this.zoom_kind)){l.event.preventDefault();var a=l.touches(this.svg_frame().node());if(2!=a.length)return this.clearInteractiveElements();var b=a[0];a=a[1];103!=this.zoom_kind&&(this.zoom_curr[0]=Math.min(b[0],a[0]),this.zoom_origin[0]=Math.max(b[0],a[0]));102!=this.zoom_kind&&(this.zoom_curr[1]=Math.min(b[1],a[1]),this.zoom_origin[1]=Math.max(b[1],a[1]));this.zoom_rect.attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",
this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);(10<this.zoom_origin[0]-this.zoom_curr[0]||10<this.zoom_origin[1]-this.zoom_curr[1])&&this.SwitchTooltip(!1);l.event.stopPropagation()}};m.prototype.endTouchSel=function(){this.svg_frame().on("touchcancel",null).on("touchend",null);if(0===this.zoom_kind){l.event.preventDefault();var a=(new Date).getTime()-this.last_touch.getTime();500<a&&2E3>a&&!this.frame_painter().IsTooltipShown()?(this.ShowContextMenu("main",
{clientX:this.zoom_curr[0],clientY:this.zoom_curr[1]}),this.last_touch=new Date(0)):this.clearInteractiveElements()}if(!(100>this.zoom_kind)){l.event.preventDefault();l.select(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);a=!1;var b=this.swap_xy?1:0,c=1-b,d=[!0,!0];102===this.zoom_kind&&(d[1]=!1);103===this.zoom_kind&&(d[0]=!1);if(d[b]&&10<Math.abs(this.zoom_curr[b]-this.zoom_origin[b])){var e=Math.min(this.RevertX(this.zoom_origin[b]),this.RevertX(this.zoom_curr[b]));
var f=Math.max(this.RevertX(this.zoom_origin[b]),this.RevertX(this.zoom_curr[b]));a=!0}if(d[c]&&10<Math.abs(this.zoom_curr[c]-this.zoom_origin[c])){var h=Math.min(this.RevertY(this.zoom_origin[c]),this.RevertY(this.zoom_curr[c]));var k=Math.max(this.RevertY(this.zoom_origin[c]),this.RevertY(this.zoom_curr[c]));a=!0}this.clearInteractiveElements();this.last_touch=new Date(0);a&&(this.zoom_changed_interactive=2,this.Zoom(e,f,h,k));l.event.stopPropagation()}};m.prototype.ShowContextMenu=function(a,b,
c){if(!("zoom_kind"in this&&100<this.zoom_kind)){var d=this,e=null,g=!1,h=null;if(!b)if(l.event.preventDefault(),l.event.stopPropagation(),b=l.event,void 0===a){var k=l.mouse(this.svg_frame().node()),n=l.touches(this.svg_frame().node()),t=this.pad_painter(),q=null,r=null;h=this;1===n.length?q={x:n[0][0],y:n[0][1],touch:!0}:2===k.length&&(q={x:k[0],y:k[1],touch:!1});if(null!==q&&null!==t)for(q.painters=!0,k=t.GetTooltips(q),n=1E3,t=0;t<k.length;++t)if(k[t]&&k[t].menu){var m="menu_dist"in k[t]?k[t].menu_dist:
7;m<n&&(r=k[t].painter,n=m)}r?d=r:a="frame";q&&(g=0<q.x&&20>q.x&&0<q.y&&20>q.y);h.SetLastEventPos(q)}else if("x"==a||"y"==a||"z"==a)e=this.main_painter();d.ctx_menu_evnt=b;e||(e=d);f.Painter.createMenu(d,function(b){var d=b.painter.FillContextMenu(b,a,c);h&&(!d||g&&"frame"!==a)&&(d=h.FillContextMenu(b));d&&e.FillObjectExecMenu(b,a,function(){b.painter.SwitchTooltip(!1);b.show(b.painter.ctx_menu_evnt,b.painter.SwitchTooltip.bind(b.painter,!0))})})}};m.prototype.ShowAxisStatus=function(a){var b=this.GetShowStatusFunc();
if(b){var c=this.histo?this.histo["f"+a.toUpperCase()+"axis"]:null,d=a,e="TAxis";c&&(d=c.fName,e=c.fTitle||"histogram TAxis object");c=l.mouse(this.svg_frame().node());var f="x"==a?0:1;this.swap_xy&&(f=1-f);f="x"==a?this.RevertX(c[f]):this.RevertY(c[f]);b(d,e,a+" : "+this.AxisAsText(a,f),c[0].toFixed(0)+","+c[1].toFixed(0))}};m.prototype.AddInteractive=function(){if(!f.BatchMode&&(f.gStyle.Zooming||f.gStyle.ContextMenu)){var a=this.pad_painter();if(!a||!a._fast_drawing)if(a=this.svg_frame(),!a.empty()){var b=
a.selectAll(".xaxis_container"),c=a.selectAll(".yaxis_container");a.property("interactive_set")||(this.AddKeysHandler(),this.last_touch=new Date(0),this.zoom_kind=0,this.zoom_curr=this.zoom_origin=this.zoom_rect=null,this.touch_cnt=0);if(f.gStyle.Zooming&&!this.projection&&(f.gStyle.ZoomMouse&&(a.on("mousedown",this.startRectSel.bind(this)),a.on("dblclick",this.mouseDoubleClick.bind(this))),f.gStyle.ZoomWheel))a.on("wheel",this.mouseWheel.bind(this));if(f.touches&&(f.gStyle.Zooming&&f.gStyle.ZoomTouch&&
!this.projection||f.gStyle.ContextMenu))a.on("touchstart",this.startTouchZoom.bind(this));f.gStyle.ContextMenu&&(f.touches&&(b.on("touchstart",this.startTouchMenu.bind(this,"x")),c.on("touchstart",this.startTouchMenu.bind(this,"y"))),a.on("contextmenu",this.ShowContextMenu.bind(this)),b.on("contextmenu",this.ShowContextMenu.bind(this,"x")),c.on("contextmenu",this.ShowContextMenu.bind(this,"y")));b.on("mousemove",this.ShowAxisStatus.bind(this,"x"));c.on("mousemove",this.ShowAxisStatus.bind(this,"y"));
a.property("interactive_set",!0)}}};p.prototype=Object.create(f.TObjectPainter.prototype);p.prototype.Cleanup=function(){for(var a=0;a<this.painters.length;++a)this.painters[a].Cleanup();a=this.svg_pad(this.this_pad_name);a.empty()||(a.property("pad_painter",null),a.property("mainpainter",null),this.iscan||a.remove());delete this.frame_painter_ref;delete this.pads_cache;delete this.custom_palette;this.painters=[];this.pad=null;this.this_pad_name="";this.has_canvas=!1;f.Painter.SelectActivePad({pp:this,
active:!1});f.TObjectPainter.prototype.Cleanup.call(this)};p.prototype.CleanPrimitives=function(a){if(a&&"function"===typeof a)for(var b=this.painters.length-1;0<=b;--b)a(this.painters[b])&&(this.painters[b].Cleanup(),this.painters.splice(b,1))};p.prototype.CreateAutoColor=function(){this.canv_painter();var a=this.root_pad(),b=a&&a.fPrimitves?a.fPrimitves.arr.length:5;a=this.get_palette(!0);var c=this._auto_color||0;this._auto_color=c+1;if(a)return 2>b&&(b=2),c>=b&&(c=b-1),b=Math.round(c*(a.getLength()-
3)/(b-1)),a=a.getColor(b),this.add_color(a);this._auto_color%=8;return c+2};p.prototype.ForEachPainterInPad=function(a,b){b||(b="all");"objects"!=b&&a(this);for(var c=0;c<this.painters.length;++c){var d=this.painters[c];"function"===typeof d.ForEachPainterInPad?"objects"!=b&&d.ForEachPainterInPad(a,b):"pads"!=b&&a(d)}};p.prototype.ButtonSize=function(a){return Math.round((a?a:1)*(this.iscan||!this.has_canvas?16:12))};p.prototype.RegisterForPadEvents=function(a){this.pad_events_receiver=a};p.prototype.SelectObjectPainter=
function(a,b){var c=this.iscan||!this.has_canvas,d=c?this:this.canv_painter(),e=a instanceof p?a:a.pad_painter();b&&!c&&this.CalcAbsolutePosition(this.svg_pad(this.this_pad_name),b);f.Painter.SelectActivePad({pp:e,active:!0});"function"==typeof d.SelectActivePad&&d.SelectActivePad(e,a,b);d.pad_events_receiver&&d.pad_events_receiver({what:"select",padpainter:e,painter:a,position:b})};p.prototype.InteractiveObjectRedraw=function(a){var b=this.iscan||!this.has_canvas?this:this.canv_painter(),c=a instanceof
p?a:a.pad_painter();b&&b.pad_events_receiver&&b.pad_events_receiver({what:"redraw",padpainter:c,painter:a})};p.prototype.SetActive=function(a){var b=this.frame_painter();b&&"function"==typeof b.SetActive&&b.SetActive(a)};p.prototype.DrawActiveBorder=function(a,b){if(void 0!==b){if(this.is_active_pad===b)return;this.is_active_pad=b}void 0!==this.is_active_pad&&(a||(a=this.iscan?this.svg_canvas().select(".canvas_fillrect"):this.svg_pad(this.this_pad_name).select(".root_pad_border")),(b=this.is_active_pad?
new f.TAttLineHandler({style:1,width:1,color:"red"}):this.lineatt)||(b=new f.TAttLineHandler({color:"none"})),a.call(b.func))};p.prototype.CreateCanvasSvg=function(a,b){if(0<a){if(this._fixed_size)return 1<a;var c=this.svg_canvas();if(c.empty())return!1;var d=c.property("height_factor");b=this.check_main_resize(a,null,d);if(!b.changed)return!1;a=this.svg_layer("btns_layer")}else{var e=this.select_main();"static"==e.style("position")&&e.style("position","relative");c=e.append("svg").attr("class","jsroot root_canvas").property("pad_painter",
this).property("mainpainter",null).property("current_pad","").property("redraw_by_resize",!1);f.BatchMode&&(c.attr("xmlns","http://www.w3.org/2000/svg"),c.attr("xmlns:xlink","http://www.w3.org/1999/xlink"));c.append("svg:title").text("ROOT canvas");d=c.append("svg:rect").attr("class","canvas_fillrect").attr("x",0).attr("y",0);if(!f.BatchMode)d.style("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,this)).on("mouseenter",this.ShowObjectStatus.bind(this));
c.append("svg:g").attr("class","primitives_layer");c.append("svg:g").attr("class","info_layer");a=c.append("svg:g").attr("class","btns_layer").property("leftside","left"==f.gStyle.ToolBarSide).property("vertical",f.gStyle.ToolBarVert);if(f.gStyle.ContextMenu)c.select(".canvas_fillrect").on("contextmenu",this.ShowContextMenu.bind(this));d=.66;this.pad&&this.pad.fCw&&this.pad.fCh&&0<this.pad.fCw&&(d=this.pad.fCh/this.pad.fCw,.1>d||10<d)&&(d=.66);this._fixed_size?(e.style("overflow","auto"),b={width:this.pad.fCw,
height:this.pad.fCh}):b=this.check_main_resize(2,b,d)}this.createAttFill({attr:this.pad});5>=b.width||5>=b.height?(c.style("display","none"),console.warn("Hide canvas while geometry too small w="+b.width+" h="+b.height),b.width=200,b.height=100):c.style("display",null);this._fixed_size?c.attr("x",0).attr("y",0).attr("width",b.width).attr("height",b.height).style("position","absolute"):c.attr("x",0).attr("y",0).style("width","100%").style("height","100%").style("position","absolute").style("left",
0).style("top",0).style("right",0).style("bottom",0);c.attr("viewBox","0 0 "+b.width+" "+b.height).attr("preserveAspectRatio","none").property("height_factor",d).property("draw_x",0).property("draw_y",0).property("draw_width",b.width).property("draw_height",b.height);d=c.select(".canvas_fillrect").attr("width",b.width).attr("height",b.height).call(this.fillatt.func);this._fast_drawing=f.gStyle.SmallPad&&(b.width<f.gStyle.SmallPad.width||b.height<f.gStyle.SmallPad.height);this.DrawActiveBorder(d);
this.AlignBtns(a,b.width,b.height,c);return!0};p.prototype.EnlargePad=function(){l.event&&(l.event.preventDefault(),l.event.stopPropagation());var a=this.svg_canvas(),b=a.property("pad_enlarged");if(!this.iscan&&this.has_canvas&&(b||this.HasObjectsToDraw()||this.painters))b?b===this.pad?(this.enlarge_main(!1),a.property("pad_enlarged",null)):console.error("missmatch with pad double click events"):(this.enlarge_main(!0,!0),a.property("pad_enlarged",this.pad));else{if(this._fixed_size||!this.enlarge_main("toggle"))return;
"off"==this.enlarge_main("state")&&a.property("pad_enlarged",null)}a=this._fast_drawing;this.CheckResize({force:!0});this._fast_drawing!=a&&this.ShowButtons()};p.prototype.CreatePadSvg=function(a){if(!this.has_canvas)return this.CreateCanvasSvg(a?2:0),!0;var b=this.svg_canvas(),c=b.property("draw_width"),d=b.property("draw_height"),e=b.property("pad_enlarged"),g=!e||e===this.pad,h=Math.round(this.pad.fAbsWNDC*c),k=Math.round(this.pad.fAbsHNDC*d),n=Math.round(this.pad.fAbsXlowNDC*c),t=Math.round(d*
(1-this.pad.fAbsYlowNDC))-k;e===this.pad&&(h=c,k=d,n=t=0);if(a)a=this.svg_pad(this.this_pad_name),b=a.select(".root_pad_border"),c=this.svg_layer("btns_layer",this.this_pad_name);else{a=b.select(".primitives_layer").append("svg:svg").classed("__root_pad_"+this.this_pad_name,!0).attr("pad",this.this_pad_name).property("pad_painter",this).property("mainpainter",null);b=a.append("svg:rect").attr("class","root_pad_border");a.append("svg:g").attr("class","primitives_layer");c=a.append("svg:g").attr("class",
"btns_layer").property("leftside","left"!=f.gStyle.ToolBarSide).property("vertical",f.gStyle.ToolBarVert);if(f.gStyle.ContextMenu)b.on("contextmenu",this.ShowContextMenu.bind(this));if(!f.BatchMode)b.attr("pointer-events","visibleFill").on("dblclick",this.EnlargePad.bind(this)).on("click",this.SelectObjectPainter.bind(this,this)).on("mouseenter",this.ShowObjectStatus.bind(this))}this.createAttFill({attr:this.pad});this.createAttLine({attr:this.pad,color0:0==this.pad.fBorderMode?"none":""});a.attr("display",
g?null:"none").attr("viewBox","0 0 "+h+" "+k).attr("preserveAspectRatio","none").attr("x",n).attr("y",t).attr("width",h).attr("height",k).property("draw_x",n).property("draw_y",t).property("draw_width",h).property("draw_height",k);b.attr("x",0).attr("y",0).attr("width",h).attr("height",k).call(this.fillatt.func).call(this.lineatt.func);this.DrawActiveBorder(b);this._fast_drawing=f.gStyle.SmallPad&&(h<f.gStyle.SmallPad.width||k<f.gStyle.SmallPad.height);1===a.property("can3d")&&this.select_main().select(".draw3d_"+
this.this_pad_name).style("display",g?"":"none");this.AlignBtns(c,h,k);return g};p.prototype.CheckSpecial=function(a){if(!a||"TObjArray"!==a._typename)return!1;if("ListOfColors"==a.name){if(this.options&&this.options.CreatePalette){for(var b=[],c=a.arr.length-this.options.CreatePalette;c<a.arr.length;++c){var d=f.Painter.MakeColorRGB(a.arr[c]);if(!d){console.log("Fail to create color for palette");b=null;break}b.push(d)}b&&(this.custom_palette=new f.ColorPalette(b))}this.options&&!this.options.GlobalColors||
f.Painter.adoptRootColors(a);this.options&&this.options.LocalColors&&(this.root_colors=f.Painter.extendRootColors(null,a));return!0}if("CurrentColorPalette"==a.name){b=[];var e=!1;for(c=0;c<a.arr.length;++c)(d=a.arr[c])&&"TColor"==d._typename?b[c]=f.Painter.MakeColorRGB(d):(console.log("Missing color with index "+c),e=!0);this.options&&(e||this.options.IgnorePalette)||(this.custom_palette=new f.ColorPalette(b));return!0}return!1};p.prototype.CheckSpecialsInPrimitives=function(a){if(a=a?a.fPrimitives:
null)for(var b=0;b<a.arr.length;++b)this.CheckSpecial(a.arr[b])&&(a.arr.splice(b,1),a.opt.splice(b,1),b--)};p.prototype.RemovePrimitive=function(a){this.pad&&this.pad.fPrimitives&&(a=this.pad.fPrimitives.arr.indexOf(a),0<=a&&this.pad.fPrimitives.RemoveAt(a))};p.prototype.FindPrimitive=function(a,b,c){if(!this.pad||!this.pad.fPrimitives)return null;for(var d=0;d<this.pad.fPrimitives.arr.length;d++){var e=this.pad.fPrimitives.arr[d];if(null===a||e===a)if(void 0===b||null===b||e._typename===b)if(void 0===
c||null===c||e.fName===c)return e}return null};p.prototype.HasObjectsToDraw=function(){if(!this.pad||!this.pad.fPrimitives)return!1;for(var a=0;a<this.pad.fPrimitives.arr.length;++a)if(this.pad.fPrimitives.arr[a]&&"TPad"!=this.pad.fPrimitives.arr[a]._typename)return!0;return!1};p.prototype.DrawPrimitives=function(a,b,c){0===a&&(this._doing_pad_draw=!0,this.iscan&&(this._start_tm=this._lasttm_tm=(new Date).getTime()),this._num_primitives=this.pad&&this.pad.fPrimitives?this.pad.fPrimitives.arr.length:
0);for(;;){c&&"object"==typeof c&&(c._primitive=!0);if(!this.pad||a>=this.pad.fPrimitives.arr.length)return delete this._doing_pad_draw,delete this._current_primitive_indx,this._start_tm&&(a=(new Date).getTime()-this._start_tm,1E3<a&&console.log("Canvas drawing took "+(.001*a).toFixed(2)+"s"),delete this._start_tm,delete this._lasttm_tm),f.CallBack(b);var d={func:this.DrawPrimitives.bind(this,a+1,b)};this._current_primitive_indx=a;c=f.draw(this.divid,this.pad.fPrimitives.arr[a],this.pad.fPrimitives.opt[a],
d);a++;if(!d.completed)break;if(!f.BatchMode&&this.iscan){var e=(new Date).getTime();if(e>this._lasttm_tm+15E3)return this._lasttm_tm=e,c._primitive=!0,requestAnimationFrame(d.func)}}};p.prototype.GetTooltips=function(a){var b=[],c=[];null!==this.painters&&this.painters.forEach(function(a){"ProcessTooltip"in a&&b.push(a)});a&&(a.nproc=b.length);b.forEach(function(b){var d=b.ProcessTooltip(a);d||(d={user_info:null});c.push(d);d&&a&&a.painters&&(d.painter=b)});return c};p.prototype.FillContextMenu=
function(a){this.pad?a.add("header: "+this.pad._typename+"::"+this.pad.fName):a.add("header: Canvas");a.addchk(this.IsTooltipAllowed(),"Show tooltips",this.SetTooltipAllowed.bind(this,"toggle"));if(!this._websocket){var b=function(a){this.pad[a.substr(1)]=parseInt(a[0]);this.InteractiveRedraw("axes",a.substr(1))};a.addchk(this.pad.fGridx,"Grid x",(this.pad.fGridx?"0":"1")+"fGridx",b);a.addchk(this.pad.fGridy,"Grid y",(this.pad.fGridy?"0":"1")+"fGridy",b);a.add("sub:Ticks x");a.addchk(0==this.pad.fTickx,
"normal","0fTickx",b);a.addchk(1==this.pad.fTickx,"ticks on both sides","1fTickx",b);a.addchk(2==this.pad.fTickx,"labels on both sides","2fTickx",b);a.add("endsub:");a.add("sub:Ticks y");a.addchk(0==this.pad.fTicky,"normal","0fTicky",b);a.addchk(1==this.pad.fTicky,"ticks on both sides","1fTicky",b);a.addchk(2==this.pad.fTicky,"labels on both sides","2fTicky",b);a.add("endsub:");this.FillAttContextMenu(a)}a.add("separator");this.ActivateStatusBar&&a.addchk(this.HasEventStatus(),"Event status",this.ActivateStatusBar.bind(this,
"toggle"));(this.enlarge_main()||this.has_canvas&&this.HasObjectsToDraw())&&a.addchk("on"==this.enlarge_main("state"),"Enlarge "+(this.iscan?"canvas":"pad"),this.EnlargePad.bind(this));b=this.this_pad_name;0===b.length&&(b=this.iscan?"canvas":"pad");a.add("Save as "+b+".png",b+".png",this.SaveAs.bind(this,"png",!1));a.add("Save as "+b+".svg",b+".svg",this.SaveAs.bind(this,"svg",!1));return!0};p.prototype.ShowContextMenu=function(a){if(!a){var b=l.mouse(this.svg_pad(this.this_pad_name).node());if(b&&
2==b.length&&0<b[0]&&10>b[0]&&0<b[1]&&10>b[1])return;l.event.stopPropagation();l.event.preventDefault();a=l.event;(b=this.frame_painter())&&b.SetLastEventPos()}f.Painter.createMenu(this,function(b){b.painter.FillContextMenu(b);b.painter.FillObjectExecMenu(b,"",function(){b.show(a)})})};p.prototype.Redraw=function(a){if(this._doing_pad_draw)return console.log("Prevent redrawing",this.pad.fName);var b=!0;this.iscan?this.CreateCanvasSvg(2):b=this.CreatePadSvg(!0);for(var c=0;c<this.painters.length;++c){var d=
this.painters[c];(b||d.this_pad_name)&&d.Redraw(a)}};p.prototype.NumDrawnSubpads=function(){if(void 0===this.painters)return 0;for(var a=0,b=0;b<this.painters.length;++b){var c=this.painters[b].GetObject();c&&"TPad"===c._typename&&a++}return a};p.prototype.RedrawByResize=function(){if(1===this.access_3d_kind())return!0;for(var a=0;a<this.painters.length;++a)if("function"===typeof this.painters[a].RedrawByResize&&this.painters[a].RedrawByResize())return!0;return!1};p.prototype.CheckCanvasResize=function(a,
b){if(!this.iscan&&this.has_canvas)return!1;if(!0===a||!1===a)b=a,a=null;a&&"object"===typeof a&&a.force&&(b=!0);b||(b=this.RedrawByResize());if(a=this.CreateCanvasSvg(b?2:1,a))for(var c=0;c<this.painters.length;++c)this.painters[c].Redraw(b?!1:!0);return a};p.prototype.UpdateObject=function(a){if(!a)return!1;this.pad.fBits=a.fBits;this.pad.fTitle=a.fTitle;this.pad.fGridx=a.fGridx;this.pad.fGridy=a.fGridy;this.pad.fTickx=a.fTickx;this.pad.fTicky=a.fTicky;this.pad.fLogx=a.fLogx;this.pad.fLogy=a.fLogy;
this.pad.fLogz=a.fLogz;this.pad.fUxmin=a.fUxmin;this.pad.fUxmax=a.fUxmax;this.pad.fUymin=a.fUymin;this.pad.fUymax=a.fUymax;this.pad.fX1=a.fX1;this.pad.fX2=a.fX2;this.pad.fY1=a.fY1;this.pad.fY2=a.fY2;this.pad.fLeftMargin=a.fLeftMargin;this.pad.fRightMargin=a.fRightMargin;this.pad.fBottomMargin=a.fBottomMargin;this.pad.fTopMargin=a.fTopMargin;this.pad.fFillColor=a.fFillColor;this.pad.fFillStyle=a.fFillStyle;this.pad.fLineColor=a.fLineColor;this.pad.fLineStyle=a.fLineStyle;this.pad.fLineWidth=a.fLineWidth;
this.pad.fPhi=a.fPhi;this.pad.fTheta=a.fTheta;this.iscan&&this.CheckSpecialsInPrimitives(a);var b=this.frame_painter();b&&b.UpdateAttributes(!b.modified_NDC);if(!a.fPrimitives)return!1;b=!1;for(var c=0,d=0;d<a.fPrimitives.arr.length;++d)for(;c<this.painters.length;){var e=this.painters[c++];if(e._primitive){e.UpdateObject(a.fPrimitives.arr[d])&&(b=!0);break}}return b};p.prototype.DrawNextSnap=function(a,b,c,d){-1===b&&(this._doing_pad_draw=!0,this._snaps_map={},this._num_primitives=a?a.length:0);
for(;;){if(d&&a&&a[b]&&void 0===d.snapid){var e=this.painters.indexOf(d);0>e&&this.painters.push(d);d.snapid=a[b].fObjectID;d.$primary&&0<e&&this.painters[e-1].$secondary&&(this.painters[e-1].snapid=d.snapid+"#hist",console.log("ASSIGN SECONDARY HIST ID",this.painters[e-1].snapid))}d=null;++b;if(!a||b>=a.length)return delete this._doing_pad_draw,delete this._snaps_map,delete this._current_primitive_indx,f.CallBack(c,this);e=a[b];var g=e.fObjectID,h=this._snaps_map[g];h?h++:h=1;this._snaps_map[g]=
h;this._current_primitive_indx=b;for(var k=0;k<this.painters.length;++k)if(this.painters[k].snapid===g&&0===--h){d=this.painters[k];break}var n=this.DrawNextSnap.bind(this,a,b,c);if(d)if(e.fKind===f.WebSnapIds.kObject)d.UpdateObject(e.fSnapshot,e.fOption)&&d.Redraw();else if(e.fKind===f.WebSnapIds.kSVG)d.UpdateObject(e.fSnapshot)&&d.Redraw();else{if(e.fKind===f.WebSnapIds.kSubPad)return d.RedrawPadSnap(e,n)}else if(e.fKind===f.WebSnapIds.kStyle)f.extend(f.gStyle,e.fSnapshot);else if(e.fKind===f.WebSnapIds.kColors){g=
[];k=e.fSnapshot.fOper.split(";");for(h=0;h<k.length;++h){var t=k[h],q=t.indexOf(":");0<q?g[parseInt(t.substr(0,q))]="rgb("+t.substr(q+1)+")":(q=t.indexOf("="),g[parseInt(t.substr(0,q))]="rgba("+t.substr(q+1)+")")}this.options&&!this.options.GlobalColors||f.Painter.adoptRootColors(g);this.options&&this.options.LocalColors&&(this.root_colors=f.Painter.extendRootColors(null,g));if(e.fSnapshot.fBuf&&(!this.options||!this.options.IgnorePalette)){k=[];for(h=0;h<e.fSnapshot.fBuf.length;++h)k[h]=g[Math.round(e.fSnapshot.fBuf[h])];
this.custom_palette=new f.ColorPalette(k)}}else{if(e.fKind===f.WebSnapIds.kSubPad){a=e.fSnapshot;a.fPrimitives=null;var r=new p(a,!1);r.DecodeOptions(e.fOption);r.SetDivId(this.divid);r.snapid=e.fObjectID;r.CreatePadSvg();r.MatchObjectType("TPad")&&0<e.fPrimitives.length&&(r.AddButton(f.ToolbarIcons.camera,"Create PNG","PadSnapShot"),r.AddButton(f.ToolbarIcons.circle,"Enlarge pad","EnlargePad"),f.gStyle.ContextMenu&&r.AddButton(f.ToolbarIcons.question,"Access context menus","PadContextMenus"));var l=
r.CurrentPadName(r.this_pad_name);r.DrawNextSnap(e.fPrimitives,-1,function(){r.CurrentPadName(l);n(r)});break}g={func:n};e.fKind===f.WebSnapIds.kObject&&(d=f.draw(this.divid,e.fSnapshot,e.fOption,g));e.fKind===f.WebSnapIds.kSVG&&(d=f.draw(this.divid,e.fSnapshot,e.fOption,g));if(!g.completed)break}}};p.prototype.FindSnap=function(a){if(this.snapid===a)return this;if(!this.painters)return null;for(var b=0;b<this.painters.length;++b){var c=this.painters[b];"function"===typeof c.FindSnap?c=c.FindSnap(a):
c.snapid!==a&&(c=null);if(c)return c}return null};p.prototype.AddOnlineButtons=function(){this.AddButton(f.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");f.gStyle.ContextMenu&&this.AddButton(f.ToolbarIcons.question,"Access context menus","PadContextMenus");this.enlarge_main("verify")&&this.AddButton(f.ToolbarIcons.circle,"Enlarge canvas","EnlargePad");this.brlayout&&(this.AddButton(f.ToolbarIcons.diamand,"Toggle Ged","ToggleGed"),this.AddButton(f.ToolbarIcons.three_circles,
"Toggle Status","ToggleStatus"))};p.prototype.RedrawPadSnap=function(a,b){function c(a,b,c,d){for(var e,f,g=0;g<a.length;++g)if(void 0!==a[g].snapid&&a[g].MatchObjectType(c)&&(!d||a[g].GetObject()&&a[g].GetObject().fName===d)){e=a[g];break}if(e){for(g=0;g<b.length;++g)if(1===b[g].fKind&&b[g].fSnapshot&&b[g].fSnapshot._typename===c&&(!d||b[g].fSnapshot.fName===d)){f=b[g];break}f&&e.snapid!==f.fObjectID&&(e.snapid=f.fObjectID)}}if(a&&a.fPrimitives){this.is_active_pad=!!a.fActive;this._readonly=void 0===
a.fReadOnly?!0:a.fReadOnly;var d=a.fSnapshot;d.fPrimitives=null;if(void 0===this.snapid)this.snapid=a.fObjectID,this.pad=this.draw_object=d,!this.batch_mode||d.fCw&&d.fCh||(d.fCw=900,d.fCh=700),d.fCw&&d.fCh||(this._fixed_size=!1),!f.BrowserLayout||this.batch_mode||this.use_openui||this.brlayout||((d=this.divid)&&"object"==typeof d&&(d=l.select(d).attr("id")),d&&"string"==typeof d&&(this.brlayout=new f.BrowserLayout(d,null,this),this.brlayout.Create(d,!0),this.SetDivId(this.brlayout.drawing_divid(),
-1),f.RegisterForResize(this.brlayout))),this.CreateCanvasSvg(0),this.SetDivId(this.divid),this.batch_mode||this.AddOnlineButtons(),this.DrawNextSnap(a.fPrimitives,-1,b);else{this.UpdateObject(d);this.iscan?this.CreateCanvasSvg(2):this.CreatePadSvg(!0);var e=!1,g=!1;c(this.painters,a.fPrimitives,"TFrame");c(this.painters,a.fPrimitives,"TPaveText","title");for(d=0;d<this.painters.length;++d){var h=this.painters[d];if(void 0!==h.snapid&&!h.$secondary){for(var k=0;k<a.fPrimitives.length;++k)if(a.fPrimitives[k].fObjectID===
h.snapid){h=null;e=!0;break}h&&(console.log("Remove painter"+d+" from "+this.painters.length+" "+h.GetObject()._typename),this.painters.splice(d--,1),h.Cleanup(),g=!0)}}g&&delete this.pads_cache;if(!e){d=this.svg_pad(this.this_pad_name);e=this.frame_painter();d&&!d.empty()&&d.property("mainpainter",null);for(d=0;d<this.painters.length;++d)e!==this.painters[d]&&this.painters[d].Cleanup();this.painters=[];e&&(this.painters.push(e),e.CleanFrameDrawings());this.RemoveButtons();this.AddOnlineButtons()}var n=
this,t=n.CurrentPadName(n.this_pad_name);n.DrawNextSnap(a.fPrimitives,-1,function(){n.CurrentPadName(t);f.CallBack(b,n)})}}};p.prototype.CreateImage=function(a,b){"pdf"==a?f.CallBack(b,btoa("dummy PDF file")):"png"==a||"jpeg"==a||"svg"==a?this.ProduceImage(!0,a,function(c){if("svg"==a||!c)return f.CallBack(b,c);var d=c.indexOf("base64,");f.CallBack(b,0<d?c.substr(d+7):"")}):f.CallBack(b,"")};p.prototype.GetWebPadOptions=function(a){var b=void 0===a,c=null,d=!0;if(b&&this._readonly)return"";"only_this"===
a&&(b=!0,d=!1);b&&(a=[]);this.snapid&&(c={_typename:"TWebPadOptions",snapid:this.snapid.toString(),active:!!this.is_active_pad,bits:0,primitives:[],logx:this.pad.fLogx,logy:this.pad.fLogy,logz:this.pad.fLogz,gridx:this.pad.fGridx,gridy:this.pad.fGridy,tickx:this.pad.fTickx,ticky:this.pad.fTicky,mleft:this.pad.fLeftMargin,mright:this.pad.fRightMargin,mtop:this.pad.fTopMargin,mbottom:this.pad.fBottomMargin,zx1:0,zx2:0,zy1:0,zy2:0,zz1:0,zz2:0},this.iscan&&(c.bits=this.GetStatusBits()),this.GetPadRanges(c)?
a.push(c):console.log("fail to get ranges for pad "+this.pad.fName));for(var e=0;e<this.painters.length;++e){var g=this.painters[e];if("function"==typeof g.GetWebPadOptions)d&&g.GetWebPadOptions(a);else if(g.snapid){var h={_typename:"TWebObjectOptions",snapid:g.snapid.toString(),opt:g.OptionsAsString(),fcust:"",fopt:[]};"function"==typeof g.FillWebObjectOptions&&(h=g.FillWebObjectOptions(h));c.primitives.push(h)}}if(b)return f.toJSON(a)};p.prototype.GetPadRanges=function(a){function b(a,b,c){return Math.abs(b-
a)<1E-10*Math.abs(c)?b:a}if(!a)return!1;var c=this.frame_painter_ref,d=this.svg_pad(this.this_pad_name);a.ranges=c&&c.ranges_set?!0:!1;a.ux1=a.px1=a.ranges?c.scale_xmin:0;a.uy1=a.py1=a.ranges?c.scale_ymin:0;a.ux2=a.px2=a.ranges?c.scale_xmax:0;a.uy2=a.py2=a.ranges?c.scale_ymax:0;c.zoom_xmin!==c.zoom_xmax&&(a.zx1=c.zoom_xmin,a.zx2=c.zoom_xmax);c.zoom_ymin!==c.zoom_ymax&&(a.zy1=c.zoom_ymin,a.zy2=c.zoom_ymax);c.zoom_zmin!==c.zoom_zmax&&(a.zz1=c.zoom_zmin,a.zz2=c.zoom_zmax);if(!a.ranges||d.empty())return!0;
var e=function(a){return a},g=function(a){return Math.pow(10,a)},h=c.logx?f.log10:e,k=c.logx?g:e,n=(h(c.scale_xmax)-h(c.scale_xmin))/d.property("draw_width");h=h(c.scale_xmin)-n*d.property("draw_x");n=h+n*d.property("draw_width");a.ux1=b(k(h),a.ux1,a.px2-a.px1);a.ux2=b(k(n),a.ux2,a.px2-a.px1);h=c.logy?f.log10:e;k=c.logy?g:e;n=(h(c.scale_ymax)-h(c.scale_ymin))/d.property("draw_height");c=h(c.scale_ymax)+n*d.property("draw_y");d=c-n*d.property("draw_height");a.uy1=b(k(d),a.uy1,a.py2-a.py1);a.uy2=b(k(c),
a.uy2,a.py2-a.py1);return!0};p.prototype.ItemContextMenu=function(a){var b=this.svg_pad(this.this_pad_name).node().getBoundingClientRect(),c={clientX:b.left+10,clientY:b.top+10};if("pad"==a)return setTimeout(this.ShowContextMenu.bind(this,c),50);var d=null;switch(a){case "xaxis":case "yaxis":case "zaxis":d=this.frame_painter_ref;var e=a[0];break;case "frame":d=this.frame_painter_ref;break;default:a=parseInt(a),isNaN(a)||(d=this.painters[a])}d&&"function"===typeof d.FillContextMenu&&f.Painter.createMenu(d,
function(a){d.FillContextMenu(a,e)&&setTimeout(a.show.bind(a,c),50)})};p.prototype.SaveAs=function(a,b,c){c||(c=this.this_pad_name,0===c.length&&(c=this.iscan?"canvas":"pad"),c+="."+a);this.ProduceImage(b,a,function(b){var d=document.createElement("a");d.download=c;d.href="svg"!=a?b:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(b);document.body.appendChild(d);d.addEventListener("click",function(a){d.parentNode.removeChild(d)});d.click()})};p.prototype.ProduceImage=function(a,b,c){function d(a){for(var b=
0;b<h.length;++b){var d=h[b];d.img&&d.img.remove();var e=d.prnt.select(".primitives_layer");d.foreign&&d.prnt.node().insertBefore(d.foreign.node(),e.node());d.frame_node&&e.node().insertBefore(d.frame_node,d.frame_next);d.btns_node&&d.btns_prnt.insertBefore(d.btns_node,d.btns_next)}f.CallBack(c,a)}var e="frame"===a,g=e?this.svg_frame():a?this.svg_canvas():this.svg_pad(this.this_pad_name);if(g.empty())return f.CallBack(c);a=a&&!e?this.canv_painter():this;var h=[];e||a.ForEachPainterInPad(function(a){var b=
{prnt:a.svg_pad(a.this_pad_name)};h.push(b);var c=a.svg_layer("btns_layer",a.this_pad_name);b.btns_node=c.node();b.btns_node&&(b.btns_prnt=b.btns_node.parentNode,b.btns_next=b.btns_node.nextSibling,c.remove());if((c=a.frame_painter_ref)&&"function"===typeof c.Render3D){var d=c.access_3d_kind();if(1===d||2===d){a=c.size_for_3d(2);var e=2==d?e:c.size_for_3d(1);e=c.renderer.domElement;c.Render3D(0);var f=e.toDataURL("image/png");2==d&&(b.foreign=b.prnt.select("."+a.clname),b.foreign.remove());c=c.svg_frame();
b.frame_node=c.node();b.frame_node&&(b.frame_next=b.frame_node.nextSibling,c.remove());b.img=b.prnt.insert("image",".primitives_layer").attr("x",a.x).attr("y",a.y).attr("width",e.width).attr("height",e.height).attr("href",f)}}},"pads");a=g.property("draw_width");var k=g.property("draw_height");e&&(a=this.frame_width(),k=this.frame_height());e='<svg width="'+a+'" height="'+k+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+g.node().innerHTML+"</svg>";if("svg"==b)return d(e);
var n=new Image;n.onload=function(){var a=document.createElement("canvas");a.width=n.width;a.height=n.height;a.getContext("2d").drawImage(n,0,0);d(a.toDataURL("image/"+b))};n.onerror=function(a){console.log("IMAGE ERROR",a);d(null)};n.src="data:image/svg+xml;base64,"+window.btoa(function(a){a=encodeURIComponent(a);a=a.replace(/%([0-9A-F]{2})/g,function(a,b){a=String.fromCharCode("0x"+b);return"%"===a?"%25":a});return decodeURIComponent(a)}('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+
e))};p.prototype.PadButtonClick=function(a){if("CanvasSnapShot"==a)return this.SaveAs("png",!0);if("EnlargePad"==a)return this.EnlargePad();if("PadSnapShot"==a)return this.SaveAs("png",!1);if("PadContextMenus"==a){if(l.event.preventDefault(),l.event.stopPropagation(),!f.Painter.closeMenu()){var b=this,c=l.event;f.Painter.createMenu(b,function(a){a.add("header:Menus");b.iscan?a.add("Canvas","pad",b.ItemContextMenu):a.add("Pad","pad",b.ItemContextMenu);b.frame_painter()&&a.add("Frame","frame",b.ItemContextMenu);
var d=b.main_painter();d&&(a.add("X axis","xaxis",b.ItemContextMenu),a.add("Y axis","yaxis",b.ItemContextMenu),"function"===typeof d.Dimension&&1<d.Dimension()&&a.add("Z axis","zaxis",b.ItemContextMenu));if(b.painters&&0<b.painters.length){a.add("separator");d=[];for(var e=0;e<b.painters.length;++e){var f=b.painters[e];if((f=f?f.GetObject():null)&&!(0<=d.indexOf(f))){var g="_typename"in f?f._typename+"::":"";"fName"in f&&(g+=f.fName);0==g.length&&(g="item"+e);a.add(g,e,b.ItemContextMenu)}}}a.show(c)})}}else for(var d=
!1,e=0;e<this.painters.length;++e){var g=this.painters[e];"function"==typeof g.PadButtonClick&&g.PadButtonClick(a);d||"function"!=typeof g.ButtonClick||(d=g.ButtonClick(a))}};p.prototype.FindButton=function(a){var b=this.svg_layer("btns_layer",this.this_pad_name),c="";b.empty()||b.selectAll("svg").each(function(){l.select(this).attr("key")===a&&(c=l.select(this).attr("name"))});return c};p.prototype.toggleButtonsVisibility=function(a){var b=this.svg_layer("btns_layer",this.this_pad_name),c=b.select("[name='Toggle']");
if(!c.empty()){var d=c.property("buttons_state");c.property("timout_handler")&&("timeout"!==a&&clearTimeout(c.property("timout_handler")),c.property("timout_handler",null));var e=!1;switch(a){case "enable":e=!0;break;case "enterbtn":return;case "timeout":e=!1;break;case "toggle":d=!d;c.property("buttons_state",d);e=d;break;case "disable":case "leavebtn":d||c.property("timout_handler",setTimeout(this.toggleButtonsVisibility.bind(this,"timeout"),500));return}b.selectAll("svg").each(function(){this!==
c.node()&&l.select(this).style("display",e?"":"none")})}};p.prototype.RemoveButtons=function(){var a=this.svg_layer("btns_layer",this.this_pad_name);a.empty()||(a.selectAll("*").remove(),a.property("nextx",null))};p.prototype.AddButton=function(a,b,c,d){if(f.gStyle.ToolBar){this._buttons||(this._buttons=[]);for(var e=0;e<this._buttons.length;++e)if(this._buttons[e].funcname==c)return;this._buttons.push({btn:a,tooltip:b,funcname:c,keyname:d});!this.iscan&&this.has_canvas&&0!=c.indexOf("Pad")&&"EnlargePad"!==
c&&(d=this.canv_painter())&&d!==this&&d.AddButton(a,b,c)}};p.prototype.ShowButtons=function(){if(this._buttons){var a=this.svg_layer("btns_layer",this.this_pad_name);if(!a.empty()){a.selectAll("*").remove();var b=this.iscan||!this.has_canvas,c=a.property("leftside")?this.ButtonSize(1.25):0;if(this._fast_drawing){var d=f.ToolbarIcons.CreateSVG(a,f.ToolbarIcons.circle,this.ButtonSize(),"EnlargePad");d.attr("name","Enlarge").attr("x",0).attr("y",0).on("click",this.PadButtonClick.bind(this,"EnlargePad"))}else{d=
f.ToolbarIcons.CreateSVG(a,f.ToolbarIcons.rect,this.ButtonSize(),"Toggle tool buttons");d.attr("name","Toggle").attr("x",0).attr("y",0).property("buttons_state","popup"!==f.gStyle.ToolBar).on("click",this.toggleButtonsVisibility.bind(this,"toggle")).on("mouseenter",this.toggleButtonsVisibility.bind(this,"enable")).on("mouseleave",this.toggleButtonsVisibility.bind(this,"disable"));for(var e=0;e<this._buttons.length;++e){var g=this._buttons[e],h=f.ToolbarIcons.CreateSVG(a,g.btn,this.ButtonSize(),g.tooltip+
(b?"":" on pad "+this.this_pad_name)+(g.keyname?" (keyshortcut "+g.keyname+")":""));a.property("vertical")?h.attr("x",0).attr("y",c):h.attr("x",c).attr("y",0);h.attr("name",g.funcname).style("display",d.property("buttons_state")?"":"none").on("mouseenter",this.toggleButtonsVisibility.bind(this,"enterbtn")).on("mouseleave",this.toggleButtonsVisibility.bind(this,"leavebtn"));g.keyname&&h.attr("key",g.keyname);h.on("click",this.PadButtonClick.bind(this,g.funcname));c+=this.ButtonSize(1.25)}}a.property("nextx",
c);this.AlignBtns(a,this.pad_width(this.this_pad_name),this.pad_height(this.this_pad_name));a.property("vertical")?d.attr("y",c):a.property("leftside")||d.attr("x",c)}}};p.prototype.AlignBtns=function(a,b,c,d){d=this.ButtonSize(1.25);var e=(a.property("nextx")||0)+d;a.property("vertical")?(b=a.property("leftside")?2:b-d,c-=e):(b=a.property("leftside")?2:b-e,c-=d);a.attr("transform","translate("+b+","+c+")")};p.prototype.DrawingReady=function(a){var b=this.frame_painter_ref;b&&b.mode3d&&"function"==
typeof b.Render3D&&b.Render3D(-2222);f.TObjectPainter.prototype.DrawingReady.call(this,a)};p.prototype.DecodeOptions=function(a){var b=this.GetObject();if(b){var c=new f.DrawOptions(a);c.check("WEBSOCKET")&&this.OpenWebsocket();this.options||(this.options={});f.extend(this.options,{GlobalColors:!0,LocalColors:!1,CreatePalette:0,IgnorePalette:!1,RotateFrame:!1,FixFrame:!1});if(c.check("NOCOLORS")||c.check("NOCOL"))this.options.GlobalColors=this.options.LocalColors=!1;if(c.check("LCOLORS")||c.check("LCOL"))this.options.GlobalColors=
!1,this.options.LocalColors=!0;if(c.check("NOPALETTE")||c.check("NOPAL"))this.options.IgnorePalette=!0;c.check("ROTATE")&&(this.options.RotateFrame=!0);c.check("FIXFRAME")&&(this.options.FixFrame=!0);c.check("CP",!0)&&(this.options.CreatePalette=c.partAsInt(0,0));c.check("WHITE")&&(b.fFillColor=0);c.check("LOGX")&&(b.fLogx=1,b.fUxmin=0,b.fUxmax=1,b.fX1=0,b.fX2=1);c.check("LOGY")&&(b.fLogy=1,b.fUymin=0,b.fUymax=1,b.fY1=0,b.fY2=1);c.check("LOGZ")&&(b.fLogz=1);c.check("LOG")&&(b.fLogx=b.fLogy=b.fLogz=
1);c.check("GRIDX")&&(b.fGridx=1);c.check("GRIDY")&&(b.fGridy=1);c.check("GRID")&&(b.fGridx=b.fGridy=1);c.check("TICKX")&&(b.fTickx=1);c.check("TICKY")&&(b.fTicky=1);c.check("TICK")&&(b.fTickx=b.fTicky=1);this.OptionsStore(a)}};u.prototype=Object.create(p.prototype);u.prototype.ChangeLayout=function(a,b){if(this.get_layout_kind()==a)return f.CallBack(b,!0);for(var c=this.select_main("origin"),d=c.select(".side_panel"),e=this.select_main(),g=[];e.node().firstChild;)g.push(e.node().removeChild(e.node().firstChild));
d.empty()||f.cleanup(d.node());this.set_layout_kind("simple");c.html("");if("simple"==a){e=c;for(var h=0;h<g.length;++h)e.node().appendChild(g[h]);this.set_layout_kind(a);f.resize(e.node());return f.CallBack(b,!0)}var k=this;f.AssertPrerequisites("jq2d",function(){var h=new f.GridDisplay(c.node(),a);0==a.indexOf("vert")?(e=l.select(h.GetFrame(0)),d=l.select(h.GetFrame(1))):(e=l.select(h.GetFrame(1)),d=l.select(h.GetFrame(0)));e.classed("central_panel",!0).style("position","relative");d.classed("side_panel",
!0).style("position","relative");for(h=0;h<g.length;++h)e.node().appendChild(g[h]);k.set_layout_kind(a,".central_panel");c.property("mdi",null);f.resize(e.node());f.CallBack(b,!0)})};u.prototype.ToggleProjection=function(a,b){delete this.proj_painter;a&&(this.proj_painter=1);if(this.ShowUI5ProjectionArea)return this.ShowUI5ProjectionArea(a,b);var c="simple";"X"==a?c="vert2_31":"Y"==a&&(c="horiz2_13");this.ChangeLayout(c,b)};u.prototype.DrawProjection=function(a,b){if(this.proj_painter)if(1===this.proj_painter){var c=
f.Create("TCanvas"),d=this,e=this.root_pad(),g=this.frame_painter_ref;"X"==a?(c.fLeftMargin=e.fLeftMargin,c.fRightMargin=e.fRightMargin,c.fLogx=g.logx?1:0,c.fUxmin=g.logx?f.log10(g.scale_xmin):g.scale_xmin,c.fUxmax=g.logx?f.log10(g.scale_xmax):g.scale_xmax,a="fixframe"):(c.fBottomMargin=e.fBottomMargin,c.fTopMargin=e.fTopMargin,c.fLogx=g.logy?1:0,c.fUxmin=g.logy?f.log10(g.scale_ymin):g.scale_ymin,c.fUxmax=g.logy?f.log10(g.scale_ymax):g.scale_ymax,a="rotate");c.fPrimitives.Add(b,"hist");this.DrawInUI5ProjectionArea?
this.DrawInUI5ProjectionArea(c,a,function(a){d.proj_painter=a}):this.DrawInSidePanel(c,a,function(a){d.proj_painter=a})}else(c=this.proj_painter.main_painter())&&c.UpdateObject(b,"hist"),this.proj_painter.RedrawPad()};u.prototype.DrawInSidePanel=function(a,b,c){var d=this.select_main("origin").select(".side_panel");if(d.empty())return f.CallBack(c,null);f.draw(d.node(),a,b,c)};u.prototype.ShowMessage=function(a){this.testUI5()||f.progress(a,7E3)};u.prototype.SaveCanvasAsFile=function(a){var b=this,
c=a.indexOf(".");this.CreateImage(a.substr(c+1),function(c){b.SendWebsocket("SAVE:"+a+":"+c)})};u.prototype.SendSaveCommand=function(a){this.SendWebsocket("PRODUCE:"+a)};u.prototype.WindowBeforeUnloadHanlder=function(){this.CloseWebsocket(!0)};u.prototype.SendWebsocket=function(a){this._websocket&&(this._websocket.CanSend()?this._websocket.Send(a):console.warn("DROP SEND: "+a))};u.prototype.CloseWebsocket=function(a){this._websocket&&(this._websocket.Close(a),this._websocket.Cleanup(),delete this._websocket)};
u.prototype.OpenWebsocket=function(a){this.CloseWebsocket();this._websocket=new f.WebWindowHandle(a);this._websocket.SetReceiver(this);this._websocket.Connect()};u.prototype.UseWebsocket=function(a){this.CloseWebsocket();this._websocket=a;this._websocket.SetReceiver(this);this._websocket.Connect()};u.prototype.OnWebsocketOpened=function(a){};u.prototype.OnWebsocketClosed=function(a){f.CloseCurrentWindow()};u.prototype.OnWebsocketMsg=function(a,b){console.log("GET MSG len:"+b.length+" "+b.substr(0,
60));if("CLOSE"==b)this.OnWebsocketClosed(),this.CloseWebsocket(!0);else if("SNAP6:"==b.substr(0,6)){var c=f.parse(b.substr(6)),d=this;this.RedrawPadSnap(c,function(){d.CompeteCanvasSnapDrawing();var b=d.GetWebPadOptions();b&&(b=":"+b);a.Send("READY6:"+c.fVersion+b)})}else if("MENU:"==b.substr(0,5))b=f.parse(b.substr(5)),"function"==typeof this._getmenu_callback&&this._getmenu_callback(b);else if("CMD:"==b.substr(0,4)){b=b.substr(4);var e=b.indexOf(":"),g=b.substr(0,e);b=b.substr(e+1);var h="REPLY:"+
g+":";"SVG"==b||"PNG"==b||"JPEG"==b?this.CreateImage(b.toLowerCase(),function(b){a.Send(h+b)}):(console.log("Unrecognized command "+b),a.Send(h))}else"DXPROJ:"==b.substr(0,7)||"DYPROJ:"==b.substr(0,7)?(g=b[1],b=f.parse(b.substr(7)),this.DrawProjection(g,b)):"SHOW:"==b.substr(0,5)?(b=b.substr(5),g="1"==b[b.length-1],this.ShowSection(b.substr(0,b.length-2),g)):"EDIT:"==b.substr(0,5)?(g=this.FindSnap(b.substr(5)),console.log("GET EDIT "+b.substr(5)+" found "+!!g),g&&(this.ShowSection("Editor",!0),this.pad_events_receiver&&
this.pad_events_receiver({what:"select",padpainter:this,painter:g}))):console.log("unrecognized msg "+b)};u.prototype.PadButtonClick=function(a){if("ToggleGed"==a)return this.ActivateGed(this,null,"toggle");if("ToggleStatus"==a)return this.ActivateStatusBar("toggle");p.prototype.PadButtonClick.call(this,a)};u.prototype.testUI5=function(){if(!this.use_openui)return!1;console.warn("full ui5 should be used - not loaded yet? Please check!!");return!0};u.prototype.HasEventStatus=function(){return this.testUI5()?
!1:this.brlayout?this.brlayout.HasStatus():!1};u.prototype.ActivateStatusBar=function(a){this.testUI5()||(this.brlayout&&this.brlayout.CreateStatusLine(23,a),this.ProcessChanges("sbits",this))};u.prototype.HasGed=function(){return this.testUI5()?!1:this.brlayout?this.brlayout.HasContent():!1};u.prototype.RemoveGed=function(){this.testUI5()||(this.RegisterForPadEvents(null),this.ged_view&&(this.ged_view.getController().cleanupGed(),this.ged_view.destroy(),delete this.ged_view),this.brlayout&&this.brlayout.DeleteContent(),
this.ProcessChanges("sbits",this))};u.prototype.ActivateGed=function(a,b,c){if(!this.testUI5()&&this.brlayout){if(this.brlayout.HasContent())return"toggle"===c||!1===c?this.RemoveGed():this.SelectObjectPainter(a);if(!1!==c){c=this.brlayout.CreateBrowserBtns();f.ToolbarIcons.CreateSVG(c,f.ToolbarIcons.diamand,15,"toggle fix-pos mode").style("margin","3px").on("click",this.brlayout.Toggle.bind(this.brlayout,"fix"));f.ToolbarIcons.CreateSVG(c,f.ToolbarIcons.circle,15,"toggle float mode").style("margin",
"3px").on("click",this.brlayout.Toggle.bind(this.brlayout,"float"));f.ToolbarIcons.CreateSVG(c,f.ToolbarIcons.cross,15,"delete GED").style("margin","3px").on("click",this.RemoveGed.bind(this));this.brlayout.SetBrowserContent("<div class='jsroot_browser_hierarchy' id='ged_placeholder'>Loading GED ...</div>");this.brlayout.SetBrowserTitle("GED");this.brlayout.ToggleBrowserKind(b||"float");var d=this;f.AssertPrerequisites("openui5",function(){l.select("#ged_placeholder").text("");sap.ui.define(["sap/ui/model/json/JSONModel",
"sap/ui/core/mvc/XMLView"],function(b,c){var e=new b({handle:null});c.create({viewName:"rootui5.canv.view.Ged"}).then(function(b){b.setModel(e);b.placeAt("ged_placeholder");d.ged_view=b;d.RegisterForPadEvents(b.getController().padEventsReceiver.bind(b.getController()));d.SelectObjectPainter(a);d.ProcessChanges("sbits",d)})})})}}};u.prototype.ShowSection=function(a,b){if(!this.testUI5())switch(console.log("Show section "+a+" flag = "+b),a){case "StatusBar":this.ActivateStatusBar(b);break;case "Editor":this.ActivateGed(this,
null,!!b);break;case "ToolTips":this.SetTooltipAllowed(b)}};u.prototype.CompeteCanvasSnapDrawing=function(){this.pad&&(document&&(document.title=this.pad.fTitle),this._all_sections_showed||(this._all_sections_showed=!0,this.ShowSection("Menu",this.pad.TestBit(f.TCanvasStatusBits.kMenuBar)),this.ShowSection("StatusBar",this.pad.TestBit(f.TCanvasStatusBits.kShowEventStatus)),this.ShowSection("ToolBar",this.pad.TestBit(f.TCanvasStatusBits.kShowToolBar)),this.ShowSection("Editor",this.pad.TestBit(f.TCanvasStatusBits.kShowEditor)),
this.ShowSection("ToolTips",this.pad.TestBit(f.TCanvasStatusBits.kShowToolTips))))};u.prototype.ProcessChanges=function(a,b,c){if(this._websocket&&!this._readonly&&this._websocket.CanSend(2)&&"string"===typeof a){var d="";b||(b=this);switch(a){case "sbits":d="STATUSBITS:"+this.GetStatusBits();break;case "frame":case "zoom":b.GetWebPadOptions||(b=b.pad_painter());"function"==typeof b.GetWebPadOptions&&(d="OPTIONS6:"+b.GetWebPadOptions("only_this"));break;case "pave_moved":b.FillWebObjectOptions&&(a=
b.FillWebObjectOptions())&&(d="PRIMIT6:"+f.toJSON(a));break;default:"exec:"==a.substr(0,5)&&b&&b.snapid?d="PRIMIT6:"+f.toJSON({_typename:"TWebObjectOptions",snapid:b.snapid.toString()+(c?"#"+c:""),opt:a.substr(5),fcust:"exec",fopt:[]}):console.log("UNPROCESSED CHANGES",a)}d&&(console.log("Sending "+d.length+"  "+d.substr(0,40)),this._websocket.Send(d))}};u.prototype.SelectActivePad=function(a,b,c){if(void 0!==this.snapid&&a){var d=null,e=!1;void 0!==a.snapid&&this._websocket&&(d={_typename:"TWebPadClick",
padid:a.snapid.toString(),objid:"",x:-1,y:-1,dbl:!1});a.is_active_pad||(e=!0,this.ForEachPainterInPad(function(b){b.DrawActiveBorder(null,b===a)},"pads"));b&&void 0!==b.snapid&&d&&(e=!0,d.objid=b.snapid.toString());c&&d&&(e=!0,d.x=Math.round(c.x||0),d.y=Math.round(c.y||0),c.dbl&&(d.dbl=!0));d&&e&&this.SendWebsocket("PADCLICKED:"+f.toJSON(d))}};u.prototype.GetStatusBits=function(){var a=0;this.HasEventStatus()&&(a|=f.TCanvasStatusBits.kShowEventStatus);this.HasGed()&&(a|=f.TCanvasStatusBits.kShowEditor);
this.IsTooltipAllowed()&&(a|=f.TCanvasStatusBits.kShowToolTips);this.use_openui&&(a|=f.TCanvasStatusBits.kMenuBar);return a};u.prototype.ProduceJSON=function(){var a=this.GetObject(),b=0==a.fFillStyle;b&&(a.fFillStyle=1001);this.normal_canvas||this.ForEachPainterInPad(function(b){if(!b.$secondary){var c=b.GetObject();c&&c._typename&&a.fPrimitives.Add(c,b.OptionsAsString())}},"objects");var c=f.toJSON(a);b&&(a.fFillStyle=0);this.normal_canvas||a.fPrimitives.Clear();return c};f.TAxisPainter=z;f.TFramePainter=
m;f.TPadPainter=p;f.TCanvasPainter=u;f.Painter.drawFrame=function(a,b,c){b=new m(b);"3d"==c&&(b.mode3d=!0);b.SetDivId(a,2);b.Redraw();return b.DrawingReady()};f.Painter.drawPad=function(a,b,c){var d=new p(b,!1);d.DecodeOptions(c);d.SetDivId(a);d.svg_canvas().empty()&&(d.has_canvas=!1,d.this_pad_name="");d.CreatePadSvg();!d.MatchObjectType("TPad")||d.has_canvas&&!d.HasObjectsToDraw()||(d.AddButton(f.ToolbarIcons.camera,"Create PNG","PadSnapShot"),(d.has_canvas&&d.HasObjectsToDraw()||d.enlarge_main("verify"))&&
d.AddButton(f.ToolbarIcons.circle,"Enlarge pad","EnlargePad"),f.gStyle.ContextMenu&&d.AddButton(f.ToolbarIcons.question,"Access context menus","PadContextMenus"));var e=d.has_canvas?d.CurrentPadName(d.this_pad_name):void 0;f.Painter.SelectActivePad({pp:d,active:!0});d.DrawPrimitives(0,function(){d.ShowButtons();d.CurrentPadName(e);d.DrawingReady()});return d};f.Painter.drawCanvas=function(a,b,c){var d=!b;d&&(b=f.Create("TCanvas"));var e=new u(b);e.DecodeOptions(c);e.normal_canvas=!d;e.SetDivId(a,
-1);e.CheckSpecialsInPrimitives(b);e.CreateCanvasSvg(0);e.SetDivId(a);e.AddButton(f.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");f.gStyle.ContextMenu&&e.AddButton(f.ToolbarIcons.question,"Access context menus","PadContextMenus");e.enlarge_main("verify")&&e.AddButton(f.ToolbarIcons.circle,"Enlarge canvas","EnlargePad");d&&0>c.indexOf("noframe")&&f.Painter.drawFrame(a,null);f.Painter.SelectActivePad({pp:e,active:!0});e.DrawPrimitives(0,function(){e.ShowButtons();e.DrawingReady()});
return e};f.Painter.drawPadSnapshot=function(a,b,c){c=f.Create("TCanvas");var d=new u(c);d.normal_canvas=!1;d.SetDivId(a,-1);d.AddButton(f.ToolbarIcons.camera,"Create PNG","CanvasSnapShot","Ctrl PrintScreen");f.gStyle.ContextMenu&&d.AddButton(f.ToolbarIcons.question,"Access context menus","PadContextMenus");d.enlarge_main("verify")&&d.AddButton(f.ToolbarIcons.circle,"Enlarge canvas","EnlargePad");d.RedrawPadSnap(b,function(){d.ShowButtons();d.DrawingReady()});return d};return f});
