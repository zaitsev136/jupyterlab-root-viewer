(function(f){if("function"===typeof define&&define.amd)define(["JSRootPainter","d3","JSRootMath"],f);else if("object"===typeof exports&&"undefined"!==typeof module)f(require("./JSRootCore.js"),require("d3"),require("./JSRootMath.js"));else{if("object"!=typeof d3)throw Error("This extension requires d3.v3.js","JSRootPainter.more.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.more.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined",
"JSRootPainter.more.js");f(JSROOT,d3)}})(function(f,t){function z(a){f.TObjectPainter.call(this,a);this.bins=null}function p(a){f.TObjectPainter.call(this,a);this.axes_draw=!1;this.bins=null;this.xmin=this.ymin=this.xmax=this.ymax=0;this.wheel_zoomy=!0;this.is_bent="TGraphBentErrors"==a._typename;this.has_errors="TGraphErrors"==a._typename||"TGraphAsymmErrors"==a._typename||this.is_bent||a._typename.match(/^RooHist/)}function A(a){f.TooltipHandler.call(this,a);this.$polargram=!0;this.zoom_rmin=this.zoom_rmax=
0}function x(a){f.TObjectPainter.call(this,a)}function r(a){f.TObjectPainter.call(this,a);this.bins=null}function B(a){f.TObjectPainter.call(this,a)}function C(a){f.TObjectPainter.call(this,a);this.fBoundary="Normal"}function y(a){f.TObjectPainter.call(this,a);this.firstpainter=null;this.autorange=!1;this.painters=[]}f.sources.push("more2d");z.prototype=Object.create(f.TObjectPainter.prototype);z.prototype.Eval=function(a){return this.GetObject().evalPar(a)};z.prototype.CreateBins=function(a){var b=
this.frame_painter(),c=0,d=0,e=this.GetObject();b&&!a&&(b.zoom_xmin!==b.zoom_xmax?(c=b.zoom_xmin,d=b.zoom_xmax):(c=b.xmin,d=b.xmax));if(0<e.fSave.length&&!this.nosave){b=e.fSave.length-2;a=e.fSave[b];var k=e.fSave[b+1];k=(k-a)/(b-1);for(var h=[],g=0;g<b;++g){var f=a+k*g;if(c===d||!(f+2*k<c||f-2*k>d)){var m=e.fSave[g];isNaN(m)||h.push({x:f,y:m})}}return h}a=e.fXmin;k=e.fXmax;var n=!1;c!==d&&(c>a&&(a=c),d<k&&(k=d));b&&b.logx&&0<a&&0<k&&(n=!0,a=Math.log(a),k=Math.log(k));b=Math.max(e.fNpx,101);k=(k-
a)/(b-1);h=[];for(g=0;g<b;g++)f=a+g*k,n&&(f=Math.exp(f)),m=this.Eval(f),isNaN(m)||h.push({x:f,y:m});return h};z.prototype.CreateDummyHisto=function(){var a=0,b=1,c=0,d=1,e=this.CreateBins(!0);e&&0<e.length&&(a=b=e[0].x,c=d=e[0].y,e.forEach(function(e){a=Math.min(e.x,a);b=Math.max(e.x,b);c=Math.min(e.y,c);d=Math.max(e.y,d)}),0<d&&(d*=1.05),0>c&&(c*=1.05));e=f.Create("TH1I");var k=this.GetObject();e.fName=k.fName+"_hist";e.fTitle=k.fTitle;e.fXaxis.fXmin=a;e.fXaxis.fXmax=b;e.fYaxis.fXmin=c;e.fYaxis.fXmax=
d;return e};z.prototype.ProcessTooltip=function(a){var b=!1;if(null===a||null===this.bins)b=!0;else if(0==this.bins.length||a.x<this.bins[0].grx||a.x>this.bins[this.bins.length-1].grx)b=!0;if(b)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;for(var c=1E5,d=-1,e=0;e<this.bins.length;++e)b=this.bins[e],b=Math.abs(b.grx-a.x),b<c&&(c=b,d=e);b=this.bins[d];e=this.draw_g.select(".tooltip_bin");c=this.lineatt.width+3;e.empty()&&(e=this.draw_g.append("svg:circle").attr("class",
"tooltip_bin").style("pointer-events","none").attr("r",c).call(this.lineatt.func).call(this.fillatt.func));c={name:this.GetObject().fName,title:this.GetObject().fTitle,x:b.grx,y:b.gry,color1:this.lineatt.color,color2:this.fillatt.fillcolor(),lines:[],exact:Math.abs(b.grx-a.x)<c&&Math.abs(b.gry-a.y)<c};c.changed=e.property("current_bin")!==d;c.menu=c.exact;c.menu_dist=Math.sqrt((b.grx-a.x)*(b.grx-a.x)+(b.gry-a.y)*(b.gry-a.y));c.changed&&e.attr("cx",b.grx).attr("cy",b.gry).property("current_bin",d);
a=this.GetTipName();0<a.length&&c.lines.push(a);(a=this.frame_painter())&&c.lines.push("x = "+a.AxisAsText("x",b.x)+" y = "+a.AxisAsText("y",b.y));return c};z.prototype.Redraw=function(){this.frame_width();var a=this.frame_height(),b=this.GetObject(),c=this.frame_painter(),d=this.main_painter();this.GetTipName("\n");this.CreateG(!0);this.bins=this.CreateBins(!1);this.createAttLine({attr:b});this.lineatt.used=!1;this.createAttFill({attr:b,kind:1});this.fillatt.used=!1;for(b=0;b<this.bins.length;++b){var e=
this.bins[b];e.grx=c.grx(e.x);e.gry=c.gry(e.y)}2<this.bins.length&&(b=a,void 0!==d.hmin&&0<=d.hmin&&(b=Math.round(c.gry(0)),b>a||0>b)&&(b=a),a=f.Painter.BuildSvgPath("bezier",this.bins,b,2),"none"!=this.lineatt.color&&this.draw_g.append("svg:path").attr("class","line").attr("d",a.path).style("fill","none").call(this.lineatt.func),this.fillatt.empty()||this.draw_g.append("svg:path").attr("class","area").attr("d",a.path+a.close).style("stroke","none").call(this.fillatt.func))};z.prototype.CanZoomIn=
function(a,b,c){if("x"!==a)return!1;a=this.GetObject();if(0<a.fSave.length){var d=a.fNpx;return Math.abs(a.fSave[d+1]-a.fSave[d+2])/d<Math.abs(b-c)}return!0};z.prototype.PerformDraw=function(){if(null===this.main_painter()){var a=this.CreateDummyHisto(),b=this;f.draw(this.divid,a,"AXIS",function(a){b.SetDivId(b.divid);b.Redraw();return b.DrawingReady()});return b}this.SetDivId(this.divid);this.Redraw();return this.DrawingReady()};p.prototype=Object.create(f.TObjectPainter.prototype);p.prototype.Redraw=
function(){this.DrawBins()};p.prototype.DecodeOptions=function(a){a||(a=this.main_painter()?"lp":"alp");"string"==typeof a&&0==a.indexOf("same ")&&(a=a.substr(5));var b=this.GetObject(),c=new f.DrawOptions(a);this.options||(this.options={});f.extend(this.options,{Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,NoOpt:0,MainError:1,Ends:1,Axis:"",PadStats:!1,PadTitle:!1,original:a});a=this.options;a.PadStats=c.check("USE_PAD_STATS");a.PadTitle=c.check("USE_PAD_TITLE");a._pfc=c.check("PFC");
a._plc=c.check("PLC");a._pmc=c.check("PMC");c.check("NOOPT")&&(a.NoOpt=1);c.check("L")&&(a.Line=1);c.check("F")&&(a.Fill=1);c.check("A")&&(a.Axis=c.check("I")?"A":"AXIS");c.check("X+")&&(a.Axis+="X+");c.check("Y+")&&(a.Axis+="Y+");c.check("RX")&&(a.Axis+="RX");c.check("RY")&&(a.Axis+="RY");c.check("C")&&(a.Curve=a.Line=1);c.check("*")&&(a.Mark=103);c.check("P0")&&(a.Mark=104);c.check("P")&&(a.Mark=1);c.check("B")&&(a.Bar=1,a.Errors=0);c.check("Z")&&(a.Errors=1,a.Ends=0);c.check("||")&&(a.Errors=1,
a.MainError=0,a.Ends=1);c.check("[]")&&(a.Errors=1,a.MainError=0,a.Ends=2);c.check("|>")&&(a.Errors=1,a.Ends=3);c.check(">")&&(a.Errors=1,a.Ends=4);c.check("0")&&(a.Mark=1,a.Errors=1,a.OutRange=1);c.check("1")&&1==a.Bar&&(a.Bar=2);c.check("2")&&(a.Rect=1,a.Errors=0);c.check("3")&&(a.EF=1,a.Errors=0);c.check("4")&&(a.EF=2,a.Errors=0);c.check("5")&&(a.Rect=2,a.Errors=0);c.check("X")&&(a.Errors=0);void 0===a.Errors&&(a.Errors=this.has_errors?1:0);1==a.Mark&&1==b.fMarkerStyle&&(a.Mark=101);0==a.Line+
a.Fill+a.Mark+a.Bar+a.EF+a.Rect+a.Errors&&c.empty()&&(a.Line=1);"TGraphErrors"==b._typename&&1E-300>t.max(b.fEX)&&1E-300>t.max(b.fEY)&&(a.Errors=0);if(a.Axis)0>a.Axis.indexOf("A")&&(a.Axis="AXIS,"+a.Axis);else if(c=this.root_pad(),!c||c.fPrimitives&&c.fPrimitives.arr[0]===b)a.Axis="AXIS";a.PadTitle&&(a.Axis+=";USE_PAD_TITLE");a.HOptions=a.Axis};p.prototype.CreateBins=function(){var a=this.GetObject();if(a){var b=0,c=a.fNpoints;"TCutG"===a._typename&&3<c&&c--;if("TGraphErrors"==a._typename)b=1;else if("TGraphAsymmErrors"==
a._typename||"TGraphBentErrors"==a._typename||a._typename.match(/^RooHist/))b=2;this.bins=[];for(var d=0;d<c;++d){var e={x:a.fX[d],y:a.fY[d],indx:d};switch(b){case 1:e.exlow=e.exhigh=a.fEX[d];e.eylow=e.eyhigh=a.fEY[d];break;case 2:e.exlow=a.fEXlow[d],e.exhigh=a.fEXhigh[d],e.eylow=a.fEYlow[d],e.eyhigh=a.fEYhigh[d]}this.bins.push(e);0===d&&(this.xmin=this.xmax=e.x,this.ymin=this.ymax=e.y);0<b?(this.xmin=Math.min(this.xmin,e.x-e.exlow,e.x+e.exhigh),this.xmax=Math.max(this.xmax,e.x-e.exlow,e.x+e.exhigh),
this.ymin=Math.min(this.ymin,e.y-e.eylow,e.y+e.eyhigh),this.ymax=Math.max(this.ymax,e.y-e.eylow,e.y+e.eyhigh)):(this.xmin=Math.min(this.xmin,e.x),this.xmax=Math.max(this.xmax,e.x),this.ymin=Math.min(this.ymin,e.y),this.ymax=Math.max(this.ymax,e.y))}}};p.prototype.CreateHistogram=function(a){var b=this.xmin,c=this.xmax,d=this.ymin,e=this.ymax,k=!0,h=!0;b>=c&&(c=b+1);d>=e&&(e=d+1);var g=.1*(c-b),l=.1*(e-d),m=b-g;g=c+g;var n=d-l;e+=l;this.options.HOptions=this.options.Axis+";ymin:"+n+";ymax:"+e;0>m&&
0<=b&&(m=.9*b);0<g&&0>=c&&(g=0);b=this.GetObject();-1111!=b.fMinimum&&(n=d=b.fMinimum);-1111!=b.fMaximum&&(e=b.fMaximum);0>n&&0<=d&&(n=.9*d);d=f.BIT(17);c=b.fHistogram;if(a)k=0<=a.indexOf("x"),h=0<=a.indexOf("y");else if(c){if(!b.TestBit(d))return c;b.InvertBit(d)}else b.fHistogram=c=f.CreateHistogram("TH1F",100),c.fName=b.fName+"_h",c.fTitle=b.fTitle,c.fBits|=f.TH1StatusBits.kNoStats,this._own_histogram=!0;k&&(c.fXaxis.fXmin=m,c.fXaxis.fXmax=g);h&&(c.fYaxis.fXmin=n,c.fYaxis.fXmax=e,c.fMinimum=n,
c.fMaximum=e);return c};p.prototype.UnzoomUserRange=function(a,b,c){c=this.GetObject();if(this._own_histogram||!c)return!1;c=c.fHistogram;if(!c)return!1;var d="";if(a&&c.fXaxis.fXmin>this.xmin||c.fXaxis.fXmax<this.xmax)d+="x";if(b&&c.fYaxis.fXmin>this.ymin||c.fYaxis.fXmax<this.ymax)d+="y";if(!d)return!1;this.CreateHistogram(d);(a=this.main_painter())&&a.CreateAxisFuncs(!1);return!0};p.prototype.CanOptimize=function(){return 0<f.gStyle.OptimizeDraw&&!this.options.NoOpt};p.prototype.OptimizeBins=function(a,
b){if(30>this.bins.length&&!b)return this.bins;var c=null;if("function"==typeof b)for(var d=0;d<this.bins.length;++d)b(this.bins[d],d)?c||(c=0==d?[]:this.bins.slice(0,d)):c&&c.push(this.bins[d]);c||(c=this.bins);a||(a=5E5);if(c.length<a||!this.CanOptimize())return c;a=Math.floor(c.length/a);2>a&&(a=2);b=[];for(d=0;d<c.length;d+=a)b.push(c[d]);return b};p.prototype.TooltipText=function(a){var b=this.frame_painter(),c=[];c.push(this.GetTipName());a&&b&&(c.push("x = "+b.AxisAsText("x",a.x)),c.push("y = "+
b.AxisAsText("y",a.y)),this.options.Errors&&"normal"==b.x_kind&&"exlow"in a&&(0!=a.exlow||0!=a.exhigh)&&c.push("error x = -"+b.AxisAsText("x",a.exlow)+"/+"+b.AxisAsText("x",a.exhigh)),(this.options.Errors||0<this.options.EF)&&"normal"==b.y_kind&&"eylow"in a&&(0!=a.eylow||0!=a.eyhigh)&&c.push("error y = -"+b.AxisAsText("y",a.eylow)+"/+"+b.AxisAsText("y",a.eyhigh)));return c};p.prototype.get_main=function(){var a=this.frame_painter();if(a&&a.grx&&a.gry)return a;a={pad_layer:!0,pad:this.root_pad(),pw:this.pad_width(),
ph:this.pad_height(),grx:function(a){a=this.pad.fLogx?0<a?f.log10(a):this.pad.fUxmin:(a-this.pad.fX1)/(this.pad.fX2-this.pad.fX1);return a*this.pw},gry:function(a){a=this.pad.fLogy?0<a?f.log10(a):this.pad.fUymin:(a-this.pad.fY1)/(this.pad.fY2-this.pad.fY1);return(1-a)*this.ph}};return a.pad?a:null};p.prototype.DrawBins=function(){var a=this,b=this.get_main(),c=this.frame_width(),d=this.frame_height(),e=this.GetObject(),k=0,h=this.pad_painter();if(b){this.CreateG(!b.pad_layer);h&&(this.options._pfc||
this.options._plc||this.options._pmc)&&(h=h.CreateAutoColor(this),this.options._pfc&&(e.fFillColor=h,delete this.fillatt),this.options._plc&&(e.fLineColor=h,delete this.lineatt),this.options._pmc&&(e.fMarkerColor=h,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1);this.createAttLine({attr:e,can_excl:!0});this.createAttFill({attr:e,kind:1});this.fillatt.used=!1;this.draw_kind="none";this.marker_size=0;0!=this.lineatt.excl_side&&(k=this.lineatt.excl_width,0<this.lineatt.width&&
(this.options.Line=1));h=null;if(this.options.EF){h=this.OptimizeBins(1<this.options.EF?5E3:0);for(var g=0;g<h.length;++g){var l=h[g];l.grx=b.grx(l.x);l.gry=b.gry(l.y-l.eylow)}var m=f.Painter.BuildSvgPath(1<this.options.EF?"bezier":"line",h),n=[];for(g=h.length-1;0<=g;--g)l=h[g],l.gry=b.gry(l.y+l.eyhigh),n.push(l);g=f.Painter.BuildSvgPath(1<this.options.EF?"Lbezier":"Lline",n);this.draw_g.append("svg:path").attr("d",m.path+g.path+"Z").style("stroke","none").call(this.fillatt.func);this.draw_kind=
"lines"}if(1==this.options.Line||1==this.options.Fill||0!==k){n="";"TCutG"==e._typename&&(this.options.Fill=1);1==this.options.Fill&&(n="Z",k=0);h||(h=this.OptimizeBins(this.options.Curve?5E3:0));for(g=0;g<h.length;++g)l=h[g],l.grx=b.grx(l.x),l.gry=b.gry(l.y);g="line";1===this.options.Curve?g="bezier":0!==k&&(g+="calc");m=f.Painter.BuildSvgPath(g,h);if(0!==k){var u=[];for(g=h.length-1;0<=g;--g){l=h[g];var E=Math.sqrt(l.dgrx*l.dgrx+l.dgry*l.dgry);l.grx+=k*l.dgry/E;l.gry-=k*l.dgrx/E;u.push(l)}g=f.Painter.BuildSvgPath("L"+
(1===this.options.Curve?"bezier":"line"),u);this.draw_g.append("svg:path").attr("d",m.path+g.path+"Z").style("stroke","none").call(this.fillatt.func).style("opacity",.75)}if(this.options.Line||this.options.Fill)g=this.draw_g.append("svg:path").attr("d",m.path+n),this.options.Line?g.call(this.lineatt.func):g.style("stroke","none"),this.options.Fill?g.call(this.fillatt.func):g.style("fill","none");this.draw_kind="lines"}k=null;if(this.options.Errors||this.options.Rect||this.options.Bar)h=this.OptimizeBins(5E3,
function(g,h){var k=b.grx(g.x);if(!a.options.Bar&&(0>k||k>c))return!0;var f=b.gry(g.y);if(!a.options.Bar&&!a.options.OutRange&&(0>f||f>d))return!0;g.grx1=Math.round(k);g.gry1=Math.round(f);a.has_errors&&(g.grx0=Math.round(b.grx(g.x-g.exlow)-k),g.grx2=Math.round(b.grx(g.x+g.exhigh)-k),g.gry0=Math.round(b.gry(g.y-g.eylow)-f),g.gry2=Math.round(b.gry(g.y+g.eyhigh)-f),a.is_bent?(g.grdx0=Math.round(b.gry(g.y+e.fEXlowd[h])-f),g.grdx2=Math.round(b.gry(g.y+e.fEXhighd[h])-f),g.grdy0=Math.round(b.grx(g.x+e.fEYlowd[h])-
k),g.grdy2=Math.round(b.grx(g.x+e.fEYhighd[h])-k)):g.grdx0=g.grdx2=g.grdy0=g.grdy2=0);return!1}),this.draw_kind="nodes",k=this.draw_g.selectAll(".grpoint").data(h).enter().append("svg:g").attr("class","grpoint").attr("transform",function(a){return"translate("+a.grx1+","+a.gry1+")"});if(this.options.Bar){for(g=1;g<h.length-1;++g)h[g].width=Math.max(2,(h[g+1].grx1-h[g-1].grx1)/2-2);switch(h.length){case 0:break;case 1:h[0].width=c/4;break;case 2:h[0].width=h[1].width=(h[1].grx1-h[0].grx1)/2;break;default:h[0].width=
h[1].width,h[h.length-1].width=h[h.length-2].width}var D=Math.round(b.gry(0));k.append("svg:rect").attr("x",function(a){return Math.round(-a.width/2)}).attr("y",function(b){b.bar=!0;return 1!==a.options.Bar?0:b.gry1>D?D-b.gry1:0}).attr("width",function(a){return Math.round(a.width)}).attr("height",function(b){return 1!==a.options.Bar?d>b.gry1?d-b.gry1:0:Math.abs(D-b.gry1)}).call(this.fillatt.func)}this.options.Rect&&k.filter(function(a){return 0<a.exlow&&0<a.exhigh&&0<a.eylow&&0<a.eyhigh}).append("svg:rect").attr("x",
function(a){a.rect=!0;return a.grx0}).attr("y",function(a){return a.gry2}).attr("width",function(a){return a.grx2-a.grx0}).attr("height",function(a){return a.gry0-a.gry2}).call(this.fillatt.func).call(2===this.options.Rect?this.lineatt.func:function(){});this.error_size=0;if(this.options.Errors){var q=this.lineatt.width+f.gStyle.fEndErrorSize;g=0;g=this.options.Ends?"m0,"+q+"v-"+2*q:"";m=this.options.Ends?"m"+q+",0h-"+2*q:"";var p=g,w=g,t=m,r=m,x=this.options.MainError?"M0,0L":"M";switch(this.options.Ends){case 2:g=
Math.max(this.lineatt.width+1,Math.round(.66*q));p="m"+g+","+q+"h-"+g+"v-"+2*q+"h"+g;w="m-"+g+","+q+"h"+g+"v-"+2*q+"h-"+g;t="m-"+q+","+g+"v-"+g+"h"+2*q+"v"+g;r="m-"+q+",-"+g+"v"+g+"h"+2*q+"v-"+g;break;case 3:q=Math.max(q,Math.round(5.28*e.fMarkerSize));g=Math.max(this.lineatt.width+1,Math.round(.66*q));p="l"+g+","+q+"v-"+2*q+"l-"+g+","+q;w="l-"+g+","+q+"v-"+2*q+"l"+g+","+q;t="l-"+q+","+g+"h"+2*q+"l-"+q+",-"+g;r="l-"+q+",-"+g+"h"+2*q+"l-"+q+","+g;break;case 4:q=Math.max(q,Math.round(5.28*e.fMarkerSize)),
g=Math.max(this.lineatt.width+1,Math.round(.66*q)),p="l"+g+","+q+"m0,-"+2*q+"l-"+g+","+q,w="l-"+g+","+q+"m0,-"+2*q+"l"+g+","+q,t="l-"+q+","+g+"m"+2*q+",0l-"+q+",-"+g,r="l-"+q+",-"+g+"m"+2*q+",0l-"+q+","+g}this.error_size=q;q=Math.floor((this.lineatt.width-1)/2);k.filter(function(a){return 0<a.exlow||0<a.exhigh||0<a.eylow||0<a.eyhigh}).append("svg:path").call(this.lineatt.func).style("fill","none").attr("d",function(a){a.error=!0;return(0<a.exlow?x+(a.grx0+q)+","+a.grdx0+p:"")+(0<a.exhigh?x+(a.grx2-
q)+","+a.grdx2+w:"")+(0<a.eylow?x+a.grdy0+","+(a.gry0-q)+r:"")+(0<a.eyhigh?x+a.grdy2+","+(a.gry2+q)+t:"")})}if(this.options.Mark){m="";this.createAttMarker({attr:e,style:this.options.Mark-100});this.marker_size=this.markeratt.GetFullSize();this.markeratt.reset_pos();g=1E6/(this.markeratt.MarkerLength()+7);l=1;h?this.CanOptimize()&&h.length>1.5*g&&(l=Math.min(2,Math.round(h.length/g))):h=this.OptimizeBins(g);for(g=0;g<h.length;g+=l)u=h[g],n=b.grx(u.x),n>-this.marker_size&&n<c+this.marker_size&&(u=
b.gry(u.y),u>-this.marker_size&&u<d+this.marker_size&&(m+=this.markeratt.create(n,u)));0<m.length&&(this.draw_g.append("svg:path").attr("d",m).call(this.markeratt.func),null===k&&"none"==this.draw_kind&&(this.draw_kind=101==this.options.Mark?"path":"mark"))}}};p.prototype.ExtractTooltip=function(a){if(!a)return null;if("lines"==this.draw_kind||"path"==this.draw_kind||"mark"==this.draw_kind)return this.ExtractTooltipForPath(a);if("nodes"!=this.draw_kind)return null;this.frame_width();var b=this.frame_height(),
c=this.frame_painter(),d=this,e=null,k=1E10,h=null,g=this.marker_size?Math.round(this.marker_size/2+1.5):0;this.draw_g.selectAll(".grpoint").each(function(){var f=t.select(this).datum();if(void 0!==f){var l=Math.pow(a.x-f.grx1,2);1===a.nproc&&(l+=Math.pow(a.y-f.gry1,2));if(!(l>=k)){if(f.error||f.rect||f.marker)var m={x1:Math.min(-d.error_size,f.grx0,-g),x2:Math.max(d.error_size,f.grx2,g),y1:Math.min(-d.error_size,f.gry2,-g),y2:Math.max(d.error_size,f.gry0,g)};else if(f.bar){if(m={x1:-f.width/2,x2:f.width/
2,y1:0,y2:b-f.gry1},1===d.options.Bar){var p=c.gry(0);m.y1=f.gry1>p?p-f.gry1:0;m.y2=f.gry1>p?0:p-f.gry1}}else m={x1:-5,x2:5,y1:-5,y2:5};p=a.x>=f.grx1+m.x1&&a.x<=f.grx1+m.x2;f=a.y>=f.gry1+m.y1&&a.y<=f.gry1+m.y2;p&&(f||1<a.nproc)&&(k=l,e=this,h=m,h.exact=p&&f)}}});if(null===e)return null;var f=t.select(e).datum(),m={name:this.GetObject().fName,title:this.GetObject().fTitle,x:f.grx1,y:f.gry1,color1:this.lineatt.color,lines:this.TooltipText(f),rect:h,d3bin:e};this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&
(m.color2=this.fillatt.fillcolor());h.exact&&(m.exact=!0);m.menu=m.exact;m.menu_dist=3;m.bin=f;m.binindx=f.indx;a.click_handler&&m.exact&&this.TestEditable()&&(m.click_handler=this.InvokeClickHandler.bind(this));return m};p.prototype.ShowTooltip=function(a){if(a){if(a.usepath)return this.ShowTooltipForPath(a);var b=t.select(a.d3bin).datum(),c=this.draw_g.select(".tooltip_bin");c.empty()&&(c=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));a.changed=
c.property("current_bin")!==a.d3bin;a.changed&&c.attr("x",b.grx1+a.rect.x1).attr("width",a.rect.x2-a.rect.x1).attr("y",b.gry1+a.rect.y1).attr("height",a.rect.y2-a.rect.y1).style("opacity","0.3").property("current_bin",a.d3bin)}else this.draw_g&&this.draw_g.select(".tooltip_bin").remove()};p.prototype.ProcessTooltip=function(a){var b=this.ExtractTooltip(a);a&&a.disabled||this.ShowTooltip(b);return b};p.prototype.FindBestBin=function(a){if(!this.bins)return null;var b="lines"==this.draw_kind,c=-1,d=
null,e=1E10,k=this.frame_painter(),h;for(h=0;h<this.bins.length;++h){var g=this.bins[h];var f=k.grx(g.x);var m=k.gry(g.y);m=(a.x-f)*(a.x-f)+(a.y-m)*(a.y-m);m<e&&(e=m,d=g,c=h)}100<e&&b&&(d=null);var n=Math.max(this.lineatt.width+3,4);0<this.marker_size&&(n=Math.max(this.marker_size,n));d&&(e=Math.sqrt(Math.pow(a.x-k.grx(d.x),2)+Math.pow(a.y-k.gry(d.y),2)));!b&&e>n&&(d=null);d||(c=-1);c={bin:d,indx:c,dist:e,radius:Math.round(n)};if(!d&&b){b=function(a,b,c){return b>=a&&a>=c||b<=a&&a<=c};e=1E4;m=this.bins[0];
var u=k.grx(m.x);d=0;for(h=1;h<this.bins.length;++h){g=this.bins[h];f=k.grx(g.x);if(b(a.x,u,f)){var p=k.gry(m.y);m=k.gry(g.y);1>Math.abs(f-u)?(d=a.y,m=b(a.y,p,m)?0:Math.min(Math.abs(a.y-p),Math.abs(a.y-m))):(d=p+(a.x-u)/(f-u)*(m-p),m=Math.abs(d-a.y));m<e&&(e=m,c.linex=a.x,c.liney=d)}m=g;u=f}e<.5*n&&(c.linedist=e,c.closeline=!0)}return c};p.prototype.TestEditable=function(a){var b=this.GetObject(),c=f.BIT(18);if(!b)return!1;a&&b.InvertBit(c);return!b.TestBit(c)};p.prototype.ExtractTooltipForPath=function(a){if(null===
this.bins)return null;var b=this.FindBestBin(a);if(!b||!b.bin&&!b.closeline)return null;var c="lines"==this.draw_kind,d="mark"==this.draw_kind,e=this.frame_painter(),f=this.GetObject(),h={name:f.fName,title:f.fTitle,x:b.bin?e.grx(b.bin.x):b.linex,y:b.bin?e.gry(b.bin.y):b.liney,color1:this.lineatt.color,lines:this.TooltipText(b.bin),usepath:!0};h.ismark=d;h.islines=c;b.closeline?(h.menu=h.exact=!0,h.menu_dist=b.linedist):b.bin&&(this.options.EF&&c?(h.gry1=e.gry(b.bin.y-b.bin.eylow),h.gry2=e.gry(b.bin.y+
b.bin.eyhigh)):h.gry1=h.gry2=e.gry(b.bin.y),h.binindx=b.indx,h.bin=b.bin,h.radius=b.radius,h.exact=Math.abs(a.x-h.x)<=b.radius&&(Math.abs(a.y-h.gry1)<=b.radius||Math.abs(a.y-h.gry2)<=b.radius),h.menu=h.exact,h.menu_dist=Math.sqrt((a.x-h.x)*(a.x-h.x)+Math.pow(Math.min(Math.abs(a.y-h.gry1),Math.abs(a.y-h.gry2)),2)),a.click_handler&&h.exact&&this.TestEditable()&&(h.click_handler=this.InvokeClickHandler.bind(this)));this.fillatt&&this.fillatt.used&&!this.fillatt.empty()&&(h.color2=this.fillatt.fillcolor());
c||(h.color1=this.get_color(f.fMarkerColor),h.color2||(h.color2=h.color1));return h};p.prototype.ShowTooltipForPath=function(a){var b=this.draw_g.select(".tooltip_bin");a&&a.bin?(b.empty()&&(b=this.draw_g.append("svg:g").attr("class","tooltip_bin")),a.changed=b.property("current_bin")!==a.bin,a.changed&&(b.selectAll("*").remove(),b.property("current_bin",a.bin),a.ismark?b.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(a.x-a.radius)).attr("y",
Math.round(a.y-a.radius)).attr("width",2*a.radius).attr("height",2*a.radius):(b.append("svg:circle").attr("cy",Math.round(a.gry1)),1<Math.abs(a.gry1-a.gry2)&&b.append("svg:circle").attr("cy",Math.round(a.gry2)),b=b.selectAll("circle").attr("r",a.radius).attr("cx",Math.round(a.x)),a.islines?(this.options.Line?b.call(this.lineatt.func):b.style("stroke","black"),this.options.Fill?b.call(this.fillatt.func):b.style("fill","none")):b.style("stroke","black"==a.color1?"green":"black").style("fill","none")))):
b.remove()};p.prototype.movePntHandler=function(a){a=t.mouse(this.svg_frame().node());var b=this.frame_painter();b&&this.interactive_bin&&(this.interactive_bin.x=b.RevertX(a[0]+this.interactive_delta_x),this.interactive_bin.y=b.RevertY(a[1]+this.interactive_delta_y),this.DrawBins())};p.prototype.endPntHandler=function(){if(this.snapid&&this.interactive_bin){var a="SetPoint("+this.interactive_bin.indx+","+this.interactive_bin.x+","+this.interactive_bin.y+")",b=this.canv_painter();b&&!b._readonly&&
b.SendWebsocket("OBJEXEC:"+this.snapid+":"+a)}delete this.interactive_bin;t.select(window).on("mousemove.graphPnt",null).on("mouseup.graphPnt",null)};p.prototype.InvokeClickHandler=function(a){if(a.bin){this.interactive_bin=a.bin;t.select(window).on("mousemove.graphPnt",this.movePntHandler.bind(this)).on("mouseup.graphPnt",this.endPntHandler.bind(this),!0);a=t.mouse(this.svg_frame().node());var b=this.frame_painter();this.interactive_delta_x=b?b.x(this.interactive_bin.x)-a[0]:0;this.interactive_delta_y=
b?b.y(this.interactive_bin.y)-a[1]:0}};p.prototype.FillContextMenu=function(a){f.TObjectPainter.prototype.FillContextMenu.call(this,a);this.snapid||a.addchk(this.TestEditable(),"Editable",this.TestEditable.bind(this,!0));return 0<a.size()};p.prototype.ExecuteMenuCommand=function(a,b){if(f.TObjectPainter.prototype.ExecuteMenuCommand.call(this,a,b))return!0;b=this.canv_painter();var c=this.frame_painter();if("RemovePoint"==a.fName||"InsertPoint"==a.fName){var d=c?c.GetLastEventPos():null;if(!b||b._readonly||
!c||!d)return!0;c=this.ExtractTooltip(d);"InsertPoint"==a.fName?(a=(c=this.frame_painter())&&c.RevertX?c.RevertX(d.x):0,d=c&&c.RevertY?c.RevertY(d.y):0,b.ShowMessage("InsertPoint("+a.toFixed(3)+","+d.toFixed(3)+") not yet implemented")):this.args_menu_id&&c&&void 0!==c.binindx&&(d="RemovePoint("+c.binindx+")",console.log("execute "+d+" for object "+this.args_menu_id),b.SendWebsocket("OBJEXEC:"+this.args_menu_id+":"+d));return!0}return!1};p.prototype.UpdateObject=function(a,b){if(!this.MatchObjectType(a))return!1;
void 0!==b&&b!=this.options.original&&this.DecodeOptions(b);b=this.GetObject();b.fBits=a.fBits;b.fTitle=a.fTitle;b.fX=a.fX;b.fY=a.fY;b.fNpoints=a.fNpoints;this.CreateBins();if(this.axes_draw){var c=this.main_painter();this.frame_painter().zoom_changed_interactive||c.UpdateObject(a.fHistogram||this.CreateHistogram());c.GetObject().fTitle=b.fTitle}return!0};p.prototype.CanZoomIn=function(a,b,c){var d=this.GetObject();if(null===d||"x"!==a)return!1;for(a=0;a<d.fNpoints;++a)if(b<d.fX[a]&&d.fX[a]<c)return!0;
return!1};p.prototype.ButtonClick=function(a){if("ToggleZoom"!==a)return!1;a=this.frame_painter();if(!a||this.xmin===this.xmax&&this.ymin===this.ymax)return!1;a.Zoom(this.xmin,this.xmax,this.ymin,this.ymax);return!0};p.prototype.FindFunc=function(){var a=this.GetObject();if(a&&a.fFunctions)for(var b=0;b<a.fFunctions.arr.length;++b){var c=a.fFunctions.arr[b];if("TF1"==c._typename||"TF2"==c._typename)return c}return null};p.prototype.FindStat=function(){var a=this.GetObject();if(a&&a.fFunctions)for(var b=
0;b<a.fFunctions.arr.length;++b){var c=a.fFunctions.arr[b];if("TPaveStats"==c._typename&&"stats"==c.fName)return c}return null};p.prototype.CreateStat=function(){var a=this.FindFunc();if(!a)return null;var b=this.FindStat();if(b)return b;if((b=this.canv_painter())&&b.normal_canvas||this.options.PadStats)return null;this.create_stats=!0;var c=f.gStyle;b=f.Create("TPaveStats");f.extend(b,{fName:"stats",fOptStat:0,fOptFit:c.fOptFit||111,fBorderSize:1});b.fX1NDC=c.fStatX-c.fStatW;b.fY1NDC=c.fStatY-c.fStatH;
b.fX2NDC=c.fStatX;b.fY2NDC=c.fStatY;b.fFillColor=c.fStatColor;b.fFillStyle=c.fStatStyle;b.fTextAngle=0;b.fTextSize=c.fStatFontSize;b.fTextAlign=12;b.fTextColor=c.fStatTextColor;b.fTextFont=c.fStatFont;b.AddText(a.fName);this.GetObject().fFunctions.Add(b);return b};p.prototype.FillStatistic=function(a,b,c){b=this.FindFunc();if(!b||!c||!this.create_stats)return!1;a.ClearPave();a.FillFunctionStat(b,c);return!0};p.prototype.DrawNextFunction=function(a,b){var c=this.GetObject();if(!c.fFunctions||a>=c.fFunctions.arr.length)return f.CallBack(b);
var d=c.fFunctions.arr[a];c=c.fFunctions.opt[a];d.$main_painter=this;f.draw(this.divid,d,c,this.DrawNextFunction.bind(this,a+1,b))};p.prototype.PerformDrawing=function(a,b){b&&(this.axes_draw=!0,this._own_histogram||(this.$primary=!0),b.$secondary=!0);this.SetDivId(a);this.DrawBins();this.DrawNextFunction(0,this.DrawingReady.bind(this));return this};A.prototype=Object.create(f.TooltipHandler.prototype);A.prototype.translate=function(a,b,c){b=this.r(b);var d=b/this.szx*this.szy;a={x:b*Math.cos(-a-
this.angle),y:d*Math.sin(-a-this.angle),rx:b,ry:d};c||(a.x=Math.round(a.x),a.y=Math.round(a.y),a.rx=Math.round(a.rx),a.ry=Math.round(a.ry));return a};A.prototype.format=function(a){return a===Math.round(a)?a.toString():10<this.ndig?a.toExponential(4):a.toFixed(0<this.ndig?this.ndig:0)};A.prototype.AxisAsText=function(a,b){if("r"==a)return b===Math.round(b)?b.toString():10<this.ndig?b.toExponential(4):b.toFixed(this.ndig+2);b*=180/Math.PI;return b===Math.round(b)?b.toString():b.toFixed(1)};A.prototype.MouseEvent=
function(a){var b=this.svg_layer("primitives_layer").select(".interactive_ellipse");if(!b.empty()){var c=null;"leave"!==a&&(a=t.mouse(b.node()),c={x:a[0],y:a[1],touch:!1});this.ProcessTooltipEvent(c)}};A.prototype.GetFrameRect=function(){var a=this.root_pad(),b=this.pad_width(),c=this.pad_height(),d={};d.szx=Math.round(Math.max(.1,.5-Math.max(a.fLeftMargin,a.fRightMargin))*b);d.szy=Math.round(Math.max(.1,.5-Math.max(a.fBottomMargin,a.fTopMargin))*c);d.width=2*d.szx;d.height=2*d.szy;d.midx=Math.round(b/
2);d.midy=Math.round(c/2);d.x=d.midx-d.szx;d.y=d.midy-d.szy;d.hint_delta_x=d.szx;d.hint_delta_y=d.szy;d.transform="translate("+d.x+","+d.y+")";return d};A.prototype.MouseWheel=function(){t.event.stopPropagation();t.event.preventDefault();this.ProcessTooltipEvent(null);var a=this.GetObject();if(t.event&&a){var b=t.event.wheelDelta?-t.event.wheelDelta:t.event.deltaY||t.event.detail;if(b){var c=this.scale_rmin,d=this.scale_rmax;d+=(0>b?-.2:.2)*(d-c);if(c<a.fRwrmin||d>a.fRwrmax)c=d=0;if(this.zoom_rmin!=
c||this.zoom_rmax!=d)this.zoom_rmin=c,this.zoom_rmax=d,this.RedrawPad()}}};A.prototype.Redraw=function(){if(this.is_main_painter()){this.root_pad();var a=this.GetObject(),b=this.GetFrameRect();this.CreateG();this.draw_g.attr("transform","translate("+b.midx+","+b.midy+")");this.szx=b.szx;this.szy=b.szy;this.scale_rmin=a.fRwrmin;this.scale_rmax=a.fRwrmax;this.zoom_rmin!=this.zoom_rmax&&(this.scale_rmin=this.zoom_rmin,this.scale_rmax=this.zoom_rmax);this.r=t.scaleLinear().domain([this.scale_rmin,this.scale_rmax]).range([0,
this.szx]);this.angle=a.fAxisAngle||0;var c=this.r.ticks(5);b=Math.floor(a.fNdivRad%1E4/100);this.createAttLine({attr:a});this.gridatt||(this.gridatt=new f.TAttLineHandler({color:a.fLineColor,style:2,width:1}));var d=Math.abs(a.fRwrmax-a.fRwrmin);this.ndig=0>=d?-3:Math.round(f.log10(c.length/d));var e=[];for(d=0;d<c.length;){var k=this.format(c[d]);if(0<=e.indexOf(k)){if(10<++this.ndig)break;e=[];d=0}else e.push(k),d++}e=!1;c[c.length-1]<a.fRwrmax&&this.zoom_rmin==this.zoom_rmax&&(c.push(a.fRwrmax),
e=!0);this.StartTextDrawing(a.fRadialLabelFont,Math.round(a.fRadialTextSize*this.szy*2));for(d=0;d<c.length;++d){var h=this.r(c[d]),g=h/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(h)).attr("ry",Math.round(g)).style("fill","none").call(this.lineatt.func);(d<c.length-1||!e)&&this.DrawText({align:23,x:Math.round(h),y:Math.round(a.fRadialTextSize*this.szy*.5),text:this.format(c[d]),color:this.get_color[a.fRadialLabelColor],latex:0});if(1<b&&(d<c.length-
1||!e)){k=(c[1]-c[0])/b;for(var l=1;l<b;++l){h=c[d]+k*l;if(h>this.scale_rmax)break;h=this.r(h);g=h/this.szx*this.szy;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(h)).attr("ry",Math.round(g)).style("fill","none").call(this.gridatt.func)}}}this.FinishTextDrawing();b=Math.round(a.fPolarTextSize*this.szy*2);this.StartTextDrawing(a.fPolarLabelFont,b);c=a.fNdivPol%100;8!==c&&3!==c&&(c=8);e=8==c?"0 #frac{#pi}{4} #frac{#pi}{2} #frac{3#pi}{4} #pi #frac{5#pi}{4} #frac{3#pi}{2} #frac{7#pi}{4}".split(" "):
["0","#frac{2#pi}{3}","#frac{4#pi}{3}"];l=[12,11,21,31,32,33,23,13];for(d=0;d<c;++d)k=2*-d*Math.PI/c-this.angle,this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(k))).attr("y2",Math.round(this.szy*Math.sin(k))).call(this.lineatt.func),this.DrawText({align:l[Math.round(16-k/Math.PI*4)%8],x:Math.round((this.szx+b)*Math.cos(k)),y:Math.round((this.szy+b/this.szx*this.szy)*Math.sin(k)),text:e[d],color:this.get_color[a.fPolarLabelColor],latex:1});this.FinishTextDrawing();
b=Math.floor(a.fNdivPol%1E4/100);if(1<b)for(d=0;d<c*b;++d)0!==d%b&&(k=2*-d*Math.PI/c/b-this.angle,this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(this.szx*Math.cos(k))).attr("y2",Math.round(this.szy*Math.sin(k))).call(this.gridatt.func));if(!f.BatchMode&&(a=this.svg_layer("primitives_layer"),b=a.select(".interactive_ellipse"),b.empty()&&(b=a.append("g").classed("most_upper_primitives",!0).append("ellipse").classed("interactive_ellipse",!0).attr("cx",0).attr("cy",0).style("fill",
"none").style("pointer-events","visibleFill").on("mouseenter",this.MouseEvent.bind(this,"enter")).on("mousemove",this.MouseEvent.bind(this,"move")).on("mouseleave",this.MouseEvent.bind(this,"leave"))),b.attr("rx",this.szx).attr("ry",this.szy),t.select(b.node().parentNode).attr("transform",this.draw_g.attr("transform")),f.gStyle.Zooming&&f.gStyle.ZoomWheel))b.on("wheel",this.MouseWheel.bind(this))}};x.prototype=Object.create(f.TObjectPainter.prototype);x.prototype.Redraw=function(){this.DrawBins()};
x.prototype.DecodeOptions=function(a){var b=new f.DrawOptions(a||"L");this.options||(this.options={});f.extend(this.options,{mark:b.check("P"),err:b.check("E"),fill:b.check("F"),line:b.check("L"),curve:b.check("C")});this.OptionsStore(a)};x.prototype.DrawBins=function(){var a=this.GetObject(),b=this.main_painter();if(a&&b&&b.$polargram){this.options.mark&&this.createAttMarker({attr:a});(this.options.err||this.options.line||this.options.curve)&&this.createAttLine({attr:a});this.options.fill&&this.createAttFill({attr:a});
this.CreateG();this.draw_g.attr("transform",b.draw_g.attr("transform"));for(var c="",d="",e="",k=[],h=0;h<a.fNpoints;++h)if(!(a.fY[h]>b.scale_rmax)){if(this.options.err){var g=b.translate(a.fX[h],a.fY[h]-a.fEY[h]),l=b.translate(a.fX[h],a.fY[h]+a.fEY[h]);d+="M"+g.x+","+g.y+"L"+l.x+","+l.y;g=b.translate(a.fX[h]+a.fEX[h],a.fY[h]);l=b.translate(a.fX[h]-a.fEX[h],a.fY[h]);d+="M"+g.x+","+g.y+"A"+l.rx+","+l.ry+",0,0,1,"+l.x+","+l.y}g=b.translate(a.fX[h],a.fY[h]);this.options.mark&&(c+=this.markeratt.create(g.x,
g.y));if(this.options.line||this.options.fill)e+=(e?"L":"M")+g.x+","+g.y;this.options.curve&&(g.grx=g.x,g.gry=g.y,k.push(g))}this.options.fill&&e&&this.draw_g.append("svg:path").attr("d",e+"Z").style("stroke","none").call(this.fillatt.func);this.options.line&&e&&this.draw_g.append("svg:path").attr("d",e).style("fill","none").call(this.lineatt.func);this.options.curve&&k.length&&this.draw_g.append("svg:path").attr("d",f.Painter.BuildSvgPath("bezier",k).path).style("fill","none").call(this.lineatt.func);
d&&this.draw_g.append("svg:path").attr("d",d).style("fill","none").call(this.lineatt.func);c&&this.draw_g.append("svg:path").attr("d",c).call(this.markeratt.func)}};x.prototype.CreatePolargram=function(){for(var a=f.Create("TGraphPolargram"),b=this.GetObject(),c=b.fY[0]||0,d=c,e=0;e<b.fNpoints;++e)c=Math.min(c,b.fY[e]-b.fEY[e]),d=Math.max(d,b.fY[e]+b.fEY[e]);a.fRwrmin=c-.1*(d-c);a.fRwrmax=d+.1*(d-c);return a};x.prototype.ExtractTooltip=function(a){if(!a)return null;for(var b=this.GetObject(),c=this.main_painter(),
d=1E10,e=-1,f=null,h=0;h<b.fNpoints;++h){var g=c.translate(b.fX[h],b.fY[h]),l=(g.x-a.x)*(g.x-a.x)+(g.y-a.y)*(g.y-a.y);l<d&&(d=l,e=h,f=g)}a=5;this.markeratt&&this.markeratt.used&&(a=this.markeratt.GetFullSize());if(Math.sqrt(d)>a)return null;d={name:this.GetObject().fName,title:this.GetObject().fTitle,x:f.x,y:f.y,color1:this.markeratt&&this.markeratt.used?this.markeratt.color:this.lineatt.color,exact:4>Math.sqrt(d),lines:[this.GetTipName()],binindx:e,menu_dist:a,radius:a};d.lines.push("r = "+c.AxisAsText("r",
b.fY[e]));d.lines.push("phi = "+c.AxisAsText("phi",b.fX[e]));b.fEY&&b.fEY[e]&&d.lines.push("error r = "+c.AxisAsText("r",b.fEY[e]));b.fEX&&b.fEX[e]&&d.lines.push("error phi = "+c.AxisAsText("phi",b.fEX[e]));return d};x.prototype.ShowTooltip=function(a){if(this.draw_g){var b=this.draw_g.select(".tooltip_bin");a?(b.empty()&&(b=this.draw_g.append("svg:ellipse").attr("class","tooltip_bin").style("pointer-events","none")),a.changed=b.property("current_bin")!==a.binindx,a.changed&&b.attr("cx",a.x).attr("cy",
a.y).attr("rx",Math.round(a.radius)).attr("ry",Math.round(a.radius)).style("fill","none").style("stroke",a.color1).property("current_bin",a.binindx)):b.remove()}};x.prototype.ProcessTooltip=function(a){var b=this.ExtractTooltip(a);a&&a.disabled||this.ShowTooltip(b);return b};x.prototype.PerformDrawing=function(a){this.SetDivId(a);this.DrawBins();this.DrawingReady()};r.prototype=Object.create(f.TObjectPainter.prototype);r.prototype.UpdateObject=function(a,b){var c=this.GetObject();if(c._typename!=
a._typename)return!1;c!==a&&f.extend(c,a);void 0!==b&&this.DecodeOptions(b);return!0};r.prototype.Eval=function(a,b){b-=a.fX;return"TSplinePoly3"==a._typename?a.fY+b*(a.fB+b*(a.fC+b*a.fD)):"TSplinePoly5"==a._typename?a.fY+b*(a.fB+b*(a.fC+b*(a.fD+b*(a.fE+b*a.fF)))):a.fY+b};r.prototype.FindX=function(a){var b=this.GetObject(),c=0,d=b.fNp-1;if(a<=b.fXmin)return 0;if(a>=b.fXmax)return d;if(b.fKstep)c=Math.round((a-b.fXmin)/b.fDelta),a<b.fPoly[c].fX?c=Math.max(c-1,0):c<d&&a>b.fPoly[c+1].fX&&++c;else for(;1<
d-c;){var e=Math.round((c+d)/2);a>b.fPoly[e].fX?c=e:d=e}return c};r.prototype.CreateDummyHisto=function(){var a=0,b=1,c=0,d=1,e=this.GetObject();e&&e.fPoly&&(a=b=e.fPoly[0].fX,c=d=e.fPoly[0].fY,e.fPoly.forEach(function(e){a=Math.min(e.fX,a);b=Math.max(e.fX,b);c=Math.min(e.fY,c);d=Math.max(e.fY,d)}),0<d&&(d*=1.05),0>c&&(c*=1.05));var k=f.Create("TH1I");k.fName=e.fName+"_hist";k.fTitle=e.fTitle;k.fXaxis.fXmin=a;k.fXaxis.fXmax=b;k.fYaxis.fXmin=c;k.fYaxis.fXmax=d;return k};r.prototype.ProcessTooltip=
function(a){var b=!1,c=this.GetObject(),d=this.frame_painter(),e=null,k=0;if(null!==a&&c&&d){var h=d.RevertX(a.x);k=this.FindX(h);e=c.fPoly[k];var g=this.Eval(e,h);k<c.fN-1&&Math.abs(c.fPoly[k+1].fX-h)<Math.abs(h-e.fX)&&(e=c.fPoly[++k]);if(Math.abs(d.grx(e.fX)-a.x)<.5*this.knot_size)h=e.fX,g=e.fY;else if(e=null,h<c.fXmin||h>c.fXmax)b=!0}else b=!0;if(b)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;b=this.draw_g.select(".tooltip_bin");c=this.lineatt.width+3;b.empty()&&
(b=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",c).style("fill","none").call(this.lineatt.func));c={name:this.GetObject().fName,title:this.GetObject().fTitle,x:d.grx(h),y:d.gry(g),color1:this.lineatt.color,lines:[],exact:null!==e||Math.abs(d.gry(g)-a.y)<c};c.changed=b.property("current_xx")!==h;c.menu=c.exact;c.menu_dist=Math.sqrt((c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y));c.changed&&b.attr("cx",Math.round(c.x)).attr("cy",Math.round(c.y)).property("current_xx",
h);a=this.GetTipName();0<a.length&&c.lines.push(a);c.lines.push("x = "+d.AxisAsText("x",h));c.lines.push("y = "+d.AxisAsText("y",g));null!==e&&(c.lines.push("knot = "+k),c.lines.push("B = "+f.FFormat(e.fB,f.gStyle.fStatFormat)),c.lines.push("C = "+f.FFormat(e.fC,f.gStyle.fStatFormat)),c.lines.push("D = "+f.FFormat(e.fD,f.gStyle.fStatFormat)),void 0!==e.fE&&void 0!==e.fF&&(c.lines.push("E = "+f.FFormat(e.fE,f.gStyle.fStatFormat)),c.lines.push("F = "+f.FFormat(e.fF,f.gStyle.fStatFormat))));return c};
r.prototype.Redraw=function(){var a=this.frame_width(),b=this.frame_height(),c=this.GetObject(),d=this.frame_painter();this.GetTipName("\n");this.CreateG(!0);this.knot_size=5;this.createAttLine({attr:c});if(this.options.Line||this.options.Curve){var e=Math.max(10,c.fNpx),k=Math.max(d.scale_xmin,c.fXmin),h=Math.min(d.scale_xmax,c.fXmax),g=this.FindX(k),l=[];d.logx&&(k=Math.log(k),h=Math.log(h));for(var m=0;m<e;++m){var n=k+(h-k)/e*(m-1);for(d.logx&&(n=Math.exp(n));g<c.fNp-1&&n>c.fPoly[g+1].fX;)++g;
var u=this.Eval(c.fPoly[g],n);l.push({x:n,y:u,grx:d.grx(n),gry:d.gry(u)})}m=b;void 0!==d.hmin&&0<=d.hmin&&(m=Math.round(d.gry(0)),m>b||0>m)&&(m=b);l=f.Painter.BuildSvgPath("bezier",l,m,2);this.draw_g.append("svg:path").attr("class","line").attr("d",l.path).style("fill","none").call(this.lineatt.func)}if(this.options.Mark){l="";this.createAttMarker({attr:c});this.markeratt.reset_pos();this.knot_size=this.markeratt.GetFullSize();for(m=0;m<c.fPoly.length;m++)k=c.fPoly[m],e=d.grx(k.fX),e>-this.knot_size&&
e<a+this.knot_size&&(k=d.gry(k.fY),k>-this.knot_size&&k<b+this.knot_size&&(l+=this.markeratt.create(e,k)));l&&this.draw_g.append("svg:path").attr("d",l).call(this.markeratt.func)}};r.prototype.CanZoomIn=function(a,b,c){return"x"===a&&this.GetObject()?!0:!1};r.prototype.DecodeOptions=function(a){var b=new f.DrawOptions(a);this.options||(this.options={});f.extend(this.options,{Same:b.check("SAME"),Line:b.check("L"),Curve:b.check("C"),Mark:b.check("P")});this.OptionsStore(a)};r.prototype.FirstDraw=function(){this.SetDivId(this.divid);
this.Redraw();return this.DrawingReady()};f.Painter.drawSpline=function(a,b,c){b=new r(b);b.SetDivId(a,-1);b.DecodeOptions(c);if(!b.main_painter()){if(b.options.Same)return console.warn("TSpline painter requires histogram to be drawn"),null;c=b.CreateDummyHisto();f.draw(a,c,"AXIS",b.FirstDraw.bind(b));return b}return b.FirstDraw()};B.prototype=Object.create(f.TObjectPainter.prototype);B.prototype.Redraw=function(){void 0===this.step&&this.StartDrawing(!1)};B.prototype.DecodeOptions=function(a){var b=
new f.DrawOptions(a||"REPEAT");this.options||(this.options={});f.extend(this.options,{once:b.check("ONCE"),repeat:b.check("REPEAT"),first:b.check("FIRST")});this.OptionsStore(a)};B.prototype.DrawPrimitives=function(a,b,c){0===a&&(this._doing_primitives=!0);for(var d=this.GetObject().fSteps.arr[this.step];;){c&&(c.$grtimeid=this.selfid);if(!d||a>=d.arr.length)return delete this._doing_primitives,f.CallBack(b);var e={func:this.DrawPrimitives.bind(this,a+1,b)};c=f.draw(this.divid,d.arr[a],d.opt[a],e);
if(!e.completed)break;a++}};B.prototype.Selector=function(a){return a&&a.$grtimeid===this.selfid};B.prototype.ContineDrawing=function(){if(this.options){var a=this.GetObject();this.ready_called||(this.ready_called=!0,this.DrawingReady());if(this.options.first)delete this.step;else if(this.wait_animation_frame)delete this.wait_animation_frame,(a=this.pad_painter())?(a.CleanPrimitives(this.Selector.bind(this)),this.DrawPrimitives(0,this.ContineDrawing.bind(this))):delete this.step;else if(this.running_timeout)clearTimeout(this.running_timeout),
delete this.running_timeout,this.wait_animation_frame=!0,requestAnimationFrame(this.ContineDrawing.bind(this));else{var b=a.fSleepTime;if(!b||100>b)b=10;if(++this.step>a.fSteps.arr.length)if(this.options.repeat)this.step=0,b=Math.max(5E3,5*b);else{delete this.step;return}this.running_timeout=setTimeout(this.ContineDrawing.bind(this),b)}}};B.prototype.StartDrawing=function(a){!1!==a&&this.SetDivId(this.divid);this.step=0;this.DrawPrimitives(0,this.ContineDrawing.bind(this))};f.Painter.drawGraphTime=
function(a,b,c){var d=new B(b);d.SetDivId(a,-1);if(d.main_painter())return console.error("Cannot draw graph time on top of other histograms"),null;if(!b.fFrame)return console.error("Frame histogram not exists"),null;d.DecodeOptions(c);!b.fFrame.fTitle&&b.fTitle&&(b.fFrame.fTitle=b.fTitle);d.selfid="grtime"+f.id_counter++;f.draw(a,b.fFrame,"AXIS",d.StartDrawing.bind(d));return d};C.prototype=Object.create(f.TObjectPainter.prototype);C.prototype.GetEfficiency=function(a){var b=this.GetObject(),c=b.fTotalHistogram.getBinContent(a);
a=b.fPassedHistogram.getBinContent(a);return c?a/c:0};C.prototype.Normal=function(a,b,c,d){if(0==a)return d?1:0;b/=a;a=f.Math.normal_quantile(1-(1-c)/2,Math.sqrt(b*(1-b)/a));return d?1<b+a?1:b+a:0>b-a?0:b-a};C.prototype.GetEfficiencyErrorLow=function(a){var b=this.GetObject(),c=b.fTotalHistogram.getBinContent(a),d=b.fPassedHistogram.getBinContent(a);return this.GetEfficiency(a)-this[this.fBoundary](c,d,b.fConfLevel,!1)};C.prototype.GetEfficiencyErrorUp=function(a){var b=this.GetObject(),c=b.fTotalHistogram.getBinContent(a),
d=b.fPassedHistogram.getBinContent(a);a=this.GetEfficiency(a);return this[this.fBoundary](c,d,b.fConfLevel,!0)-a};C.prototype.CreateGraph=function(){var a=f.Create("TGraphAsymmErrors");a.fName="eff_graph";return a};C.prototype.FillGraph=function(a,b){var c=this.GetObject(),d=c.fTotalHistogram.fXaxis.fNbins,e=!1,f=0;0<=b.toLowerCase().indexOf("e0")&&(e=!0);for(b=0;b<d;++b)if(e||0!==c.fTotalHistogram.getBinContent(b+1))a.fX[f]=c.fTotalHistogram.fXaxis.GetBinCenter(b+1),a.fY[f]=this.GetEfficiency(b+
1),a.fEXlow[f]=c.fTotalHistogram.fXaxis.GetBinCenter(b+1)-c.fTotalHistogram.fXaxis.GetBinLowEdge(b+1),a.fEXhigh[f]=c.fTotalHistogram.fXaxis.GetBinLowEdge(b+2)-c.fTotalHistogram.fXaxis.GetBinCenter(b+1),a.fEYlow[f]=this.GetEfficiencyErrorLow(b+1),a.fEYhigh[f]=this.GetEfficiencyErrorUp(b+1),++f;a.fNpoints=f};f.Painter.drawEfficiency=function(a,b,c){if(!b||!b.fTotalHistogram||0!=b.fTotalHistogram._typename.indexOf("TH1"))return null;var d=new C(b);d.options=c;b=d.CreateGraph();d.FillGraph(b,c);f.draw(a,
b,c,function(){d.SetDivId(a);d.DrawingReady()});return d};y.prototype=Object.create(f.TObjectPainter.prototype);y.prototype.Cleanup=function(){this.painters=[];f.TObjectPainter.prototype.Cleanup.call(this)};y.prototype.UpdateObject=function(a){if(!this.MatchObjectType(a))return!1;var b=this.GetObject(),c=a.fGraphs;b.fTitle=a.fTitle;b=!1;if(this.firstpainter){var d=a.fHistogram;this.autorange&&!d&&(d=this.ScanGraphsRange(c));this.firstpainter.UpdateObject(d)&&(b=!0)}for(d=0;d<c.arr.length;++d)d<this.painters.length&&
this.painters[d].UpdateObject(c.arr[d])&&(b=!0);if(a.fFunctions)for(d=0;d<a.fFunctions.arr.length;++d)if((c=a.fFunctions.arr[d])&&c._typename&&c.fName){var e=this.FindPainterFor(null,c.fName,c._typename);e&&e.UpdateObject(c)}return b};y.prototype.ComputeGraphRange=function(a,b){if(0!=b.fNpoints){a.first&&(a.xmin=a.xmax=b.fX[0],a.ymin=a.ymax=b.fY[0],a.first=!1);for(var c=0;c<b.fNpoints;++c)a.xmin=Math.min(a.xmin,b.fX[c]),a.xmax=Math.max(a.xmax,b.fX[c]),a.ymin=Math.min(a.ymin,b.fY[c]),a.ymax=Math.max(a.ymax,
b.fY[c]);return a}};y.prototype.padtoX=function(a,b){return a.fLogx&&50>b?Math.exp(2.302585092994*b):b};y.prototype.ScanGraphsRange=function(a,b,c){var d=this.GetObject(),e=0;var k=0;var h=!1,g=!1,l=!1,m="",n={xmin:0,xmax:0,ymin:0,ymax:0,first:!0};c&&(h=c.fLogx,g=c.fLogy,n.xmin=c.fUxmin,n.xmax=c.fUxmax,n.ymin=c.fUymin,n.ymax=c.fUymax,n.first=!1);if(b){a=b.fYaxis.fXmin;var u=b.fYaxis.fXmax;c&&(e=this.padtoX(c,n.xmin),k=this.padtoX(c,n.xmax))}else{this.autorange=!0;for(e=0;e<a.arr.length;++e)this.ComputeGraphRange(n,
a.arr[e]);a.arr[0]&&a.arr[0].fHistogram&&a.arr[0].fHistogram.fXaxis.fTimeDisplay&&(l=!0,m=a.arr[0].fHistogram.fXaxis.fTimeFormat);n.xmin==n.xmax&&(n.xmax+=1);n.ymin==n.ymax&&(n.ymax+=1);k=.05*(n.xmax-n.xmin);c=.05*(n.ymax-n.ymin);e=n.xmin-k;k=n.xmax+k;g?(0>=n.ymin&&(n.ymin=.001*n.ymax),a=n.ymin/(1+.5*f.log10(n.ymax/n.ymin)),u=n.ymax*(1+.2*f.log10(n.ymax/n.ymin))):(a=n.ymin-c,u=n.ymax+c);0>a&&0<=n.ymin&&(a=0);0<u&&0>=n.ymax&&(u=0)}0>e&&0<=n.xmin&&(e=h?.9*n.xmin:0);0<k&&0>=n.xmax&&(k=h?1.1*n.xmax:0);
-1111!=d.fMinimum&&(n.ymin=a=d.fMinimum);-1111!=d.fMaximum&&(n.ymax=u=d.fMaximum);0>a&&0<=n.ymin&&g&&(a=.9*n.ymin);0<u&&0>=n.ymax&&g&&(u=1.1*n.ymax);0>=a&&g&&(a=.001*u);!g&&0<a&&a<.05*u&&(a=0);0>=e&&h&&(e=1E3<k?1:.001*k);!b&&(b=f.Create("TH1I"),b.fTitle=d.fTitle,b.fXaxis.fXmin=e,b.fXaxis.fXmax=k,b.fXaxis.fTimeDisplay=l)&&(b.fXaxis.fTimeFormat=m);b.fYaxis.fXmin=a;b.fYaxis.fXmax=u;return b};y.prototype.DrawAxis=function(a){var b=this.GetObject();b=this.ScanGraphsRange(b.fGraphs,b.fHistogram,this.root_pad());
f.draw(this.divid,b,"AXIS",a)};y.prototype.DrawNextFunction=function(a,b){var c=this.GetObject();if(!c.fFunctions||a>=c.fFunctions.arr.length)return f.CallBack(b);f.draw(this.divid,c.fFunctions.arr[a],c.fFunctions.opt[a],this.DrawNextFunction.bind(this,a+1,b))};y.prototype.DrawNextGraph=function(a,b,c,d){c&&this.painters.push(c);c=this.GetObject().fGraphs;if(a>=c.arr.length)return this._pfc=this._plc=this._pmc=!1,this.DrawNextFunction(0,this.DrawingReady.bind(this));if(499===a%500&&!d)return setTimeout(this.DrawNextGraph.bind(this,
a,b,null,!0),0);if(this._pfc||this._plc||this._pmc)!this.pallette&&f.Painter.GetColorPalette&&(this.palette=f.Painter.GetColorPalette()),this.palette&&(d=this.palette.calcColor(a,c.arr.length+1),d=this.add_color(d),this._pfc&&(c.arr[a].fFillColor=d),this._plc&&(c.arr[a].fLineColor=d),this._pmc&&(c.arr[a].fMarkerColor=d));f.draw(this.divid,c.arr[a],c.opt[a]||b,this.DrawNextGraph.bind(this,a+1,b))};f.Painter.drawMultiGraph=function(a,b,c){var d=new y(b);d.SetDivId(a,-1);var e=new f.DrawOptions(c);e.check("3D");
e.check("FB");d._pfc=e.check("PFC");d._plc=e.check("PLC");d._pmc=e.check("PMC");e.check("A")||!d.main_painter()?d.DrawAxis(function(b){d.firstpainter=b;d.SetDivId(a);d.DrawNextGraph(0,e.remain())}):(d.SetDivId(a),d.DrawNextGraph(0,e.remain()));return d};f.Painter.drawASImage=function(a,b,c){b=new f.TBasePainter;b.SetDivId(a,-1);b.select_main();b.SetDivId(a);return b.DrawingReady()};f.Painter.drawJSImage=function(a,b,c){var d=new f.TBasePainter;d.SetDivId(a,-1);var e=d.select_main();b=e.append("img").attr("src",
b.fName).attr("title",b.fTitle||b.fName);c&&0<=c.indexOf("scale")?b.style("width","100%").style("height","100%"):c&&0<=c.indexOf("center")&&(e.style("position","relative"),b.attr("style","margin: 0; position: absolute;  top: 50%; left: 50%; transform: translate(-50%, -50%);"));d.SetDivId(a);return d.DrawingReady()};f.Painter.CreateBranchItem=function(a,b,c,d){function e(a){var b=a.indexOf("[");0<b&&(a=a.substr(0,b));d&&0==a.indexOf(d.fName)&&(a=a.substr(d.fName.length),"."===a[0]&&(a=a.substr(1)));
return a}if(!a||!b)return!1;var k=b.fBranches?b.fBranches.arr.length:0,h=b.fLeaves?b.fLeaves.arr.length:0;b.$tree=c;c={_name:e(b.fName),_kind:"ROOT."+b._typename,_title:b.fTitle,_obj:b};a._childs||(a._childs=[]);a._childs.push(c);"TBranchElement"===b._typename&&(c._title+=" from "+b.fClassName+";"+b.fClassVersion);if(0<k)c._more=!0,c._expand=function(a,b){if(!b)return!1;a._childs||(a._childs=[]);!b.fLeaves||1!==b.fLeaves.arr.length||b.fType!==f.BranchType.kClonesNode&&b.fType!==f.BranchType.kSTLNode||
(b.fLeaves.arr[0].$branch=b,a._childs.push({_name:"@size",_title:"container size",_kind:"ROOT.TLeafElement",_icon:"img_leaf",_obj:b.fLeaves.arr[0],_more:!1}));for(var c=0;c<b.fBranches.arr.length;++c)f.Painter.CreateBranchItem(a,b.fBranches.arr[c],b.$tree,b);var d=(c=f.IO.GetBranchObjectClass(b,b.$tree,!0))?f.getMethods(c):null;if(d&&0<b.fBranches.arr.length)for(var e in d)if("function"===typeof d[e]){var g=d[e].toString();0<g.indexOf("return")&&0==g.indexOf("function ()")&&a._childs.push({_name:e+
"()",_title:"function "+e+" of class "+c,_kind:"ROOT.TBranchFunc",_obj:{_typename:"TBranchFunc",branch:b,func:e},_more:!1})}return!0};else if(1===h)c._icon="img_leaf",c._more=!1;else if(1<h)for(c._childs=[],a=0;a<h;++a)b.fLeaves.arr[a].$branch=b,k={_name:e(b.fLeaves.arr[a].fName),_kind:"ROOT."+b.fLeaves.arr[a]._typename,_obj:b.fLeaves.arr[a]},c._childs.push(k);return!0};f.Painter.TreeHierarchy=function(a,b){if("TTree"!=b._typename&&"TNtuple"!=b._typename&&"TNtupleD"!=b._typename)return!1;a._childs=
[];a._tree=b;for(var c=0;c<b.fBranches.arr.length;++c)f.Painter.CreateBranchItem(a,b.fBranches.arr[c],b);return!0};f.Painter.drawTree=function(a,b,c){var d=new f.TObjectPainter(b),e=b,k=c;if("TBranchFunc"==b._typename)k={expr:"."+b.func+"()",branch:b.branch},c&&0==c.indexOf("dump")?k.expr+=">>"+c:c&&(k.expr+=c),e=b.branch.$tree;else if(b.$branch){k={expr:"."+b.fName+(c||""),branch:b.$branch};if(k.branch.fType===f.BranchType.kClonesNode||k.branch.fType===f.BranchType.kSTLNode)k.expr=c,k.direct_branch=
!0;e=b.$branch.$tree}else if(b.$tree)!c&&b.fStreamerType&&b.fStreamerType!==f.IO.kTString&&b.fStreamerType>=f.IO.kObject&&b.fStreamerType<=f.IO.kAnyP&&(c="dump"),k={expr:c,branch:b},e=b.$tree;else{if("player"===k||!k)return f.AssertPrerequisites("jq2d",function(){f.CreateTreePlayer(d);d.ConfigureTree(e);d.Show(a);d.DrawingReady()}),d;"string"===typeof k&&(k={expr:k})}if(!e)return console.error("No TTree object available for TTree::Draw"),d.DrawingReady();var h=d.DrawingReady.bind(d);d._return_res_painter=
!0;f.cleanup(a);e.Draw(k,function(b,c,m){var g="";k.player?2===k.create_player&&(g=d.drawid):g=a;if(g)return f.redraw(g,b,c,m?null:h);1===k.create_player?k.player_intermediate=m:(k.player_create=1,k.player_intermediate=m,f.AssertPrerequisites("jq2d",function(){f.CreateTreePlayer(d);d.ConfigureTree(e);d.Show(a,k);k.create_player=2;f.redraw(d.drawid,b,c,k.player_intermediate?null:h);d.SetItemName("TreePlayer")}))});return d};f.Painter.drawText=function(){var a=this.GetObject(),b=this.pad_width(),c=
this.pad_height(),d=a.fX,e=a.fY,k=this.get_color(a.fTextColor),h=!1,g=1,l=a.fTextSize||.05,m=this.frame_painter();a.TestBit(f.BIT(14))?(d*=b,e=(1-e)*c):m&&!m.mode3d?(b=this.frame_width(),c=this.frame_height(),h="upper_layer",d=m.grx(d),e=m.gry(e)):null!==this.root_pad()?(d=this.ConvertToNDC("x",d)*b,e=(1-this.ConvertToNDC("y",e))*c):(a.fTextAlign=22,d=b/2,e=c/2,k||(k="black"));this.CreateG(h);d={align:a.fTextAlign,x:Math.round(d),y:Math.round(e),text:a.fTitle,color:k,latex:0};a.fTextAngle&&(d.rotate=
-a.fTextAngle);"TLatex"==a._typename?(d.latex=1,g=.9):"TMathText"==a._typename&&(d.latex=2,g=.8);this.StartTextDrawing(a.fTextFont,Math.round(1<l?l:l*Math.min(b,c)*g));this.DrawText(d);this.FinishTextDrawing()};f.Painter.drawLine=function(){var a=this.GetObject(),b=new f.TAttLineHandler(a),c=f.BIT(14);c=a.TestBit(c);this.CreateG();this.draw_g.append("svg:line").attr("x1",this.AxisToSvg("x",a.fX1,c)).attr("y1",this.AxisToSvg("y",a.fY1,c)).attr("x2",this.AxisToSvg("x",a.fX2,c)).attr("y2",this.AxisToSvg("y",
a.fY2,c)).call(b.func)};f.Painter.drawPolyLine=function(){var a=this.GetObject(),b=new f.TAttLineHandler(a),c=this.createAttFill(a),d=f.BIT(14),e=a.TestBit(d);d="";e=this.AxisToSvgFunc(e);this.CreateG();for(var k=0;k<=a.fLastPoint;++k)d+=(0<k?"L":"M")+e.x(a.fX[k])+","+e.y(a.fY[k]);"TPolyLine"!=a._typename&&c.SetSolidColor("none");c.empty()||(d+="Z");this.draw_g.append("svg:path").attr("d",d).call(b.func).call(c.func)};f.Painter.drawArrow=function(){var a=this.GetObject(),b=Math.max(3,Math.round(Math.max(this.pad_width(),
this.pad_height())*a.fArrowSize)),c=Math.round(b*Math.tan(a.fAngle/2*Math.PI/180));this.createAttLine({attr:a});this.createAttFill({attr:a});this.CreateG();var d=this.AxisToSvg("x",a.fX1,!1),e=this.AxisToSvg("y",a.fY1,!1),k=this.AxisToSvg("x",a.fX2,!1),h=this.AxisToSvg("y",a.fY2,!1),g="M0,0L"+b+","+c+"L0,"+2*c,l="M"+b+",0L0,"+c+"L"+b+","+2*c,m=null,n=null,u=null,p=null;a=a.fOption;var t=a.length;if(0==a.indexOf("<")){var q=0==a.indexOf("<|");p||(p=this.draw_g.append("defs"));m="jsroot_arrowmarker_"+
f.id_counter++;var v=p.append("svg:marker").attr("id",m).attr("markerWidth",b).attr("markerHeight",2*c).attr("refX",0).attr("refY",c).attr("orient","auto").attr("markerUnits","userSpaceOnUse"),w=v.append("svg:path").style("fill","none").attr("d",l+(q?"Z":"")).call(this.lineatt.func);if(q){w.call(this.fillatt.func);this.fillatt.color==this.lineatt.color&&this.fillatt.isSolid()&&w.style("stroke-width",1);q=k-d;w=h-e;var r=Math.sqrt(q*q+w*w);r>b&&(r=b/r,d+=r*q,e+=r*w,v.attr("refX",b))}}v=0;0<=a.indexOf("->-")?
v=1:0<=a.indexOf("-|>-")?v=11:0<=a.indexOf("-<-")?v=2:0<=a.indexOf("-<|-")&&(v=12);0<v&&(p||(p=this.draw_g.append("defs")),n="jsroot_arrowmarker_"+f.id_counter++,l=p.append("svg:marker").attr("id",n).attr("markerWidth",b).attr("markerHeight",2*c).attr("refX",Math.round(.5*b)).attr("refY",c).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",(1==v%10?g:l)+(10<v?"Z":"")).call(this.lineatt.func),10<v&&(l.call(this.fillatt.func),this.fillatt.isSolid(this.lineatt.color)&&
l.style("stroke-width",1)));a.lastIndexOf(">")==t-1&&(q=a.lastIndexOf("|>")==t-2&&1<t,p||(p=this.draw_g.append("defs")),u="jsroot_arrowmarker_"+f.id_counter++,c=p.append("svg:marker").attr("id",u).attr("markerWidth",b).attr("markerHeight",2*c).attr("refX",b).attr("refY",c).attr("orient","auto").attr("markerUnits","userSpaceOnUse"),g=c.append("svg:path").style("fill","none").attr("d",g+(q?"Z":"")).call(this.lineatt.func),q&&(g.call(this.fillatt.func),this.fillatt.isSolid(this.lineatt.color)&&g.style("stroke-width",
1),q=k-d,w=h-e,r=Math.sqrt(q*q+w*w),r>b&&(r=b/r,k-=r*q,h-=r*w,c.attr("refX",0))));b=this.draw_g.append("svg:path").attr("d","M"+Math.round(d)+","+Math.round(e)+(null==n?"":"L"+Math.round(d/2+k/2)+","+Math.round(e/2+h/2))+"L"+Math.round(k)+","+Math.round(h)).call(this.lineatt.func);m&&b.style("marker-start","url(#"+m+")");n&&b.style("marker-mid","url(#"+n+")");u&&b.style("marker-end","url(#"+u+")")};f.Painter.drawEllipse=function(){var a=this.GetObject();this.createAttLine({attr:a});this.createAttFill({attr:a});
this.CreateG();var b=this.AxisToSvg("x",a.fX1,!1),c=this.AxisToSvg("y",a.fY1,!1),d=this.AxisToSvg("x",a.fX1+a.fR1,!1)-b,e=c-this.AxisToSvg("y",a.fY1+a.fR2,!1);if("TCrown"==a._typename)if(0>=a.fR1)d=this.AxisToSvg("x",a.fX1+a.fR2,!1)-b;else{var f=c-this.AxisToSvg("y",a.fY1+a.fR1,!1),h=this.AxisToSvg("x",a.fX1+a.fR2,!1)-b;b=this.draw_g.attr("transform","translate("+b+","+c+")").append("svg:path").call(this.lineatt.func).call(this.fillatt.func);if(0==a.fPhimin&&360==a.fPhimax)b.attr("d","M-"+d+",0A"+
d+","+f+",0,1,0,"+d+",0A"+d+","+f+",0,1,0,-"+d+",0M-"+h+",0A"+h+","+e+",0,1,0,"+h+",0A"+h+","+e+",0,1,0,-"+h+",0");else{c=180<=a.fPhimax-a.fPhimin?1:0;var g=a.fPhimin*Math.PI/180;a=a.fPhimax*Math.PI/180;var l=d*Math.cos(g),m=f*Math.sin(g),n=d*Math.cos(a),p=f*Math.sin(a);b.attr("d","M"+Math.round(n)+","+Math.round(p)+"A"+d+","+f+",0,"+c+",0,"+Math.round(l)+","+Math.round(m)+"L"+Math.round(h*Math.cos(g))+","+Math.round(e*Math.sin(g))+"A"+h+","+e+",0,"+c+",1,"+Math.round(h*Math.cos(a))+","+Math.round(e*
Math.sin(a))+"Z")}return}0==a.fPhimin&&360==a.fPhimax&&0==a.fTheta?this.draw_g.append("svg:ellipse").attr("cx",b).attr("cy",c).attr("rx",d).attr("ry",e).call(this.lineatt.func).call(this.fillatt.func):(h=Math.cos(Math.PI*a.fTheta/180),g=Math.sin(Math.PI*a.fTheta/180),l=d*Math.cos(a.fPhimin*Math.PI/180),m=e*Math.sin(a.fPhimin*Math.PI/180),f=l*h-m*g,l=-l*g-m*h,n=d*Math.cos(a.fPhimax*Math.PI/180),p=e*Math.sin(a.fPhimax*Math.PI/180),m=n*h-p*g,n=-n*g-p*h,this.draw_g.attr("transform","translate("+b+","+
c+")").append("svg:path").attr("d","M0,0L"+Math.round(f)+","+Math.round(l)+"A"+d+","+e+","+Math.round(-a.fTheta)+",1,0,"+Math.round(m)+","+Math.round(n)+"Z").call(this.lineatt.func).call(this.fillatt.func))};f.Painter.drawPie=function(){var a=this.GetObject();this.CreateG();var b=this.AxisToSvg("x",a.fX,!1),c=this.AxisToSvg("y",a.fY,!1),d=this.AxisToSvg("x",a.fX+a.fRadius,!1)-b,e=this.AxisToSvg("y",a.fY+a.fRadius,!1)-c;this.draw_g.attr("transform","translate("+b+","+c+")");b=a.fPieSlices.length;c=
0;for(var k,h,g=0;g<b;g++){var l=a.fPieSlices[g];c+=l.fValue}k=a.fAngularOffset*Math.PI/180;var m=d*Math.cos(k),n=e*Math.sin(k),p=k;for(g=0;g<b;g++){l=a.fPieSlices[g];k=new f.TAttLineHandler(l);h=this.createAttFill(l);l=l.fValue;p+=2*Math.PI/c*l;l=d*Math.cos(p);var t=e*Math.sin(p);this.draw_g.append("svg:path").attr("d","M0,0L"+m.toFixed(1)+","+n.toFixed(1)+"A"+d.toFixed(1)+","+e.toFixed(1)+",0,0,0,"+l.toFixed(1)+","+t.toFixed(1)+"Z").call(k.func).call(h.func);m=l;n=t}};f.Painter.drawBox=function(){var a=
this.GetObject(),b=0<=this.OptionsAsString().toUpperCase().indexOf("L"),c=this.createAttLine(a),d=this.createAttFill(a);this.CreateG();var e=this.AxisToSvg("x",a.fX1,!1),f=this.AxisToSvg("x",a.fX2,!1),h=this.AxisToSvg("y",a.fY1,!1),g=this.AxisToSvg("y",a.fY2,!1),l=Math.min(e,f),m=Math.min(h,g);e=Math.abs(f-e);h=Math.abs(h-g);d.empty()||b||(c.color="none");this.draw_g.append("svg:rect").attr("x",l).attr("y",m).attr("width",e).attr("height",h).call(c.func).call(d.func);a.fBorderMode&&a.fBorderSize&&
"none"!==d.color&&(g=c=a.fBorderSize,b="M"+l+","+m+"h"+e+"l"+-c+","+g+"h"+(2*c-e)+"v"+(h-2*g)+"l"+-c+","+g+"z",l="M"+(l+e)+","+(m+h)+"v"+-h+"l"+-c+","+g+"v"+(h-2*g)+"h"+(2*c-e)+"l"+-c+","+g+"z",0>a.fBorderMode&&(a=b,b=l,l=a),this.draw_g.append("svg:path").attr("d",b).style("stroke","none").call(d.func).style("fill",t.rgb(d.color).brighter(.5).toString()),this.draw_g.append("svg:path").attr("d",l).style("stroke","none").call(d.func).style("fill",t.rgb(d.color).darker(.5).toString()))};f.Painter.drawMarker=
function(){var a=this.GetObject(),b=new f.TAttMarkerHandler(a),c=f.BIT(14),d=a.TestBit(c);this.CreateG();c=this.AxisToSvg("x",a.fX,d);a=this.AxisToSvg("y",a.fY,d);(a=b.create(c,a))&&this.draw_g.append("svg:path").attr("d",a).call(b.func)};f.Painter.drawPolyMarker=function(){var a=this.GetObject(),b=new f.TAttMarkerHandler(a),c=this.AxisToSvgFunc(!1),d="";this.CreateG();for(var e=0;e<a.fN;++e)d+=b.create(c.x(a.fX[e]),c.y(a.fY[e]));d&&this.draw_g.append("svg:path").attr("d",d).call(b.func)};f.Painter.drawWebPainting=
function(a,b,c){b=new f.TObjectPainter(b,c);b.UpdateObject=function(a){if(!this.MatchObjectType(a))return!1;this.draw_object=a;return!0};b.ReadAttr=function(a,b){for(var c=0,d={_typename:"any"},e=0;e<b.length;++e){var f=a.indexOf(":",c+1);d[b[e]]=parseInt(a.substr(c+1,f>c?f-c-1:void 0));c=f}return d};b.Redraw=function(){function a(a,b){if(b!=m&&(l&&(l.attr("d",n),n="",l=null,m="none"),b))switch(m=b,l=a.draw_g.append("svg:path"),b){case "f":l.call(a.fillatt.func).attr("stroke","none");break;case "l":l.call(a.lineatt.func).attr("fill",
"none");break;case "m":l.call(a.markeratt.func)}}var b=this.GetObject(),c=this.AxisToSvgFunc(!1);if(b&&b.fOper&&c){var h=0,g={},l=null,m="none",n="",p,t=b.fOper.split(";");this.CreateG();for(p=0;p<t.length;++p){var r=t[p][0];switch(r){case "z":this.createAttLine({attr:this.ReadAttr(t[p],["fLineColor","fLineStyle","fLineWidth"]),force:!0});a();continue;case "y":this.createAttFill({attr:this.ReadAttr(t[p],["fFillColor","fFillStyle"]),force:!0});a();continue;case "x":this.createAttMarker({attr:this.ReadAttr(t[p],
["fMarkerColor","fMarkerStyle","fMarkerSize"]),force:!0});a();continue;case "o":g=this.ReadAttr(t[p],["fTextColor","fTextFont","fTextSize","fTextAlign","fTextAngle"]);0>g.fTextSize&&(g.fTextSize*=-.001);a();continue;case "r":case "b":a(this,"b"==r?"f":"l");r=c.x(b.fBuf[h++]);var q=c.y(b.fBuf[h++]);var v=c.x(b.fBuf[h++]);var w=c.y(b.fBuf[h++]);n+="M"+r+","+q+"h"+(v-r)+"v"+(w-q)+"h"+(r-v)+"z";continue;case "l":case "f":a(this,r);v=parseInt(t[p].substr(1));for(q=0;q<v;++q)n+=(0<q?"L":"M")+c.x(b.fBuf[h++])+
","+c.y(b.fBuf[h++]);"f"==r&&(n+="Z");continue;case "m":a(this,r);v=parseInt(t[p].substr(1));this.markeratt.reset_pos();for(q=0;q<v;++q)n+=this.markeratt.create(c.x(b.fBuf[h++]),c.y(b.fBuf[h++]));continue;case "h":case "t":if(g.fTextSize){a();q=1<g.fTextSize?g.fTextSize:this.pad_height()*g.fTextSize;v=this.draw_g.append("svg:g");this.StartTextDrawing(g.fTextFont,q,v);w=g.fTextAngle;360<=w&&(w-=360*Math.floor(w/360));var x=t[p].substr(1);if("h"==r){r="";for(q=0;q<x.length;q+=2)r+=String.fromCharCode(parseInt(x.substr(q,
2),16));x=r}this.DrawText({align:g.fTextAlign,x:c.x(b.fBuf[h++]),y:c.y(b.fBuf[h++]),rotate:-w,text:x,color:f.Painter.root_colors[g.fTextColor],latex:0,draw_g:v});this.FinishTextDrawing(v)}continue;default:console.log("unsupported operation "+r)}}a()}};b.SetDivId(a);b.Redraw();return b.DrawingReady()};f.Painter.drawRooPlot=function(a,b,c){function d(){if(++k>=b._items.arr.length)return e.DrawingReady();f.draw(a,b._items.arr[k],b._items.opt[k],d)}var e=new f.TObjectPainter(b),k=-1;f.draw(a,b._hist,
"hist",d);return e};f.Painter.drawGraph=function(a,b,c){b=new p(b);b.SetDivId(a,-1);b.DecodeOptions(c);b.CreateBins();b.CreateStat();!b.main_painter()&&b.options.HOptions?f.draw(a,b.CreateHistogram(),b.options.HOptions,b.PerformDrawing.bind(b,a)):b.PerformDrawing(a);return b};f.Painter.drawFunction=function(a,b,c){b=new z(b);b.SetDivId(a,-1);a=new f.DrawOptions(c);b.nosave=a.check("NOSAVE");if(void 0!==f.Math)return b.PerformDraw();f.AssertPrerequisites("math",b.PerformDraw.bind(b));return b};f.Painter.drawGraphPolar=
function(a,b,c){var d=new x(b);d.DecodeOptions(c);d.SetDivId(a,-1);if(c=d.main_painter()){if(!c.$polargram)return console.error("Cannot superimpose TGraphPolar with plain histograms"),null;d.PerformDrawing(a);return d}b.fPolargram||(b.fPolargram=d.CreatePolargram());return f.draw(a,b.fPolargram,"",d.PerformDrawing.bind(d,a))};f.Painter.drawGraphPolargram=function(a,b,c){c=new A(b);c.SetDivId(a,-1);var d=c.main_painter();if(d)return d.GetObject()!==b&&console.error("Cannot superimpose TGraphPolargram with any other drawings"),
null;c.SetDivId(a,4);c.Redraw();return c.DrawingReady()};f.TF1Painter=z;f.TGraphPainter=p;f.TGraphPolarPainter=x;f.TMultiGraphPainter=y;f.TSplinePainter=r;return f});
