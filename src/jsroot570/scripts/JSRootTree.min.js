var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,n,v){b!=Array.prototype&&b!=Object.prototype&&(b[n]=v.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,n,v,t){if(n){v=$jscomp.global;b=b.split(".");for(t=0;t<b.length-1;t++){var r=b[t];r in v||(v[r]={});v=v[r]}b=b[b.length-1];t=v[b];n=n(t);n!=t&&null!=n&&$jscomp.defineProperty(v,b,{configurable:!0,writable:!0,value:n})}};
$jscomp.polyfill("Array.from",function(b){return b?b:function(b,v,t){v=null!=v?v:function(a){return a};var n=[],a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof a){b=a.call(b);for(var d=0;!(a=b.next()).done;)n.push(v.call(t,a.value,d++))}else for(a=b.length,d=0;d<a;d++)n.push(v.call(t,b[d],d));return n}},"es6","es3");$jscomp.arrayIteratorImpl=function(b){var n=0;return function(){return n<b.length?{done:!1,value:b[n++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,n){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:n})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function b(v){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(v||"")+"_"+n++,v)}var n=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,n){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var v=0,t={next:function(){if(v<b.length){var r=v++;return{value:n(r,b[r]),done:!1}}t.next=function(){return{done:!0,value:void 0}};return t.next()}};t[Symbol.iterator]=function(){return t};return t};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,v){return v})}},"es8","es3");
(function(b){if("function"===typeof define&&define.amd)define(["JSRootCore","JSRootIOEvolution","JSRootMath"],b);else if("object"===typeof exports&&"undefined"!==typeof module)b(require("./JSRootCore.js"),require("./JSRootIOEvolution.js"),require("./JSRootMath.js"));else{if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootTree.js");if("object"!=typeof JSROOT.IO)throw Error("JSROOT.IO not defined","JSRootTree.js");b(JSROOT)}})(function(b){function n(){this.branches=[];this.names=
[];this.directs=[];this.break_execution=0;this.tgtobj={}}function v(a,d,c){this.object=a;this.value=0;this.arr=[];this.indx=[];this.cnt=-1;this.tgtobj=c;this.select="object"===typeof d?d:[]}function t(a){this.globals=a;this.code="";this.brindex=[];this.branches=[];this.brarray=[];this.func=null;this.kind=void 0;this.buf=[]}function r(a){n.call(this);this.ndim=0;this.vars=[];this.hist=this.cut=null;this.histo_callback=a;this.histo_drawopt="";this.hist_name="$htemp";this.hist_title="Result of TTree::Draw";
this.graph=!1;this.hist_args=[];this.arr_limit=1E3;this.htype="F";this.monitoring=0;this.globals={};this.aver_diff=this.last_progress=0}b.sources.push("tree");b.BranchType={kLeafNode:0,kBaseClassNode:1,kObjectNode:2,kClonesNode:3,kSTLNode:4,kClonesMemberNode:31,kSTLMemberNode:41};b.IO.BranchBits={kDoNotProcess:b.BIT(10),kIsClone:b.BIT(11),kBranchObject:b.BIT(12),kBranchAny:b.BIT(17),kAutoDelete:b.BIT(15),kDoNotUseBufferMap:b.BIT(22)};n.prototype.AddBranch=function(a,d,c){d||(d="string"===typeof a?
a:"br"+this.branches.length);this.branches.push(a);this.names.push(d);this.directs.push(c);return this.branches.length-1};n.prototype.indexOfBranch=function(a){return this.branches.indexOf(a)};n.prototype.nameOfBranch=function(a){return this.names[a]};n.prototype.ShowProgress=function(a){};n.prototype.Abort=function(){this.break_execution=-1111};n.prototype.Begin=function(a){};n.prototype.Process=function(a){};n.prototype.Terminate=function(a){};b.CheckArrayPrototype=function(a,d){if("object"!==typeof a)return 0;
var c=Object.prototype.toString.apply(a);if(0!==c.indexOf("[object"))return 0;c=c.indexOf("Array]");if(0>c)return 0;if(8<c)return 2;if(!d)return 1;var g;d=!0;for(c=0;c<a.length;++c){var e=typeof a[c];g||(g=e);if(e!==g){d=!1;break}if("object"==e&&b.CheckArrayPrototype(a[c])){d=!1;break}}return d?2:1};v.prototype.next=function(){var a,d=this.cnt;if(0<=d){if(++this.fastindx<this.fastlimit)return this.value=this.fastarr[this.fastindx],!0;for(;0<=--d&&!(void 0===this.select[d]&&++this.indx[d]<this.arr[d].length););
if(0>d)return!1}for(;;){var c=(a=0>d?this.object:this.arr[d][this.indx[d]])?typeof a:"any";"object"===c&&(void 0!==a._typename?b.IsRootCollection(a)?(a=a.arr,c="array"):c="any":c=!isNaN(a.length)&&0<b.CheckArrayPrototype(a)?"array":"any");if("$self$"==this.select[d+1])return this.value=a,this.fastindx=this.fastlimit=0,this.cnt=d+1,!0;if("any"==c&&"string"===typeof this.select[d+1])this.arr[++d]=a,this.indx[d]=this.select[d];else if("array"===c&&(0<a.length||"$size$"===this.select[d+1]))switch(this.arr[++d]=
a,this.select[d]){case void 0:this.indx[d]=0;break;case "$last$":this.indx[d]=a.length-1;break;case "$size$":return this.value=a.length,this.fastindx=this.fastlimit=0,this.cnt=d,!0;default:isNaN(this.select[d])?(this.select[d].Produce(this.tgtobj),this.indx[d]=Math.round(this.select[d].get(0))):(this.indx[d]=this.select[d],0>this.indx[d]&&(this.indx[d]=a.length-1))}else{if(0>d)return!1;this.value=a;void 0===this.select[d]?(this.fastarr=this.arr[d],this.fastindx=this.indx[d],this.fastlimit=this.fastarr.length):
this.fastindx=this.fastlimit=0;this.cnt=d;return!0}}};v.prototype.reset=function(){this.arr=[];this.indx=[];delete this.fastarr;this.cnt=-1;this.value=0};t.prototype.Parse=function(a,d,c,g,e){function h(a){return"A"<=a&&"Z">=a||"a"<=a&&"z">=a?!0:"_"===a}function p(a){return h(a)||"0"<=a&&"9">=a?!0:!1}c||(c="");this.code=(g?g.fName:"")+c;for(var k=0,f=0,x=null;k<c.length||g;){var q=[];if(g)x=g,g=void 0;else{for(;k<c.length&&!h(c[k]);)k++;for(f=k;f<c.length&&(p(c[f])||"."===c[f]);)f++;if("$"==c[f]){x=
"";switch(c.substr(k,f-k)){case "LocalEntry":case "Entry":x="arg.$globals.entry";break;case "Entries":x="arg.$globals.entries"}if(x){c=c.substr(0,k)+x+c.substr(f+1);k+=x.length;continue}}x=a.FindBranch(c.substr(k,f-k),!0);if(!x){k=f+1;continue}x.branch&&void 0!==x.rest&&(f-=x.rest.length,e=x.read_mode,x=x.branch);f>=c.length-1&&"."===c[c.length-1]&&(q.push("$self$"),f=c.length)}for(;f<c.length;){if("@"===c[f]&&"@size"==c.substr(f,5)&&0==q.length){f+=5;e=!0;break}if("."===c[f]){var l=++f;if("@"===
c[l]&&"@size"===c.substr(l,5)){q.push("$size$");f+=5;break}if(!h(c[l])){q.push("$self$");break}for(;f<c.length&&p(c[f]);)f++;if("("==c[f]){f=l-1;break}if(0===q.length&&x)if(x.fType===b.BranchType.kClonesNode||x.fType===b.BranchType.kSTLNode)q.push(void 0);else{var w=b.IO.GetBranchObjectClass(x,a,!1,!0);w&&b.IsRootCollection(null,w)&&q.push(void 0)}q.push(c.substr(l,f-l))}else{if("["!==c[f])break;if("]"==c[f+1])q.push(void 0),f+=2;else{l=f++;for(w=0;f<c.length&&("]"!=c[f]||0<w);)"["==c[f]?w++:"]"==
c[f]&&w--,f++;l=c.substr(l+1,f-l-1);switch(l){case "":case "$all$":q.push(void 0);break;case "$last$":q.push("$last$");break;case "$size$":q.push("$size$");break;case "$first$":q.push(0);break;default:if(isNaN(parseInt(l))){w=new t(this.globals);if(!w.Parse(a,d,l))return!1;q.push(w)}else q.push(parseInt(l))}f++}}}0===q.length?q=void 0:1===q.length&&void 0===q[0]&&(q=!0);l=d.indexOfBranch(x);0>l&&(l=d.AddBranch(x,void 0,e));e=void 0;this.brindex.push(l);this.branches.push(d.nameOfBranch(l));this.brarray.push(q);
if(0===k&&f===c.length&&1===this.branches.length)return this.direct_branch=!0;q="arg.var"+(this.branches.length-1);c=c.substr(0,k)+q+c.substr(f);k+=q.length}c=c.replace(/TMath::Exp\(/g,"Math.exp(").replace(/TMath::Abs\(/g,"Math.abs(").replace(/TMath::Prob\(/g,"arg.$math.Prob(").replace(/TMath::Gaus\(/g,"arg.$math.Gaus(");this.func=new Function("arg","return ("+c+")");return!0};t.prototype.is_dummy=function(){return 0===this.branches.length&&!this.func};t.prototype.Produce=function(a){this.length=
1;this.isarray=!1;if(this.is_dummy())this.value=1,this.kind="number";else{for(var d={$globals:this.globals,$math:b.Math},c=-1,g=[],e=0;e<this.branches.length;++e){var h="var"+e;d[h]=a[this.branches[e]];void 0===this.brarray[e]&&(this.brarray[e]=0<b.CheckArrayPrototype(d[h])||b.IsRootCollection(d[h]));if(!1!==this.brarray[e]){if(!0===this.brarray[e]&&2===b.CheckArrayPrototype(d[h],!0))g[e]=d[h];else for(h=new v(d[h],this.brarray[e],a),g[e]=[];h.next();)g[e].push(h.value);if(0>c||c<g[e].length)c=g[e].length}}if(0>
c)this.value=this.direct_branch?d.var0:this.func(d),this.kind||(this.kind=typeof this.value);else if(0==c)this.value=this.length=0;else{this.length=c;this.isarray=!0;if(this.direct_branch)this.value=g[0];else for(this.value=Array(c),a=0;a<c;++a){for(e=0;e<this.branches.length;++e)g[e]&&(d["var"+e]=g[e][a]);this.value[a]=this.func(d)}this.kind||(this.kind=typeof this.value[0])}}};t.prototype.get=function(a){return this.isarray?this.value[a]:this.value};t.prototype.AppendArray=function(a){this.buf=
this.buf.concat(a[this.branches[0]])};r.prototype=Object.create(n.prototype);r.prototype.ParseParameters=function(a,d,c){if(!c||"string"!==typeof c)return"";for(var b=c.lastIndexOf(";");0<=b;){var e=c.substr(b+1),h=void 0;c=c.substr(0,b);b=c.lastIndexOf(";");var p=e.indexOf(":");0<p&&(h=e.substr(p+1),e=e.substr(0,p));p=parseInt(h);if(!h||isNaN(p))p=void 0;switch(e){case "num":case "entries":case "numentries":"all"===h?d.numentries=a.fEntries:"half"===h?d.numentries=Math.round(a.fEntries/2):void 0!==
p&&(d.numentries=p);break;case "first":void 0!==p&&(d.firstentry=p);break;case "mon":case "monitor":d.monitoring=void 0!==p?p:5E3;break;case "player":d.player=!0;break;case "dump":d.dump=!0;break;case "maxseg":case "maxrange":p&&(a.$file.fMaxRanges=p);break;case "accum":p&&(this.arr_limit=p);break;case "htype":h&&1===h.length&&(this.htype=h.toUpperCase(),"C"!==this.htype&&"S"!==this.htype&&"I"!==this.htype&&"F"!==this.htype&&"L"!==this.htype&&"D"!==this.htype&&(this.htype="F"));break;case "hbins":this.hist_nbins=
parseInt(h);(isNaN(this.hist_nbins)||3>=this.hist_nbins)&&delete this.hist_nbins;break;case "drawopt":d.drawopt=h;break;case "graph":d.graph=p||!0}}b=c.lastIndexOf(">>");if(0<=b)if(a=c.substr(b+2).trim(),c=c.substr(0,b).trim(),b=a.indexOf("("),0<b&&(this.hist_name=a.substr(0,b),a=a.substr(b)),"dump"===a)d.dump=!0;else if(0==a.indexOf("Graph"))d.graph=!0;else if(0>b)this.hist_name=a;else if("("==a[0]&&")"==a[a.length-1]){a=a.substr(1,a.length-2).split(",");b=!0;for(e=0;e<a.length;++e)a[e]=0===e%3?
parseInt(a[e]):parseFloat(a[e]),isNaN(a[e])&&(b=!1);b&&(this.hist_args=a)}d.dump&&(this.dump_values=!0,d.reallocate_objects=!0,void 0===d.numentries&&(d.numentries=10));return c};r.prototype.ParseDrawExpression=function(a,d){var c=this.ParseParameters(a,d,d.expr),b="";this.hist_title="drawing '"+c+"' from "+a.fName;if(d.cut)b=d.cut;else{var e=c.replace(/TMath::/g,"TMath__").lastIndexOf("::");0<e&&(b=c.substr(e+2).trim(),c=c.substr(0,e).trim())}d.parse_expr=c;d.parse_cut=b;var h=[],p=0,k=0,f=0;for(e=
0;e<c.length;++e)switch(c[e]){case "(":p++;break;case ")":p--;break;case "[":k++;break;case "]":k--;break;case ":":":"==c[e+1]?e++:(!p&&!k&&e>f&&h.push(c.substr(f,e-f)),f=e+1)}!p&&!k&&e>f&&h.push(c.substr(f,e-f));if(1>h.length||3<h.length)return!1;this.ndim=h.length;c=!b;for(e=0;e<this.ndim;++e){this.vars[e]=new t(this.globals);if(!this.vars[e].Parse(a,this,h[e]))return!1;this.vars[e].direct_branch||(c=!1)}this.cut=new t(this.globals);if(b&&!this.cut.Parse(a,this,b))return!1;if(!this.branches.length)return console.warn("no any branch is selected"),
!1;c&&(this.ProcessArrays=this.ProcessArraysFunc);this.monitoring=d.monitoring;this.graph=d.graph;this.histo_drawopt=void 0!==d.drawopt?d.drawopt:2===this.ndim?"col":"";return!0};r.prototype.DrawOnlyBranch=function(a,d,c,b){this.ndim=1;0==c.indexOf("dump")&&(c=";"+c);c=this.ParseParameters(a,b,c);this.monitoring=b.monitoring;b.dump&&(this.dump_values=!0,b.reallocate_objects=!0);if(this.dump_values)return this.hist=[],this.leaf=b.leaf,this.copy_fields=(b.branch.fLeaves&&1<b.branch.fLeaves.arr.length||
b.branch.fBranches&&0<b.branch.fBranches.arr.length)&&!b.leaf,this.AddBranch(d,"br0",b.direct_branch),this.Process=this.ProcessDump,!0;this.vars[0]=new t(this.globals);if(!this.vars[0].Parse(a,this,c,d,b.direct_branch))return!1;this.hist_title="drawing branch '"+d.fName+(c?"' expr:'"+c:"")+"'  from "+a.fName;this.cut=new t(this.globals);this.vars[0].direct_branch&&(this.ProcessArrays=this.ProcessArraysFunc);return!0};r.prototype.Begin=function(a){this.globals.entries=a.fEntries;this.monitoring&&(this.lasttm=
(new Date).getTime())};r.prototype.ShowProgress=function(a){if("undefined"!=typeof document&&b.progress){if(void 0===a||isNaN(a))return b.progress();if(this.last_progress!==a){var d=a-this.last_progress;this.aver_diff||(this.aver_diff=d);this.aver_diff=.3*d+.7*this.aver_diff}d=0;0>=this.aver_diff?d=0:1E-4>this.aver_diff?d=3:.001>this.aver_diff?d=2:.01>this.aver_diff&&(d=1);var c=document.createElement("p"),g=document.createTextNode("TTree draw "+(100*a).toFixed(d)+" %  "),e=this;c.appendChild(g);
c.title="Click on element to break drawing";c.onclick=function(){if(3>++e.break_execution)return c.title="Tree draw will break after next I/O operation",g.nodeValue="Breaking ... ";e.Abort();b.progress()};b.progress(c);this.last_progress=a}};r.prototype.GetBitsBins=function(a,d){d.nbins=d.max=a;d.fLabels=b.Create("THashList");for(var c=0;c<a;++c){var g=b.Create("TObjString");g.fString=c.toString();g.fUniqueID=c+1;d.fLabels.Add(g)}return d};r.prototype.GetMinMaxBins=function(a,d){var c={min:0,max:0,
nbins:d,k:1,fLabels:null,title:""};if(a>=this.ndim)return c;var g=this.vars[a].buf;c.title=this.vars[a].code||"";if("object"===this.vars[a].kind){for(var e,h=!0,p=8,k=0;k<g.length;++k)g[k]&&(e||(e=g[k]._typename),e!==g[k]._typename&&(h=!1),g[k].fNbits&&(p=Math.max(p,g[k].fNbits+1)));if(e&&h&&"TBits"===e&&0===a)return this.Fill1DHistogram=this.FillTBitsHistogram,p%8&&(p=(p&65520)+8),"bits"===this.hist_name&&1==this.hist_args.length&&this.hist_args[0]&&(p=this.hist_args[0]),this.GetBitsBins(p,c)}if("string"===
this.vars[a].kind){c.lbls=[];for(k=0;k<g.length;++k)0>c.lbls.indexOf(g[k])&&c.lbls.push(g[k]);c.lbls.sort();c.max=c.nbins=c.lbls.length;c.fLabels=b.Create("THashList");for(k=0;k<c.lbls.length;++k)d=b.Create("TObjString"),d.fString=c.lbls[k],d.fUniqueID=k+1,""===d.fString&&(d.fString="<empty>"),c.fLabels.Add(d)}else{if(0===a&&"bits"===this.hist_name&&1>=this.hist_args.length)return this.Fill1DHistogram=this.FillBitsHistogram,this.GetBitsBins(this.hist_args[0]||32,c);if(3*a+2<this.hist_args.length)c.nbins=
this.hist_args[3*a],c.min=this.hist_args[3*a+1],c.max=this.hist_args[3*a+2];else{c.min=Math.min.apply(null,g);c.max=Math.max.apply(null,g);this.hist_nbins&&(d=c.nbins=this.hist_nbins);c.isinteger=Math.round(c.min)===c.min&&Math.round(c.max)===c.max;if(c.isinteger)for(k=0;k<g.length;++k)if(g[k]!==Math.round(g[k])){c.isinteger=!1;break}if(c.isinteger)if(c.min=Math.round(c.min),c.max=Math.round(c.max),c.max-c.min<5*d)--c.min,c.max+=2,c.nbins=Math.round(c.max-c.min);else{k=c.max-c.min+2;for(a=Math.floor(k/
d);a*d<k;)a++;c.max=c.min+d*a}else c.min>=c.max?(c.max=c.min,100>Math.abs(c.min)?(--c.min,c.max+=1):0<c.min?(c.min*=.9,c.max*=1.1):(c.min*=1.1,c.max*=.9)):c.max+=(c.max-c.min)/c.nbins}}c.k=c.nbins/(c.max-c.min);c.GetBin=function(a){a=this.lbls?this.lbls.indexOf(a):Math.floor((a-this.min)*this.k);return 0>a?0:a>this.nbins?this.nbins+1:a+1};return c};r.prototype.CreateHistogram=function(){if(!this.hist&&this.vars[0].buf){if(this.dump_values)this.hist=[],this.Fill1DHistogram=this.Fill2DHistogram=this.Fill3DHistogram=
this.DumpValue;else if(this.graph){var a=this.vars[0].buf.length;1==this.ndim?this.hist=b.CreateTGraph(a,Array.from(Array(a).keys()),this.vars[0].buf):2==this.ndim&&(this.hist=b.CreateTGraph(a,this.vars[0].buf,this.vars[1].buf),delete this.vars[1].buf);this.hist.fTitle=this.hist_title;this.hist.fName="Graph"}else{this.x=this.GetMinMaxBins(0,1<this.ndim?50:200);this.y=this.GetMinMaxBins(1,50);this.z=this.GetMinMaxBins(2,50);switch(this.ndim){case 1:this.hist=b.CreateHistogram("TH1"+this.htype,this.x.nbins);
break;case 2:this.hist=b.CreateHistogram("TH2"+this.htype,this.x.nbins,this.y.nbins);break;case 3:this.hist=b.CreateHistogram("TH3"+this.htype,this.x.nbins,this.y.nbins,this.z.nbins)}this.hist.fXaxis.fTitle=this.x.title;this.hist.fXaxis.fXmin=this.x.min;this.hist.fXaxis.fXmax=this.x.max;this.hist.fXaxis.fLabels=this.x.fLabels;1<this.ndim&&(this.hist.fYaxis.fTitle=this.y.title);this.hist.fYaxis.fXmin=this.y.min;this.hist.fYaxis.fXmax=this.y.max;this.hist.fYaxis.fLabels=this.y.fLabels;2<this.ndim&&
(this.hist.fZaxis.fTitle=this.z.title);this.hist.fZaxis.fXmin=this.z.min;this.hist.fZaxis.fXmax=this.z.max;this.hist.fZaxis.fLabels=this.z.fLabels;this.hist.fName=this.hist_name;this.hist.fTitle=this.hist_title;this.hist.$custom_stat="$htemp"==this.hist_name?111110:111111}a=this.vars[0].buf;var d=this.cut.buf,c=a.length;if(!this.graph)switch(this.ndim){case 1:for(var g=0;g<c;++g)this.Fill1DHistogram(a[g],d?d[g]:1);break;case 2:var e=this.vars[1].buf;for(g=0;g<c;++g)this.Fill2DHistogram(a[g],e[g],
d?d[g]:1);delete this.vars[1].buf;break;case 3:e=this.vars[1].buf;var h=this.vars[2].buf;for(g=0;g<c;++g)this.Fill3DHistogram(a[g],e[g],h[g],d?d[g]:1);delete this.vars[1].buf;delete this.vars[2].buf}delete this.vars[0].buf;delete this.cut.buf}};r.prototype.FillTBitsHistogram=function(a,b){if(b&&a&&a.fNbits&&a.fAllBits)for(var c=Math.min(a.fNbits+1,8*a.fNbytes),d=0,e=1,h=0;d<c;++d)a.fAllBits[h]&&e&&(d<=this.x.nbins?this.hist.fArray[d+1]+=b:this.hist.fArray[this.x.nbins+1]+=b),e*=2,256<=e&&(e=1,++h)};
r.prototype.FillBitsHistogram=function(a,b){if(b)for(var c=0,d=1;c<this.x.nbins;++c)a&d&&(this.hist.fArray[c+1]+=b),d*=2};r.prototype.Fill1DHistogram=function(a,b){var c=this.x.GetBin(a);this.hist.fArray[c]+=b;this.x.lbls||(this.hist.fTsumw+=b,this.hist.fTsumwx+=b*a,this.hist.fTsumwx2+=b*a*a)};r.prototype.Fill2DHistogram=function(a,b,c){var d=this.x.GetBin(a),e=this.y.GetBin(b);this.hist.fArray[d+(this.x.nbins+2)*e]+=c;this.x.lbls||this.y.lbls||(this.hist.fTsumw+=c,this.hist.fTsumwx+=c*a,this.hist.fTsumwy+=
c*b,this.hist.fTsumwx2+=c*a*a,this.hist.fTsumwxy+=c*a*b,this.hist.fTsumwy2+=c*b*b)};r.prototype.Fill3DHistogram=function(a,b,c,g){var d=this.x.GetBin(a),h=this.y.GetBin(b),p=this.z.GetBin(c);this.hist.fArray[d+(this.x.nbins+2)*(h+(this.y.nbins+2)*p)]+=g;this.x.lbls||this.y.lbls||this.z.lbls||(this.hist.fTsumw+=g,this.hist.fTsumwx+=g*a,this.hist.fTsumwy+=g*b,this.hist.fTsumwz+=g*c,this.hist.fTsumwx2+=g*a*a,this.hist.fTsumwy2+=g*b*b,this.hist.fTsumwz2+=g*c*c,this.hist.fTsumwxy+=g*a*b,this.hist.fTsumwxz+=
g*a*c,this.hist.fTsumwyz+=g*b*c)};r.prototype.DumpValue=function(a,b,c,g){switch(this.ndim){case 1:var d={x:a,weight:b};break;case 2:d={x:a,y:b,weight:c};break;case 3:d={x:a,y:b,z:c,weight:g}}this.cut.is_dummy()&&(1===this.ndim?d=a:delete d.weight);this.hist.push(d)};r.prototype.ProcessArraysFunc=function(a){if(this.arr_limit||this.graph){var b=this.vars[0];a=this.tgtarr.br0.length;var c=this.vars[1],g=this.vars[2];if(0===b.buf.length&&a>=this.arr_limit&&!this.graph)b.buf=this.tgtarr.br0,c&&(c.buf=
this.tgtarr.br1),g&&(g.buf=this.tgtarr.br2);else for(var e=0;e<a;++e)b.buf.push(this.tgtarr.br0[e]),c&&c.buf.push(this.tgtarr.br1[e]),g&&g.buf.push(this.tgtarr.br2[e]);b.kind="number";c&&(c.kind="number");g&&(g.kind="number");this.cut.buf=null;!this.graph&&b.buf.length>=this.arr_limit&&(this.CreateHistogram(),this.arr_limit=0)}else switch(b=this.tgtarr.br0,a=b.length,this.ndim){case 1:for(e=0;e<a;++e)this.Fill1DHistogram(b[e],1);break;case 2:c=this.tgtarr.br1;for(e=0;e<a;++e)this.Fill2DHistogram(b[e],
c[e],1);break;case 3:for(c=this.tgtarr.br1,g=this.tgtarr.br2,e=0;e<a;++e)this.Fill3DHistogram(b[e],c[e],g[e],1)}};r.prototype.ProcessDump=function(a){(a=this.leaf?this.tgtobj.br0[this.leaf]:this.tgtobj.br0)&&this.copy_fields?0===b.CheckArrayPrototype(a)?this.hist.push(b.extend({},a)):this.hist.push(a):this.hist.push(a)};r.prototype.Process=function(a){this.globals.entry=a;this.cut.Produce(this.tgtobj);if(this.dump_values||this.cut.value){for(a=0;a<this.ndim;++a)this.vars[a].Produce(this.tgtobj);a=
this.vars[0];var d=this.vars[1],c=this.vars[2],g=this.cut;if(this.graph||this.arr_limit){switch(this.ndim){case 1:for(var e=0;e<a.length;++e)a.buf.push(a.get(e)),g.buf.push(g.value);break;case 2:for(e=0;e<a.length;++e)for(var h=0;h<d.length;++h)a.buf.push(a.get(e)),d.buf.push(d.get(h)),g.buf.push(g.value);break;case 3:for(e=0;e<a.length;++e)for(h=0;h<d.length;++h)for(var p=0;p<c.length;++p)a.buf.push(a.get(e)),d.buf.push(d.get(h)),c.buf.push(c.get(p)),g.buf.push(g.value)}!this.graph&&a.buf.length>=
this.arr_limit&&(this.CreateHistogram(),this.arr_limit=0)}else if(this.hist)switch(this.ndim){case 1:for(e=0;e<a.length;++e)this.Fill1DHistogram(a.get(e),g.value);break;case 2:for(e=0;e<a.length;++e)for(h=0;h<d.length;++h)this.Fill2DHistogram(a.get(e),d.get(h),g.value);break;case 3:for(e=0;e<a.length;++e)for(h=0;h<d.length;++h)for(p=0;p<c.length;++p)this.Fill3DHistogram(a.get(e),d.get(h),c.get(p),g.value)}this.monitoring&&this.hist&&!this.dump_values&&(a=(new Date).getTime(),a-this.lasttm>this.monitoring&&
(this.lasttm=a,b.CallBack(this.histo_callback,this.hist,this.histo_drawopt,!0)))}};r.prototype.Terminate=function(a){a&&!this.hist&&this.CreateHistogram();this.ShowProgress();return b.CallBack(this.histo_callback,this.hist,this.dump_values?"inspect":this.histo_drawopt)};b.IO.FindBrachStreamerElement=function(a,d){function c(c){if(!c||c.fName!==g)return!1;if(c.fType===a.fStreamerType||c.fType===b.IO.kBool&&a.fStreamerType===b.IO.kUChar||(a.fStreamerType===b.IO.kSTL||a.fStreamerType===b.IO.kSTL+b.IO.kOffsetL||
a.fStreamerType===b.IO.kSTLp||a.fStreamerType===b.IO.kSTLp+b.IO.kOffsetL)&&c.fType===b.IO.kStreamer)return!0;console.warn("Should match element",c.fType,"with branch",a.fStreamerType);return!1}if(!a||!d||"TBranchElement"!==a._typename||0>a.fID||0>a.fStreamerType)return null;d=(d=d.FindStreamerInfo(a.fClassName,a.fClassVersion,a.fCheckSum))&&d.fElements?d.fElements.arr:null;if(!d)return null;var g=a.fName,e=g.indexOf("[");0<e&&(g=g.substr(0,e));e=g.lastIndexOf(".");0<e&&(g=g.substr(e+1));if(c(d[a.fID]))return d[a.fID];
for(e=0;e<d.length;++e)if(e!==a.fID&&c(d[e]))return d[e];console.error("Did not found/match element for branch",a.fName,"class",a.fClassName);return null};b.IO.DefineMemberTypeName=function(a,d,c){d=(d=a.FindStreamerInfo(d))&&d.fElements?d.fElements.arr:null;var g=null;if(!d)return"";for(var e=0;e<d.length;++e)if("BASE"===d[e].fTypeName){var h=b.IO.DefineMemberTypeName(a,d[e].fName,c);if(h)return h}else if(d[e].fName===c){g=d[e];break}if(!g)return"";a=g.fTypeName;"*"===a[a.length-1]&&(a=a.substr(0,
a.length-1));return a};b.IO.GetBranchObjectClass=function(a,d,c,g){if(!a||"TBranchElement"!==a._typename)return"";if(a.fType===b.BranchType.kLeafNode&&-2===a.fID&&-1===a.fStreamerType)return a.fClassName;if(c&&a.fClonesName&&(a.fType===b.BranchType.kClonesNode||a.fType===b.BranchType.kSTLNode))return a.fClonesName;d=b.IO.FindBrachStreamerElement(a,d.$file);if(a.fType===b.BranchType.kBaseClassNode&&d&&"BASE"===d.fTypeName)return d.fName;if(a.fType===b.BranchType.kObjectNode)return!d||d.fType!==b.IO.kObject&&
d.fType!==b.IO.kAny?"TObject":d.fTypeName;if(a.fType===b.BranchType.kLeafNode&&d&&g){if(d.fType===b.IO.kObject||d.fType===b.IO.kAny)return d.fTypeName;if(d.fType===b.IO.kObjectp)return d.fTypeName.substr(0,d.fTypeName.length-1)}return""};b.IO.MakeMethodsList=function(a){var d=b.getMethods(a),c={names:[],values:[],Create:function(){for(var a={},b=0;b<this.names.length;++b)a[this.names[b]]=this.values[b];return a}};c.names.push("_typename");c.values.push(a);for(var g in d)c.names.push(g),c.values.push(d[g]);
return c};b.IO.DetectBranchMemberClass=function(a,b,c){var d="";for(c=c||0;c<a.arr.length;++c)0===a.arr[c].fName.indexOf(b)&&a.arr[c].fClassName&&(d=a.arr[c].fClassName);return d};b.TreeMethods={};b.TreeMethods.Process=function(a,d){function c(a,c){switch(a._typename){case "TLeafF":var d=b.IO.kFloat;break;case "TLeafD":d=b.IO.kDouble;break;case "TLeafO":d=b.IO.kBool;break;case "TLeafB":d=a.fIsUnsigned?b.IO.kUChar:b.IO.kChar;break;case "TLeafS":d=a.fIsUnsigned?b.IO.kUShort:b.IO.kShort;break;case "TLeafI":d=
a.fIsUnsigned?b.IO.kUInt:b.IO.kInt;break;case "TLeafL":d=a.fIsUnsigned?b.IO.kULong64:b.IO.kLong64;break;case "TLeafC":d=b.IO.kTString;break;default:return null}return b.IO.CreateStreamerElement(c||a.fName,d)}function g(a){for(var b=0;b<f.arr.length;++b)if(f.arr[b].branch===a)return f.arr[b];return null}function e(a,h,k,p){function q(c,d,g){if(!c||!c.arr.length)return!0;var m=a.fName;"."===m[m.length-1]&&(m=m.substr(0,m.length-1));"string"===typeof p&&"."==p[0]&&(m+=p);m+=".";for(var E=0;E<c.arr.length;++E){var l=
c.arr[E];if(!(0<g&&l.fType!==g))if(l.fType===b.BranchType.kBaseClassNode){if(!q(l.fBranches,d,g))return!1}else{var A=b.IO.FindBrachStreamerElement(l,f.file);if(A&&"BASE"===A.fTypeName){if(l.fTotBytes&&!e(l,h,k,p)||!q(l.fBranches,d,g))return!1}else{A=l.fName;var u=1;if(0===l.fName.indexOf(m))A=A.substr(m.length);else if(0<g)continue;var n=A.indexOf("[");0<n&&(A=A.substr(0,n));n=A.indexOf("<");0<n&&(A=A.substr(0,n));0<g&&(u="$child$",n=A.indexOf("."),0<n&&(u=b.IO.DetectBranchMemberClass(c,a.fName+"."+
A.substr(0,n+1),E)||"TObject"));if(!e(l,d,A,u))return!1}}}return!0}"string"===typeof a&&(a=f.tree.FindBranch(a));if(!a)return console.error("Did not found branch"),null;var l=g(a);if(l)return console.error("Branch already configured for reading",a.fName),l.tgt!==h&&console.error("Target object differs"),u;if(!a.fEntries)return console.warn("Branch ",a.fName," does not have entries"),null;for(l={branch:a,tgt:h,name:k,index:-1,member:null,type:0,curr_entry:-1,raw:null,basket:null,curr_basket:0,read_entry:-1,
staged_entry:-1,first_readentry:-1,staged_basket:0,numentries:a.fEntries,numbaskets:a.fWriteBasket,counters:null,ascounter:[],baskets:[],staged_prev:0,staged_now:0,progress_showtm:0,GetBasketEntry:function(a){if(!this.branch||a>this.branch.fMaxBaskets)return 0;var b=a<this.branch.fMaxBaskets?this.branch.fBasketEntry[a]:0;return b?b:(b=0<a?this.branch.fBaskets.arr[a-1]:null)?this.branch.fBasketEntry[a-1]+b.fNevBuf:0},GetTarget:function(a){if(!this.tgt)return a;for(var b=0;b<this.tgt.length;++b){var c=
this.tgt[b];a[c.name]||(a[c.name]=c.lst.Create());a=a[c.name]}return a},GetEntry:function(a){a-=this.first_entry;this.branch.TestBit(b.IO.BranchBits.kDoNotUseBufferMap)||this.raw.ClearObjectMap();if(this.basket.fEntryOffset){var c=this.basket.fEntryOffset[a];this.basket.fDisplacement&&(this.raw.fDisplacement=this.basket.fDisplacement[a])}else c=this.basket.fKeylen+this.basket.fNevBufSize*a;this.raw.locate(c-this.raw.raw_shift)}};l.GetBasketEntry(l.numbaskets+1);)l.numbaskets++;var n=a.fLeaves?a.fLeaves.arr.length:
0,z=0<n?a.fLeaves.arr[0]:null,u=null,m=null,C="TBranchElement"===a._typename,w=0,y=null,t=null,r="";if(a.fBranchCount){(y=g(a.fBranchCount))||(y=e(a.fBranchCount,h,"$counter"+x++,!0));if(!y)return console.error("Cannot add counter branch",a.fBranchCount.fName),null;var v=a.fBranchCount2;if(!v&&a.fBranchCount.fStreamerType===b.IO.kSTL&&(a.fStreamerType===b.IO.kStreamLoop||a.fStreamerType===b.IO.kOffsetL+b.IO.kStreamLoop)){var F=b.IO.FindBrachStreamerElement(a,f.file),D=a.fBranchCount.fBranches.arr;
if(F&&F.fCountName&&D)for(r=0;r<D.length;++r)if(D[r].fName===a.fBranchCount.fName+"."+F.fCountName){v=D[r];break}v||console.error("Did not found branch for second counter of kStreamLoop element")}if(v&&((t=g(v))||(t=e(v,h,"$counter"+x++,!0)),!t))return console.error("Cannot add counter branch2",v.fName),null}else if(1===n&&z&&z.fLeafCount&&(r=f.tree.FindBranch(z.fLeafCount.fName))&&((y=g(r))||(y=e(r,h,"$counter"+x++,!0)),!y))return console.error("Cannot add counter branch",r.fName),null;if("TBranchObject"===
a._typename)m={name:k,typename:a.fClassName,virtual:z.fVirtual,func:function(a,b){var c=this.typename;this.virtual&&(c=a.ReadFastString(a.ntou1()+1));b[this.name]=a.ClassStreamer({},c)}};else if(a.fType===b.BranchType.kClonesNode||a.fType===b.BranchType.kSTLNode){if(u=b.IO.CreateStreamerElement(k,b.IO.kInt),!p||"string"===typeof p&&"."===p[0]||1===p){f.process_arrays=!1;m={name:k,conttype:a.fClonesName||"TObject",reallocate:d.reallocate_objects,func:function(a,b){a=a.ntoi4();var c=0;!b[this.name]||
this.reallocate?b[this.name]=Array(a):(c=b[this.name].length,b[this.name].length=a);for(;c<a;)b[this.name][c++]=this.methods.Create()}};if("string"===typeof p&&"."===p[0]&&(m.conttype=b.IO.DetectBranchMemberClass(a.fBranches,a.fName+p),!m.conttype))return console.error("Cannot select object",p,"in the branch",a.fName),null;m.methods=b.IO.MakeMethodsList(m.conttype);w=a.fType===b.BranchType.kClonesNode?b.BranchType.kClonesMemberNode:b.BranchType.kSTLMemberNode}}else{if(r=b.IO.GetBranchObjectClass(a,
f.tree)){if(!0===p)return console.warn("Object branch "+r+" can not have data to be read directly"),null;f.process_arrays=!1;u=Array(h?h.length+1:1);for(z=0;z<u.length-1;++z)u[z]=h[z];u[u.length-1]={name:k,lst:b.IO.MakeMethodsList(r)};return q(a.fBranches,u,0)?l:null}if(C&&1===n&&z.fName===a.fName&&-1==a.fID)u=b.IO.CreateStreamerElement(k,a.fClassName),u.fType===b.IO.kAny&&((n=f.file.GetStreamer(a.fClassName,{val:a.fClassVersion,checksum:a.fCheckSum}))?m={name:k,typename:a.fClassName,streamer:n,func:function(a,
b){for(var c={_typename:this.typename},d=0;d<this.streamer.length;++d)this.streamer[d].func(a,c);b[this.name]=c}}:(u=null,console.warn("not found streamer!")));else if(C&&1>=n)u=b.IO.FindBrachStreamerElement(a,f.file),!u&&a.fStreamerType&&20>a.fStreamerType&&(u=b.IO.CreateStreamerElement(k,a.fStreamerType));else if(1===n)u=c(z,k);else if("TBranch"===a._typename&&1<n){r=Array(n);C=!0;for(z=0;z<n;++z)r[z]=c(a.fLeaves.arr[z]),r[z]=b.IO.CreateMember(r[z],f.file),r[z]||(C=!1);C&&(m={name:k,leaves:r,func:function(a,
b){var c=b[this.name],d=0;for(c||(b[this.name]=c={});d<this.leaves.length;)this.leaves[d++].func(a,c)}})}}if(!u&&!m)return console.warn("Not supported branch kind",a.fName,a._typename),null;m||(m=b.IO.CreateMember(u,f.file),void 0!==m.base&&m.basename&&(m.func=function(a,b){b[this.name]||(b[this.name]={_typename:this.basename});a.ClassStreamer(b[this.name],this.basename)}));if(y&&"string"===typeof p){m.name0=y.name;var B=k.split(".");if(1===B.length)m.get=function(a,b){return a[b]};else{if("$child$"===
p)return console.error("target name contains point, but suppose to be direct child",k),null;if(2===B.length)k=m.name=B[1],m.name1=B[0],m.subtype1=p,m.methods1=b.IO.MakeMethodsList(m.subtype1),m.get=function(a,b){var c=a[b][this.name1];c||(c=a[b][this.name1]=this.methods1.Create());return c};else{if(!a.fParentName)return console.error("Not possible to provide more than 2 parts in the target name",k),null;k=m.name=B.pop();m.snames=B;m.smethods=[];n=a.fParentName;for(r=0;r<B.length;++r)n=b.IO.DefineMemberTypeName(f.file,
n,B[r]),m.smethods[r]=b.IO.MakeMethodsList(n||"AbstractClass");m.get=function(a,b){var c=a[b][this.snames[0]];c||(c=a[b][this.snames[0]]=this.smethods[0].Create());for(a=1;a<this.snames.length;++a)(b=c[this.snames[a]])||(b=c[this.snames[a]]=this.smethods[a].Create()),c=b;return c}}}m.objs_branch_func?m.func=m.objs_branch_func:(m.func0=m.func,m.func=function(a,b){b=b[this.name0];for(var c=0;c<b.length;)this.func0(a,this.get(b,c++))})}else if(y)if(f.process_arrays=!1,u.fType===b.IO.kDouble32||u.fType===
b.IO.kFloat16)m.stl_size=y.name,m.func=function(a,b){b[this.name]=this.readarr(a,b[this.stl_size])};else if(u.fType!==b.IO.kOffsetP+b.IO.kDouble32&&u.fType!==b.IO.kOffsetP+b.IO.kFloat16||!a.fBranchCount2)if(0<u.fType&&u.fType<b.IO.kOffsetL||u.fType===b.IO.kTString||u.fType>b.IO.kOffsetP&&u.fType<b.IO.kOffsetP+b.IO.kOffsetL&&a.fBranchCount2)m={name:k,stl_size:y.name,type:u.fType,func:function(a,b){b[this.name]=a.ReadFastArray(b[this.stl_size],this.type)}},a.fBranchCount2&&(m.type-=b.IO.kOffsetP,m.arr_size=
t.name,m.func=function(a,b){for(var c=b[this.stl_size],d=b[this.arr_size],f=Array(c),e=0;e<c;++e)f[e]=1===a.ntou1()?a.ReadFastArray(d[e],this.type):[];b[this.name]=f});else if(u.fType>b.IO.kOffsetP&&u.fType<b.IO.kOffsetP+b.IO.kOffsetL&&m.cntname)m.cntname=y.name;else if(u.fType==b.IO.kStreamer){if(t)throw Error("Second branch counter not supported yet with JSROOT.IO.kStreamer");m.func=m.branch_func;m.stl_size=y.name}else if(u.fType===b.IO.kStreamLoop||u.fType===b.IO.kOffsetL+b.IO.kStreamLoop)t?(m.stl_size=
y.name,m.cntname=t.name,m.func=m.branch_func):m.cntname=y.name;else{m.name="$stl_member";if(t)if(m.cntname)B=t.name,m.cntname="$loop_size";else throw Error("Second branch counter not used - very BAD");m={name:k,stl_size:y.name,loop_size:B,member0:m,func:function(a,b){var c=b[this.stl_size],d=Array(c),f;for(f=0;f<c;++f)this.loop_size&&(b.$loop_size=b[this.loop_size][f]),this.member0.func(a,b),d[f]=b.$stl_member;delete b.$stl_member;delete b.$loop_size;b[this.name]=d}}}else m.stl_size=y.name,m.arr_size=
t.name,m.func=function(a,b){for(var c=b[this.stl_size],d=b[this.arr_size],f=Array(c),e=0;e<c;++e)f[e]=1===a.ntou1()?this.readarr(a,d[e]):[];b[this.name]=f};m.name=k;l.member=m;u&&(l.type=u.fType);l.index=f.arr.length;y&&(l.counters=[y.index],y.ascounter.push(l.index),t&&(l.counters.push(t.index),t.ascounter.push(l.index)));f.arr.push(l);return w&&!q(a.fBranches,h,w)?null:l}function h(a,c){function d(){k=[];h="";for(var b=0;b<a.length;++b)if(!a[b].done){var c=a[b].branch;if(0===k.length)h=c.fFileName;
else if(h!==c.fFileName)continue;a[b].selected=!0;k.push(c.fBasketSeek[a[b].basket],c.fBasketBytes[a[b].basket])}return 0<k.length}function e(a){if(!(f.staged_prev===f.staged_now||f.process_max<=f.process_min)){var b=(new Date).getTime();500>b-f.progress_showtm||(f.progress_showtm=b,f.selector.ShowProgress((f.staged_prev+a*(f.staged_now-f.staged_prev))/(f.process_max-f.process_min)))}}function g(p){if(!p||2<k.length&&2*p.length!==k.length)return b.CallBack(c,null);for(var l=0,m=0;m<a.length;++m)if(a[m].selected){a[m].selected=
!1;a[m].done=!0;var q=2<k.length?p[l++]:p,n=b.CreateTBuffer(q,0,f.file),r=n.ClassStreamer({},"TBasket");r.fNbytes!==a[m].branch.fBasketBytes[a[m].basket]&&console.error("mismatch in read basket sizes",a[m].branch.fBasketBytes[a[m].basket]);a[m].bskt_obj=r;if(r.fKeylen+r.fObjlen===r.fNbytes)n.raw_shift=0;else if(q=b.R__unzip(q,r.fObjlen,!1,n.o))n=b.CreateTBuffer(q,0,f.file),n.raw_shift=r.fKeylen,n.fTagOffset=r.fKeylen;else throw Error("FAIL TO UNPACK");a[m].raw=n;0<a[m].branch.fEntryOffsetLen&&n.ReadBasketEntryOffset(r,
n.raw_shift)}d()?f.file.ReadBuffer(k,g,h,e):b.CallBack(c,a)}var k=[],h="";d()?f.file.ReadBuffer(k,g,h,e):b.CallBack(c,null)}function p(){for(var a=0,c=[],d=!0,e=!1,g=f.process_max;1E6>a&&d;){d=!1;for(var p=f.arr.length-1;0<=p;--p)for(var l=f.arr[p];l.staged_basket<l.numbaskets;){var n=l.staged_basket++;if(l.GetBasketEntry(n)>=f.process_max)break;if(0>l.first_readentry){if(l.GetBasketEntry(n+1)<=f.process_min)continue;l.curr_basket=n;l.first_readentry=l.GetBasketEntry(n)}var q={id:p,branch:l.branch,
basket:n,raw:null},m=l.branch.fBaskets.arr[n];m?(q.raw=m.fBufferRef,q.raw?q.raw.locate(0):q.raw=b.CreateTBuffer(null,0,f.file),q.raw.raw_shift=m.fKeylen,m.fBufferRef&&0<l.branch.fEntryOffsetLen&&q.raw.ReadBasketEntryOffset(m,q.raw.raw_shift),q.bskt_obj=m,e=!0,l.baskets[n]=q):(c.push(q),a+=l.branch.fBasketBytes[n],d=!0);l.staged_entry=l.GetBasketEntry(n+1);g=Math.min(g,l.staged_entry);break}}if(0===a&&!e)return f.selector.Terminate(!0);f.staged_prev=f.staged_now;f.staged_now=g;d=0;f.process_max>f.process_min&&
(d=(f.staged_prev-f.process_min)/(f.process_max-f.process_min));f.selector.ShowProgress(d);f.progress_showtm=(new Date).getTime();if(0<a)return h(c,k);if(e)return k([]);throw Error("No any data is requested - never come here");}function k(a){if(0!==f.selector.break_execution||null===a)return f.selector.Terminate(!1);for(var b=0;b<a.length;++b)f.arr[a[b].id].baskets[a[b].basket]=a[b];for(a=!1;;){var c=1E8;for(b=0;b<f.arr.length;++b){var d=f.arr[b];if(!d.raw||!d.basket||d.first_entry+d.basket.fNevBuf<=
f.current_entry){delete d.raw;delete d.basket;if(d.curr_basket>=d.numbaskets){if(0==b)return f.selector.Terminate(!0);continue}var e=d.baskets[d.curr_basket];if(!e)return a?p():(console.warn("no data?",d.branch.fName,d.curr_basket),f.selector.Terminate(!1));d.raw=e.raw;d.basket=e.bskt_obj;d.first_entry=d.GetBasketEntry(e.basket);e.raw=null;e.branch=null;e.bskt_obj=null;d.baskets[d.curr_basket++]=void 0}c=Math.min(c,d.first_entry+d.basket.fNevBuf-f.current_entry)}f.current_entry+c>f.process_max&&(c=
f.process_max-f.current_entry);if(f.process_arrays&&1<c){for(b=0;b<f.arr.length;++b)d=f.arr[b],d.GetEntry(f.current_entry),d.arrmember.arrlength=c,d.arrmember.func(d.raw,f.selector.tgtarr),d.raw=null;f.selector.ProcessArrays(f.current_entry);f.current_entry+=c;a=!0}else for(;c--;){for(b=0;b<f.arr.length;++b)d=f.arr[b],d.GetEntry(f.current_entry),d.member.func(d.raw,d.GetTarget(f.selector.tgtobj));f.selector.Process(f.current_entry);f.current_entry++;a=!0}if(f.current_entry>=f.process_max)return f.selector.Terminate(!0)}}
d||(d={});if(!a||!this.$file||!a.branches)return console.error("required parameter missing for TTree::Process"),a&&a.Terminate(!1),!1;for(var f={tree:this,file:this.$file,selector:a,arr:[],curr:-1,current_entry:-1,simple_read:!0,process_arrays:!0},x=0,q=0;q<a.branches.length;++q){var l=e(a.branches[q],void 0,a.names[q],a.directs[q]);if(!l)return a.Terminate(!1),!1}for(q=1;q<f.arr.length&&f.simple_read;++q){l=f.arr[q];var w=f.arr[0];if(l.numentries!==w.numentries||l.numbaskets!==w.numbaskets)f.simple_read=
!1;for(var n=0;n<l.numbaskets;++n)l.GetBasketEntry(n)!==w.GetBasketEntry(n)&&(f.simple_read=!1)}for(q=f.firstentry=f.lastentry=0;q<f.arr.length;++q)l=f.arr[q].branch,w=l.fFirstEntry,void 0===w&&(w=l.fBasketBytes[0]?l.fBasketEntry[0]:0),f.firstentry=Math.max(f.firstentry,w),f.lastentry=0===q?w+l.fEntries:Math.min(f.lastentry,w+l.fEntries);if(f.firstentry>=f.lastentry)return console.warn("No any common events for selected branches"),a.Terminate(!1),!1;f.process_min=f.firstentry;f.process_max=f.lastentry;
!isNaN(d.firstentry)&&d.firstentry>f.firstentry&&d.firstentry<f.lastentry&&(f.process_min=d.firstentry);f.current_entry=f.staged_now=f.process_min;!isNaN(d.numentries)&&0<d.numentries&&(l=f.process_min+d.numentries,l<f.process_max&&(f.process_max=l));if("function"===typeof a.ProcessArrays&&f.simple_read){for(l=0;l<f.arr.length;++l)if(w=f.arr[l],0>=w.type||w.type>=b.IO.kOffsetL||w.type===b.IO.kCharStar)f.process_arrays=!1;if(f.process_arrays)for(a.tgtarr={},q=0;q<f.arr.length;++q)l=f.arr[q],w=b.IO.CreateStreamerElement(l.name,
l.type),w.fType=l.type+b.IO.kOffsetL,w.fArrayLength=10,w.fArrayDim=1,w.fMaxIndex[0]=10,l.arrmember=b.IO.CreateMember(w,f.file)}else f.process_arrays=!1;f.selector.Begin(this);p();return!0};b.TreeMethods.FindBranch=function(a,b,c){var d=!1,e=a,h=null;if(void 0===c){d=!0;c=this.fBranches;var p=e.indexOf("[");0<p&&(e=e.substr(0,p))}if(!c||0===c.arr.length)return null;for(p=0;p<c.arr.length;++p){var k=c.arr[p].fName;"]"==k[k.length-1]&&(k=k.substr(0,k.indexOf("[")));if(0!==e.indexOf(k)&&0<k.indexOf("<")){var f=
k.indexOf("<"),n=k.lastIndexOf(">");k=k.substr(0,f)+k.substr(n+1)}if(k===e){h={branch:c.arr[p],rest:""};break}if(0===e.indexOf(k)&&(f=k.length,"."===k[f-1]&&f--,"."===e[f])){(h=this.FindBranch(e,b,c.arr[p].fBranches))||(h=this.FindBranch(e.substr(f+1),b,c.arr[p].fBranches));h||(h={branch:c.arr[p],rest:e.substr(f)});break}}if(!d||!h)return h;a.length>e.length&&(h.rest+=a.substr(e.length));return!b&&0<h.rest.length?null:b?h:h.branch};b.TreeMethods.Draw=function(a,d){"string"===typeof a&&(a={expr:a});
a.expr||(a.expr="");if("testio"===a.expr)return this.IOTest(a,d);var c=new r(d);a.branch?c.DrawOnlyBranch(this,a.branch,a.expr,a)||(c=null):c.ParseDrawExpression(this,a)||(c=null);return c?this.Process(c,a):b.CallBack(d,null)};b.TreeMethods.IOTest=function(a,d){function c(){var e=new n;e.AddBranch(a.branches[a.nbr],"br0");e.Process=function(){void 0===this.tgtobj.br0&&(this.fail=!0)};e.Terminate=function(f){"string"!==typeof f&&(f=!f||this.fails?"FAIL":"ok");a.names[a.nbr]=f+" "+a.names[a.nbr];a.nbr++;
if(a.nbr>=a.branches.length)return b.progress(),b.CallBack(d,a.names,"inspect");5E3<(new Date).getTime()-a.lasttm||50<a.nbr-a.lastnbr?setTimeout(h.IOTest.bind(h,a,d),100):c()};b.progress("br "+a.nbr+"/"+a.branches.length+" "+a.names[a.nbr]);var g=a.branches[a.nbr],f=b.IO.GetBranchObjectClass(g,h),r=g.fEntries,q=!g.fLeaves||0===g.fLeaves.arr.length;f&&(q=100<a.nchilds[a.nbr]);if(q||0>=r)e.Terminate("ignore");else{f={numentries:10};q=g.fFirstEntry||0;var l=g.fEntryNumber||q+r;r<f.numentries?f.numentries=
r:f.firstentry=q+Math.round((l-q-f.numentries)*Math.random());console.log("test branch",g.fName,"first",f.firstentry||0,"num",f.numentries);h.Process(e,f)}}if(!a.names&&!a.bracnhes){var g=function(b,c){if(!b||!b.fBranches)return 0;for(var d=0,e=0;e<b.fBranches.arr.length;++e){var h=b.fBranches.arr[e],l=(c?c+"/":"")+h.fName;a.branches.push(h);a.names.push(l);a.nchilds.push(0);var k=a.nchilds.length-1;d+=h.fLeaves?h.fLeaves.arr.length:0;h=g(h,l);d+=h;a.nchilds[k]=h}return d};a.branches=[];a.names=[];
a.nchilds=[];a.nbr=0;var e=g(this);a.names.push("Total are "+a.branches.length+" branches with "+e+" leaves")}a.lasttm=(new Date).getTime();a.lastnbr=a.nbr;var h=this;c()};b.TSelector=n;b.TDrawVariable=t;b.TDrawSelector=r;return b});
