var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(d){var q=0;return function(){return q<d.length?{done:!1,value:d[q++]}:{done:!0}}};$jscomp.arrayIterator=function(d){return{next:$jscomp.arrayIteratorImpl(d)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,q,u){d!=Array.prototype&&d!=Object.prototype&&(d[q]=u.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(d,q){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:q})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function d(u){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(u||"")+"_"+q++,u)}var q=0;return d}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.asyncIterator;d||(d=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};
$jscomp.iteratorFromArray=function(d,q){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var u=0,r={next:function(){if(u<d.length){var x=u++;return{value:q(x,d[x]),done:!1}}r.next=function(){return{done:!0,value:void 0}};return r.next()}};r[Symbol.iterator]=function(){return r};return r};
$jscomp.polyfill=function(d,q,u,r){if(q){u=$jscomp.global;d=d.split(".");for(r=0;r<d.length-1;r++){var x=d[r];x in u||(u[x]={});u=u[x]}d=d[d.length-1];r=u[d];q=q(r);q!=r&&null!=q&&$jscomp.defineProperty(u,d,{configurable:!0,writable:!0,value:q})}};$jscomp.polyfill("Array.prototype.keys",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d){return d})}},"es6","es3");
(function(d){if("function"===typeof define&&define.amd)define(["JSRootCore","d3","JSRootPainter"],d);else if("object"===typeof exports&&"undefined"!==typeof module)d(require("./JSRootCore.js"),require("d3"),require("./JSRootPainter.js"));else{if("object"!=typeof d3)throw Error("This extension requires d3.js","JSRootPainter.hierarchy.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.hierarchy.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined",
"JSRootPainter.hierarchy.js");d(JSROOT,d3)}})(function(d,q){function u(a,b){if(!d.IsRootCollection(b))return!1;if(void 0===b.arr||0===b.arr.length)return a._more=!1,!0;for(var e=!1,g=a;g;)g._do_context&&(e=!0),g=g._parent;g="TMap"==b._typename;for(var c=[],f=[],l=[],h=0;h<b.arr.length;++h){var k=g?b.arr[h].first:b.arr[h];if(k){var n=k.fName||k.name;n&&(k=c.indexOf(n),0<=k?f[k]++:(f[c.length]=l[c.length]=1,c.push(n)))}}a._childs=[];for(h=0;h<b.arr.length;++h){if((k=g?b.arr[h].first:b.arr[h])&&k._typename){n=
{_name:k.fName||k.name,_kind:"ROOT."+k._typename,_title:(k.fTitle||"")+" type:"+k._typename,_obj:k};switch(k._typename){case "TColor":n._value=d.Painter.MakeColorRGB(k);break;case "TText":n._value=k.fTitle;break;case "TLatex":n._value=k.fTitle;break;case "TObjString":n._value=k.fString;break;default:b.opt&&b.opt[h]&&b.opt[h].length&&(n._value=b.opt[h])}e&&d.canDraw(k._typename)&&(n._direct_context=!0);!n._name||!isNaN(parseInt(n._name))&&parseInt(n._name)!==h||b.arr.indexOf(k)<h?n._name=h.toString():
(k=c.indexOf(k.fName),0<=k&&1<f[k]&&(n._cycle=l[k]++,n._keyname=n._name,n._name=n._keyname+";"+n._cycle))}else n={_name:h.toString(),_kind:"ROOT.NULL",_title:"NULL",_value:"null",_obj:null};a._childs.push(n)}return!0}function r(a,b,e,g){if(void 0===b)return!1;a._childs=[];for(var c=0;c<b.length;++c){var f=b[c],d={_name:f.fName+";"+f.fCycle,_cycle:f.fCycle,_kind:"ROOT."+f.fClassName,_title:f.fTitle,_keyname:f.fName,_readobj:null,_parent:a};1E5<f.fObjlen&&(d._title+=" (size: "+(f.fObjlen/1E6).toFixed(1)+
"MB)");"fRealName"in f&&(d._realname=f.fRealName+";"+f.fCycle);if("TDirectory"==f.fClassName||"TDirectoryFile"==f.fClassName){var h=null;null!=g&&null!=e&&(h=e.GetDir(g+f.fName));null==h?(d._more=!0,d._expand=function(a,b){return r(a,b.fKeys)}):(d._name=f.fName,r(d,h.fKeys,e,g+f.fName+"/"))}else"TList"==f.fClassName&&"StreamerInfo"==f.fName&&(d._name="StreamerInfo",d._kind="ROOT.TStreamerInfoList",d._title="List of streamer infos for binary I/O",d._readobj=e.fStreamerInfos);a._childs.push(d)}return!0}
function x(a,b,e){if(!a||null===b)return!1;a._childs=[];var g=Object.prototype.toString.apply(b);if("[object DataView]"===g){var c={_parent:a,_name:"size",_value:b.byteLength.toString(),_vclass:"h_value_num"};a._childs.push(c);e=10>b.byteLength?1:d.log10(b.byteLength);for(var f=0;f<b.byteLength;++f){if(0===f%16){for(c={_parent:a,_name:f.toString(),_value:"",_vclass:"h_value_num"};c._name.length<e;)c._name="0"+c._name;a._childs.push(c)}for(var l=b.getUint8(f).toString(16);2>l.length;)l="0"+l;0<c._value.length&&
(c._value+=0===f%4?" | ":" ");c._value+=l}return!0}l=!0;var h=!1;for(c=a;c;){c._do_context&&(h=!0);if("_nosimple"in c){l=c._nosimple;break}c=c._parent}var k=(c=g.lastIndexOf("Array]")==g.length-6&&0==g.indexOf("[object")&&!isNaN(b.length))&&b.length>d.gStyle.HierarchyLimit,n=!1;c&&"Object"===a._name&&!a._parent&&(a._name="Array");if(k)for(n=!0,f=0;f<b.length;++f)if(g=typeof b[f],!("number"===g||"boolean"===g||"string"==g&&16>b[f].length)){n=!1;break}"_obj"in a?a._obj!==b&&alert("object missmatch"):
a._obj=b;a._title||(b._typename?a._title="ROOT."+b._typename:c&&(a._title="Array len: "+b.length));if(n){for(f=0;f<b.length;){e=Math.min(f+10,b.length);l=!0;for(c=f;l;){l=!0;for(h=c;h<e;++h)b[f]!==b[h]&&(l=!1);if(l){if(e===b.length)break;c=e;e=Math.min(e+10,b.length)}else if(c!==f){e=c;l=!0;break}}c={_parent:a,_name:f+".."+(e-1),_vclass:"h_value_num"};if(l)c._value=b[f].toString();else{c._value="";for(h=f;h<e;++h)c._value+=(h===f?"[ ":", ")+b[h].toString();c._value+=" ]"}a._childs.push(c);f=e}return!0}var p;
for(p in b)if("_typename"!=p&&"$"!=p[0]&&(f=b[p],"function"!=typeof f&&!(e&&e.exclude&&0<=e.exclude.indexOf(p)))){if(k&&q){if(G===f){++D;var m=p;continue}0<D&&(q._name+=".."+m)}c={_parent:a,_name:p};if(k){var q=c;m=p;var G=f;var D=0}if(null===f)c._value=c._title="null",l||a._childs.push(c);else{n=!1;if("object"==typeof f)if(g=Object.prototype.toString.apply(f),g.lastIndexOf("Array]")==g.length-6&&0==g.indexOf("[object"))c._title="array len="+f.length,n="[object Array]"!=g,0===f.length?(c._value="[ ]",
c._more=!1):(c._value="[...]",c._more=!0,c._expand=x,c._obj=f);else if("[object DataView]"===g)c._title="DataView len="+f.byteLength,c._value="[...]",c._more=!0,c._expand=x,c._obj=f;else if("[object Date]"===g)c._more=!1,c._title="Date",c._value=f.toString(),c._vclass="h_value_num";else{if(f.$kind||f._typename)c._kind=c._title="ROOT."+(f.$kind||f._typename);f._typename&&(c._title=f._typename,h&&d.canDraw(f._typename)&&(c._direct_context=!0));g=a;for(var E=!1;g&&!E;)E=g._obj===f,g=g._parent;if(E)c._value=
"{ prnt }",c._vclass="h_value_num",c._more=!1,n=!0;else switch(c._obj=f,c._more=!1,f._typename){case "TColor":c._value=d.Painter.MakeColorRGB(f);break;case "TText":c._value=f.fTitle;break;case "TLatex":c._value=f.fTitle;break;case "TObjString":c._value=f.fString;break;default:d.IsRootCollection(f)&&"object"===typeof f.arr?(c._value=f.arr.length?"[...]":"[]",c._title+=", size:"+f.arr.length,0<f.arr.length&&(c._more=!0)):(c._more=!0,c._value="{ }")}}else"number"===typeof f||"boolean"===typeof f?(n=
!0,c._value="fBits"==p?"0x"+f.toString(16):f.toString(),c._vclass="h_value_num"):"string"===typeof f?(n=!0,c._value="&quot;"+f.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"&quot;",c._vclass="h_value_str"):"undefined"===typeof f?(n=!0,c._value="undefined",c._vclass="h_value_num"):(n=!0,alert("miss "+p+"  "+typeof f));n&&l||a._childs.push(c)}}k&&q&&0<D&&(q._name+=".."+m);return!0}function w(a,b,e){this.gui_div=a;this.hpainter=b;this.objpainter=e;this.browser_kind=
null}function m(a,b,e){d.TBasePainter.call(this);this.name=a;this.h=null;this.with_icons=!0;this.background=e;this.files_monitoring=null==b;(this.nobrowser=null===b)||this.SetDivId(b);d.hpainter||(d.hpainter=this)}function t(a){d.TBasePainter.call(this);this.frameid=a;this.SetDivId(a);this.select_main().property("mdi",this);this.CleanupFrame=d.cleanup;this.active_frame_title=""}function B(){d.MDIDisplay.call(this,"dummy");this.frames={}}function y(a,b,e){d.MDIDisplay.call(this,a);this.getcnt=this.framecnt=
0;this.groups=[];this.vertical=b&&"v"==b[0];this.use_separarators=!b||0>b.indexOf("x");this.simple_layout=!1;this.select_main().style("overflow","hidden");if("simple"===b)this.simple_layout=!0,this.use_separarators=!1,this.framecnt=1;else{var g=2,c=a=void 0;if(0==b.indexOf("grid")||e){b=e?b+"x"+e:b.substr(4).trim();this.use_separarators=!1;"i"===b[0]&&(this.use_separarators=!0,b=b.substr(1));e=b.indexOf("x");0<e?(g=parseInt(b.substr(e+1)),b=parseInt(b.substr(0,e))):b=g=parseInt(b);isNaN(b)&&(b=3);
isNaN(g)&&(g=3);if(1<g){if(this.vertical=!0,1<b)for(a=Array(g),e=0;e<g;++e)a[e]=b}else if(1<b)this.vertical=!1,g=b;else{this.simple_layout=!0;this.use_separarators=!1;this.framecnt=1;return}b=""}if(b&&0<b.indexOf("_")&&(e=parseInt(b.substr(b.indexOf("_")+1),10),!isNaN(e)&&10<e))for(b=b.substr(0,b.indexOf("_")),c=[];0<e;)c.unshift(Math.max(e%10,1)),e=Math.round((e-c[0])/10),0===c[0]&&(c[0]=1);if((b=b?parseInt(b.replace(/^\D+/g,""),10):0)&&1<b)if(10>b)g=b;else{for(a=[];0<b;)a.unshift(b%10),b=Math.round((b-
a[0])/10),0==a[0]&&(a[0]=1);g=a.length}c&&c.length!==g&&(c=void 0);this.simple_layout||this.CreateGroup(this,this.select_main(),g,a,c)}}d.sources.push("hierarchy");w.prototype.main=function(){return q.select("#"+this.gui_div)};w.prototype.drawing_divid=function(){return this.gui_div+"_drawing"};w.prototype.CheckResize=function(){this.hpainter&&"function"==typeof this.hpainter.CheckResize?this.hpainter.CheckResize():this.objpainter&&"function"==typeof this.objpainter.CheckResize&&this.objpainter.CheckResize(!0)};
w.prototype.Create=function(a){var b=this.main();b.append("div").attr("id",this.drawing_divid()).classed("jsroot_draw_area",!0).style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0);a&&b.append("div").classed("jsroot_browser",!0)};w.prototype.CreateBrowserBtns=function(){var a=this.main().select(".jsroot_browser");if(!a.empty())return a=a.append("div").classed("jsroot_browser_btns",!0).classed("jsroot",!0),a.style("position","absolute").style("left","7px").style("top",
"7px"),d.touches&&a.style("opacity","0.2"),a};w.prototype.RemoveBrowserBtns=function(){this.main().select(".jsroot_browser").select(".jsroot_browser_btns").remove()};w.prototype.SetBrowserContent=function(a){var b=q.select("#"+this.gui_div+" .jsroot_browser");b.empty()||b.insert("div",".jsroot_browser_btns").classed("jsroot_browser_area",!0).style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("width","250px").style("padding-left","5px").style("display","flex").style("flex-direction",
"column").html("<p class='jsroot_browser_title'>title</p>"+a)};w.prototype.HasContent=function(){var a=q.select("#"+this.gui_div+" .jsroot_browser");return a.empty()?!1:!a.select(".jsroot_browser_area").empty()};w.prototype.DeleteContent=function(){var a=q.select("#"+this.gui_div+" .jsroot_browser");a.empty()||(a.selectAll("*").remove(),delete this.browser_visible)};w.prototype.HasStatus=function(){return q.select("#"+this.gui_div+" .jsroot_browser").empty()?!1:!q.select("#"+(this.gui_div+"_status")).empty()};
w.prototype.CreateStatusLine=function(a,b){if(!this.gui_div)return"";var e=this;d.AssertPrerequisites("jq2d",function(){e.CreateStatusLine(a,b)});return this.gui_div+"_status"};d.hpainter=null;m.prototype=Object.create(d.TBasePainter.prototype);m.prototype.Cleanup=function(){this.clear(!0);d.TBasePainter.prototype.Cleanup.call(this);d.hpainter===this&&(d.hpainter=null)};m.prototype.FileHierarchy=function(a){var b=this,e={_name:a.fFileName,_title:(a.fTitle?a.fTitle+", path ":"")+a.fFullURL,_kind:"ROOT.TFile",
_file:a,_fullurl:a.fFullURL,_localfile:a.fLocalFile,_had_direct_read:!1,_get:function(a,c,f){function e(e){h._file||(h._file=e);if(null==e)return d.CallBack(f,a,null);e.ReadObject(c,function(g){if(!a&&g){var k=b.Find({name:c,top:h,last_exists:!0,check_keys:!0});if(null!=k&&"last"in k&&k.last!=h){var l=e.GetDir(b.itemFullName(k.last,h));if(l){k.last._name=k.last._keyname;var n=b.itemFullName(k.last,h);r(k.last,l.fKeys,e,n+"/")}}else r(h,e.fKeys,e,"");a=b.Find({name:c,top:h})}a&&(a._readobj=g,"_expand"in
a&&(a._name=a._keyname));d.CallBack(f,a,g)})}var h=this;if(a&&a._readobj)return d.CallBack(f,a,a._readobj);null!=a&&(c=b.itemFullName(a,h));h._file?e(h._file):h._localfile?new d.TLocalFile(h._localfile,e):h._fullurl&&new d.TFile(h._fullurl,e)}};r(e,a.fKeys,a,"");return e};m.prototype.ForEach=function(a,b){function e(b){a(b);if("_childs"in b)for(var c=0;c<b._childs.length;++c)b._childs[c]._parent=b,e(b._childs[c])}b||(b=this.h);b&&"function"==typeof a&&e(b)};m.prototype.Find=function(a){function b(c,
e){function d(a,d){d||(a._parent=c);return h>=e.length-1||0>h?a:b(a,e.substr(h+1))}if(!e||0==e.length||!c)return c;var h=e.length;if(!c._parent&&"TopFolder"!==c._kind&&0===e.indexOf(c._name)){if(e===c._name)return c;var k=c._name.length;"/"==e[k]&&(e=e.substr(k+1),h=e.length)}for(;0<h;){k=h>=e.length?e:e.substr(0,h);if(c._childs){for(var f=0;f<c._childs.length;++f)if(c._childs[f]._name==k)return d(c._childs[f]);if("TopFolder"===c._kind&&void 0!==c._childs[0]._online)for(f=0;f<c._childs[0]._childs.length;++f)if(c._childs[0]._childs[f]._name==
k)return d(c._childs[0]._childs[f],!0);if(a.check_keys){var g=null;for(f=0;f<c._childs.length;++f)c._childs[f]._keyname===k&&(!g||g._cycle<c._childs[f]._cycle)&&(g=c._childs[f]);if(g)return d(g)}f=a.allow_index;"["!==k[0]||"]"!==k[k.length-1]||isNaN(parseInt(k.substr(1,k.length-2)))||(f=!0,k=k.substr(1,k.length-2));if(f&&(k=parseInt(k),!isNaN(k)&&0<=k&&k<c._childs.length))return d(c._childs[k])}h=e.lastIndexOf("/",h-1)}return a.force?(void 0===c._childs&&(c._childs=[]),h=e.indexOf("/"),k={_name:0>
h?e:e.substr(0,h)},c._childs.push(k),d(k)):a.last_exists&&c?{last:c,rest:e}:null}var e=this.h,d="";if(null===a)return null;if("string"==typeof a)d=a,a={};else if("object"==typeof a)d=a.name,"top"in a&&(e=a.top);else return null;return"__top_folder__"===d?e:"string"==typeof d&&0==d.indexOf("img:")?null:b(e,d)};m.prototype.itemFullName=function(a,b,e){if(a&&"TopFolder"===a._kind)return"__top_folder__";for(var d="";a&&(void 0===a._online||b)&&a!==b&&"TopFolder"!==a._kind&&(!e||a._parent);)0<d.length&&
(d="/"+d),d=a._name+d,a=a._parent;return d};m.prototype.ExecuteCommand=function(a,b){var e=this.Find(a),g=this.GetOnlineItemUrl(e)+"/cmd.json",c=this,f=q.select("function"==typeof b?void 0:b);if("_numargs"in e)for(var l=0;l<e._numargs;++l){var h="arg"+(l+1),k=null;l+2<arguments.length&&(k=arguments[l+2]);k||"object"!=typeof b||(k=prompt("Input argument "+h+" for command "+e._name,""));if(!k)return;g+=(0==l?"?":"&")+h+"="+k}f.empty()||(f.style("background","yellow"),e&&e._title&&f.attr("title","Executing "+
e._title));d.NewHttpRequest(g,"text",function(a){if("function"==typeof b)return b(a);if(!f.empty()){var d=null!=a&&"false"!=a?"green":"red";e&&e._title&&f.attr("title",e._title+" lastres="+a);f.style("background",d);setTimeout(function(){f.style("background","")},2E3);"green"==d&&"_hreload"in e&&c.reload();"green"==d&&"_update_item"in e&&c.updateItems(e._update_item.split(";"))}}).send()};m.prototype.RefreshHtml=function(a){if(!this.divid)return d.CallBack(a);var b=this;d.AssertPrerequisites("jq2d",
function(){b.RefreshHtml(a)})};m.prototype.get=function(a,b,e){if(null===a)return d.CallBack(b,null,null);var g=this;if("string"===typeof a)var c=a;else if("object"===typeof a)if(void 0!==a._parent&&void 0!==a._name&&void 0!==a._kind)var f=a;else void 0!==a.name?c=a.name:void 0!==a.arg?c=a.arg:void 0!==a.item&&(f=a.item);if("string"==typeof c&&0==c.indexOf("img:"))return d.CallBack(b,null,{_typename:"TJSImage",fName:c.substr(4)});f?c=this.itemFullName(f):f=this.Find({name:c,allow_index:!0,check_keys:!0});
var l=null!=f?null:this.Find({name:c,last_exists:!0,check_keys:!0,allow_index:!0});if(null!==l&&"last"in l&&null!==l.last)return f=this.itemFullName(l.last),"object"==typeof a&&"rest"in a&&(a.rest==l.rest||a.rest.length<=l.rest.length)?d.CallBack(b):this.expand(f,function(a){a||d.CallBack(b);a=g.itemFullName(l.last);0<a.length&&(a+="/");g.get({name:a+l.rest,rest:l.rest},b,e)},null,!0);if(null!==f&&"object"==typeof f._obj)return d.CallBack(b,f,f._obj);for(a=f;a;){if("_get"in a&&"function"==typeof a._get)return a._get(f,
null,b,e);a="_parent"in a?a._parent:null}d.CallBack(b,f,null)};m.prototype.draw=function(a,b,e){return d.draw(a,b,e)};m.prototype.redraw=function(a,b,e){return d.redraw(a,b,e)};m.prototype.player=function(a,b,e){var g=this.Find(a);if(!g||!g._player)return d.CallBack(e,null);var c=this;d.AssertPrerequisites(g._prereq||"",function(){var f=d.findFunction(g._player);if(!f)return d.CallBack(e,null);c.CreateDisplay(function(g){g=g?f(c,a,b):null;d.CallBack(e,g)})})};m.prototype.canDisplay=function(a,b){return a?
a._player?!0:void 0!==a._can_draw?a._can_draw:"inspect"==b?!0:(a=d.getDrawHandle(a._kind,b))&&("func"in a||"draw_field"in a):!1};m.prototype.isItemDisplayed=function(a){var b=this.GetDisplay();return b?null!==b.FindFrame(a):!1};m.prototype.display=function(a,b,e){function g(a){l||d.progress();a&&"object"===typeof a&&"function"===typeof a.SetItemName&&(a.SetItemName(k,l?null:b,c),h&&!h._painter&&(h._painter=a));d.CallBack(e,a||f,k)}var c=this,f=null,l=!1,h=null,k=a,n=a;a=b?b.indexOf("::_display_on_frame_::"):
-1;0<=a&&(n=b.substr(a+22),b=b.substr(0,a));c.CreateDisplay(function(a){if(!a)return g();if((h=c.Find(k))&&"_player"in h)return c.player(k,b,g);if(l="string"==typeof b&&0==b.indexOf("update:")){b=b.substr(7);if(!h||h._doing_update)return g();h._doing_update=!0}if(h&&!c.canDisplay(h,b))return g();var e="";if("string"==typeof b&&0<=b.indexOf("divid:")){var p=b.indexOf("divid:");e=b.slice(p+6);b=b.slice(0,p)}l||d.progress("Loading "+k);c.get(k,function(p,m){l||d.progress();h||(h=p);l&&h&&delete h._doing_update;
if(!m)return g();l||d.progress("Drawing "+k);if(0<e.length)return(l?d.redraw:d.draw)(e,m,b,g);a.ForEachPainter(function(e,c){e.GetItemName()!=k||!l&&null!=b&&e.GetItemDrawOpt()!=b||(a.ActivateFrame(c),c=null,m._typename&&(c=d.getDrawHandle("ROOT."+m._typename)),c&&c.draw_field&&m[c.draw_field]&&(m=m[c.draw_field]),e.RedrawObject(m)&&(f=e))});if(f)return g();if(l)return d.console("something went wrong - did not found painter when doing update of "+k),g();p=a.FindFrame(n,!0);q.select(p).html("");a.ActivateFrame(p);
d.draw(q.select(p).attr("id"),m,b,g);d.gStyle.DragAndDrop&&c.enable_dropping(p,k)},b)})};m.prototype.enable_dragging=function(a,b){};m.prototype.enable_dropping=function(a,b){};m.prototype.dropitem=function(a,b,e,g){function c(b){b&&"object"===typeof b&&b.SetItemName(a,null,f);d.CallBack(g)}var f=this;e&&"function"===typeof e&&(g=e,e="");void 0===e&&(e="");if("$legend"==a)return d.AssertPrerequisites("v6;hist",function(){var a=d.Painter.produceLegend(b,e);d.CallBack(c,a)});f.get(a,function(l,h){if(!h)return d.CallBack(g);
var k=d.GetMainPainter(b);if(k&&"function"===typeof k.PerformDrop)return k.PerformDrop(h,a,l,e,c);if(k&&k.accept_drops)return d.draw(b,h,"same "+e,c);f.CleanupFrame(b);return d.draw(b,h,e,c)});return!0};m.prototype.updateItems=function(a){if(this.disp&&a){var b=[],e=[];this.disp.ForEachPainter(function(d){var c=d.GetItemName();if(c&&!(0<=b.indexOf(c))){if("array"==typeof a){if(0>a.indexOf(c))return}else if(a!=c)return;b.push(c);e.push("update:"+d.GetItemDrawOpt())}},!0);0<b.length&&this.displayAll(b,
e)}};m.prototype.updateAll=function(a,b){if(this.disp){"monitoring"===a&&(a=!this._monitoring_on);var e=[],g=[],c=this;this.disp.ForEachPainter(function(b){var f=b.GetItemName();b=b.GetItemDrawOpt();if(!("string"!=typeof f||0<=e.indexOf(f))){var k=c.Find(f),l=!1;if(!(!k||"_not_monitor"in k||"_player"in k)){if("_always_monitor"in k)l=!0;else if((k=d.getDrawHandle(k._kind))&&"monitor"in k){if(!1===k.monitor||"never"==k.monitor)return;"always"===k.monitor&&(l=!0)}if(l||!a)e.push(f),g.push("update:"+
b)}}},!0);var f=this;this.files_monitoring&&!a&&this.ForEachRootFile(function(a){f.ForEach(function(a){delete a._readobj},a);delete a._file});0<e.length&&this.displayAll(e,g)}};m.prototype.displayAll=function(a,b,e){if(!a||0==a.length)return d.CallBack(e);var g=this;for(b||(b=[]);b.length<a.length;)b.push("");if(1==b.length&&"iotest"==b[0]){g.clear();q.select("#"+g.disp_frameid).html("<h2>Start I/O test</h2>");var c=new Date;return g.get(a[0],function(b,f){b=new Date;q.select("#"+g.disp_frameid).append("h2").html("Item "+
a[0]+" reading time = "+(b.getTime()-c.getTime())+"ms");return d.CallBack(e)})}for(var f=Array(a.length),l=Array(a.length),h=Array(a.length),k=0;k<a.length;++k){f[k]=l[k]=null;var n=a[k],p=!0;if(n&&0==n.indexOf("img:"))h[k]=!0;else if(n&&1<n.length&&"'"==n[0]&&"'"==n[n.length-1]&&(a[k]=n.substr(1,n.length-2),p=!1),n=g.Find({name:a[k],check_keys:!0}))a[k]=g.itemFullName(n);else{p&&"["==a[k][0]&&"]"==a[k][a[k].length-1]?(f[k]=d.ParseAsArray(a[k]),a[k]=f[k].shift()):p&&0<a[k].indexOf("+")&&(f[k]=a[k].split("+"),
a[k]=f[k].shift());if(f[k]&&0<f[k].length){for(p=0;p<f[k].length;++p)n=f[k][p].indexOf("_same_"),0<n&&null===g.Find(f[k][p])&&(f[k][p]=f[k][p].substr(0,n)+a[k].substr(n)),(n=g.Find({name:f[k][p],check_keys:!0}))&&(f[k][p]=g.itemFullName(n));"["==b[k][0]&&"]"==b[k][b[k].length-1]?(l[k]=d.ParseAsArray(b[k]),b[k]=l[k].shift()):0<b[k].indexOf("+")?(l[k]=b[k].split("+"),b[k]=l[k].shift()):l[k]=[];for(;l[k].length<f[k].length;)l[k].push("")}n=a[k].indexOf("_same_");0<n&&!g.Find(a[k])&&0<k&&(a[k]=a[k].substr(0,
n)+a[0].substr(n));(n=g.Find({name:a[k],check_keys:!0}))&&(a[k]=g.itemFullName(n))}}for(k=a.length-1;0<=k;--k)h[k]||(p=g.Find(a[k]))&&!g.canDisplay(p,b[k])&&(g.expand(a[k],null,null,!0),a.splice(k,1),b.splice(k,1),f.splice(k,1));if(0==a.length)return d.CallBack(e);var m=Array(a.length),r=Array(a.length);for(k=0;k<a.length;++k){r[k]=0;p=a[k];h=0;a.indexOf(p)<k&&(r[k]=!0);n=b[k].indexOf("frameid:");if(0<=n)p=b[k].substr(n+8),b[k]=b[k].substr(0,n);else for(;0<=m.indexOf(p);)p=a[k]+"_"+h++;m[k]=p}for(k=
0;k<a.length;++k)if(0===r[k]){p=k;for(h=0;h<a.length;++h)a[k]===a[h]&&0<=b[h].indexOf("main")&&(p=h);for(h=0;h<a.length;++h)a[k]===a[h]&&(r[h]=p!=h)}g.CreateDisplay(function(c){function k(c,h){if(h&&f[c]&&0<f[c].length)return g.dropitem(f[c].shift(),h.divid,l[c].shift(),k.bind(g,c,h));f[c]=null;a[c]=null;c=!1;for(h=0;h<a.length;++h)f[h]&&(c=!0),null!==a[h]&&(c=!0,r[h]&&a.indexOf(a[h])===h&&(r[h]=!1,g.display(a[h],b[h],k.bind(g,h))));!c&&e&&(d.CallBack(e),e=null)}if(!c)return d.CallBack(e);for(var h=
0;h<a.length;++h)0!==b[h].indexOf("update:")&&(c.CreateFrame(m[h]),b[h]+="::_display_on_frame_::"+m[h]);for(h=0;h<a.length;++h)r[h]||g.display(a[h],b[h],k.bind(g,h))})};m.prototype.reload=function(){var a=this;"_online"in this.h&&this.OpenOnline(this.h._online,function(){a.RefreshHtml()})};m.prototype.UpdateTreeNode=function(){};m.prototype.activate=function(a,b){function e(){if("function"===typeof f.UpdateBackground){for(var a=l.length-1;0<=a;--a)f.UpdateTreeNode(l[a]);for(a=0;a<c.length;++a)f.UpdateBackground(c[a],
b)}}function d(h,k){if(void 0===h){if(0==a.length)return e();h=a.shift()}var g=f.Find(h);if(!g){var p=f.Find({name:h,last_exists:!0,check_keys:!0,allow_index:!0});if(!p||!p.last)return d();p.now_found=f.itemFullName(p.last);if(b)return void 0!==k&&p.now_found===k?d():f.expand(p.now_found,function(a){if(!a)return d();a=f.itemFullName(p.last);0<a.length&&(a+="/");d(a+p.rest,p.now_found)});g=p.last}if(g){for(h=g._parent;h;){if(!h._isopen)if(b)h._isopen=!0,0>l.indexOf(h)&&l.push(h);else{g=h;break}h=h._parent}g._background=
"grey";0>c.indexOf(g)&&c.push(g)}d()}"string"==typeof a&&(a=[a]);var c=[],f=this,l=[];this.ForEach(function(a){a._background&&(c.push(a),delete a._background)});if(b&&this.brlayout){if(!this.brlayout.browser_kind)return this.CreateBrowser("float",!0,d);this.brlayout.browser_visible||this.brlayout.ToggleBrowserVisisbility()}d()};m.prototype.expand=function(a,b,e,g){function c(a,k,l){l||(l=f.itemFullName(a));var h=a._expand?null:d.getDrawHandle(a._kind,"::expand");k&&h&&h.expand_item&&(k=k[h.expand_item])&&
k._typename&&(h=d.getDrawHandle("ROOT."+k._typename,"::expand"));return h&&h.expand?(d.AssertPrerequisites(h.prereq,function(){a._expand=d.findFunction(h.expand);if(a._expand)return c(a,k,l);d.CallBack(b)}),!0):k&&a&&"function"===typeof a._expand&&a._expand(a,k)||k&&x(a,k)?(a._isopen=!0,a._parent&&!a._parent._isopen?(a._parent._isopen=!0,g||f.UpdateTreeNode(a._parent)):g||f.UpdateTreeNode(a,e),d.CallBack(b,a),!0):!1}var f=this,l=this.Find(a);if(!l&&e)return d.CallBack(b);if(l){if(!1===l._more||!l._parent&&
l._childs)return d.CallBack(b);if(l._childs&&l._isopen)return l._isopen=!1,g||f.UpdateTreeNode(l,e),d.CallBack(b);if(l._obj&&c(l,l._obj,a))return}d.progress("Loading "+a);this.get(a,function(a,e){d.progress();e&&c(a,e)||d.CallBack(b)},"hierarchy_expand")};m.prototype.GetTopOnlineItem=function(a){if(a){for(;a&&!("_online"in a);)a=a._parent;return a}return this.h?"_online"in this.h?this.h:this.h._childs&&"_online"in this.h._childs[0]?this.h._childs[0]:null:null};m.prototype.ForEachJsonFile=function(a){if(this.h){if("_jsonfile"in
this.h)return d.CallBack(a,this.h);if(this.h._childs)for(var b=0;b<this.h._childs.length;++b){var e=this.h._childs[b];"_jsonfile"in e&&d.CallBack(a,e)}}};m.prototype.OpenJsonFile=function(a,b){var e=!1;this.ForEachJsonFile(function(b){b._jsonfile==a&&(e=!0)});if(e)return d.CallBack(b);var g=this;d.NewHttpRequest(a,"object",function(c){if(!c)return d.CallBack(b);var e={_jsonfile:a,_kind:"ROOT."+c._typename,_jsontmp:c,_name:a.split("/").pop()};c.fTitle&&(e._title=c.fTitle);e._get=function(a,b,c){if(a._jsontmp)return d.CallBack(c,
a,a._jsontmp);d.NewHttpRequest(a._jsonfile,"object",function(b){a._jsontmp=b;d.CallBack(c,a,a._jsontmp)}).send()};null==g.h?g.h=e:"TopFolder"==g.h._kind?g.h._childs.push(e):(c=g.h,g.h={_name:"_jsonfile"in c?"Files":"Items",_kind:"TopFolder",_childs:[c,e]});g.RefreshHtml(b)}).send(null)};m.prototype.ForEachRootFile=function(a){if(this.h){if("ROOT.TFile"==this.h._kind&&this.h._file)return d.CallBack(a,this.h);if(this.h._childs)for(var b=0;b<this.h._childs.length;++b){var e=this.h._childs[b];"ROOT.TFile"==
e._kind&&"_fullurl"in e&&d.CallBack(a,e)}}};m.prototype.OpenRootFile=function(a,b){var e=!1;this.ForEachRootFile(function(b){b._fullurl===a&&(e=!0)});if(e)return d.CallBack(b);var g=this;d.progress("Opening "+a+" ...");d.OpenFile(a,function(a){d.progress();if(!a)return q.select("#gui_fileCORS").style("background","red").empty()||setTimeout(function(){q.select("#gui_fileCORS").style("background","")},5E3),d.CallBack(b,!1);a=g.FileHierarchy(a);a._isopen=!0;if(null==g.h)g.h=a,g._topname&&(a._name=g._topname);
else if("TopFolder"==g.h._kind)g.h._childs.push(a);else{var e=g.h;g.h={_name:"ROOT.TFile"==e._kind?"Files":"Items",_kind:"TopFolder",_childs:[e,a],_isopen:!0}}g.RefreshHtml(b)})};m.prototype.ApplyStyle=function(a,b){if(!a)return d.CallBack(b);if("object"===typeof a)return"TStyle"===a._typename&&d.extend(d.gStyle,a),d.CallBack(b);if("string"===typeof a){var e=this,g=this.Find({name:a,allow_index:!0,check_keys:!0});if(null!==g)return this.get(g,function(a,d){e.ApplyStyle(d,b)});if(0<a.indexOf(".json"))return d.NewHttpRequest(a,
"object",function(a){e.ApplyStyle(a,b)}).send(null)}return d.CallBack(b)};m.prototype.GetFileProp=function(a){a=this.Find(a);if(null==a)return null;for(var b=a._name;a._parent;){a=a._parent;if("_file"in a)return{kind:"file",fileurl:a._file.fURL,itemname:b,localfile:!!a._file.fLocalFile};if("_jsonfile"in a)return{kind:"json",fileurl:a._jsonfile,itemname:b};b=a._name+"/"+b}return null};d.MarkAsStreamerInfo=function(a,b,e){e&&"TList"==e._typename&&(e._typename="TStreamerInfoList")};m.prototype.GetOnlineItemUrl=
function(a){"string"==typeof a&&(a=this.Find(a));for(var b=a;b&&void 0===b._online;)b=b._parent;return b?b._online+this.itemFullName(a,b):null};m.prototype.isOnlineItem=function(a){return null!==this.GetOnlineItemUrl(a)};m.prototype.GetOnlineItem=function(a,b,e,g){var c=b,f=!1,l="",h="object",k=this,n=null;"hierarchy_expand"===g&&(f=!0,g=void 0);if(a){c=this.GetOnlineItemUrl(a);var p=null;"_kind"in a&&(n=d.getDrawHandle(a._kind));f?(l="h.json?compact=3",a._expand=d.Painter.OnlineHierarchy):"_make_request"in
a?p=d.findFunction(a._make_request):null!=n&&"make_request"in n&&(p=n.make_request);"function"==typeof p&&(p=p(k,a,c,g),null!=p&&("string"==typeof p?l=p:("req"in p&&(l=p.req),"kind"in p&&(h=p.kind))));0==l.length&&0!=a._kind.indexOf("ROOT.")&&(l="item.json.gz?compact=3")}if(!b&&a&&"_cached_draw_object"in this&&0==l.length)return b=this._cached_draw_object,delete this._cached_draw_object,d.CallBack(e,a,b);0==l.length&&(l="root.json.gz?compact=23");0<c.length&&(c+="/");var m=d.NewHttpRequest(c+l,h,
function(b){var c=null;!f&&a&&"_after_request"in a?c=d.findFunction(a._after_request):n&&"after_request"in n&&(c=n.after_request);"function"==typeof c&&(c=c(k,a,b,g,m),null!=c&&"object"==typeof c&&(b=c));d.CallBack(e,a,b)});m.send(null)};d.Painter.OnlineHierarchy=function(a,b){if(b&&a&&"_childs"in b){for(var e=0;e<b._childs.length;++e)if(b._childs[e]._more||b._childs[e]._childs)b._childs[e]._expand=d.Painter.OnlineHierarchy;a._childs=b._childs;b._childs=null;return!0}return!1};m.prototype.OpenOnline=
function(a,b){function e(e){g.h=e;if(null!=g.h){"_title"in g.h&&""!=g.h._title&&(document.title=g.h._title);e._isopen=!0;g.h._online=a;g.h._get=function(a,b,c,e){g.GetOnlineItem(a,b,c,e)};g.h._expand=d.Painter.OnlineHierarchy;var c="",f="";g.ForEach(function(a){"_childs"in a&&(a._expand=d.Painter.OnlineHierarchy);if("_autoload"in a){a=a._autoload.split(";");for(var b=0;b<a.length;++b)3<a[b].length&&(a[b].lastIndexOf(".js")==a[b].length-3||a[b].lastIndexOf(".css")==a[b].length-4)?0>c.indexOf(a[b])&&
(c+=a[b]+";"):0>f.indexOf(a[b])&&(f+=a[b]+";")}});0<c.length&&(c="user:"+c);d.AssertPrerequisites(f+c,function(){g.ForEach(function(a){if("_drawfunc"in a&&"_kind"in a){var b="kind:"+a._kind;0==a._kind.indexOf("ROOT.")&&(b=a._kind.slice(5));var c=a._drawopt;d.canDraw(b)&&null==c||d.addDrawFunc({name:b,func:a._drawfunc,script:a._drawscript,opt:c})}});d.CallBack(b,g)})}}var g=this;a||(a="");if("object"==typeof a){var c=a;a="";return e(c)}d.NewHttpRequest(a+"h.json?compact=3","object",e).send(null)};
m.prototype.GetOnlineProp=function(a){a=this.Find(a);if(!a)return null;for(var b=a._name;a._parent;){a=a._parent;if("_online"in a)return{server:a._online,itemname:b};b=a._name+"/"+b}return null};m.prototype.FillOnlineMenu=function(a,b,e){var g=this,c=this.Find(e),f=d.getDrawSettings(c._kind,"nosame;noinspect"),l=d.getDrawHandle(c._kind),h="string"==typeof c._kind?0==c._kind.indexOf("ROOT."):!1;f.opts&&!1!==c._can_draw&&(f.opts.push("inspect"),a.addDrawMenu("Draw",f.opts,function(a){g.display(e,a)}));
!c._childs&&!1!==c._more&&(c._more||h||f.expand)&&a.add("Expand",function(){g.expand(e)});l&&"execute"in l&&a.add("Execute",function(){g.ExecuteCommand(e,a.tree_node)});var k=b.server+b.itemname+"/draw.htm",n="?";this.IsMonitoring()&&(k+=n+"monitoring="+this.MonitoringInterval(),n="&");f.opts&&!1!==c._can_draw&&a.addDrawMenu("Draw in new window",f.opts,function(a){window.open(k+n+"opt="+a)});f.opts&&0<f.opts.length&&h&&!1!==c._can_draw&&a.addDrawMenu("Draw as png",f.opts,function(a){window.open(b.server+
b.itemname+"/root.png?w=400&h=300&opt="+a)});"_player"in c&&a.add("Player",function(){g.player(e)})};m.prototype.Adopt=function(a){this.h=a;this.RefreshHtml()};m.prototype.SetMonitoring=function(a,b){this._runMonitoring("cleanup");a&&(a=parseInt(a),!isNaN(a)&&0<a?(this._monitoring_interval=Math.max(100,a),b=!0):this._monitoring_interval=3E3);this._monitoring_on=b;this.IsMonitoring()&&this._runMonitoring()};m.prototype._runMonitoring=function(a){"cleanup"!=a&&this.IsMonitoring()?"frame"==a?(delete this._monitoring_handle,
this._monitoring_frame=requestAnimationFrame(this._runMonitoring.bind(this,"draw"))):("draw"==a&&(delete this._monitoring_frame,this.updateAll("monitoring")),this._monitoring_handle=setTimeout(this._runMonitoring.bind(this,"frame"),this.MonitoringInterval())):(this._monitoring_handle&&(clearTimeout(this._monitoring_handle),delete this._monitoring_handle),this._monitoring_frame&&(cancelAnimationFrame(this._monitoring_frame),delete this._monitoring_frame))};m.prototype.MonitoringInterval=function(a){return this._monitoring_interval||
3E3};m.prototype.EnableMonitoring=function(a){this.SetMonitoring(void 0,a)};m.prototype.IsMonitoring=function(){return this._monitoring_on};m.prototype.SetDisplay=function(a,b){b||"object"!=typeof a?(this.disp_kind=a,this.disp_frameid=b):(this.disp=a,this.disp_kind="custom",this.disp_frameid=null);this.register_resize||(this.register_resize=!0,d.RegisterForResize(this))};m.prototype.GetLayout=function(){return this.disp_kind};m.prototype.ClearPainter=function(a){this.ForEach(function(b){b._painter===
a&&delete b._painter})};m.prototype.clear=function(a){this.disp&&(this.disp.Reset(),delete this.disp);var b=[];this.ForEach(function(e){delete e._painter;a||"function"!=typeof e.clear||e.clear();a&&b.push(e)});a&&(this.EnableMonitoring(!1),this.select_main().html(""),b.forEach(function(a){delete a._parent;delete a._childs;delete a._obj;delete a._d3cont}),delete this.h)};m.prototype.GetDisplay=function(){return"disp"in this?this.disp:null};m.prototype.CleanupFrame=function(a){var b=d.cleanup(a);b&&
0<b.length&&this.ForEach(function(a){a._painter&&0<=b.indexOf(a._painter)&&delete a._painter})};m.prototype.CreateDisplay=function(a){if("disp"in this){if(0<this.disp.NumDraw()||"custom"==this.disp_kind)return d.CallBack(a,this.disp);this.disp.Reset();delete this.disp}if(null==document.getElementById(this.disp_frameid))return d.CallBack(a,null);if("simple"==this.disp_kind||0==this.disp_kind.indexOf("grid")&&0>this.disp_kind.indexOf("gridi"))this.disp=new y(this.disp_frameid,this.disp_kind);else return d.AssertPrerequisites("jq2d",
this.CreateDisplay.bind(this,a));this.disp&&(this.disp.CleanupFrame=this.CleanupFrame.bind(this));d.CallBack(a,this.disp)};m.prototype.CreateCustomDisplay=function(a,b,e){if("simple"!=this.disp_kind)return this.CreateDisplay(e);this.disp_kind=b;if(this.disp){b=this.disp.NumDraw();if(1<b||1==b&&!this.disp.FindFrame(a))return this.CreateDisplay(e);this.disp.Reset();delete this.disp}this.CreateDisplay(e)};m.prototype.updateOnOtherFrames=function(a,b){var e=this.disp,g=null,c=!1;if(!e)return!1;b._typename&&
(g=d.getDrawHandle("ROOT."+b._typename));g&&g.draw_field&&b[g.draw_field]&&(b=b[g.draw_field]);e.ForEachPainter(function(d,g){d!==a&&d.GetItemName()==a.GetItemName()&&(e.ActivateFrame(g),d.RedrawObject(b)&&(c=!0))});return c};m.prototype.CheckResize=function(a){this.disp&&this.disp.CheckMDIResize(null,a)};m.prototype.StartGUI=function(a,b,e){function g(b){var c=d.GetUrlOption(b,e);!c&&a&&!a.empty()&&a.node().hasAttribute(b)&&(c=a.attr(b));return c}function c(b){var c=d.GetUrlOptionAsArray(b,e);if(0<
c.length||!a||a.empty())return c;for(;0<b.length;){var f=b.indexOf(";"),g=0<f?b.substr(0,f):b;b=0<f?b.substr(f+1):"";f=!0;"#"==g[0]&&(g=g.substr(1),f=!1);"files"!==g&&a.node().hasAttribute(g)&&(g=a.attr(g),f?c=c.concat(d.ParseAsArray(g)):null!==g&&c.push(g))}return c}function f(a){v&&(h.CreateBrowser(v),v="");null!==z&&(h.CreateStatusLine(C,z),z=null);0<r.length?h.OpenJsonFile(r.shift(),f):0<m.length?h.OpenRootFile(m.shift(),f):null!==q&&"function"==typeof h.SelectLocalFile?(q=null,h.SelectLocalFile(f)):
0<u.length?h.expand(u.shift(),f):0<B.length?h.ApplyStyle(B.shift(),f):h.displayAll(t,x,function(){h.RefreshHtml();h.SetMonitoring(w);d.CallBack(b)})}function l(){!h.exclude_browser&&!F&&"_browser"in h.h&&(v=h.h._browser,"no"===v?v="":"off"===v&&(v="",z=null,h.exclude_browser=!0));"_monitoring"in h.h&&!w&&(w=h.h._monitoring);"_loadfile"in h.h&&0==m.length&&(m=d.ParseAsArray(h.h._loadfile));"_drawitem"in h.h&&0==t.length&&(t=d.ParseAsArray(h.h._drawitem),x=d.ParseAsArray(h.h._drawopt));"_layout"in h.h&&
!y&&("draw"!=h.is_online||1<t.length)&&(h.disp_kind=h.h._layout);"_toptitle"in h.h&&h.exclude_browser&&document&&(document.title=h.h._toptitle);a&&h.PrepareGuiDiv(a,h.disp_kind);f()}var h=this,k=g("prereq")||"",n=d.GetUrlOption("path",e)||"",m=c("#file;files"),q=g("localfile"),r=c("#json;jsons"),u=c("expand"),t=c("#item;items"),x=c("#opt;opts"),w=g("monitoring"),y=g("layout"),B=c("#style"),C=0,z=g("status"),v=g("browser"),F=!!v,A=g("title");null!==g("float")?(v="float",F=!0):null!==g("fix")&&(v="fix",
F=!0);this.no_select=g("noselect");null!==g("files_monitoring")&&(this.files_monitoring=!0);A&&(document.title=A);(A=g("load"))&&(k+=";io;2d;load:"+A);0==u.length&&""===g("expand")&&u.push("");if(n){for(A=0;A<m.length;++A)m[A]=n+m[A];for(A=0;A<r.length;++A)r[A]=n+r[A]}0==t.length&&""===g("item")&&t.push("");1==r.length&&0==t.length&&0==u.length&&t.push("");if(!this.disp_kind)if("string"==typeof y&&0<y.length)this.disp_kind=y;else switch(t.length){case 0:case 1:this.disp_kind="simple";break;case 2:this.disp_kind=
"vert2";break;case 3:this.disp_kind="vert21";break;case 4:this.disp_kind="vert22";break;case 5:this.disp_kind="vert32";break;case 6:this.disp_kind="vert222";break;case 7:this.disp_kind="vert322";break;case 8:this.disp_kind="vert332";break;case 9:this.disp_kind="vert333";break;default:this.disp_kind="flex"}if("no"===z)z=null;else if("off"===z)this.status_disabled=!0,z=null;else if("on"===z)z=!0;else if(null!==z){C=parseInt(z);if(isNaN(C)||5>C)C=0;z=!0}""===this.no_select&&(this.no_select=!0);v?"no"===
v?v="":"off"===v&&(v="",z=null,this.exclude_browser=!0):v="fix";null!==g("nofloat")&&(this.float_browser_disabled=!0);this.start_without_browser&&(v="");if(z||v)k="jq2d;"+k;this._topname=g("topname");n=null;this.is_online&&("function"==typeof GetCachedHierarchy&&(n=GetCachedHierarchy()),"object"!==typeof n&&(n=""));if(null!==n)return this.OpenOnline(n,l);a&&this.PrepareGuiDiv(a,this.disp_kind);0<k.length?d.AssertPrerequisites(k,f):f()};m.prototype.PrepareGuiDiv=function(a,b){this.gui_div=a.attr("id");
this.brlayout=new w(this.gui_div,this);this.brlayout.Create(!this.exclude_browser);if(!this.exclude_browser){a=this.brlayout.CreateBrowserBtns();d.ToolbarIcons.CreateSVG(a,d.ToolbarIcons.diamand,15,"toggle fix-pos browser").style("margin","3px").on("click",this.CreateBrowser.bind(this,"fix",!0));if(!this.float_browser_disabled)d.ToolbarIcons.CreateSVG(a,d.ToolbarIcons.circle,15,"toggle float browser").style("margin","3px").on("click",this.CreateBrowser.bind(this,"float",!0));if(!this.status_disabled)d.ToolbarIcons.CreateSVG(a,
d.ToolbarIcons.three_circles,15,"toggle status line").style("margin","3px").on("click",this.CreateStatusLine.bind(this,0,"toggle"))}this.SetDisplay(b,this.brlayout.drawing_divid())};m.prototype.CreateStatusLine=function(a,b){return!this.status_disabled&&this.gui_div&&this.brlayout?this.brlayout.CreateStatusLine(a,b):""};m.prototype.CreateBrowser=function(a,b,e){if(this.gui_div){var g=this;d.AssertPrerequisites("jq2d",function(){g.CreateBrowser(a,b,e)})}};d.BuildNobrowserGUI=function(){var a=q.select("#simpleGUI"),
b=!1,e=!1;if(a.empty()&&(b=!0,a=q.select("#onlineGUI"),a.empty()&&(a=q.select("#drawGUI"),e=!0),a.empty()))return alert("no div for simple nobrowser gui found");"true"===a.attr("ignoreurl")&&(d.gStyle.IgnoreUrlOptions=!0);d.Painter.readStyleFromURL();var g=d.GetUrlOption("divsize");g&&(g=g.split("x"),2!=g.length&&(g=null));g?a.style("position","relative").style("width",g[0]+"px").style("height",g[1]+"px"):(q.select("html").style("height","100%"),q.select("body").style("min-height","100%").style("margin",
0).style("overflow","hidden"),a.style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0).style("padding",1));var c=new d.HierarchyPainter("root",null);b&&(c.is_online=e?"draw":"online");e&&(c.exclude_browser=!0);c.start_without_browser=!0;c.StartGUI(a,function(){if(e){var a=d.findFunction("GetCachedObject");if(a="function"==typeof a?d.JSONR_unref(a()):null)c._cached_draw_object=a;a=d.GetUrlOption("opt")||"";null!==d.GetUrlOption("websocket")&&(a+=";websocket");
c.display("",a)}})};d.Painter.drawStreamerInfo=function(a,b){var e=new d.HierarchyPainter("sinfo",a,"white");e.h={_name:"StreamerInfo",_childs:[]};for(var g=0;g<b.arr.length;++g){var c=b.arr[g];if("TList"!=c._typename)if("undefined"==typeof c.fName)d.console("strange element in StreamerInfo with type "+c._typename);else{var f={_name:c.fName+";"+c.fClassVersion,_kind:"class "+c.fName,_title:"class:"+c.fName+" version:"+c.fClassVersion+" checksum:"+c.fCheckSum,_icon:"img_class",_childs:[]};""!=c.fTitle&&
(f._title+="  "+c.fTitle);e.h._childs.push(f);if("undefined"!=typeof c.fElements){for(var l=0;l<c.fElements.arr.length;++l){var h=c.fElements.arr[l];if(h&&h.fName){var k=h.fTypeName+" "+h.fName,n=h.fTypeName+" type:"+h.fType;if(1===h.fArrayDim)k+="["+h.fArrayLength+"]";else for(var m=0;m<h.fArrayDim;++m)k+="["+h.fMaxIndex[m]+"]";4294967295===h.fBaseVersion?k+=":-1":void 0!==h.fBaseVersion&&(k+=":"+h.fBaseVersion);k+=";";""!=h.fTitle&&(k+=" // "+h.fTitle);f._childs.push({_name:k,_title:n,_kind:h.fTypeName,
_icon:"BASE"==h.fTypeName?"img_class":"img_member"})}}0==f._childs.length&&delete f._childs}}}e.RefreshHtml(function(){e.SetDivId(a);e.DrawingReady()});return e};d.Painter.drawInspector=function(a,b){d.cleanup(a);var e=new d.HierarchyPainter("inspector",a,"white");e.default_by_click="expand";e.with_icons=!1;e.h={_name:"Object",_title:"",_click_action:"expand",_nosimple:!1,_do_context:!0};"string"===typeof b.fTitle&&0<b.fTitle.length&&(e.h._title=b.fTitle);e.select_main().classed("jsroot_inspector")&&
(e.removeInspector=function(){this.select_main().remove()});b._typename&&(e.h._title+="  type:"+b._typename);"string"===typeof b.fName&&0<b.fName.length&&(e.h._name=b.fName);e.fill_context=function(a,b){var c=d.getDrawSettings(b._kind,"nosame");c.opts&&a.addDrawMenu("nosub:Draw",c.opts,function(a){if(b&&b._obj){var c=b._obj,e=this.divid;if(this.removeInspector&&(e=this.select_main().node().parentNode,this.removeInspector(),"inspect"==a))return this.ShowInspector(c);d.cleanup(e);d.draw(e,c,a)}})};
d.IsRootCollection(b)?(e.h._name=b.name||b._typename,u(e.h,b)):x(e.h,b);e.RefreshHtml(function(){e.SetDivId(a);e.DrawingReady()});return e};t.prototype=Object.create(d.TBasePainter.prototype);t.prototype.BeforeCreateFrame=function(a){this.active_frame_title=a};t.prototype.ForEachFrame=function(a,b){console.warn("ForEachFrame not implemented in MDIDisplay")};t.prototype.ForEachPainter=function(a,b){this.ForEachFrame(function(b){var e=new d.TObjectPainter;e.SetDivId(b,-1);e.ForEachPainter(function(c){a(c,
b)})},b)};t.prototype.NumDraw=function(){var a=0;this.ForEachFrame(function(){++a});return a};t.prototype.FindFrame=function(a,b){var e=null;this.ForEachFrame(function(b){q.select(b).attr("frame_title")==a&&(e=b)});null==e&&b&&(e=this.CreateFrame(a));return e};t.prototype.ActivateFrame=function(a){this.active_frame_title=q.select(a).attr("frame_title")};t.prototype.GetActiveFrame=function(){return this.FindFrame(this.active_frame_title)};t.prototype.CheckMDIResize=function(a,b){var e=null;this.ForEachPainter(function(d,
c){a&&q.select(c).attr("id")!=a||null===d.GetItemName()||"function"!=typeof d.CheckResize||e===c||(d.CheckResize(b),e=c)})};t.prototype.Reset=function(){this.active_frame_title="";this.ForEachFrame(this.CleanupFrame);this.select_main().html("").property("mdi",null)};t.prototype.Draw=function(a,b,e){if(b&&d.canDraw(b._typename,e))return a=this.FindFrame(a,!0),this.ActivateFrame(a),d.redraw(a,b,e)};B.prototype=Object.create(t.prototype);B.prototype.AddFrame=function(a,b){a in this.frames||(this.frames[a]=
"");this.frames[a]+=b+";"};B.prototype.ForEachFrame=function(a,b){b=Object.keys(this.frames);for(var e=0;e<b.length;++e){var g=q.select("#"+b[e]);g.empty()||d.CallBack(a,g.node())}};B.prototype.CreateFrame=function(a){this.BeforeCreateFrame(a);for(var b=Object.keys(this.frames),e=0;e<b.length;++e)if(0<=this.frames[b[e]].indexOf(a+";"))return q.select("#"+b[e]).node();return null};B.prototype.Reset=function(){t.prototype.Reset.call(this);this.ForEachFrame(function(a){q.select(a).html("")})};y.prototype=
Object.create(t.prototype);y.prototype.CreateGroup=function(a,b,e,d,c){c||(c=Array(e));for(var f=0,g=0,h=0;h<e;++h)f+=c[h]||1;for(h=0;h<e;++h)c[h]=Math.round(100*(c[h]||1)/f),g+=c[h],h==e-1&&(c[h]+=100-g);for(f=0;f<e;++f){g={id:f,drawid:-1,position:0,size:c[f]};0<f&&(g.position=a.groups[f-1].position+a.groups[f-1].size);g.position0=g.position;if(!d||!d[f]||2>d[f])g.drawid=this.framecnt++;a.groups.push(g);h=b.append("div").attr("groupid",g.id);a.vertical?h.style("float","bottom").style("height",g.size+
"%").style("width","100%"):h.style("float","left").style("width",g.size+"%").style("height","100%");0<=g.drawid?(h.classed("jsroot_newgrid",!0),"string"===typeof this.frameid&&h.attr("id",this.frameid+"_"+g.drawid)):h.style("display","flex").style("flex-direction",a.vertical?"row":"column");d&&1<d[f]&&(g.vertical=!a.vertical,g.groups=[],h.style("overflow","hidden"),this.CreateGroup(g,h,d[f]))}if(this.use_separarators&&this.CreateSeparator)for(f=1;f<e;++f)this.CreateSeparator(a,b,a.groups[f])};y.prototype.ForEachFrame=
function(a,b){this.simple_layout?a(this.GetFrame()):this.select_main().selectAll(".jsroot_newgrid").each(function(){a(q.select(this).node())})};y.prototype.GetActiveFrame=function(){if(this.simple_layout)return this.GetFrame();var a=t.prototype.GetActiveFrame.call(this);if(a)return a;this.ForEachFrame(function(b){a||(a=b)},!0);return a};y.prototype.ActivateFrame=function(a){this.active_frame_title=q.select(a).attr("frame_title")};y.prototype.GetFrame=function(a){if(this.simple_layout)return this.select_main("origin").node();
var b=null;this.select_main().selectAll(".jsroot_newgrid").each(function(){0===a--&&(b=this)});return b};y.prototype.NumGridFrames=function(){return this.framecnt};y.prototype.CreateFrame=function(a){this.BeforeCreateFrame(a);for(var b=null,e=this.framecnt||2;!b&&e--;)b=this.GetFrame(this.getcnt),!this.simple_layout&&this.framecnt&&(this.getcnt=(this.getcnt+1)%this.framecnt),q.select(b).classed("jsroot_fixed_frame")&&(b=null);b&&(this.CleanupFrame(b),q.select(b).attr("frame_title",a));return b};d.Painter.drawList=
function(a,b,e,g){if(!b||!b.arr)return d.CallBack(g);a={divid:a,lst:b,opt:e,indx:-1,callback:g,draw_next:function(){for(;++this.indx<this.lst.arr.length;){var a={func:this.draw_bind},b=this.lst.arr[this.indx];if(b&&(d.draw(this.divid,b,this.lst.opt&&this.lst.opt[this.indx]?this.lst.opt[this.indx]:this.opt,a),!a.completed))return}return d.CallBack(this.callback)}};a.draw_bind=a.draw_next.bind(a);a.draw_next()};d.Painter.FolderHierarchy=function(a,b){if(!(b&&"fFolders"in b)||null===b.fFolders)return!1;
if(0===b.fFolders.arr.length)return a._more=!1,!0;a._childs=[];for(var e=0;e<b.fFolders.arr.length;++e){var d=b.fFolders.arr[e];a._childs.push({_name:d.fName,_kind:"ROOT."+d._typename,_obj:d})}return!0};d.Painter.ObjectHierarchy=x;d.Painter.TaskHierarchy=function(a,b){if(!(b&&"fTasks"in b)||null===b.fTasks)return!1;x(a,b,{exclude:["fTasks","fName"]});if(0===b.fTasks.arr.length&&0==a._childs.length)return a._more=!1,!0;for(var d=0;d<b.fTasks.arr.length;++d){var g=b.fTasks.arr[d];a._childs.push({_name:g.fName,
_kind:"ROOT."+g._typename,_obj:g})}return!0};d.Painter.ListHierarchy=u;d.Painter.KeysHierarchy=r;d.BrowserLayout=w;d.HierarchyPainter=m;d.MDIDisplay=t;d.CustomDisplay=B;d.GridDisplay=y;return d});
