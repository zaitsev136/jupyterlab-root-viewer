(function(d){if("function"===typeof define&&define.amd)define(["JSRootCore","rawinflate"],d);else if("object"===typeof exports&&"undefined"!==typeof module)require("./rawinflate.min.js"),d(require("./JSRootCore.js"));else{if("undefined"==typeof JSROOT)throw Error("JSROOT I/O requires JSRootCore.js","JSRootIOEvolution.js");if("undefined"==typeof JSROOT.ZIP)throw Error("JSROOT I/O requires rawinflate.js","JSRootIOEvolution.js");if("object"==typeof JSROOT.IO)throw Error("This JSROOT IO already loaded",
"JSRootIOEvolution.js");d(JSROOT)}})(function(d){function k(c,b,a,d){this._typename="TBuffer";this.arr=c;this.o=b||0;this.fFile=a;this.length=d||(c?c.byteLength:0);this.ClearObjectMap();this.last_read_version=this.fTagOffset=0;return this}function v(c,b,a){this.fFile=c;this._typename="TDirectory";this.dir_name=b;this.dir_cycle=a;this.fKeys=[];return this}function l(c,b){this._typename="TFile";this.fEND=0;this.fURL=this.fFullURL=c;this.fAcceptRanges=!0;this.fUseStampPar="stamp="+(new Date).getTime();
this.fFileContent=null;this.fMaxRanges=200;this.fDirectories=[];this.fKeys=[];this.fStreamers=this.fTagOffset=this.fNbytesInfo=this.fSeekInfo=0;this.fStreamerInfos=null;this.fFileName="";this.fStreamers=[];this.fBasicTypes={};if("string"!=typeof this.fURL)return this;"+"===this.fURL[this.fURL.length-1]&&(this.fURL=this.fURL.substr(0,this.fURL.length-1),this.fAcceptRanges=!1);"-"===this.fURL[this.fURL.length-1]&&(this.fURL=this.fURL.substr(0,this.fURL.length-1),this.fUseStampPar=!1);0==this.fURL.indexOf("file://")&&
(this.fAcceptRanges=this.fUseStampPar=!1);c=Math.max(this.fURL.lastIndexOf("/"),this.fURL.lastIndexOf("\\"));this.fFileName=0<=c?this.fURL.substr(c+1):this.fURL;if(this.fAcceptRanges){var a=this;d.NewHttpRequest(this.fURL,"head",function(c){if(!c)return d.CallBack(b,null);c.getResponseHeader("Accept-Ranges")||(a.fAcceptRanges=!1);(c=c.getResponseHeader("Content-Length"))?a.fEND=parseInt(c):a.fAcceptRanges=!1;a.ReadKeys(b)}).send(null)}else this.ReadKeys(b);return this}function y(c,b){l.call(this,
null);this.fUseStampPar=!1;this.fLocalFile=c;this.fEND=c.size;this.fFileName=this.fURL=this.fFullURL=c.name;this.ReadKeys(b);return this}function w(c,b){l.call(this,null);this.fUseStampPar=!1;this.fEND=0;this.fFileName=this.fURL=this.fFullURL=c;var a=this;a.fs=require("fs");a.fs.open(c,"r",function(c,e){if(c)return console.log(c.message),d.CallBack(b,null);c=a.fs.fstatSync(e);a.fEND=c.size;a.fd=e;a.ReadKeys(b)});return this}d.sources.push("io");d.IO={kBase:0,kOffsetL:20,kOffsetP:40,kChar:1,kShort:2,
kInt:3,kLong:4,kFloat:5,kCounter:6,kCharStar:7,kDouble:8,kDouble32:9,kLegacyChar:10,kUChar:11,kUShort:12,kUInt:13,kULong:14,kBits:15,kLong64:16,kULong64:17,kBool:18,kFloat16:19,kObject:61,kAny:62,kObjectp:63,kObjectP:64,kTString:65,kTObject:66,kTNamed:67,kAnyp:68,kAnyP:69,kAnyPnoVT:70,kSTLp:71,kSkip:100,kSkipL:120,kSkipP:140,kConv:200,kConvL:220,kConvP:240,kSTL:300,kSTLstring:365,kStreamer:500,kStreamLoop:501,kMapOffset:2,kByteCountMask:1073741824,kNewClassTag:4294967295,kClassMask:2147483648,Mode:"array",
NativeArray:!0,TypeNames:"BASE;char;short;int;long;float;int;const char*;double;Double32_t;char;unsigned  char;unsigned short;unsigned;unsigned long;unsigned;Long64_t;ULong64_t;bool;Float16_t".split(";"),kNotSTL:0,kSTLvector:1,kSTLlist:2,kSTLdeque:3,kSTLmap:4,kSTLmultimap:5,kSTLset:6,kSTLmultiset:7,kSTLbitset:8,kSTLforwardlist:9,kSTLunorderedset:10,kSTLunorderedmultiset:11,kSTLunorderedmap:12,kSTLunorderedmultimap:13,kSTLend:14,StlNames:" vector list deque map multimap set multiset bitset".split(" "),
kStreamedMemberWise:d.BIT(14),kSplitCollectionOfPointers:100,CustomStreamers:{},DirectStreamers:{},kIsReferenced:d.BIT(4),kHasUUID:d.BIT(5),IsInteger:function(c){return c>=this.kChar&&c<=this.kLong||c===this.kCounter||c>=this.kLegacyChar&&c<=this.kBool},IsNumeric:function(c){return 0<c&&c<=this.kBool&&c!==this.kCharStar},GetTypeId:function(c,b){switch(c){case "bool":case "Bool_t":return d.IO.kBool;case "char":case "signed char":case "Char_t":return d.IO.kChar;case "Color_t":case "Style_t":case "Width_t":case "short":case "Short_t":return d.IO.kShort;
case "int":case "EErrorType":case "Int_t":return d.IO.kInt;case "long":case "Long_t":return d.IO.kLong;case "float":case "Float_t":return d.IO.kFloat;case "double":case "Double_t":return d.IO.kDouble;case "unsigned char":case "UChar_t":return d.IO.kUChar;case "unsigned short":case "UShort_t":return d.IO.kUShort;case "unsigned":case "unsigned int":case "UInt_t":return d.IO.kUInt;case "unsigned long":case "ULong_t":return d.IO.kULong;case "int64_t":case "long long":case "Long64_t":return d.IO.kLong64;
case "uint64_t":case "unsigned long long":case "ULong64_t":return d.IO.kULong64;case "Double32_t":return d.IO.kDouble32;case "Float16_t":return d.IO.kFloat16;case "char*":case "const char*":case "const Char_t*":return d.IO.kCharStar}return b||(c=d.IO.CustomStreamers[c],"string"!==typeof c)?-1:d.IO.GetTypeId(c,!0)},GetTypeSize:function(c){switch(c){case d.IO.kBool:return 1;case d.IO.kChar:return 1;case d.IO.kShort:return 2;case d.IO.kInt:return 4;case d.IO.kLong:return 8;case d.IO.kFloat:return 4;
case d.IO.kDouble:return 8;case d.IO.kUChar:return 1;case d.IO.kUShort:return 2;case d.IO.kUInt:return 4;case d.IO.kULong:return 8;case d.IO.kLong64:return 8;case d.IO.kULong64:return 8}return-1}};d.addUserStreamer=function(c,b){d.IO.CustomStreamers[c]=b};d.R__unzip=function(c,b,a,f){function e(a){return String.fromCharCode(c.getUint8(a))}var g=c.byteLength;f=f||0;for(var h=0,n=null;h<b;){var m="unknown",q=0,k=0;if(f+9>=g)return a||d.alert("Error R__unzip: header size exceeds buffer size"),null;"Z"==
e(f)&&"L"==e(f+1)&&8==c.getUint8(f+2)?(m="new",q=2):"C"==e(f)&&"S"==e(f+1)&&8==c.getUint8(f+2)?(m="old",q=0):"X"==e(f)&&"Z"==e(f+1)?m="LZMA":"L"==e(f)&&"4"==e(f+1)&&(m="LZ4",q=0,k=8);if("new"!==m&&"old"!==m&&"LZ4"!==m)return a||d.alert("R__unzip: "+m+" format is not supported!"),null;var l=9+(c.getUint8(f+3)&255|(c.getUint8(f+4)&255)<<8|(c.getUint8(f+5)&255)<<16);q=new Uint8Array(c.buffer,c.byteOffset+f+9+q+k,Math.min(c.byteLength-f-9-q-k,l-9-k));n||(n=new ArrayBuffer(b));k=new Uint8Array(n,h);m=
"LZ4"===m?d.LZ4.uncompress(q,k):d.ZIP.inflate(q,k);if(0>=m)break;h+=m;f+=l}return h!==b?(a||d.alert("R__unzip: fail to unzip data expects "+b+" , got "+h),null):new DataView(n)};k.prototype.locate=function(c){this.o=c};k.prototype.shift=function(c){this.o+=c};k.prototype.remain=function(){return this.length-this.o};k.prototype.GetMappedObject=function(c){return this.fObjectMap[c]};k.prototype.MapObject=function(c,b){null!==b&&(this.fObjectMap[c]=b)};k.prototype.MapClass=function(c,b){this.fClassMap[c]=
b};k.prototype.GetMappedClass=function(c){return c in this.fClassMap?this.fClassMap[c]:-1};k.prototype.ClearObjectMap=function(){this.fObjectMap={};this.fClassMap={};this.fObjectMap[0]=null;this.fDisplacement=0};k.prototype.ReadVersion=function(){var c={},b=this.ntou4();b&d.IO.kByteCountMask?c.bytecnt=b-d.IO.kByteCountMask-2:this.o-=4;this.last_read_version=c.val=this.ntoi2();this.last_read_checksum=0;c.off=this.o;0>=c.val&&c.bytecnt&&4<=c.bytecnt&&(c.checksum=this.ntou4(),this.fFile.FindSinfoCheckum(c.checksum)?
this.last_read_checksum=c.checksum:(this.o-=4,delete c.checksum));return c};k.prototype.CheckBytecount=function(c,b){return void 0!==c.bytecnt&&c.off+c.bytecnt!==this.o?(null!=b&&console.log("Missmatch in "+b+" bytecount expected = "+c.bytecnt+"  got = "+(this.o-c.off)),this.o=c.off+c.bytecnt,!1):!0};k.prototype.ReadTString=function(){var c=this.ntou1();255==c&&(c=this.ntou4());if(0==c)return"";var b=this.o;this.o+=c;return 0==this.codeAt(b)?"":this.substring(b,b+c)};k.prototype.ReadFastString=function(c){for(var b=
"",a,d=!1,e=0;0>c||e<c;++e){a=this.ntou1();if(0==a&&(d=!0,0>c))break;d||(b+=String.fromCharCode(a))}return b};k.prototype.ntou1=function(){return this.arr.getUint8(this.o++)};k.prototype.ntou2=function(){var c=this.o;this.o+=2;return this.arr.getUint16(c)};k.prototype.ntou4=function(){var c=this.o;this.o+=4;return this.arr.getUint32(c)};k.prototype.ntou8=function(){var c=this.arr.getUint32(this.o);this.o+=4;var b=this.arr.getUint32(this.o);this.o+=4;return 4294967296*c+b};k.prototype.ntoi1=function(){return this.arr.getInt8(this.o++)};
k.prototype.ntoi2=function(){var c=this.o;this.o+=2;return this.arr.getInt16(c)};k.prototype.ntoi4=function(){var c=this.o;this.o+=4;return this.arr.getInt32(c)};k.prototype.ntoi8=function(){var c=this.arr.getUint32(this.o);this.o+=4;var b=this.arr.getUint32(this.o);this.o+=4;return 2147483648>c?4294967296*c+b:-1-(4294967296*~c+~b)};k.prototype.ntof=function(){var c=this.o;this.o+=4;return this.arr.getFloat32(c)};k.prototype.ntod=function(){var c=this.o;this.o+=8;return this.arr.getFloat64(c)};k.prototype.ReadFastArray=
function(c,b){var a=0,f=this.o,e=this.arr;switch(b){case d.IO.kDouble:for(b=new Float64Array(c);a<c;++a,f+=8)b[a]=e.getFloat64(f);break;case d.IO.kFloat:for(b=new Float32Array(c);a<c;++a,f+=4)b[a]=e.getFloat32(f);break;case d.IO.kLong:case d.IO.kLong64:for(b=new Float64Array(c);a<c;++a)b[a]=this.ntoi8();return b;case d.IO.kULong:case d.IO.kULong64:for(b=new Float64Array(c);a<c;++a)b[a]=this.ntou8();return b;case d.IO.kInt:case d.IO.kCounter:for(b=new Int32Array(c);a<c;++a,f+=4)b[a]=e.getInt32(f);
break;case d.IO.kBits:case d.IO.kUInt:for(b=new Uint32Array(c);a<c;++a,f+=4)b[a]=e.getUint32(f);break;case d.IO.kShort:for(b=new Int16Array(c);a<c;++a,f+=2)b[a]=e.getInt16(f);break;case d.IO.kUShort:for(b=new Uint16Array(c);a<c;++a,f+=2)b[a]=e.getUint16(f);break;case d.IO.kChar:for(b=new Int8Array(c);a<c;++a)b[a]=e.getInt8(f++);break;case d.IO.kBool:case d.IO.kUChar:for(b=new Uint8Array(c);a<c;++a)b[a]=e.getUint8(f++);break;case d.IO.kTString:for(b=Array(c);a<c;++a)b[a]=this.ReadTString();return b;
case d.IO.kDouble32:throw Error("kDouble32 should not be used in ReadFastArray");case d.IO.kFloat16:throw Error("kFloat16 should not be used in ReadFastArray");default:for(b=new Uint32Array(c);a<c;++a,f+=4)b[a]=e.getUint32(f)}this.o=f;return b};k.prototype.can_extract=function(c){for(var b=0;b<c.length;b+=2)if(c[b]+c[b+1]>this.length)return!1;return!0};k.prototype.extract=function(c){if(!this.arr||!this.arr.buffer||!this.can_extract(c))return null;if(2===c.length)return new DataView(this.arr.buffer,
this.arr.byteOffset+c[0],c[1]);for(var b=Array(c.length/2),a=0;a<c.length;a+=2)b[a/2]=new DataView(this.arr.buffer,this.arr.byteOffset+c[a],c[a+1]);return b};k.prototype.codeAt=function(c){return this.arr.getUint8(c)};k.prototype.substring=function(c,b){for(var a="";c<b;++c)a+=String.fromCharCode(this.arr.getUint8(c));return a};d.IO.GetArrayKind=function(c){if("TString"===c||"string"===c||"TString"===d.IO.CustomStreamers[c])return 0;if(7>c.length||0!==c.indexOf("TArray"))return-1;if(7==c.length)switch(c[6]){case "I":return d.IO.kInt;
case "D":return d.IO.kDouble;case "F":return d.IO.kFloat;case "S":return d.IO.kShort;case "C":return d.IO.kChar;case "L":return d.IO.kLong;default:return-1}return"TArrayL64"==c?d.IO.kLong64:-1};k.prototype.ReadNdimArray=function(c,b){var a=c.fArrayDim,d=c.fMaxIndex;1>a&&0<c.fArrayLength&&(a=1,d=[c.fArrayLength]);c.minus1&&--a;if(1>a)return b(this,c);if(1===a){var e=Array(d[0]);for(a=0;a<d[0];++a)e[a]=b(this,c)}else if(2===a)for(e=Array(d[0]),a=0;a<d[0];++a){for(var g=Array(d[1]),h=0;h<d[1];++h)g[h]=
b(this,c);e[a]=g}else{g=[];var n=[];for(h=0;h<a;++h)g[h]=0,n[h]=[];for(e=n[0];g[0]<d[0];)for(h=a-1,n[h].push(b(this,c)),++g[h];g[h]===d[h]&&0<h;)g[h]=0,n[h-1].push(n[h]),n[h]=[],++g[--h]}return e};k.prototype.ReadTKey=function(c){c||(c={});this.ClassStreamer(c,"TKey");var b=c.fName.replace(/['"]/g,"");b!==c.fName&&(c.fRealName=c.fName,c.fName=b);return c};k.prototype.ReadBasketEntryOffset=function(c,b){this.locate(c.fLast-b);0>=this.remain()?(!c.fEntryOffset&&1>=c.fNevBuf&&(c.fEntryOffset=[c.fKeylen]),
c.fEntryOffset||console.warn("No fEntryOffset when expected for basket with",c.fNevBuf,"entries")):(b=this.ntoi4(),0>b||b>4*this.remain()?(console.error("Error when reading entries offset from basket fNevBuf",c.fNevBuf,"remains",this.remain(),"want to read",b),1>=c.fNevBuf&&(c.fEntryOffset=[c.fKeylen])):(c.fEntryOffset=this.ReadFastArray(b,d.IO.kInt),c.fEntryOffset||(c.fEntryOffset=[c.fKeylen]),0<this.remain()?c.fDisplacement=this.ReadFastArray(this.ntoi4(),d.IO.kInt):c.fDisplacement=void 0))};k.prototype.ReadClass=
function(){var c={name:-1};var b=this.ntou4();var a=this.o;b=b&d.IO.kByteCountMask&&b!=d.IO.kNewClassTag?this.ntou4():b;if(!(b&d.IO.kClassMask))return c.objtag=b+this.fDisplacement,c;b==d.IO.kNewClassTag?(c.name=this.ReadFastString(-1),-1===this.GetMappedClass(this.fTagOffset+a+d.IO.kMapOffset)&&this.MapClass(this.fTagOffset+a+d.IO.kMapOffset,c.name)):(a=(b&~d.IO.kClassMask)+this.fDisplacement,c.name=this.GetMappedClass(a),-1===c.name&&d.alert("Did not found class with tag "+a));return c};k.prototype.ReadObjectAny=
function(){var c=this.fTagOffset+this.o+d.IO.kMapOffset,b=this.ReadClass();if("objtag"in b)return this.GetMappedObject(b.objtag);if(-1===b.name)return null;var a=d.IO.GetArrayKind(b.name);0===a?a=this.ReadTString():0<a?(a=this.ReadFastArray(this.ntou4(),a),this.MapObject(c,a)):(a={},this.MapObject(c,a),this.ClassStreamer(a,b.name));return a};k.prototype.ClassStreamer=function(c,b){void 0===c._typename&&(c._typename=b);var a=d.IO.DirectStreamers[b];if(a)return a(this,c),c;a=this.ReadVersion();var f=
this.fFile.GetStreamer(b,a);if(null!==f)for(var e=0;e<f.length;++e)f[e].func(this,c);else d.addMethods(c);this.CheckBytecount(a,b);return c};d.CreateTBuffer=function(c,b,a,d){return new k(c,b,a,d)};d.ReconstructObject=function(c,b,a){var f=new l;a=d.CreateTBuffer(a,0,f);f.ExtractStreamerInfos(a);var e={};a=d.CreateTBuffer(b,0,f);a.MapObject(e,1);a.ClassStreamer(e,c);return e};v.prototype.GetKey=function(c,b,a){"number"!=typeof b&&(b=-1);for(var f=null,e=0;e<this.fKeys.length;++e){var g=this.fKeys[e];
if(g&&g.fName===c){if(g.fCycle==b){f=g;break}0>b&&(!f||g.fCycle>f.fCycle)&&(f=g)}}if(f)return d.CallBack(a,f),f;for(f=c.lastIndexOf("/");0<f;){e=c.substr(0,f);var h=c.substr(f+1);g=this.GetKey(e);if(null!==g&&"function"==typeof a&&0==g.fClassName.indexOf("TDirectory"))return this.fFile.ReadObject(this.dir_name+"/"+e,1,function(c){c&&c.GetKey(h,b,a)}),null;f=c.lastIndexOf("/",f-1)}d.CallBack(a,null);return null};v.prototype.ReadObject=function(c,b,a){this.fFile.ReadObject(this.dir_name+"/"+c,b,a)};
v.prototype.ReadKeys=function(c,b){c.ClassStreamer(this,"TDirectory");if(0>=this.fSeekKeys||0>=this.fNbytesKeys)return d.CallBack(b,this);var a=this,f=this.fFile;f.ReadBuffer([this.fSeekKeys,this.fNbytesKeys],function(c){if(!c)return d.CallBack(b,null);c=d.CreateTBuffer(c,0,f);c.ReadTKey();for(var g=c.ntoi4(),e=0;e<g;++e)a.fKeys.push(c.ReadTKey());f.fDirectories.push(a);d.CallBack(b,a)})};l.prototype.ReadBuffer=function(c,b,a,f){function e(a){if(a&&(n=m,m=Math.min(n+2*g.fMaxRanges,c.length),n>=c.length))return b(q);
var e=h,k="bytes",p=0;g.fUseStampPar&&(e+=(0>e.indexOf("?")?"?":"&")+g.fUseStampPar);for(a=n;a<m;a+=2)k+=(a>n?",":"=")+(c[a]+"-"+(c[a]+c[a+1]-1)),p+=c[a+1];2<m-n&&(p+=60*(m-n));e=d.NewHttpRequest(e,"buf",l);g.fAcceptRanges&&(e.setRequestHeader("Range",k),e.expected_size=Math.max(Math.round(1.1*p),p+200));if(f&&"function"===typeof e.addEventListener){var x=p=k=0;for(a=1;a<c.length;a+=2)x+=c[a],a<n&&(k+=c[a]),a<m&&(p+=c[a]);x||(x=1);var A=k/x,t=(p-k)/x;e.addEventListener("progress",function(a){a.lengthComputable&&
f(A+t*a.loaded/a.total)})}e.send(null)}if(null!==this.fFileContent&&!a&&(!this.fAcceptRanges||this.fFileContent.can_extract(c)))return b(this.fFileContent.extract(c));var g=this,h=g.fURL,n=0,m=0,q=[];if(a&&"string"===typeof a&&0<a.length){var k=h.lastIndexOf("/");h=0>k?a:h.substr(0,k+1)+a}var l=function(a){if(!a&&g.fUseStampPar&&0===c[0]&&2===c.length)return g.fUseStampPar=!1,e();if(a&&0===c[0]&&2===c.length&&!g.fFileContent)return g.fFileContent=d.CreateTBuffer("string"==typeof a?a:new DataView(a)),
g.fAcceptRanges||(g.fEND=g.fFileContent.length),b(g.fFileContent.extract(c));if(!a)return 0===n&&2<m&&1<g.fMaxRanges?(g.fMaxRanges=200<m/2?200:50<m/2?50:20<m/2?20:5<m/2?5:1,m=Math.min(m,2*g.fMaxRanges),e()):b(null);if(2===m-n){a=new DataView(a);if(2===c.length)return b(a);q.push(a);return e(!0)}var f=this.getResponseHeader("Content-Type"),h="string"===typeof f&&0<=f.indexOf("multipart"),k=new DataView(a);if(!h){k=this.getResponseHeader("Content-Range");f=0;var p=-1;if(k&&0<=k.indexOf("bytes")){var l=
k.substr(k.indexOf("bytes")+6).split(/[\s-\/]+/);3===l.length&&(f=parseInt(l[0]),p=parseInt(l[1]),isNaN(f)||isNaN(p)||f>p)&&(f=0,p=-1)}k=f<=p;for(h=n;h<m;h+=2)if(c[h]<f||c[h]+c[h+1]-1>p)k=!1;if(k){for(h=n;h<m;h+=2)q.push(new DataView(a,c[h]-f,c[h+1]));return e(!0)}console.error("Server returns normal response when multipart was requested, disable multirange support");if(1===g.fMaxRanges||0!==n)return b(null);g.fMaxRanges=1;m=Math.min(m,2*g.fMaxRanges);return e()}p=f.indexOf("boundary=");var t="";
h=n;var u=0;0<p?(t=f.substr(p+9),'"'==t[0]&&'"'==t[t.length-1]&&(t=t.substr(1,t.length-2)),t="--"+t):console.error("Did not found boundary id in the response header");for(;h<m;){var z=k.getUint8(u),v=0,r="",w=!1;f=0;for(p=-1;u<k.byteLength-1&&!w&&5>v;){l=z;z=k.getUint8(u+1);if(13==l&&10==z){if(2<r.length&&"--"==r.substr(0,2)&&r!==t)return console.error("Decode multipart message, expect boundary ",t,"got ",r),b(null);r=r.toLowerCase();if(0<=r.indexOf("content-range")&&0<r.indexOf("bytes"))if(l=r.substr(r.indexOf("bytes")+
6).split(/[\s-\/]+/),3===l.length){if(f=parseInt(l[0]),p=parseInt(l[1]),isNaN(f)||isNaN(p)||f>p)f=0,p=-1}else console.error("Fail to decode content-range",r,l);1<v&&0===r.length&&(w=!0);u++;v++;r="";z=k.getUint8(u+1)}else r+=String.fromCharCode(l);u++}if(!w)return console.error("Cannot decode header in multipart message "),b(null);if(f>p)q.push(new DataView(a,u,c[h+1])),u+=c[h+1],h+=2;else{for(;h<m&&c[h]>=f&&c[h]+c[h+1]-1<=p;)q.push(new DataView(a,u+c[h]-f,c[h+1])),h+=2;u+=p-f+1}}e(!0)};e(!0)};l.prototype.GetDir=
function(c,b){if(void 0===b&&"string"==typeof c){var a=c.lastIndexOf(";");0<a&&(b=parseInt(c.substr(a+1)),c=c.substr(0,a))}for(a=0;a<this.fDirectories.length;++a){var d=this.fDirectories[a];if(d.dir_name==c&&(void 0===b||d.dir_cycle===b))return d}return null};l.prototype.GetKey=function(c,b,a){"number"!=typeof b&&(b=-1);for(var f=null,e=0;e<this.fKeys.length;++e){var g=this.fKeys[e];if(g&&g.fName===c){if(g.fCycle==b){f=g;break}0>b&&(!f||g.fCycle>f.fCycle)&&(f=g)}}if(f)return d.CallBack(a,f),f;for(f=
c.lastIndexOf("/");0<f;){e=c.substr(0,f);var h=c.substr(f+1);if(g=this.GetDir(e))return g.GetKey(h,b,a);if((g=this.GetKey(e))&&a&&0==g.fClassName.indexOf("TDirectory"))return this.ReadObject(e,function(c){c&&c.GetKey(h,b,a)}),null;f=c.lastIndexOf("/",f-1)}d.CallBack(a,null);return null};l.prototype.ReadObjBuffer=function(c,b){var a=this;this.ReadBuffer([c.fSeekKey+c.fKeylen,c.fNbytes-c.fKeylen],function(f){if(!f)return b(null);if(c.fObjlen<=c.fNbytes-c.fKeylen)f=d.CreateTBuffer(f,0,a);else{f=d.R__unzip(f,
c.fObjlen);if(!f)return b(null);f=d.CreateTBuffer(f,0,a)}f.fTagOffset=c.fKeylen;b(f)})};l.prototype.AddReadTree=function(c){if(d.TreeMethods)return d.extend(c,d.TreeMethods);void 0===this.readTrees&&(this.readTrees=[]);0>this.readTrees.indexOf(c)&&this.readTrees.push(c)};l.prototype.ReadObject=function(c,b,a,f){"function"==typeof b&&(a=b,b=-1);var e=c.lastIndexOf(";");0<e&&(b=parseInt(c.slice(e+1)),c=c.slice(0,e));for("number"!=typeof b&&(b=-1);c.length&&"/"==c[0];)c=c.substr(1);var g=this;this.GetKey(c,
b,function(h){if(!h)return d.CallBack(a,null);if("StreamerInfo"==c&&"TList"==h.fClassName)return g.fStreamerInfos;var e=!1;if("TDirectory"==h.fClassName||"TDirectoryFile"==h.fClassName){e=!0;var m=g.GetDir(c,b);if(m)return d.CallBack(a,m)}if(!e&&f)return d.CallBack(a,null);g.ReadObjBuffer(h,function(f){if(!f)return d.CallBack(a,null);if(e){var m=new v(g,c,b);m.fTitle=h.fTitle;return m.ReadKeys(f,a)}var n={};f.MapObject(1,n);f.ClassStreamer(n,h.fClassName);if("TF1"===h.fClassName||"TF2"===h.fClassName)return g.ReadFormulas(n,
a,-1);if(g.readTrees)return d.AssertPrerequisites("tree",function(){g.readTrees&&(g.readTrees.forEach(function(a){d.extend(a,d.TreeMethods)}),delete g.readTrees);d.CallBack(a,n)});d.CallBack(a,n)})})};l.prototype.ReadFormulas=function(c,b,a){for(var f=a;++f<this.fKeys.length&&"TFormula"!=this.fKeys[f].fClassName;);if(f>=this.fKeys.length)return d.CallBack(b,c);var e=this;this.ReadObject(this.fKeys[f].fName,this.fKeys[f].fCycle,function(a){c.addFormula(a);e.ReadFormulas(c,b,f)})};l.prototype.ExtractStreamerInfos=
function(c){if(c){var b={};c.MapObject(1,b);c.ClassStreamer(b,"TList");b._typename="TStreamerInfoList";this.fStreamerInfos=b;"function"===typeof d.addStreamerInfos&&d.addStreamerInfos(b);for(c=0;c<b.arr.length;++c){var a=b.arr[c];if(a.fElements)for(var f=0;f<a.fElements.arr.length;++f){var e=a.fElements.arr[f];if(e.fTypeName&&e.fType){var g=e.fType,h=e.fTypeName;if(60<=g){if(g===d.IO.kStreamer&&"TStreamerSTL"==e._typename&&e.fSTLtype&&e.fCtype&&20>e.fCtype){var n=(d.IO.StlNames[e.fSTLtype]||"undef")+
"<";if(0===h.indexOf(n)&&">"==h[h.length-1]&&(g=e.fCtype,h=h.substr(n.length,h.length-n.length-1).trim(),e.fSTLtype===d.IO.kSTLmap||e.fSTLtype===d.IO.kSTLmultimap))if(0<h.indexOf(","))h=h.substr(0,h.indexOf(",")).trim();else continue}if(60<=g)continue}else 20<g&&"*"==h[h.length-1]&&(h=h.substr(0,h.length-1)),g%=20;e=d.IO.GetTypeId(h);e===g||g===d.IO.kBits&&e===d.IO.kUInt||g===d.IO.kCounter&&e===d.IO.kInt||!h||!g||this.fBasicTypes[h]===g||(this.fBasicTypes[h]=g,d.BatchMode||console.log("Extract basic data type",
g,h))}}}}};l.prototype.ReadKeys=function(c){var b=this;this.ReadBuffer([0,1024],function(a){if(!a)return d.CallBack(c,null);a=d.CreateTBuffer(a,0,b);if("root"!==a.substring(0,4))return d.alert("NOT A ROOT FILE! "+b.fURL),d.CallBack(c,null);a.shift(4);b.fVersion=a.ntou4();b.fBEGIN=a.ntou4();1E6>b.fVersion?(b.fEND=a.ntou4(),b.fSeekFree=a.ntou4(),b.fNbytesFree=a.ntou4(),a.shift(4),b.fNbytesName=a.ntou4(),b.fUnits=a.ntou1(),b.fCompress=a.ntou4(),b.fSeekInfo=a.ntou4()):(b.fEND=a.ntou8(),b.fSeekFree=a.ntou8(),
b.fNbytesFree=a.ntou4(),a.shift(4),b.fNbytesName=a.ntou4(),b.fUnits=a.ntou1(),b.fCompress=a.ntou4(),b.fSeekInfo=a.ntou8());b.fNbytesInfo=a.ntou4();if(!b.fSeekInfo||!b.fNbytesInfo)return d.CallBack(c,null);if(!b.fNbytesName||1E5<b.fNbytesName)return d.console("Init : cannot read directory info of file "+b.fURL),d.CallBack(c,null);a=b.fNbytesName+22;a=a+4+4+18;4E4<=b.fVersion&&(a+=12);b.ReadBuffer([b.fBEGIN,Math.max(300,a)],function(a){if(!a)return d.CallBack(c,null);a=d.CreateTBuffer(a,0,b);b.fTitle=
a.ReadTKey().fTitle;a.locate(b.fNbytesName);a.ClassStreamer(b,"TDirectory");if(!b.fSeekKeys)return d.console("Empty keys list in "+b.fURL),d.CallBack(c,null);b.ReadBuffer([b.fSeekKeys,b.fNbytesKeys,b.fSeekInfo,b.fNbytesInfo],function(a){if(!a)return d.CallBack(c,null);var g=d.CreateTBuffer(a[0],0,b);g.ReadTKey();for(var f=g.ntoi4(),e=0;e<f;++e)b.fKeys.push(g.ReadTKey());a=d.CreateTBuffer(a[1],0,b).ReadTKey();if(!a)return d.CallBack(c,null);b.fKeys.push(a);b.ReadObjBuffer(a,function(a){a&&b.ExtractStreamerInfos(a);
return d.CallBack(c,b)})})})})};l.prototype.ReadDirectory=function(c,b,a){this.ReadObject(c,b,a,!0)};d.IO.AddClassMethods=function(c,b){if(null===b)return b;c=d.getMethods(c);if(null!==c)for(var a in c)"function"!==typeof c[a]&&0!=a.indexOf("_")||b.push({name:a,method:c[a],func:function(a,b){b[this.name]=this.method}});return b};l.prototype.FindStreamerInfo=function(c,b,a){if(this.fStreamerInfos)for(var d=0;d<this.fStreamerInfos.arr.length;++d){var e=this.fStreamerInfos.arr[d];if(void 0!==a&&e.fCheckSum===
a||e.fName===c&&void 0===a&&(void 0===b||e.fClassVersion===b))return e}return null};l.prototype.FindSinfoCheckum=function(c){if(!this.fStreamerInfos)return null;var b=this.fStreamerInfos.cache,a=this.fStreamerInfos.arr;b||(b=this.fStreamerInfos.cache={});var d=b[c];if(void 0!==d)return d;for(var e=0;e<a.length;++e)if(d=a[e],d.fCheckSum===c)return b[c]=d;return b[c]=null};d.IO.GetPairStreamer=function(c,b,a){if(!c){if(0!==b.indexOf("pair"))return null;c=a.FindStreamerInfo(b);if(!c){var f=function(){for(var a=
"",c=e+1,d=0;c<g&&0<=d;){switch(b[c]){case "<":d++;break;case ",":0===d&&d--;break;case ">":d--}0<=d&&(a+=b[c]);c++}e=c-1;return a.trim()},e=b.indexOf("<"),g=b.lastIndexOf(">");c={_typename:"TStreamerInfo",fVersion:1,fName:b,fElements:d.Create("TList")};c.fElements.Add(d.IO.CreateStreamerElement("first",f(),a));c.fElements.Add(d.IO.CreateStreamerElement("second",f(),a))}}c=a.GetStreamer(b,null,c);if(!c)return null;if(2!==c.length)return console.error("Streamer for pair class contains ",c.length,"elements"),
null;for(a=0;2>a;++a)c[a].readelem&&!c[a].pair_name&&(c[a].pair_name=0==a?"first":"second",c[a].func=function(a,b){b[this.pair_name]=this.readelem(a)});return c};d.IO.CreateMember=function(c,b){var a={name:c.fName,type:c.fType,fArrayLength:c.fArrayLength,fArrayDim:c.fArrayDim,fMaxIndex:c.fMaxIndex};"BASE"===c.fTypeName&&(0<d.IO.GetArrayKind(a.name)?(a.name="fArray",a.type=d.IO.kAny):a.type=d.IO.kBase);switch(a.type){case d.IO.kBase:a.base=c.fBaseVersion;a.basename=c.fName;a.func=function(a,b){a.ClassStreamer(b,
this.basename)};break;case d.IO.kShort:a.func=function(a,b){b[this.name]=a.ntoi2()};break;case d.IO.kInt:case d.IO.kCounter:a.func=function(a,b){b[this.name]=a.ntoi4()};break;case d.IO.kLong:case d.IO.kLong64:a.func=function(a,b){b[this.name]=a.ntoi8()};break;case d.IO.kDouble:a.func=function(a,b){b[this.name]=a.ntod()};break;case d.IO.kFloat:a.func=function(a,b){b[this.name]=a.ntof()};break;case d.IO.kLegacyChar:case d.IO.kUChar:a.func=function(a,b){b[this.name]=a.ntou1()};break;case d.IO.kUShort:a.func=
function(a,b){b[this.name]=a.ntou2()};break;case d.IO.kBits:case d.IO.kUInt:a.func=function(a,b){b[this.name]=a.ntou4()};break;case d.IO.kULong64:case d.IO.kULong:a.func=function(a,b){b[this.name]=a.ntou8()};break;case d.IO.kBool:a.func=function(a,b){b[this.name]=0!=a.ntou1()};break;case d.IO.kOffsetL+d.IO.kBool:case d.IO.kOffsetL+d.IO.kInt:case d.IO.kOffsetL+d.IO.kCounter:case d.IO.kOffsetL+d.IO.kDouble:case d.IO.kOffsetL+d.IO.kUChar:case d.IO.kOffsetL+d.IO.kShort:case d.IO.kOffsetL+d.IO.kUShort:case d.IO.kOffsetL+
d.IO.kBits:case d.IO.kOffsetL+d.IO.kUInt:case d.IO.kOffsetL+d.IO.kULong:case d.IO.kOffsetL+d.IO.kULong64:case d.IO.kOffsetL+d.IO.kLong:case d.IO.kOffsetL+d.IO.kLong64:case d.IO.kOffsetL+d.IO.kFloat:2>c.fArrayDim?(a.arrlength=c.fArrayLength,a.func=function(a,b){b[this.name]=a.ReadFastArray(this.arrlength,this.type-d.IO.kOffsetL)}):(a.arrlength=c.fMaxIndex[c.fArrayDim-1],a.minus1=!0,a.func=function(a,b){b[this.name]=a.ReadNdimArray(this,function(a,b){return a.ReadFastArray(b.arrlength,b.type-d.IO.kOffsetL)})});
break;case d.IO.kOffsetL+d.IO.kChar:2>c.fArrayDim?(a.arrlength=c.fArrayLength,a.func=function(a,b){b[this.name]=a.ReadFastString(this.arrlength)}):(a.minus1=!0,a.arrlength=c.fMaxIndex[c.fArrayDim-1],a.func=function(a,b){b[this.name]=a.ReadNdimArray(this,function(a,b){return a.ReadFastString(b.arrlength)})});break;case d.IO.kOffsetP+d.IO.kBool:case d.IO.kOffsetP+d.IO.kInt:case d.IO.kOffsetP+d.IO.kDouble:case d.IO.kOffsetP+d.IO.kUChar:case d.IO.kOffsetP+d.IO.kShort:case d.IO.kOffsetP+d.IO.kUShort:case d.IO.kOffsetP+
d.IO.kBits:case d.IO.kOffsetP+d.IO.kUInt:case d.IO.kOffsetP+d.IO.kULong:case d.IO.kOffsetP+d.IO.kULong64:case d.IO.kOffsetP+d.IO.kLong:case d.IO.kOffsetP+d.IO.kLong64:case d.IO.kOffsetP+d.IO.kFloat:a.cntname=c.fCountName;a.func=function(a,b){1===a.ntou1()?b[this.name]=a.ReadFastArray(b[this.cntname],this.type-d.IO.kOffsetP):b[this.name]=[]};break;case d.IO.kOffsetP+d.IO.kChar:a.cntname=c.fCountName;a.func=function(a,b){1===a.ntou1()?b[this.name]=a.ReadFastString(b[this.cntname]):b[this.name]=null};
break;case d.IO.kDouble32:case d.IO.kOffsetL+d.IO.kDouble32:case d.IO.kOffsetP+d.IO.kDouble32:a.double32=!0;case d.IO.kFloat16:case d.IO.kOffsetL+d.IO.kFloat16:case d.IO.kOffsetP+d.IO.kFloat16:0!==c.fFactor?(a.factor=1/c.fFactor,a.min=c.fXmin,a.read=function(a){return a.ntou4()*this.factor+this.min}):0===c.fXmin&&a.double32?a.read=function(a){return a.ntof()}:(a.nbits=Math.round(c.fXmin),0===a.nbits&&(a.nbits=12),a.dv=new DataView(new ArrayBuffer(8),0),a.read=function(a){var b=a.ntou1();a=a.ntou2();
this.dv.setUint32(0,b<<23|(a&(1<<this.nbits+1)-1)<<23-this.nbits);return(1<<this.nbits+1&a?-1:1)*this.dv.getFloat32(0)});a.readarr=function(a,b){for(var c=this.double32?new Float64Array(b):new Float32Array(b),d=0;d<b;++d)c[d]=this.read(a);return c};a.type<d.IO.kOffsetL?a.func=function(a,b){b[this.name]=this.read(a)}:a.type>d.IO.kOffsetP?(a.cntname=c.fCountName,a.func=function(a,b){1===a.ntou1()?b[this.name]=this.readarr(a,b[this.cntname]):b[this.name]=null}):2>c.fArrayDim?(a.arrlength=c.fArrayLength,
a.func=function(a,b){b[this.name]=this.readarr(a,this.arrlength)}):(a.arrlength=c.fMaxIndex[c.fArrayDim-1],a.minus1=!0,a.func=function(a,b){b[this.name]=a.ReadNdimArray(this,function(a,b){return b.readarr(a,b.arrlength)})});break;case d.IO.kAnyP:case d.IO.kObjectP:a.func=function(a,b){b[this.name]=a.ReadNdimArray(this,function(a){return a.ReadObjectAny()})};break;case d.IO.kAny:case d.IO.kAnyp:case d.IO.kObjectp:case d.IO.kObject:b="BASE"===c.fTypeName?c.fName:c.fTypeName;"*"==b[b.length-1]&&(b=b.substr(0,
b.length-1));var f=d.IO.GetArrayKind(b);0<f?(a.arrkind=f,a.func=function(a,b){b[this.name]=a.ReadFastArray(a.ntou4(),this.arrkind)}):0===f?a.func=function(a,b){b[this.name]=a.ReadTString()}:(a.classname=b,a.func=1<c.fArrayLength?function(a,b){b[this.name]=a.ReadNdimArray(this,function(a,b){return a.ClassStreamer({},b.classname)})}:function(a,b){b[this.name]=a.ClassStreamer({},this.classname)});break;case d.IO.kOffsetL+d.IO.kObject:case d.IO.kOffsetL+d.IO.kAny:case d.IO.kOffsetL+d.IO.kAnyp:case d.IO.kOffsetL+
d.IO.kObjectp:b=c.fTypeName;"*"==b[b.length-1]&&(b=b.substr(0,b.length-1));a.arrkind=d.IO.GetArrayKind(b);0>a.arrkind&&(a.classname=b);a.func=function(a,b){b[this.name]=a.ReadNdimArray(this,function(a,b){return 0<b.arrkind?a.ReadFastArray(a.ntou4(),b.arrkind):0===b.arrkind?a.ReadTString():a.ClassStreamer({},b.classname)})};break;case d.IO.kChar:a.func=function(a,b){b[this.name]=a.ntoi1()};break;case d.IO.kCharStar:a.func=function(a,b){var c=a.ntoi4();b[this.name]=a.substring(a.o,a.o+c);a.o+=c};break;
case d.IO.kTString:a.func=function(a,b){b[this.name]=a.ReadTString()};break;case d.IO.kTObject:case d.IO.kTNamed:a.typename=c.fTypeName;a.func=function(a,b){b[this.name]=a.ClassStreamer({},this.typename)};break;case d.IO.kOffsetL+d.IO.kTString:case d.IO.kOffsetL+d.IO.kTObject:case d.IO.kOffsetL+d.IO.kTNamed:a.typename=c.fTypeName;a.func=function(a,b){var c=a.ReadVersion();b[this.name]=a.ReadNdimArray(this,function(a,b){return"TString"===b.typename?a.ReadTString():a.ClassStreamer({},b.typename)});
a.CheckBytecount(c,this.typename+"[]")};break;case d.IO.kStreamLoop:case d.IO.kOffsetL+d.IO.kStreamLoop:a.typename=c.fTypeName;a.cntname=c.fCountName;0<a.typename.lastIndexOf("**")?(a.typename=a.typename.substr(0,a.typename.lastIndexOf("**")),a.isptrptr=!0):(a.typename=a.typename.substr(0,a.typename.lastIndexOf("*")),a.isptrptr=!1);a.isptrptr?a.readitem=function(a){return a.ReadObjectAny()}:(a.arrkind=d.IO.GetArrayKind(a.typename),a.readitem=0<a.arrkind?function(a){return a.ReadFastArray(a.ntou4(),
this.arrkind)}:0===a.arrkind?function(a){return a.ReadTString()}:function(a){return a.ClassStreamer({},this.typename)});void 0!==a.readitem?(a.read_loop=function(a,b){return a.ReadNdimArray(this,function(a,c){for(var d=Array(b),f=0;f<b;++f)d[f]=c.readitem(a);return d})},a.func=function(a,b){var c=a.ReadVersion(),d=this.read_loop(a,b[this.cntname]);a.CheckBytecount(c,this.typename)||(d=null);b[this.name]=d},a.branch_func=function(a,b){for(var c=a.ReadVersion(),d=b[this.stl_size],f=Array(d),e=0;e<d;++e)f[e]=
this.read_loop(a,b[this.cntname][e]);a.CheckBytecount(c,this.typename)||(f=null);b[this.name]=f},a.objs_branch_func=function(a,b){var c=a.ReadVersion();b=b[this.name0];for(var d=0;d<b.length;++d){var f=this.get(b,d);f[this.name]=this.read_loop(a,f[this.cntname])}a.CheckBytecount(c,this.typename)}):(d.console("fail to provide function for "+c.fName+" ("+c.fTypeName+")  typ = "+c.fType),a.func=function(a,b){var c=a.ReadVersion();a.CheckBytecount(c);b[this.name]=ull});break;case d.IO.kStreamer:a.typename=
c.fTypeName;f=(c.fSTLtype||0)%40;if("TStreamerSTLstring"===c._typename||"string"==a.typename||"string*"==a.typename)a.readelem=function(a){return a.ReadTString()};else if(f===d.IO.kSTLvector||f===d.IO.kSTLlist||f===d.IO.kSTLdeque||f===d.IO.kSTLset||f===d.IO.kSTLmultiset){f=a.typename.indexOf("<");var e=a.typename.lastIndexOf(">");a.conttype=a.typename.substr(f+1,e-f-1).trim();a.typeid=d.IO.GetTypeId(a.conttype);0>a.typeid&&b.fBasicTypes[a.conttype]&&(a.typeid=b.fBasicTypes[a.conttype],console.log("!!! Reuse basic type",
a.conttype,"from file streamer infos"));c.fCtype&&20>c.fCtype&&c.fCtype!==a.typeid&&(console.warn("Contained type",a.conttype,"not recognized as basic type",c.fCtype,"FORCE"),a.typeid=c.fCtype);0<a.typeid?a.readelem=function(a){return a.ReadFastArray(a.ntoi4(),this.typeid)}:(a.isptr=!1,a.conttype.lastIndexOf("*")===a.conttype.length-1&&(a.isptr=!0,a.conttype=a.conttype.substr(0,a.conttype.length-1)),c.fCtype===d.IO.kObjectp&&(a.isptr=!0),a.arrkind=d.IO.GetArrayKind(a.conttype),a.readelem=d.IO.ReadVectorElement,
!a.isptr&&0>a.arrkind&&(f=d.IO.CreateStreamerElement("temp",a.conttype),f.fType===d.IO.kStreamer&&(f.$fictional=!0,a.submember=d.IO.CreateMember(f,b))))}else f===d.IO.kSTLmap||f===d.IO.kSTLmultimap?(f=a.typename.indexOf("<"),e=a.typename.lastIndexOf(">"),a.pairtype="pair<"+a.typename.substr(f+1,e-f-1)+">",a.si=b.FindStreamerInfo(a.pairtype),a.streamer=d.IO.GetPairStreamer(a.si,a.pairtype,b),a.streamer&&2===a.streamer.length||(d.console("Fail to build streamer for pair "+a.pairtype),delete a.streamer),
a.streamer&&(a.readelem=d.IO.ReadMapElement)):f===d.IO.kSTLbitset&&(a.readelem=function(a,b){return a.ReadFastArray(a.ntou4(),d.IO.kBool)});a.readelem?c.$fictional||(a.read_version=function(a,b){if(0===b)return null;b=a.ReadVersion();this.member_wise=0!==(b.val&d.IO.kStreamedMemberWise);this.stl_version=void 0;this.member_wise&&(this.stl_version={val:a.ntoi2()},0>=this.stl_version.val&&(this.stl_version.checksum=a.ntou4()));return b},a.func=function(a,b){var c=this.read_version(a),d=a.ReadNdimArray(this,
function(a,b){return b.readelem(a)});a.CheckBytecount(c,this.typename)||(d=null);b[this.name]=d},a.branch_func=function(a,b){for(var c=b[this.stl_size],d=Array(c),f=this.read_version(a,c),e=0;e<c;++e)d[e]=a.ReadNdimArray(this,function(a,b){return b.readelem(a)});f&&a.CheckBytecount(f,"branch "+this.typename);b[this.name]=d},a.split_func=function(a,b,c){for(var d=this.read_version(a),f=0;f<c;++f)b[f][this.name]=a.ReadNdimArray(this,function(a,b){return b.readelem(a)});a.CheckBytecount(d,this.typename)},
a.objs_branch_func=function(a,b){b=b[this.name0];for(var c=this.read_version(a,b.length),d=0;d<b.length;++d)this.get(b,d)[this.name]=a.ReadNdimArray(this,function(a,b){return b.readelem(a)});c&&a.CheckBytecount(c,"branch "+this.typename)}):(d.console("failed to create streamer for element "+a.typename+" "+a.name+" element "+c._typename+" STL type "+c.fSTLtype),a.func=function(a,b){var c=a.ReadVersion();a.CheckBytecount(c);b[this.name]=null});break;default:d.console("fail to provide function for "+
c.fName+" ("+c.fTypeName+")  typ = "+c.fType),a.func=function(a,b){}}return a};l.prototype.GetStreamer=function(c,b,a){if("TQObject"==c||"TBasket"==c)return null;var f=c;if(b){f+=b.checksum?"$chksum"+b.checksum:"$ver"+b.val;var e=this.fStreamers[f];if(void 0!==e)return e}var g=d.IO.CustomStreamers[c];if("string"===typeof g)return this.GetStreamer(g,b,a);if("function"===typeof g)return e=[{typename:c,func:g}],d.IO.AddClassMethods(c,e);e=[];if("object"===typeof g){if(!g.name&&!g.func)return g;e.push(g)}a||
(a=this.FindStreamerInfo(c,b.val,b.checksum));if(!a)return delete this.fStreamers[f],b.nowarning||console.warn("Not found streamer for",c,"ver",b.val,"checksum",b.checksum,f),null;if(a.fElements)for(b=0;b<a.fElements.arr.length;++b)e.push(d.IO.CreateMember(a.fElements.arr[b],this));this.fStreamers[f]=e;return d.IO.AddClassMethods(c,e)};l.prototype.GetSplittedStreamer=function(c,b){if(!c)return b;b||(b=[]);for(var a=0;a<c.length;++a){var f=c[a];if(void 0===f.base)b.push(f);else if("TObject"==f.basename)b.push({func:function(a,
b){a.ntoi2();b.fUniqueID=a.ntou4();b.fBits=a.ntou4();b.fBits&d.IO.kIsReferenced&&a.ntou2()}});else{var e={val:f.base};4294967295===e.val&&(e.val=1);(f=this.GetStreamer(f.basename,e))&&this.GetSplittedStreamer(f,b)}}return b};l.prototype.Delete=function(){this.fStreamers=this.fKeys=this.fDirectories=null;this.fTagOffset=this.fNbytesInfo=this.fSeekInfo=0};y.prototype=Object.create(l.prototype);y.prototype.ReadBuffer=function(c,b,a,d){if(a)throw Error("Cannot access other local file "+a);var f=new FileReader,
g=0,h=[],k=this.fLocalFile;f.onload=function(a){a=new DataView(a.target.result);if(2===c.length)return b(a);h.push(a);g+=2;if(g>=c.length)return b(h);f.readAsArrayBuffer(k.slice(c[g],c[g]+c[g+1]))};f.readAsArrayBuffer(k.slice(c[0],c[0]+c[1]))};w.prototype=Object.create(l.prototype);w.prototype.ReadBuffer=function(c,b,a,d){function f(a,d,e){a=new DataView(e.buffer,e.byteOffset,c[g+1]);if(2===c.length)return b(a);h.push(a);g+=2;if(g>=c.length)return b(h);k.fs.read(k.fd,new Buffer(c[g+1]),0,c[g+1],c[g],
f)}if(a)throw Error("Cannot access other local file "+a);if(!this.fs||!this.fd)throw Error("File is not opened "+this.fFileName);var g=0,h=[],k=this;k.fs.read(k.fd,new Buffer(c[1]),0,c[1],c[0],f)};d.IO.ProduceCustomStreamers=function(){var c=d.IO.CustomStreamers;c.TObject=c.TMethodCall=function(b,a){a.fUniqueID=b.ntou4();a.fBits=b.ntou4();a.fBits&d.IO.kIsReferenced&&b.ntou2()};c.TNamed=[{basename:"TObject",base:1,func:function(b,a){a._typename||(a._typename="TNamed");b.ClassStreamer(a,"TObject")}},
{name:"fName",func:function(b,a){a.fName=b.ReadTString()}},{name:"fTitle",func:function(b,a){a.fTitle=b.ReadTString()}}];d.IO.AddClassMethods("TNamed",c.TNamed);c.TObjString=[{basename:"TObject",base:1,func:function(b,a){a._typename||(a._typename="TObjString");b.ClassStreamer(a,"TObject")}},{name:"fString",func:function(b,a){a.fString=b.ReadTString()}}];d.IO.AddClassMethods("TObjString",c.TObjString);c.TList=c.THashList=function(b,a){a._typename||(a._typename=this.typename);a.$kind="TList";if(3<b.last_read_version){b.ClassStreamer(a,
"TObject");a.name=b.ReadTString();var c=b.ntou4(),d=0;a.arr=Array(c);for(a.opt=Array(c);d<c;++d)a.arr[d]=b.ReadObjectAny(),a.opt[d]=b.ReadTString()}else a.name="",a.arr=[],a.opt=[]};c.TClonesArray=function(b,a){a._typename||(a._typename="TClonesArray");a.$kind="TClonesArray";a.name="";var c=b.last_read_version;2<c&&b.ClassStreamer(a,"TObject");1<c&&(a.name=b.ReadTString());c=b.ReadTString();var d=0,g=c.lastIndexOf(";");0<g&&(d=parseInt(c.substr(g+1)),c=c.substr(0,g));g=b.ntou4();0>g&&(g=-g);a.arr=
Array(g);a.fLast=g-1;a.fLowerBound=b.ntou4();var h=b.fFile.GetStreamer(c,{val:d});if(h=b.fFile.GetSplittedStreamer(h)){for(d=0;d<g;++d)a.arr[d]={_typename:c};for(c=0;c<h.length;++c)for(d=0;d<g;++d)h[c].func(b,a.arr[d])}else console.log("Cannot get member-wise streamer for",c,d)};c.TMap=function(b,a){a._typename||(a._typename="TMap");a.name="";a.arr=[];var c=b.last_read_version;2<c&&b.ClassStreamer(a,"TObject");1<c&&(a.name=b.ReadTString());c=b.ntou4();for(var d=0;d<c;++d){var g={_typename:"TPair"};
g.first=b.ReadObjectAny();g.second=b.ReadObjectAny();g.first&&a.arr.push(g)}};c.TTreeIndex=function(b,a){var c=b.last_read_version;a._typename="TTreeIndex";b.ClassStreamer(a,"TVirtualIndex");a.fMajorName=b.ReadTString();a.fMinorName=b.ReadTString();a.fN=b.ntoi8();a.fIndexValues=b.ReadFastArray(a.fN,d.IO.kLong64);1<c&&(a.fIndexValuesMinor=b.ReadFastArray(a.fN,d.IO.kLong64));a.fIndex=b.ReadFastArray(a.fN,d.IO.kLong64)};c.TRefArray=function(b,a){a._typename="TRefArray";b.ClassStreamer(a,"TObject");a.name=
b.ReadTString();var c=b.ntoi4();a.fLast=c-1;a.fLowerBound=b.ntoi4();b.ntou2();a.fUIDs=b.ReadFastArray(c,d.IO.kUInt)};c.TCanvas=function(b,a){a._typename="TCanvas";b.ClassStreamer(a,"TPad");a.fDISPLAY=b.ReadTString();a.fDoubleBuffer=b.ntoi4();a.fRetained=0!==b.ntou1();a.fXsizeUser=b.ntoi4();a.fYsizeUser=b.ntoi4();a.fXsizeReal=b.ntoi4();a.fYsizeReal=b.ntoi4();a.fWindowTopX=b.ntoi4();a.fWindowTopY=b.ntoi4();a.fWindowWidth=b.ntoi4();a.fWindowHeight=b.ntoi4();a.fCw=b.ntou4();a.fCh=b.ntou4();a.fCatt=b.ClassStreamer({},
"TAttCanvas");b.ntou1();b.ntou1();a.fHighLightColor=b.ntoi2();a.fBatch=0!==b.ntou1();b.ntou1();b.ntou1();b.ntou1()};c.TObjArray=function(b,a){a._typename||(a._typename="TObjArray");a.$kind="TObjArray";a.name="";var c=b.last_read_version;2<c&&b.ClassStreamer(a,"TObject");1<c&&(a.name=b.ReadTString());c=b.ntou4();var d=0;a.arr=Array(c);a.fLast=c-1;for(a.fLowerBound=b.ntou4();d<c;)a.arr[d++]=b.ReadObjectAny()};c.TPolyMarker3D=function(b,a){var c=b.last_read_version;b.ClassStreamer(a,"TObject");b.ClassStreamer(a,
"TAttMarker");a.fN=b.ntoi4();a.fP=b.ReadFastArray(3*a.fN,d.IO.kFloat);a.fOption=b.ReadTString();a.fName=1<c?b.ReadTString():"TPolyMarker3D"};c.TPolyLine3D=function(b,a){b.ClassStreamer(a,"TObject");b.ClassStreamer(a,"TAttLine");a.fN=b.ntoi4();a.fP=b.ReadFastArray(3*a.fN,d.IO.kFloat);a.fOption=b.ReadTString()};c.TStreamerInfo=function(b,a){b.ClassStreamer(a,"TNamed");a.fCheckSum=b.ntou4();a.fClassVersion=b.ntou4();a.fElements=b.ReadObjectAny()};c.TStreamerElement=function(b,a){var c=b.last_read_version;
b.ClassStreamer(a,"TNamed");a.fType=b.ntou4();a.fSize=b.ntou4();a.fArrayLength=b.ntou4();a.fArrayDim=b.ntou4();a.fMaxIndex=b.ReadFastArray(1==c?b.ntou4():5,d.IO.kUInt);a.fTypeName=b.ReadTString();a.fType!==d.IO.kUChar||"Bool_t"!=a.fTypeName&&"bool"!=a.fTypeName||(a.fType=d.IO.kBool);a.fXmin=a.fXmax=a.fFactor=0;if(3===c)a.fXmin=b.ntod(),a.fXmax=b.ntod(),a.fFactor=b.ntod();else if(3<c&&a.fBits&d.BIT(6)){c=a.fTitle.indexOf("[");0<=c&&a.fType>d.IO.kOffsetP&&(c=a.fTitle.indexOf("[",c+1));var e=a.fTitle.indexOf("]",
c+1);if(0<=c&&e>=c+2){b=function(a){if(!a)return 0;if(0>a.indexOf("pi"))return parseFloat(a);a=a.trim();var b=1;"-"==a[0]&&(b=-1,a=a.substr(1));switch(a){case "2pi":case "2*pi":case "twopi":return 2*b*Math.PI;case "pi/2":return b*Math.PI/2;case "pi/4":return b*Math.PI/4}return b*Math.PI};c=d.ParseAsArray(a.fTitle.substr(c,e-c+1));e=32;3===c.length&&(e=parseInt(c[2]));if(isNaN(e)||2>e||32<e)e=32;a.fXmin=b(c[0]);a.fXmax=b(c[1]);a.fXmin<a.fXmax?a.fFactor=(32>e?1<<e:4294967295)/(a.fXmax-a.fXmin):15>e&&
(a.fXmin=e)}}};c.TStreamerBase=function(b,a){var c=b.last_read_version;b.ClassStreamer(a,"TStreamerElement");2<c&&(a.fBaseVersion=b.ntou4())};c.TStreamerBasicPointer=c.TStreamerLoop=function(b,a){1<b.last_read_version&&(b.ClassStreamer(a,"TStreamerElement"),a.fCountVersion=b.ntou4(),a.fCountName=b.ReadTString(),a.fCountClass=b.ReadTString())};c.TStreamerSTL=function(b,a){b.ClassStreamer(a,"TStreamerElement");a.fSTLtype=b.ntou4();a.fCtype=b.ntou4();a.fSTLtype!==d.IO.kSTLmultimap||0!==a.fTypeName.indexOf("std::set")&&
0!=a.fTypeName.indexOf("set")||(a.fSTLtype=d.IO.kSTLset);a.fSTLtype!==d.IO.kSTLset||0!==a.fTypeName.indexOf("std::multimap")&&0!==a.fTypeName.indexOf("multimap")||(a.fSTLtype=d.IO.kSTLmultimap)};c.TStreamerSTLstring=function(b,a){0<b.last_read_version&&b.ClassStreamer(a,"TStreamerSTL")};c.TStreamerObject=c.TStreamerBasicType=c.TStreamerObjectAny=c.TStreamerString=c.TStreamerObjectPointer=function(b,a){1<b.last_read_version&&b.ClassStreamer(a,"TStreamerElement")};c.TStreamerObjectAnyPointer=function(b,
a){0<b.last_read_version&&b.ClassStreamer(a,"TStreamerElement")};c.TTree={name:"$file",func:function(b,a){a.$kind="TTree";a.$file=b.fFile;b.fFile.AddReadTree(a)}};c.TVirtualPerfStats="TObject";c.RooRealVar=function(b,a){var c=b.last_read_version;b.ClassStreamer(a,"RooAbsRealLValue");1==c&&(b.ntod(),b.ntod(),b.ntoi4());a._error=b.ntod();a._asymErrLo=b.ntod();a._asymErrHi=b.ntod();2<=c&&(a._binning=b.ReadObjectAny());3==c&&(a._sharedProp=b.ReadObjectAny());4<=c&&(a._sharedProp=b.ClassStreamer({},"RooRealVarSharedProperties"))};
c.RooAbsBinning=function(b,a){b.ClassStreamer(a,1==b.last_read_version?"TObject":"TNamed");b.ClassStreamer(a,"RooPrintable")};c.RooCategory=function(b,a){var c=b.last_read_version;b.ClassStreamer(a,"RooAbsCategoryLValue");a._sharedProp=1===c?b.ReadObjectAny():b.ClassStreamer({},"RooCategorySharedProperties")};c["RooWorkspace::CodeRepo"]=function(b,a){a=2==b.last_read_version?3:2;for(var c=0;c<a;++c)for(var d=b.ntoi4()*(0==c?4:3);d--;)b.ReadTString()};c.RooLinkedList=function(b,a){var c=b.last_read_version;
b.ClassStreamer(a,"TObject");var e=b.ntoi4();for(a.arr=d.Create("TList");e--;)a.arr.Add(b.ReadObjectAny());1<c&&(a._name=b.ReadTString())};c.TASImage=function(b,a){if(1==b.last_read_version&&0<b.fFile.fVersion&&5E4>b.fFile.fVersion)return console.warn("old TASImage version - not yet supported");b.ClassStreamer(a,"TNamed");if(0!=b.ntou1()){var c=b.ntoi4();a.fPngBuf=b.ReadFastArray(c,d.IO.kUChar)}else b.ClassStreamer(a,"TAttImage"),a.fWidth=b.ntoi4(),a.fHeight=b.ntoi4(),a.fImgBuf=b.ReadFastArray(a.fWidth*
a.fHeight,d.IO.kDouble)};c.TMaterial=function(b,a){var c=b.last_read_version;b.ClassStreamer(a,"TNamed");a.fNumber=b.ntoi4();a.fA=b.ntof();a.fZ=b.ntof();a.fDensity=b.ntof();2<c?(b.ClassStreamer(a,"TAttFill"),a.fRadLength=b.ntof(),a.fInterLength=b.ntof()):a.fRadLength=a.fInterLength=0};c.TMixture=function(b,a){b.ClassStreamer(a,"TMaterial");a.fNmixt=b.ntoi4();a.fAmixt=b.ReadFastArray(b.ntoi4(),d.IO.kFloat);a.fZmixt=b.ReadFastArray(b.ntoi4(),d.IO.kFloat);a.fWmixt=b.ReadFastArray(b.ntoi4(),d.IO.kFloat)};
c=d.IO.DirectStreamers;c.TQObject=c.TGraphStruct=c.TGraphNode=c.TGraphEdge=function(b,a){};c.TDatime=function(b,a){a.fDatime=b.ntou4()};c.TKey=function(b,a){a.fNbytes=b.ntoi4();a.fVersion=b.ntoi2();a.fObjlen=b.ntou4();a.fDatime=b.ClassStreamer({},"TDatime");a.fKeylen=b.ntou2();a.fCycle=b.ntou2();1E3<a.fVersion?(a.fSeekKey=b.ntou8(),b.shift(8)):(a.fSeekKey=b.ntou4(),b.shift(4));a.fClassName=b.ReadTString();a.fName=b.ReadTString();a.fTitle=b.ReadTString()};c.TDirectory=function(b,a){var c=b.ntou2();
a.fDatimeC=b.ClassStreamer({},"TDatime");a.fDatimeM=b.ClassStreamer({},"TDatime");a.fNbytesKeys=b.ntou4();a.fNbytesName=b.ntou4();a.fSeekDir=1E3<c?b.ntou8():b.ntou4();a.fSeekParent=1E3<c?b.ntou8():b.ntou4();a.fSeekKeys=1E3<c?b.ntou8():b.ntou4()};c.TBasket=function(b,a){b.ClassStreamer(a,"TKey");var c=b.ReadVersion();a.fBufferSize=b.ntoi4();a.fNevBufSize=b.ntoi4();a.fNevBuf=b.ntoi4();a.fLast=b.ntoi4();a.fLast>a.fBufferSize&&(a.fBufferSize=a.fLast);var e=b.ntoi1();if(0!==e){if(2!=e%10){if(a.fNevBuf&&
(a.fEntryOffset=b.ReadFastArray(b.ntoi4(),d.IO.kInt),20<e&&40>e))for(var g=0;g<a.fNevBuf;++g)a.fEntryOffset[g]&=16777215;40<e&&(a.fDisplacement=b.ReadFastArray(b.ntoi4(),d.IO.kInt))}if(1===e||10<e)c=1>=c.val?b.ntoi4():a.fLast,c>a.fKeylen&&(e=b.extract([b.o+a.fKeylen,c-a.fKeylen]),a.fBufferRef=d.CreateTBuffer(e,0,b.fFile,c-a.fKeylen),a.fBufferRef.fTagOffset=a.fKeylen),b.shift(c)}};c.TRef=function(b,a){b.ClassStreamer(a,"TObject");a.fBits&d.IO.kHasUUID?a.fUUID=b.ReadTString():a.fPID=b.ntou2()};c["TMatrixTSym<float>"]=
function(b,a){b.ClassStreamer(a,"TMatrixTBase<float>");a.fElements=new Float32Array(a.fNelems);b=b.ReadFastArray(a.fNrows*(a.fNcols+1)/2,d.IO.kFloat);for(var c=0,e=0;e<a.fNrows;++e)for(var g=e;g<a.fNcols;++g)a.fElements[g*a.fNcols+e]=a.fElements[e*a.fNcols+g]=b[c++]};c["TMatrixTSym<double>"]=function(b,a){b.ClassStreamer(a,"TMatrixTBase<double>");a.fElements=new Float64Array(a.fNelems);b=b.ReadFastArray(a.fNrows*(a.fNcols+1)/2,d.IO.kDouble);for(var c=0,e=0;e<a.fNrows;++e)for(var g=e;g<a.fNcols;++g)a.fElements[g*
a.fNcols+e]=a.fElements[e*a.fNcols+g]=b[c++]}};d.IO.CreateStreamerElement=function(c,b,a){c={_typename:"TStreamerElement",fName:c,fTypeName:b,fType:0,fSize:0,fArrayLength:0,fArrayDim:0,fMaxIndex:[0,0,0,0,0],fXmin:0,fXmax:0,fFactor:0};"string"===typeof b?(c.fType=d.IO.GetTypeId(b),0>c.fType&&a&&a.fBasicTypes[b]&&(c.fType=a.fBasicTypes[b])):(c.fType=b,b=c.fTypeName=d.IO.TypeNames[c.fType]||"int");if(0<c.fType)return c;a=d.IO.kNotSTL;var f=b.indexOf("<");if(0<f&&b.indexOf(">")>f+2)for(var e=1;e<d.IO.StlNames.length;++e)if(b.substr(0,
f)===d.IO.StlNames[e]){a=e;break}if(a!==d.IO.kNotSTL)return c._typename="TStreamerSTL",c.fType=d.IO.kStreamer,c.fSTLtype=a,c.fCtype=0,c;a=!1;b.lastIndexOf("*")===b.length-1&&(a=!0,c.fTypeName=b=b.substr(0,b.length-1));if(0==d.IO.GetArrayKind(b))return c.fType=d.IO.kTString,c;c.fType=a?d.IO.kAnyP:d.IO.kAny;return c};d.IO.ReadVectorElement=function(c){if(this.member_wise){var b=c.ntou4(),a=this.stl_version;if(0===b)return[];if(1E6<b)throw Error("member-wise streaming of "+this.conttype+" num "+b+" member "+
this.name);if(a.val===this.member_ver&&a.checksum===this.member_checksum)var d=this.member_streamer;else d=c.fFile.GetStreamer(this.conttype,a),this.member_streamer=d=c.fFile.GetSplittedStreamer(d),this.member_ver=a.val,this.member_checksum=a.checksum;var e=Array(b),g;for(g=0;g<b;++g)e[g]={_typename:this.conttype};if(d)for(a=0;a<d.length;++a){var h=d[a];if(h.split_func)h.split_func(c,e,b);else for(g=0;g<b;++g)h.func(c,e[g])}else console.error("Fail to create split streamer for",this.conttype,"need to read ",
b,"objects version",a);return e}b=c.ntou4();e=Array(b);g=0;if(2E5<b)return console.error("vector streaming for of",this.conttype,b),e;if(0<this.arrkind)for(;g<b;)e[g++]=c.ReadFastArray(c.ntou4(),this.arrkind);else if(0===this.arrkind)for(;g<b;)e[g++]=c.ReadTString();else if(this.isptr)for(;g<b;)e[g++]=c.ReadObjectAny();else if(this.submember)for(;g<b;)e[g++]=this.submember.readelem(c);else for(;g<b;)e[g++]=c.ClassStreamer({},this.conttype);return e};d.IO.ReadMapElement=function(c){var b=this.streamer;
if(this.member_wise){var a=this.stl_version;if(this.si&&(a=c.fFile.FindStreamerInfo(this.pairtype,a.val,a.checksum),this.si!==a&&(b=d.IO.GetPairStreamer(a,this.pairtype,c.fFile),!b||2!==b.length)))return console.log("Fail to produce streamer for ",this.pairtype),null}var f=c.ntoi4(),e=Array(f);for(a=0;a<f;++a)e[a]={_typename:this.pairtype},b[0].func(c,e[a]),this.member_wise||b[1].func(c,e[a]);if(this.member_wise)for(a=0;a<f;++a)b[1].func(c,e[a]);return e};d.OpenFile=function(c,b){if(d.nodejs){if(0==
c.indexOf("file://"))return new w(c.substr(7),b);if(0!==c.indexOf("http"))return new w(c,b)}return"object"===typeof c&&c.size&&c.name?new y(c,b):new l(c,b)};d.IO.NativeArray=d.nodejs||window&&"Float64Array"in window;d.IO.ProduceCustomStreamers();d.TBuffer=k;d.TDirectory=v;d.TFile=l;d.TLocalFile=y;d.TNodejsFile=w;return d});
