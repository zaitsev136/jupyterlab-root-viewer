var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(m,B,f){m!=Array.prototype&&m!=Object.prototype&&(m[B]=f.value)};$jscomp.getGlobal=function(m){return"undefined"!=typeof window&&window===m?m:"undefined"!=typeof global&&null!=global?global:m};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(m,B,f,y){if(B){f=$jscomp.global;m=m.split(".");for(y=0;y<m.length-1;y++){var q=m[y];q in f||(f[q]={});f=f[q]}m=m[m.length-1];y=f[m];B=B(y);B!=y&&null!=B&&$jscomp.defineProperty(f,m,{configurable:!0,writable:!0,value:B})}};$jscomp.arrayIteratorImpl=function(m){var B=0;return function(){return B<m.length?{done:!1,value:m[B++]}:{done:!0}}};$jscomp.arrayIterator=function(m){return{next:$jscomp.arrayIteratorImpl(m)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(m,B){this.$jscomp$symbol$id_=m;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:B})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function m(f){if(this instanceof m)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(f||"")+"_"+B++,f)}var B=0;return m}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var m=$jscomp.global.Symbol.iterator;m||(m=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[m]&&$jscomp.defineProperty(Array.prototype,m,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var m=$jscomp.global.Symbol.asyncIterator;m||(m=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(m){$jscomp.initSymbolIterator();m={next:m};m[$jscomp.global.Symbol.iterator]=function(){return this};return m};
$jscomp.iteratorFromArray=function(m,B){$jscomp.initSymbolIterator();m instanceof String&&(m+="");var f=0,y={next:function(){if(f<m.length){var q=f++;return{value:B(q,m[q]),done:!1}}y.next=function(){return{done:!0,value:void 0}};return y.next()}};y[Symbol.iterator]=function(){return y};return y};$jscomp.polyfill("Array.prototype.entries",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(m,f){return[m,f]})}},"es6","es3");
(function(m){if("function"===typeof define&&define.amd)define(["JSRootPainter","d3"],m);else if("object"===typeof exports&&"undefined"!==typeof module)m(require("./JSRootCore.js"),require("d3"));else{if("object"!=typeof d3)throw Error("This extension requires d3.js","JSRootPainter.v7hist.js");if("undefined"==typeof JSROOT)throw Error("JSROOT is not defined","JSRootPainter.v7hist.js");if("object"!=typeof JSROOT.Painter)throw Error("JSROOT.Painter not defined","JSRootPainter.v7hist.js");m(JSROOT,d3)}})(function(m,
B){function f(a){m.TObjectPainter.call(this,a);this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=!1;this.zoom_changed_interactive=0}function y(a){f.call(this,a);this.wheel_zoomy=!1}function q(a){f.call(this,a);this.fContour=null;this.fCustomContour=!1;this.fPalette=null;this.wheel_zoomy=!0}m.sources.push("v7hist");f.prototype=Object.create(m.TObjectPainter.prototype);f.prototype.PrepareFrame=function(a){this.SetDivId(a,-1);if(!this.frame_painter()){var c=this.root_pad();
m.v7.drawFrame(a,c?c.fFrame:null)}this.SetDivId(a,1)};f.prototype.GetHImpl=function(a){return a&&a.fHistImpl?a.fHistImpl.fIsWeak?a.fHistImpl.fWeakForIO:a.fHistImpl.fUnique:null};f.prototype.GetHisto=function(){var a=this.GetObject();(a=this.GetHImpl(a))&&!a.getBinContent&&(a.fAxes._1?(a.getBin=function(a,b){return a+this.fAxes._0.fNBins*b},a.getBinContent=function(a,b){return this.fStatistics.fBinContent[this.getBin(a,b)]},a.getBinError=function(a,b){a=this.getBin(a,b);return this.fStatistics.fSumWeightsSquared?
Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):(a.getBinContent=function(a){return this.fStatistics.fBinContent[a]},a.getBinError=function(a){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.getBinContent(a)))}));return a};f.prototype.IsTProfile=function(){return!1};f.prototype.IsTH1K=function(){return!1};f.prototype.IsTH2Poly=function(){return!1};f.prototype.DecodeOptions=
function(a){this.options||(this.options={Hist:1})};f.prototype.Clear3DScene=function(){var a=this.frame_painter();a&&"function"===typeof a.Create3DScene&&a.Create3DScene(-1);this.mode3d=!1};f.prototype.Cleanup=function(){this.Clear3DScene();delete this.fPalette;delete this.fContour;delete this.options;m.TObjectPainter.prototype.Cleanup.call(this)};f.prototype.Dimension=function(){return 1};f.prototype.ScanContent=function(a){alert("HistPainter.prototype.ScanContent not implemented")};f.prototype.DrawAxes=
function(){var a=this.frame_painter();if(!a)return!1;this.is_main_painter()&&this.draw_content&&(a.CleanupAxes(),a.xmin=a.xmax=0,a.ymin=a.ymax=0,a.zmin=a.zmax=0,a.SetAxesRanges(this.xmin,this.xmax,this.ymin,this.ymax));return a.DrawAxes(!0)};f.prototype.CheckHistDrawAttributes=function(){var a=this.GetObject().fOpts,c=this.canv_painter();this.createAttFill({pattern:0,color:0});var b=c.GetNewColor(a,"contentLine.color");a=c.GetNewOpt(a,"contentLine.width");console.log("new color lcol",b,a);this.createAttLine({color:b||
"black",width:parseInt(a)||1})};f.prototype.UpdateObject=function(a,c){c=this.GetObject();if(a!==c){if(!this.MatchObjectType(a))return!1;c=this.GetHImpl(c);a=this.GetHImpl(a);if(!c||!a)return!1;c.fStatistics=a.fStatistics}this.ScanContent();return this.histogram_updated=!0};f.prototype.GetAxis=function(a){var c=this.GetHisto();if(!c||!c.fAxes)return null;var b=c.fAxes._0;switch(a){case "x":b=c.fAxes._0;break;case "y":b=c.fAxes._1;break;case "z":b=c.fAxes._2}if(!b||b.GetBinCoord)return b;"ROOT::Experimental::RAxisEquidistant"==
b._typename?(b.min=b.fLow,b.max=b.fLow+(b.fNBins-2)/b.fInvBinWidth,b.GetBinCoord=function(a){return this.fLow+a/this.fInvBinWidth},b.FindBin=function(a,b){return Math.floor((a-this.fLow)*this.fInvBinWidth+b)}):(b.min=b.fBinBorders[0],b.max=b.fBinBorders[b.fNBins-2],b.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fBinBorders[0];if(b>this.fNBins-2)return this.fBinBorders[this.fNBins-2];if(b==a)return this.fBinBorders[b];var c=a<b?b-1:b+1;return this.fBinBorders[b]*Math.abs(a-c)+this.fBinBorders[c]*
Math.abs(a-b)},b.FindBin=function(a,b){for(var c=1;c<this.fBinBorders.length;++c)if(a<this.fBinBorders[c])return Math.floor(c-1+b);return this.fNBins-2});return b};f.prototype.CreateAxisFuncs=function(a,c){if(this.GetHisto()){var b=this.GetAxis("x");this.xmin=b.min;this.xmax=b.max;a&&this.nbinsy&&(b=this.GetAxis("y"),this.ymin=b.min,this.ymax=b.max,c&&this.nbinsz&&(b=this.GetAxis("z"),this.zmin=b.min,this.zmax=b.max))}};f.prototype.AddInteractive=function(){if(this.is_main_painter()){var a=this.frame_painter();
a&&a.AddInteractive()}};f.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};f.prototype.ToggleTitle=function(a){return!1};f.prototype.DecomposeTitle=function(){};f.prototype.DrawTitle=function(){};f.prototype.UpdateStatWebCanvas=function(){};f.prototype.ToggleStat=function(a){};f.prototype.GetSelectIndex=function(a,c,b){var d=this.frame_painter(),g=this.GetAxis(a),p=this["nbins"+a]||0,l=d?d["zoom_"+a+"min"]:0;a=d?d["zoom_"+a+"max"]:0;l!==a&&g?(c="left"==c?g.FindBin(l,b||
0):g.FindBin(a,(b||0)+.5),0>c?c=0:c>p&&(c=p)):c="left"==c?0:p;return c};f.prototype.FindStat=function(){return null};f.prototype.IgnoreStatsFill=function(){return!0};f.prototype.CreateStat=function(a){return null};f.prototype.ButtonClick=function(a){switch(a){case "ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax){this.Unzoom();if(a=this.frame_painter())a.zoom_changed_interactive=0;return!0}if(this.draw_content&&"function"===typeof this.AutoZoom)return this.AutoZoom(),
!0;break;case "ToggleLogX":this.frame_painter().ToggleLog("x");break;case "ToggleLogY":this.frame_painter().ToggleLog("y");break;case "ToggleLogZ":this.frame_painter().ToggleLog("z");break;case "ToggleStatBox":return this.ToggleStat(),!0}return!1};f.prototype.FillToolbar=function(a){var c=this.pad_painter();c&&(c.AddButton(m.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),c.AddButton(m.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown"),c.AddButton(m.ToolbarIcons.arrow_up,
"Toggle log y","ToggleLogY","PageUp"),1<this.Dimension()&&c.AddButton(m.ToolbarIcons.arrow_diag,"Toggle log z","ToggleLogZ"),this.draw_content&&c.AddButton(m.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox"),a||c.ShowButtons())};f.prototype.Get3DToolTip=function(a){var c=this.GetHisto(),b={bin:a,name:c.fName||"histo",title:c.fTitle};switch(this.Dimension()){case 1:b.ix=a;b.iy=1;b.value=c.getBinContent(b.ix);b.error=c.getBinError(a);b.lines=this.GetBinTips(a-1);break;case 2:b.ix=a%(this.nbinsx+
2);b.iy=(a-b.ix)/(this.nbinsx+2);b.value=c.getBinContent(b.ix,b.iy);b.error=c.getBinError(a);b.lines=this.GetBinTips(b.ix-1,b.iy-1);break;case 3:b.ix=a%(this.nbinsx+2),b.iy=(a-b.ix)/(this.nbinsx+2)%(this.nbinsy+2),b.iz=(a-b.ix-b.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),b.value=this.GetObject().getBinContent(b.ix,b.iy,b.iz),b.error=c.getBinError(a),b.lines=this.GetBinTips(b.ix-1,b.iy-1,b.iz-1)}return b};f.prototype.CreateContour=function(a,c,b,d){1>a&&(a=m.gStyle.fNumberContours);this.fContour=
[];this.colzmin=c;this.colzmax=b;if(this.root_pad().fLogz){0>=this.colzmax&&(this.colzmax=1);0>=this.colzmin&&(this.colzmin=void 0===d||0>=d?1E-4*this.colzmax:3>d||100<d?.3*d:1);this.colzmin>=this.colzmax&&(this.colzmin=1E-4*this.colzmax);c=Math.log(this.colzmin)/Math.log(10);b=(Math.log(this.colzmax)/Math.log(10)-c)/a;this.fContour.push(this.colzmin);for(d=1;d<a;d++)this.fContour.push(Math.exp((c+b*d)*Math.log(10)));this.fContour.push(this.colzmax);this.fCustomContour=!0}else for(this.colzmin===
this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin)),b=(this.colzmax-this.colzmin)/a,d=0;d<=a;d++)this.fContour.push(this.colzmin+b*d);a=this.frame_painter();3>this.Dimension()&&(a.zmin=this.zmin=this.colzmin,a.zmax=this.zmax=this.colzmax);a.fContour=this.fContour;a.fCustomContour=this.fCustomContour;a.colzmin=this.colzmin;a.colzmax=this.colzmax;return this.fContour};f.prototype.GetContour=function(){if(this.fContour)return this.fContour;
var a=this.frame_painter();if(a&&a.fContour)return this.fContour=a.fContour,this.fCustomContour=a.fCustomContour,this.colzmin=a.colzmin,this.colzmax=a.colzmax,this.fContour;this.GetHisto();var c=m.gStyle.fNumberContours,b=this.minbin,d=this.maxbin,g=this.minposbin;b===d&&(b=this.gminbin,d=this.gmaxbin,g=this.gminposbin);a.zoom_zmin!=a.zoom_zmax&&(b=a.zoom_zmin,d=a.zoom_zmax);this.fCustomContour=!1;return this.CreateContour(c,b,d,g)};f.prototype.FillContextMenu=function(a){this.GetHisto();a.add("header:v7histo::anyname");
this.draw_content&&(a.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()}),"function"==typeof this.FillHistContextMenu&&this.FillHistContextMenu(a));if(this.options.Mode3D){0<a.size()&&a.add("separator");var c=this.main_painter()||this,b=this.frame_painter();a.addchk(c.IsTooltipAllowed(),"Show tooltips",function(){c.SetTooltipAllowed("toggle")});a.addchk(b.enable_highlight,"Highlight bins",function(){b.enable_highlight=!b.enable_highlight;!b.enable_highlight&&c.BinHighlight3D&&
c.mode3d&&c.BinHighlight3D(null)});b&&b.Render3D&&(a.addchk(c.options.FrontBox,"Front box",function(){c.options.FrontBox=!c.options.FrontBox;b.Render3D()}),a.addchk(c.options.BackBox,"Back box",function(){c.options.BackBox=!c.options.BackBox;b.Render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.RedrawPad()}),12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()}),
this.FillPaletteMenu&&this.FillPaletteMenu(a));c.control&&"function"===typeof c.control.reset&&a.add("Reset camera",function(){c.control.reset()})}this.FillAttContextMenu(a);this.histogram_updated&&this.zoom_changed_interactive&&a.add("Let update zoom",function(){this.zoom_changed_interactive=0});return!0};f.prototype.getContourIndex=function(a){var c=this.GetContour();if(this.fCustomContour){var b=0,d=c.length-1;if(a<c[0])return-1;if(a>=c[d])return d;for(;b<d-1;){var g=Math.round((b+d)/2);c[g]>a?
d=g:b=g}return b}return a<this.colzmin?this.options.Zero?-1:0:a===this.colzmin?0!=this.colzmin||!this.options.Zero||this.IsTH2Poly()?0:-1:Math.floor(.01+(a-this.colzmin)*(c.length-1)/(this.colzmax-this.colzmin))};f.prototype.getContourColor=function(a,c){var b=this.getContourIndex(a);if(0>b)return null;var d=this.GetContour();a=this.GetPalette();b=a.calcColorIndex(b,d.length);return c?b:a.getColor(b)};f.prototype.GetPalette=function(a){if(!this.fPalette||a)this.fPalette=this.get_palette(!0,this.options.Palette);
return this.fPalette};f.prototype.FillPaletteMenu=function(a){function c(a){g.options.Palette=parseInt(a);g.GetPalette(!0);g.Redraw()}function b(b,g,e){a.addchk(b===d||e,"<nobr>"+g+"</nobr>",b,c)}var d=this.options.Palette,g=this;if(null===d||0===d)d=m.gStyle.Palette;a.add("sub:Palette");b(50,"ROOT 5",10<=d&&51>d);b(51,"Deep Sea");b(52,"Grayscale",0<d&&10>d);b(53,"Dark body radiator");b(54,"Two-color hue");b(55,"Rainbow");b(56,"Inverted dark body radiator");b(57,"Bird",112<d);b(58,"Cubehelix");b(59,
"Green Red Violet");b(60,"Blue Red Yellow");b(61,"Ocean");b(62,"Color Printable On Grey");b(63,"Alpine");b(64,"Aquamarine");b(65,"Army");b(66,"Atlantic");a.add("endsub:")};f.prototype.DrawColorPalette=function(a,c,b){return null};f.prototype.ToggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=!this.options.Zscale,this.DrawColorPalette(this.options.Zscale,
!1,!0)};f.prototype.ToggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.CopyOptionsToOthers();this.InteractiveRedraw("pad","drawopt")};f.prototype.PrepareColorDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===a.extra&&(a.extra=0);void 0===a.middle&&(a.middle=0);var c=
this.GetHisto(),b=this.GetAxis("x"),d=this.GetAxis("y"),g=this.frame_painter(),p=this.Dimension(),l,e={i1:this.GetSelectIndex("x","left",0-a.extra),i2:this.GetSelectIndex("x","right",1+a.extra),j1:1===p?0:this.GetSelectIndex("y","left",0-a.extra),j2:1===p?1:this.GetSelectIndex("y","right",1+a.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};e.grx=new Float32Array(e.i2+1);e.gry=new Float32Array(e.j2+1);a.original&&(e.original=!0,e.origx=new Float32Array(e.i2+1),e.origy=new Float32Array(e.j2+
1));a.pixel_density&&(a.rounding=!0);for(l=e.i1;l<=e.i2;++l){var k=b.GetBinCoord(l+a.middle);g.logx&&0>=k?e.i1=l+1:(e.origx&&(e.origx[l]=k),e.grx[l]=g.grx(k),a.rounding&&(e.grx[l]=Math.round(e.grx[l])),a.use3d&&(e.grx[l]<-g.size_xy3d&&(e.i1=l,e.grx[l]=-g.size_xy3d),e.grx[l]>g.size_xy3d&&(e.i2=l,e.grx[l]=g.size_xy3d)))}if(1===p)e.gry[0]=g.gry(0),e.gry[1]=g.gry(1);else for(b=e.j1;b<=e.j2;++b)l=d.GetBinCoord(b+a.middle),g.logy&&0>=l?e.j1=b+1:(e.origy&&(e.origy[b]=l),e.gry[b]=g.gry(l),a.rounding&&(e.gry[b]=
Math.round(e.gry[b])),a.use3d&&(e.gry[b]<-g.size_xy3d&&(e.j1=b,e.gry[b]=-g.size_xy3d),e.gry[b]>g.size_xy3d&&(e.j2=b,e.gry[b]=g.size_xy3d)));c.getBinContent(e.i1+1,e.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(l=e.i1;l<e.i2;++l)for(b=e.j1;b<e.j2;++b){d=c.getBinContent(l+1,b+1);e.sumz+=d;if(a.pixel_density){g=(e.grx[l+1]-e.grx[l])*(e.gry[b]-e.gry[b+1]);if(0>=g)continue;e.max=Math.max(e.max,d);0<d&&(d<e.min||0===e.min)&&(e.min=d);d/=g}null===this.maxbin?this.maxbin=this.minbin=d:(this.maxbin=
Math.max(this.maxbin,d),this.minbin=Math.min(this.minbin,d));0<d&&(null===this.minposbin||d<this.minposbin)&&(this.minposbin=d)}this.fContour=null;this.fCustomContour=!1;return e};y.prototype=Object.create(f.prototype);y.prototype.ConvertTH1K=function(){var a=this.GetObject();if(!a.fReady){var c=a.fArray;a.fNcells=a.fXaxis.fNbins+2;a.fArray=new Float64Array(a.fNcells);for(var b=0;b<a.fNcells;++b)a.fArray[b]=0;for(b=0;b<a.fNIn;++b)a.Fill(c[b]);a.fReady=!0}};y.prototype.ScanContent=function(a){var c=
this.GetHisto();if(c){!this.nbinsx&&a&&(a=!1);a||(this.nbinsx=this.GetAxis("x").fNBins-2,this.nbinsy=0,this.CreateAxisFuncs(!1));var b=this.GetSelectIndex("x","left"),d=this.GetSelectIndex("x","right");if(!a||b!==this.scan_xleft||d!==this.scan_xright){this.scan_xleft=b;this.scan_xright=d;for(var g=a=0,p=0,l=0,e=!0,k,z=0;z<this.nbinsx;++z)k=c.getBinContent(z+1),l+=k,z<b||z>=d||(0<k&&(0==g||k<g)&&(g=k),e&&(a=p=k,e=!1),a=Math.min(a,k-0),p=Math.max(p,k+0));this.stat_entries=l+=c.getBinContent(0)+c.getBinContent(this.nbinsx+
1);this.hmin=a;this.hmax=p;this.ymin_nz=g;if(this.draw_content=0==this.nbinsx||1E-300>Math.abs(a)&&1E-300>Math.abs(p)?!1:!0)a>=p?0==a?(this.ymin=0,this.ymax=1):0>a?(this.ymin=2*a,this.ymax=0):(this.ymin=0,this.ymax=2*a):(c=.05*(p-a),this.ymin=a-c,0>this.ymin&&0<=a&&(this.ymin=0),this.ymax=p+c)}}};y.prototype.CountStat=function(a){for(var c=this.IsTProfile(),b=this.GetHisto(),d=this.GetAxis("x"),g=this.GetSelectIndex("x","left"),p=this.GetSelectIndex("x","right"),l=0,e=0,k=0,z=0,h=0,n,u,r=null,x=null,
t=this.frame_painter(),v={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};g<p;++g)if(n=d.GetBinCoord(g+.5),!a||a(n)){c?(u=b.fBinEntries[g+1],z+=b.fArray[g+1],h+=b.fSumw2[g+1]):u=b.getBinContent(g+1);if(null===r||u>x)r=n,x=u;l+=u;e+=u*n;k+=u*n*n}!t.IsAxisZoomed("x")&&b.fTsumw&&(l=b.fTsumw,e=b.fTsumwx,k=b.fTsumwx2);v.integral=l;0<l&&(v.meanx=e/l,v.meany=z/l,v.rmsx=Math.sqrt(Math.abs(k/l-v.meanx*v.meanx)),v.rmsy=Math.sqrt(Math.abs(h/l-v.meany*v.meany)));
null!==r&&(v.xmax=r,v.wmax=x);return v};y.prototype.FillStatistic=function(a,c,b){if(this.IgnoreStatsFill())return!1;b=this.CountStat();var d=c%10,g=Math.floor(c/10)%10,p=Math.floor(c/100)%10,l=Math.floor(c/1E3)%10,e=Math.floor(c/1E4)%10,k=Math.floor(c/1E5)%10,z=Math.floor(c/1E6)%10,h=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.ClearPave();0<d&&a.AddText(b.name);this.IsTProfile()?(0<g&&a.AddText("Entries = "+a.Format(b.entries,"entries")),0<p&&(a.AddText("Mean = "+a.Format(b.meanx)),a.AddText("Mean y = "+
a.Format(b.meany))),0<l&&(a.AddText("Std Dev = "+a.Format(b.rmsx)),a.AddText("Std Dev y = "+a.Format(b.rmsy)))):(0<g&&a.AddText("Entries = "+a.Format(b.entries,"entries")),0<p&&a.AddText("Mean = "+a.Format(b.meanx)),0<l&&a.AddText("Std Dev = "+a.Format(b.rmsx)),0<e&&a.AddText("Underflow = "+a.Format(histo.getBinContent(0),"entries")),0<k&&a.AddText("Overflow = "+a.Format(histo.getBinContent(this.nbinsx+1),"entries")),0<z&&a.AddText("Integral = "+a.Format(b.integral,"entries")),0<h&&a.AddText("Skew = <not avail>"),
0<c&&a.AddText("Kurt = <not avail>"));return!0};y.prototype.DrawBars=function(a,c){this.CreateG(!0);var b=this.GetSelectIndex("x","left",-1);a=this.GetSelectIndex("x","right",1);var d=this.frame_painter(),g=this.GetHisto(),p=this.GetAxis("x"),l="",e="",k="",z=10<this.options.BarStyle?this.options.BarStyle%10:0;4<z&&(z=4);c=d.swap_xy?0:c;for(!1===this.options.BaseLine||isNaN(this.options.BaseLine)||this.options.BaseLine>=d.scale_ymin&&(c=Math.round(d.gry(this.options.BaseLine)));b<a;++b){var h=p.GetBinCoord(b);
var n=p.GetBinCoord(b+1);if(!(d.logx&&0>=n)){h=Math.round(d.grx(h));n=Math.round(d.grx(n));var u=g.getBinContent(b+1);if(!(d.logy&&u<d.scale_ymin)){u=Math.round(d.gry(u));var r=n-h;h+=Math.round(this.options.fBarOffset/1E3*r);r=Math.round(this.options.fBarWidth/1E3*r);l=d.swap_xy?l+("M"+c+","+h+"h"+(u-c)+"v"+r+"h"+(c-u)+"z"):l+("M"+h+","+u+"h"+r+"v"+(c-u)+"h"+-r+"z");0<z&&(n=h+r,r=Math.round(r*z/10),d.swap_xy?(e+="M"+c+","+h+"h"+(u-c)+"v"+r+"h"+(c-u)+"z",k+="M"+c+","+n+"h"+(u-c)+"v"+-r+"h"+(c-u)+
"z"):(e+="M"+h+","+u+"h"+r+"v"+(c-u)+"h"+-r+"z",k+="M"+n+","+u+"h"+-r+"v"+(c-u)+"h"+r+"z"))}}}this.fillatt.empty()&&this.fillatt.SetSolidColor("blue");0<l.length&&this.draw_g.append("svg:path").attr("d",l).call(this.fillatt.func);0<e.length&&this.draw_g.append("svg:path").attr("d",e).call(this.fillatt.func).style("fill",B.rgb(this.fillatt.color).brighter(.5).toString());0<k.length&&this.draw_g.append("svg:path").attr("d",k).call(this.fillatt.func).style("fill",B.rgb(this.fillatt.color).darker(.5).toString())};
y.prototype.DrawFilledErrors=function(a,c){this.CreateG(!0);var b=this.GetSelectIndex("x","left",-1),d=this.GetSelectIndex("x","right",1),g=this.frame_painter(),p=this.GetHisto(),l=this.GetAxis("x");c=[];for(a=[];b<d;++b){var e=l.GetBinCoord(b+.5);if(!(g.logx&&0>=e)){e=Math.round(g.grx(e));var k=p.getBinContent(b+1);var z=p.getBinError(b+1);if(!(g.logy&&k-z<g.scale_ymin)){var h=Math.round(g.gry(k+z));k=Math.round(g.gry(k-z));c.push({grx:e,gry:h});a.unshift({grx:e,gry:k})}}}d=4===this.options.ErrorKind?
"bezier":"line";c=m.Painter.BuildSvgPath(d,c);a=m.Painter.BuildSvgPath("L"+d,a);this.fillatt.empty()&&this.fillatt.setSolidColor("blue");this.draw_g.append("svg:path").attr("d",c.path+a.path+"Z").style("stroke","none").call(this.fillatt.func)};y.prototype.DrawBins=function(){function a(a){S=k.getBinContent(a+1);C&&0===S||(K=Math.round(l.grx(z.GetBinLowEdge(a+1))),M=Math.round(l.grx(z.GetBinLowEdge(a+2))),P=Math.round((K+M)/2),J=Math.round(l.gry(S)),Q=U=20,w&&(Z=k.getBinError(a+1),Q=Math.round(J-l.gry(S+
Z)),U=Math.round(l.gry(S-Z)-J)),q&&(a=y?k.fBinEntries[a+1]:S,0!==a&&(a=a===Math.round(a)?a.toString():m.FFormat(a,m.gStyle.fPaintTextFormat),V?e.DrawText({align:12,x:P,y:Math.round(J-2-N/5),width:0,height:0,rotate:V,text:a,color:ca,latex:0}):e.DrawText({align:22,x:Math.round(K+.1*(M-K)),y:Math.round(J-2-N),width:Math.round(.8*(M-K)),height:N,text:a,color:ca,latex:0}))),f&&null!==L&&(L+=(0===L.length?"M":"L")+P+","+J),W&&J>=-Q&&J<=b+U&&(null!==D&&(D+="M"+K+","+(J-Q)+"h"+(M-K)+"v"+(Q+U+1)+"h-"+(M-K)+
"z"),null!==B&&(B+=e.markeratt.create(P,J)),null!==A&&(0<e.options.errorX&&(a=Math.round(P-(M-K)*e.options.errorX),A+="M"+(a+X)+","+J+aa+"h"+(Math.round(P+(M-K)*e.options.errorX)-a-2*X)+aa),A+="M"+P+","+(J-Q+X)+ba+"v"+(Q+U-2*X)+ba)))}var c=this.frame_width(),b=this.frame_height(),d=this.options;if(!this.draw_content||0>=c||0>=b)return this.RemoveDrawG();this.CheckHistDrawAttributes();if(d.Bar)return this.DrawBars(c,b);if(3===d.ErrorKind||4===d.ErrorKind)return this.DrawFilledErrors(c,b);this.CreateG(!0);
var g=this.GetSelectIndex("x","left",-1),p=this.GetSelectIndex("x","right",2),l=this.frame_painter(),e=this,k=this.GetHisto(),z=this.GetAxis("x"),h="",n=!1,u,r,x,t,v,E,C=!d.Zero,w=d.Error;n=d.Mark;var f=d.Line,q=d.Text,y=q&&"E"==this.options.TextKind&&this.IsTProfile()&&k.fBinEntries,D=null,A=null,B=null,L=null,aa="",ba="",X=0,J,Q,U,S,Z,K,M,P;2===d.ErrorKind?this.fillatt.empty()?n=!0:D="":d.Error&&(A="");f&&(L="");n&&(this.createAttMarker({attr:k,style:this.options.MarkStyle}),0<this.markeratt.size?
(B="",this.markeratt.reset_pos()):n=!1);if(q){var ca=this.get_color(k.fMarkerColor);var V=-1*d.TextAngle;var N=20;1!==d.fMarkerSize&&V&&(N=.02*b*d.fMarkerSize);if(!V&&!d.TextKind){var G=c/(p-g+1);G<3*N&&(V=270,N=Math.round(.7*G))}this.StartTextDrawing(42,N,this.draw_g,N)}c=p-g>3*c;1===d.ErrorKind&&(G=this.lineatt.width+m.gStyle.fEndErrorSize,aa="m0,"+G+"v-"+2*G+"m0,"+G,ba="m"+G+",0h-"+2*G+"m"+G+",0",X=Math.floor((this.lineatt.width-1)/2));var W=w||n;if(W||q||f)c=!0;for(G=g;G<=p;++G)if(n=z.GetBinCoord(G),
!(l.logx&&0>=n)){var O=Math.round(l.grx(n));if((n=G===p)&&g<p)var I=x;else I=k.getBinContent(G+1),I=Math.round(l.gry(I));if(0===h.length){var R=E=G;var Y=u=r=O;var T=t=v=x=I;h="M"+r+","+x}else if(c)if(O!==r||n){if(W||q||f)R===E?a(R):R<E?(a(R),a(E)):(a(E),a(R));W||t===v&&T===t||(Y!==r&&(h+="h"+(r-Y)),x===t?(v!==T&&(h+="v"+(v-T)),t!==v&&(h+="v"+(t-v))):(t!==T&&(h+="v"+(t-T)),v!==t&&(h+="v"+(v-t)),x!==v&&(h+="v"+(x-v))),Y=r,T=x);n&&Y!==O&&(h+="h"+(O-Y));R=E=G;t=v=x=I;r=O}else I<t?E=G:I>v&&(R=G),t=Math.min(t,
I),v=Math.max(v,I),x=I;else if(I!==x||n)O!==r&&(h+="h"+(O-r)),I!==x&&(h+="v"+(I-x)),x=I,r=O}g="";this.fillatt.empty()||(g=b+3,p=Math.round(l.gry(0)),0>=p?g=-3:p<b&&(g=p),g="L"+r+","+g+"L"+u+","+g+"Z",0<h.length&&(h+=g));W||f?(null!==D&&0<D.length&&this.draw_g.append("svg:path").attr("d",D).call(this.fillatt.func),null!==A&&0<A.length&&this.draw_g.append("svg:path").attr("d",A).call(this.lineatt.func),null!==L&&0<L.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",d.Fill?L+g:h).attr("stroke",
"none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",L).attr("fill","none").call(this.lineatt.func)),null!==B&&0<B.length&&this.draw_g.append("svg:path").attr("d",B).call(this.markeratt.func)):h&&d.Hist&&this.draw_g.append("svg:path").attr("d",h).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func);q&&this.FinishTextDrawing(this.draw_g)};y.prototype.GetBinTips=function(a){var c=[],b=this.GetTipName(),d=this.frame_painter(),g=this.GetHisto(),p=this.GetAxis("x"),
l=p.GetBinCoord(a);p=p.GetBinCoord(a+1);var e=g.getBinContent(a+1),k=!1;0<b.length&&c.push(b);"labels"===d.x_kind?b=d.AxisAsText("x",l):"time"===d.x_kind?b=d.AxisAsText("x",(l+p)/2):(k=!0,b="["+d.AxisAsText("x",l)+", "+d.AxisAsText("x",p)+")");this.options.Error||this.options.Mark?(c.push("x = "+b),c.push("y = "+d.AxisAsText("y",e)),this.options.Error&&(k&&c.push("error x = "+((p-l)/2).toPrecision(4)),c.push("error y = "+g.getBinError(a+1).toPrecision(4)))):(c.push("bin = "+(a+1)),c.push("x = "+b),
g.$baseh&&(e-=g.$baseh.getBinContent(a+1)),e===Math.round(e)?c.push("entries = "+e):c.push("entries = "+m.FFormat(e,m.gStyle.fStatFormat)));return c};y.prototype.ProcessTooltip=function(a){function c(a){a=e.GetBinCoord(a);return p.logx&&0>=a?null:p.grx(a)}function b(a){a=l.getBinContent(a+1);return p.logy&&a<p.scale_ymin?p.swap_xy?-1E3:10*g:Math.round(p.gry(a))}if(null===a||!this.draw_content||this.options.Mode3D)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var d=this.frame_width(),
g=this.frame_height(),p=this.frame_painter(),l=this.GetHisto(),e=this.GetAxis("x"),k=null,z=!0,h,n=2,u=this.GetSelectIndex("x","left",-1),r=this.GetSelectIndex("x","right",2);var x=u;var t=r;for(var v=p.swap_xy?a.y:a.x,m=p.swap_xy?a.x:a.y;x<t-1;){var C=Math.round(.5*(x+t));k=c(C);null===k||k<v-.5?p.swap_xy?t=C:x=C:k>v+.5?p.swap_xy?x=C:t=C:(x++,t--)}k=t=x;C=c(k);if(p.swap_xy){for(;x>u&&c(x-1)<C+2;)--x;for(;t<r&&c(t+1)>C-2;)++t}else{for(;x>u&&c(x-1)>C-2;)--x;for(;t<r&&c(t+1)<C+2;)++t}if(x<t){z=g;for(C=
x;C<=t;C++){var w=Math.abs(b(C)-m);w<z&&(z=w,k=C)}z>g/10&&(k=Math.round(x+(t-x)/g*m));C=c(k)}C=Math.round(C);var f=Math.round(c(k+1));this.options.Bar&&(x=f-C,C+=Math.round(this.options.fBarOffset/1E3*x),f=C+Math.round(this.options.fBarWidth/1E3*x));if(C>f){var q=C;C=f;f=q}x=Math.round((C+f)/2);t=w=h=b(k);if(this.options.Bar)z=!0,n=0,w=Math.round(p.gry(!1!==this.options.BaseLine&&this.options.BaseLine>p.scale_ymin?this.options.BaseLine:p.scale_ymin)),w>h&&(q=w,w=h,h=q),!a.touch&&1===a.nproc&&(m<w||
m>h)&&(k=null);else if(this.options.Error||this.options.Mark||this.options.Line)z=!0,d=3,this.markeratt&&(d=Math.max(d,this.markeratt.GetFullSize())),this.options.Error&&(q=l.getBinContent(k+1),h=l.getBinError(k+1),w=Math.round(p.gry(q+h)),h=Math.round(p.gry(q-h)),0==q&&this.IsTProfile()&&(k=null),f=(f-C)*this.options.errorX,C=Math.round(x-f),f=Math.round(x+f)),f-C<2*d&&(C=x-d,f=x+d),w=Math.min(w,t-d),h=Math.max(h,t+d),!a.touch&&1===a.nproc&&(m<w||m>h)&&(k=null);else if(z=1===a.nproc&&r-u<d)h=g,this.fillatt.empty()||
(h=Math.round(p.gry(0)),0>h?h=0:h>g&&(h=g),h<w&&(q=w,w=h,h=q)),(a.y<w||a.y>h)&&!a.touch&&(k=null);null!==k&&(k===u&&C>v+n?k=null:k===r-1&&f<v-n?k=null:v<C-n||v>f+n?k=null:this.options.Zero||0!==l.getBinContent(k+1)||(k=null));n=this.draw_g.select(".tooltip_bin");if(null===k||0>=h||w>=g)return n.remove(),null;u={name:"histo",title:l.fTitle,x:x,y:t,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(k)};a.disabled?
(n.remove(),u.changed=!0):z?(n.empty()&&(n=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),u.changed=n.property("current_bin")!==k,u.changed&&n.attr("x",p.swap_xy?w:C).attr("width",p.swap_xy?h-w:f-C).attr("y",p.swap_xy?C:w).attr("height",p.swap_xy?f-C:h-w).style("opacity","0.3").property("current_bin",k),u.exact=5>=Math.abs(t-m)||m>=w&&m<=h,u.menu=!0,u.menu_dist=Math.sqrt((x-v)*(x-v)+(t-m)*(t-m))):(v=this.lineatt.width+3,n.empty()&&(n=this.draw_g.append("svg:circle").attr("class",
"tooltip_bin").style("pointer-events","none").attr("r",v).call(this.lineatt.func).call(this.fillatt.func)),u.exact=Math.abs(x-a.x)<=v&&Math.abs(t-a.y)<=v,u.menu=u.exact,u.menu_dist=Math.sqrt((x-a.x)*(x-a.x)+(t-a.y)*(t-a.y)),u.changed=n.property("current_bin")!==k,u.changed&&n.attr("cx",x).attr("cy",t).property("current_bin",k));u.changed&&(u.user_info={obj:l,name:"histo",bin:k,cont:l.getBinContent(k+1),grx:x,gry:t});return u};y.prototype.FillHistContextMenu=function(a){a.add("Auto zoom-in",this.AutoZoom);
var c=m.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.options.need_fillcol&&this.fillatt&&this.fillatt.empty()&&this.fillatt.Change(5,1001);this.InteractiveRedraw("pad","drawopt")})};y.prototype.AutoZoom=function(){var a=this.GetSelectIndex("x","left",-1),c=this.GetSelectIndex("x","right",1),b=c-a,d=this.GetHisto(),g=this.GetAxis("x");if(0!=b){for(var p=d.getBinContent(a+
1),l=a;l<c;++l)p=Math.min(p,d.getBinContent(l+1));if(!(0<p)){for(;a<c&&d.getBinContent(a+1)<=p;)++a;for(;a<c&&d.getBinContent(c)<=p;)--c;a===c-1&&2<a&&c<this.nbinsx-2&&(--a,++c);c-a<b&&a<c&&this.frame_painter().Zoom(g.GetBinCoord(a),g.GetBinCoord(c))}}};y.prototype.CanZoomIn=function(a,c,b){var d=this.GetAxis("x");return"x"==a&&1<d.FindBin(b,.5)-d.FindBin(c,0)||"y"==a&&Math.abs(b-c)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};y.prototype.CallDrawFunc=function(a,c){var b=this.frame_painter();b&&b.mode3d!==
this.options.Mode3D&&(this.options.Mode3D=b.mode3d);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,c)};y.prototype.Draw2D=function(a){this.Clear3DScene();this.mode3d=!1;"function"===typeof this.DrawColorPalette&&this.DrawColorPalette(!1);this.DrawAxes()?this.DrawBins():console.log("FAIL DARWING AXES");this.AddInteractive();m.CallBack(a)};y.prototype.Draw3D=function(a,c){this.mode3d=!0;m.AssertPrerequisites("hist3d",function(){this.Draw3D(a,c)}.bind(this))};y.prototype.Redraw=function(a){this.CallDrawFunc(null,
a)};q.prototype=Object.create(f.prototype);q.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;f.prototype.Cleanup.call(this)};q.prototype.Dimension=function(){return 2};q.prototype.ToggleProjection=function(a,c){"Projections"==a&&(a="");"string"==typeof a&&1<a.length&&(c=parseInt(a.substr(1)),a=a[0]);c||(c=1);if(a&&this.is_projection==a)if(this.projection_width===c)a="";else{this.projection_width=c;return}delete this.proj_hist;a=this.is_projection===a?"":a;this.is_projection=
"";this.projection_width=c;(c=this.canv_painter())&&c.ToggleProjection(this.is_projection,this.RedrawProjection.bind(this,"toggling",a))};q.prototype.RedrawProjection=function(a,c,b,d){"toggling"===a&&(this.is_projection=c)};q.prototype.ExecuteMenuCommand=function(a,c){return f.prototype.ExecuteMenuCommand.call(this,a,c)?!0:"SetShowProjectionX"==a.fName||"SetShowProjectionY"==a.fName?(this.ToggleProjection(a.fName[17],c&&parseInt(c)?parseInt(c):1),!0):!1};q.prototype.FillHistContextMenu=function(a){a.add("sub:Projections",
this.ToggleProjection);var c=this.is_projection||"";c&&(c+=this.projection_width);for(var b="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" "),d=0;d<b.length;++d)a.addchk(c==b[d],b[d],b[d],this.ToggleProjection);a.add("endsub:");a.add("Auto zoom-in",this.AutoZoom);c=m.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");a.addDrawMenu("Draw with",c.opts,function(a){if("inspect"===a)return this.ShowInspector();this.DecodeOptions(a);this.InteractiveRedraw("pad","drawopt")});this.options.Color&&this.FillPaletteMenu(a)};
q.prototype.ButtonClick=function(a){if(f.prototype.ButtonClick.call(this,a))return!0;switch(a){case "ToggleColor":this.ToggleColor();break;case "ToggleColorZ":this.ToggleColz();break;case "Toggle3D":this.ToggleMode3D();break;default:return!1}return!0};q.prototype.FillToolbar=function(){f.prototype.FillToolbar.call(this,!0);var a=this.pad_painter();a&&(this.IsTH2Poly()||a.AddButton(m.ToolbarIcons.th2color,"Toggle color","ToggleColor"),a.AddButton(m.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ"),
a.AddButton(m.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D"),a.ShowButtons())};q.prototype.ToggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color;this._can_move_colz=!0;this.Redraw()};q.prototype.AutoZoom=function(){if(!this.IsTH2Poly()){var a=this.GetSelectIndex("x","left",-1),c=this.GetSelectIndex("x","right",1),b=this.GetSelectIndex("y","left",-1),d=this.GetSelectIndex("y","right",1),g,p,l=this.GetHisto(),e=this.GetAxis("x"),
k=this.GetAxis("y");if(a!=c&&b!=d){var z=l.getBinContent(a+1,b+1);for(g=a;g<c;++g)for(p=b;p<d;++p)z=Math.min(z,l.getBinContent(g+1,p+1));if(!(0<z)){var h=c,n=a,u=d,r=b;for(g=a;g<c;++g)for(p=b;p<d;++p)l.getBinContent(g+1,p+1)>z&&(g<h&&(h=g),g>=n&&(n=g+1),p<u&&(u=p),p>=r&&(r=p+1));g=!1;h===n-1&&h>a+1&&n<c-1&&(h--,n++);u===r-1&&u>b+1&&r<d-1&&(u--,r++);if((h>a||n<c)&&h<n-1){var m=e.GetBinCoord(h);var t=e.GetBinCoord(n);g=!0}if((u>b||r<d)&&u<r-1){var v=k.GetBinCoord(u);var E=k.GetBinCoord(r);g=!0}g&&this.frame_painter().Zoom(m,
t,v,E)}}}};q.prototype.ScanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var c;a=this.GetHisto();this.nbinsx=this.GetAxis("x").fNBins-2;this.nbinsy=this.GetAxis("y").fNBins-2;this.CreateAxisFuncs(!0);if(this.IsTH2Poly()){this.gminposbin=null;var b=this.gminbin=this.gmaxbin=0;for(c=a.fBins.arr.length;b<c;++b){var d=a.fBins.arr[b].fContent;0===b&&(this.gminbin=this.gmaxbin=d);d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d);0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=
d)}}else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,b=0;b<this.nbinsx;++b)for(c=0;c<this.nbinsy;++c)d=a.getBinContent(b+1,c+1),d<this.gminbin?this.gminbin=d:d>this.gmaxbin&&(this.gmaxbin=d),0<d&&(null===this.gminposbin||this.gminposbin>d)&&(this.gminposbin=d);null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.IsTH2Poly()&&(this.draw_content=!0,
this.options.Line=1))}};q.prototype.CountStat=function(a){var c=this.GetObject(),b=0,d=0,g=0,p=0,l=0,e,k,z=this.frame_painter(),h={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){var n=c.fBins.arr.length,u,r,m,t,v=this.frame_painter();for(u=0;u<n;++u){var E=c.fBins.arr[u];var f=e=1;E.fXmin>v.scale_xmax?e=2:E.fXmax<v.scale_xmin&&(e=0);E.fYmin>v.scale_ymax?f=2:E.fYmax<v.scale_ymin&&(f=0);var w=k=t=0;var q=E.fPoly;
var y=1;"TMultiGraph"===q._typename&&(y=E.fPoly.fGraphs.arr.length,q=null);for(m=0;m<y;++m){if(!q||0<m)q=E.fPoly.fGraphs.arr[m];for(r=0;r<q.fNpoints;++r)++t,w+=q.fX[r],k+=q.fY[r]}1<t&&(w/=t,k/=t);E=E.fContent;h.entries+=E;h.matrix[3*f+e]+=E;if(1==e&&1==f&&(null==a||a(w,k))){if(null==h.wmax||E>h.wmax)h.wmax=E,h.xmax=w,h.ymax=k;b+=E;d+=w*E;g+=k*E;p+=w*w*E;l+=k*k*E}}}else for(n=this.GetSelectIndex("x","left"),u=this.GetSelectIndex("x","right"),v=this.GetSelectIndex("y","left"),r=this.GetSelectIndex("y",
"right"),y=this.GetAxis("x"),t=this.GetAxis("y"),q=0;q<=this.nbinsx+1;++q)for(e=q<=n?0:q>u?2:1,w=y.GetBinCoord(q-.5),m=0;m<=this.nbinsy+1;++m)if(f=m<=v?0:m>r?2:1,k=t.GetBinCoord(m-.5),E=c.getBinContent(q,m),h.entries+=E,h.matrix[3*f+e]+=E,1==e&&1==f&&(null==a||a(w,k))){if(null==h.wmax||E>h.wmax)h.wmax=E,h.xmax=w,h.ymax=k;b+=E;d+=w*E;g+=k*E;p+=w*w*E;l+=k*k*E}!z.IsAxisZoomed("x")&&!z.IsAxisZoomed("y")&&0<c.fTsumw&&(b=c.fTsumw,d=c.fTsumwx,p=c.fTsumwx2,g=c.fTsumwy,l=c.fTsumwy2);0<b&&(h.meanx=d/b,h.meany=
g/b,h.rmsx=Math.sqrt(Math.abs(p/b-h.meanx*h.meanx)),h.rmsy=Math.sqrt(Math.abs(l/b-h.meany*h.meany)));null===h.wmax&&(h.wmax=0);h.integral=b;1<c.fEntries&&(h.entries=c.fEntries);return h};q.prototype.FillStatistic=function(a,c,b){if(this.IgnoreStatsFill())return!1;b=this.CountStat();var d=Math.floor(c%10),g=Math.floor(c/10)%10,p=Math.floor(c/100)%10,l=Math.floor(c/1E3)%10,e=Math.floor(c/1E4)%10,k=Math.floor(c/1E5)%10,z=Math.floor(c/1E6)%10,h=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.ClearPave();
0<d&&a.AddText(b.name);0<g&&a.AddText("Entries = "+a.Format(b.entries,"entries"));0<p&&(a.AddText("Mean x = "+a.Format(b.meanx)),a.AddText("Mean y = "+a.Format(b.meany)));0<l&&(a.AddText("Std Dev x = "+a.Format(b.rmsx)),a.AddText("Std Dev y = "+a.Format(b.rmsy)));0<z&&a.AddText("Integral = "+a.Format(b.matrix[4],"entries"));0<h&&(a.AddText("Skewness x = <undef>"),a.AddText("Skewness y = <undef>"));0<c&&a.AddText("Kurt = <undef>");if(0<e||0<k)c=b.matrix,a.AddText(""+c[6].toFixed(0)+" | "+c[7].toFixed(0)+
" | "+c[7].toFixed(0)),a.AddText(""+c[3].toFixed(0)+" | "+c[4].toFixed(0)+" | "+c[5].toFixed(0)),a.AddText(""+c[0].toFixed(0)+" | "+c[1].toFixed(0)+" | "+c[2].toFixed(0));return!0};q.prototype.DrawBinsColor=function(a,c){a=this.GetHisto();c=this.PrepareColorDraw();var b=[],d=[],g=[],p,l;for(p=c.i1;p<c.i2;++p)for(l=c.j1;l<c.j2;++l){var e=a.getBinContent(p+1,l+1);var k=this.getContourColor(e,!0);if(0===e){if(!this.options.Zero)continue;null===k&&this._show_empty_bins&&(k=0)}if(null!==k){e="M"+c.grx[p]+
","+c.gry[l+1];if(void 0===b[k])b[k]=e;else{var z="m"+(c.grx[p]-d[k])+","+(c.gry[l+1]-g[k]);b[k]+=z.length<e.length?z:e}d[k]=c.grx[p];g[k]=c.gry[l+1];b[k]+="v"+(c.gry[l]-c.gry[l+1])+"h"+(c.grx[p+1]-c.grx[p])+"v"+(c.gry[l+1]-c.gry[l])+"z"}}for(k=0;k<b.length;++k)void 0!==b[k]&&this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",this.fPalette.getColor(k)).attr("d",b[k]);return c};q.prototype.BuildContour=function(a,c,b,d){function g(a){for(var b=0;b<c.length;++b)if(a<c[b])return b-1;
return c.length-1}function p(a,b,d,g,l,p,n,u){var f=d===n;n=f?u-g:n-d;b+=1;l-=a;u=h-1;for(var m=999+h,r=0,t;b<=p&&u<=m;)t=c[b],t-=a,t/=l,t*=n,f?(e[u]=d,k[u]=g+t):(e[u]=d+t,k[u]=g),z[u]=b,r++,u+=2,b++;return r}var l=this.GetHisto(),e=new Float32Array(4008),k=new Float32Array(4008),z=new Int32Array(4008),h=0,n=[],u=0,r=[0,0,0,0],x=[0,0,0,0],t=[0,0,0,0],v=[0,0,0,0],f,q,w,y,B=a.original?a.origx:a.grx,F=a.original?a.origy:a.gry;for(q=a.j1;q<a.j2-1;++q)for(x[1]=x[0]=(F[q]+F[q+1])/2,x[3]=x[2]=(F[q+1]+F[q+
2])/2,f=a.i1;f<a.i2-1;++f){t[0]=l.getBinContent(f+1,q+1);t[1]=l.getBinContent(f+2,q+1);t[2]=l.getBinContent(f+2,q+2);t[3]=l.getBinContent(f+1,q+2);for(w=0;4>w;w++)v[w]=g(t[w]);if(v[0]!==v[1]||v[1]!==v[2]||v[2]!==v[3]||v[3]!==v[0]){r[3]=r[0]=(B[f]+B[f+1])/2;r[2]=r[1]=(B[f+1]+B[f+2])/2;var D=t[0]<=t[1]?0:1;var A=t[2]<=t[3]?2:3;t[D]>t[A]&&(D=A);D++;for(w=h=1;4>=w;w++)A=D%4+1,D=p(t[D-1],v[D-1],r[D-1],x[D-1],t[A-1],v[A-1],r[A-1],x[A-1]),h+=2*D,D=A;D=t[0]<=t[1]?0:1;A=t[2]<=t[3]?2:3;t[D]>t[A]&&(D=A);D++;
h=2;for(w=1;4>=w;w++)A=1==D?4:D-1,D=p(t[D-1],v[D-1],r[D-1],x[D-1],t[A-1],v[A-1],r[A-1],x[A-1]),h+=2*D,D=A;A=0;for(w=1;w<=h-5;w+=2)for(;z[w-1]!=z[w];){D=e[w];var H=k[w];var L=z[w];for(y=w;y<=h-5;y+=2)e[y]=e[y+2],k[y]=k[y+2],z[y]=z[y+2];e[h-3]=D;k[h-3]=H;z[h-3]=L;if(2E3<A)break;A++}if(!(2E3<A))for(w=1;w<=h-2;w+=2)A=z[w-1],0<=A&&A<c.length&&((H=n[A])||(H=n[A]=m.CreateTPolyLine(8016,!0)),D=H.fLastPoint,D<H.fN-2&&(H.fX[D+1]=Math.round(e[w-1]),H.fY[D+1]=Math.round(k[w-1]),H.fX[D+2]=Math.round(e[w]),H.fY[D+
2]=Math.round(k[w]),H.fLastPoint=D+2,u=Math.max(u,H.fLastPoint+1)))}}a=new Int32Array(c.length);for(A=f=0;A<c.length;A++)if(0<=c[A]){f=A;break}w=0;for(A=f-1;0<=A;A--)a[w]=A,w++;for(A=f;A<c.length;A++)a[w]=A,w++;l=new Float32Array(2*u);r=new Float32Array(2*u);for(w=0;w<c.length;++w)if(A=a[w],H=n[A])for(x=b.calcColorIndex(A,c.length),t=H.fX,v=H.fY,D=H.fLastPoint+1,F=0;;){q=u;B=q+1;l[q]=t[F];r[q]=v[F];l[B]=t[F+1];r[B]=v[F+1];t[F]=t[F+1]=0;for(v[F]=v[F+1]=0;;){F=0;for(f=2;f<D;f+=2)B<2*u-1&&t[f]===l[B]&&
v[f]===r[B]&&(B++,l[B]=t[f+1],r[B]=v[f+1],t[f]=t[f+1]=0,v[f]=v[f+1]=0,F++),0<q&&t[f+1]===l[q]&&v[f+1]===r[q]&&(q--,l[q]=t[f],r[q]=v[f],t[f]=t[f+1]=0,v[f]=v[f+1]=0,F++);if(0==F)break}q+1<B&&0<=q&&d(x,l,r,q,B,A);F=0;for(f=2;f<D;f+=2)if(0!==t[f]&&0!==v[f]){F=f;break}if(0===F)break}};q.prototype.DrawBinsContour=function(a,c){function b(a,b,c,d){var h="",g=null,k;for(k=c;k<=d;++k){c=null;switch(l.options.Proj){case 1:c=e.ProjectAitoff2xy(a[k],b[k]);break;case 2:c=e.ProjectMercator2xy(a[k],b[k]);break;
case 3:c=e.ProjectSinusoidal2xy(a[k],b[k]);break;case 4:c=e.ProjectParabolic2xy(a[k],b[k])}c?(c.x=e.grx(c.x),c.y=e.gry(c.y)):c={x:a[k],y:b[k]};c.x=Math.round(c.x);c.y=Math.round(c.y);h?c.x!=g.x&&c.y!=g.y?h+="l"+(c.x-g.x)+","+(c.y-g.y):c.x!=g.x?h+="h"+(c.x-g.x):c.y!=g.y&&(h+="v"+(c.y-g.y)):h="M"+c.x+","+c.y;g=c}return h}var d=this.PrepareColorDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),g=this.GetContour(),p=this.GetPalette(),l=this,e=this.frame_painter();if(14===this.options.Contour){a=
"M0,0h"+a+"v"+c+"h-"+a;if(this.options.Proj){a=d.j2-d.j1;c=new Float32Array(2*a);for(var k=new Float32Array(2*a),f=0;f<a;++f)c[f]=d.origx[d.i1],k[f]=(d.origy[d.j1]*(f+.5)+d.origy[d.j2]*(a-.5-f))/a,c[f+a]=d.origx[d.i2],k[f+a]=(d.origy[d.j2]*(f+.5)+d.origy[d.j1]*(a-.5-f))/a;a=b(c,k,0,2*a-1)}this.draw_g.append("svg:path").attr("d",a+"z").style("stroke","none").style("fill",p.calcColor(0,g.length))}this.BuildContour(d,g,p,function(a,c,d,e,g){var k=p.getColor(a),h=k,n=null;switch(l.options.Contour){case 11:h=
"none";n=new m.TAttLineHandler({color:k});break;case 12:h="none";n=new m.TAttLineHandler({color:1,style:a%5+1,width:1});break;case 13:h="none",n=l.lineatt}a=l.draw_g.append("svg:path").attr("class","th2_contour").attr("d",b(c,d,e,g)+("none"==h?"":"z")).style("fill",h);null!==n?a.call(n.func):a.style("stroke","none")});d.hide_only_zeros=!0;return d};q.prototype.CreatePolyBin=function(a,c,b){function d(a,b,d,e){var g=Math.sqrt((a-d)*(a-d)+(b-e)*(b-e));c._sumx+=(a+d)*g/2;c._sumy+=(b+e)*g/2;c._suml+=
g}var g="",p,l=1,e=null;"TMultiGraph"==c.fPoly._typename?l=c.fPoly.fGraphs.arr.length:e=c.fPoly;b&&(c._sumx=c._sumy=c._suml=0);for(p=0;p<l;++p){if(!e||0<p)e=c.fPoly.fGraphs.arr[p];var k=e.fNpoints,f,h=e.fX,n=e.fY,u=Math.round(a.grx(h[0])),m=Math.round(a.gry(n[0]));2<k&&h[0]==h[k-1]&&n[0]==n[k-1]&&k--;g+="M"+u+","+m;for(f=1;f<k;++f){var q=Math.round(a.grx(h[f]));var t=Math.round(a.gry(n[f]));b&&d(u,m,q,t);if(u!==q||m!==t)g=u===q?g+("v"+(t-m)):m===t?g+("h"+(q-u)):g+("l"+(q-u)+","+(t-m));u=q;m=t}b&&
d(u,m,Math.round(a.grx(h[0])),Math.round(a.gry(n[0])));g+="z"}b&&(0<c._suml?(c._midx=Math.round(c._sumx/c._suml),c._midy=Math.round(c._sumy/c._suml)):(c._midx=Math.round(a.grx((c.fXmin+c.fXmax)/2)),c._midy=Math.round(a.gry((c.fYmin+c.fYmax)/2))));return g};q.prototype.DrawPolyBinsColor=function(a,c){var b=this.GetHisto(),d=this.frame_painter(),g=[];a=[];var p,l=b.fBins.arr.length;this.fContour=null;this.fCustomContour=!1;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;
for(p=0;p<l;++p){var e=b.fBins.arr[p];var k=this.getContourColor(e.fContent,!0);if(null!==k){if(0===e.fContent){if(!this.options.Zero||!this.options.Line)continue;k=0}if(!(e.fXmin>d.scale_xmax||e.fXmax<d.scale_xmin||e.fYmin>d.scale_ymax||e.fYmax<d.scale_ymin)){var f=this.CreatePolyBin(d,e,this.options.Text&&e.fContent);g[k]=void 0===g[k]?f:g[k]+f;this.options.Text&&a.push(e)}}}for(k=0;k<g.length;++k)g[k]&&(e=this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",k?this.fPalette.getColor(k):
"none").attr("d",g[k]),this.options.Line&&e.call(this.lineatt.func));if(0<a.length){g=this.get_color(b.fMarkerColor);k=-1*this.options.TextAngle;d=this.draw_g.append("svg:g").attr("class","th2poly_text");e=12;1!==b.fMarkerSize&&k&&(e=Math.round(.02*c*b.fMarkerSize));this.StartTextDrawing(42,e,d,e);for(p=0;p<a.length;++p)e=a[p],c="",this.options.TextKind?(e.fPoly&&(c=e.fPoly.fName),"Graph"===c&&(c=""),c||(c=e.fNumber)):c=Math.round(e.fContent)===e.fContent?e.fContent.toString():m.FFormat(e.fContent,
m.gStyle.fPaintTextFormat),this.DrawText({align:22,x:e._midx,y:e._midy,rotate:k,text:c,color:g,latex:0,draw_g:d});this.FinishTextDrawing(d,null)}return{poly:!0}};q.prototype.DrawBinsText=function(a,c,b){a=this.GetHisto();null===b&&(b=this.PrepareColorDraw({rounding:!1}));var d=this.get_color(a.fMarkerColor),g=-1*this.options.TextAngle,p=this.draw_g.append("svg:g").attr("class","th2_text");var l=20;var e=0,k="E"==this.options.TextKind&&this.MatchObjectType("TProfile2D")&&"function"==typeof a.getBinEntries;
1!==a.fMarkerSize&&g&&(l=Math.round(.02*c*a.fMarkerSize));0!==this.options.fBarOffset&&(e=.001*this.options.fBarOffset);this.StartTextDrawing(42,l,p,l);for(c=b.i1;c<b.i2;++c)for(l=b.j1;l<b.j2;++l){var f=a.getBinContent(c+1,l+1);if(0!==f||this._show_empty_bins){var h=b.grx[c+1]-b.grx[c];var n=b.gry[l]-b.gry[l+1];k&&(f=a.getBinEntries(c+1,l+1));f=f===Math.round(f)?f.toString():m.FFormat(f,m.gStyle.fPaintTextFormat);if(g){var u=Math.round(b.grx[c]+.5*h);var r=Math.round(b.gry[l+1]+n*(.5+e));n=h=0}else u=
Math.round(b.grx[c]+.1*h),r=Math.round(b.gry[l+1]+n*(.1+e)),h=Math.round(.8*h),n=Math.round(.8*n);this.DrawText({align:22,x:u,y:r,width:h,height:n,rotate:g,text:f,color:d,latex:0,draw_g:p})}}this.FinishTextDrawing(p,null);b.hide_only_zeros=!0;return b};q.prototype.DrawBinsArrow=function(a,c){a=this.GetHisto();c="";var b,d,g,p=1E-30,l=this.PrepareColorDraw({rounding:!1}),e=(l.grx[l.i2]-l.grx[l.i1])/(l.i2-l.i1+1-.03)/2,k=(l.gry[l.j2]-l.gry[l.j1])/(l.j2-l.j1+1-.03)/2;for(g=0;2>g;++g)for(b=l.i1;b<l.i2;++b)for(d=
l.j1;d<l.j2;++d){var f=b===l.i1?a.getBinContent(b+2,d+1)-a.getBinContent(b+1,d+1):b===l.i2-1?a.getBinContent(b+1,d+1)-a.getBinContent(b,d+1):.5*(a.getBinContent(b+2,d+1)-a.getBinContent(b,d+1));var h=d===l.j1?a.getBinContent(b+1,d+2)-a.getBinContent(b+1,d+1):d===l.j2-1?a.getBinContent(b+1,d+1)-a.getBinContent(b+1,d):.5*(a.getBinContent(b+1,d+2)-a.getBinContent(b+1,d));if(0===g)p=Math.max(p,Math.abs(f),Math.abs(h));else{var n=(l.grx[b]+l.grx[b+1])/2;var m=(l.gry[d]+l.gry[d+1])/2;var r=e*f/p;f=k*h/
p;var q=n-r;h=n+r;n=m-f;m+=f;f=Math.round(h-q);h=Math.round(m-n);if(0!==f||0!==h)if(c+="M"+Math.round(q)+","+Math.round(n)+"l"+f+","+h,5<Math.abs(f)||5<Math.abs(h))m=Math.sqrt(2/(f*f+h*h)),q=Math.round(m*(f+h)),f=Math.round(m*(f-h)),0!==q&&0!==f&&(c+="l"+-q+","+f+"m"+q+","+-f+"l"+-f+","+-q)}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",c).style("fill","none").call(this.lineatt.func);return l};q.prototype.DrawBinsBox=function(a,c){var b=this.GetHisto();a=this.PrepareColorDraw({rounding:!1});
var d=this.frame_painter();d.maxbin===d.minbin&&(d.maxbin=this.gmaxbin,d.minbin=this.gminbin,d.minposbin=this.gminposbin);d.maxbin===d.minbin&&(d.minbin=Math.min(0,d.maxbin-1));var g=Math.max(Math.abs(d.maxbin),Math.abs(d.minbin)),p=Math.max(0,d.minbin),l="",e=c="",k="",f=!1,h=0;if(this.root_pad().fLogz&&0<g){f=!0;g=Math.log(g);h=0<p?Math.log(p):1<=d.minposbin&&100>d.minposbin?Math.log(.7):0<d.minposbin?Math.log(.7*d.minposbin):g-10;h>=g&&(h=g-10);var n=1/(g-h)}else n=1/(g-p);for(d=a.i1;d<a.i2;++d)for(g=
a.j1;g<a.j2;++g){var m=b.getBinContent(d+1,g+1);var r=Math.abs(m);if(!(0===r||r<p)){var q=f?0<r?Math.log(r)-h:0:r-p;q=.5*(0>q?1:1-Math.sqrt(q*n));0>q&&(q=0);r=a.grx[d+1]-a.grx[d];var t=a.gry[g]-a.gry[g+1];var v=q*r;var y=q*t;q=Math.round(a.grx[d]+v);var C=Math.round(a.gry[g+1]+y);r=Math.max(Math.round(r-2*v),1);t=Math.max(Math.round(t-2*y),1);l+="M"+q+","+C+"v"+t+"h"+r+"v-"+t+"z";0>m&&10===this.options.BoxStyle&&(c+="M"+q+","+C+"l"+r+","+t+"M"+(q+r)+","+C+"l-"+r+","+t);if(11===this.options.BoxStyle&&
5<r&&5<t){y=Math.round(.1*r);var w=Math.round(.1*t);v="M"+q+","+C+"h"+r+"l"+-y+","+w+"h"+(2*y-r)+"v"+(t-2*w)+"l"+-y+","+w+"z";r="M"+(q+r)+","+(C+t)+"v"+-t+"l"+-y+","+w+"v"+(t-2*w)+"h"+(2*y-r)+"l"+-y+","+w+"z";0>m?(k+=v,e+=r):(e+=v,k+=r)}}}0<l.length&&(b=this.draw_g.append("svg:path").attr("d",l).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?b.call(this.lineatt.func):b.style("stroke","none"));0<e.length&&"none"!==this.fillatt.color&&this.draw_g.append("svg:path").attr("d",
e).style("stroke","none").call(this.fillatt.func).style("fill",B.rgb(this.fillatt.color).brighter(.5).toString());0<k.length&&this.draw_g.append("svg:path").attr("d",k).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":B.rgb(this.fillatt.color).darker(.5).toString());0<c.length&&(b=this.draw_g.append("svg:path").attr("d",c).style("fill","none"),"none"!==this.lineatt.color?b.call(this.lineatt.func):b.style("stroke","black"));return a};q.prototype.DrawCandle=
function(a,c){c=this.GetHisto();var b=this.GetAxis("y"),d=this.PrepareColorDraw(),g=this.frame_painter(),p,l,e,k,f="",h="";1===c.fMarkerColor&&(c.fMarkerColor=c.fLineColor);this.createAttMarker({attr:c,style:5});this.markeratt.reset_pos();d.candle=[];for(p=d.i1;p<d.i2;++p){for(a=e=k=l=0;a<this.nbinsy;++a)k+=c.getBinContent(p+1,a+1);var n={bin:p,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(a=0;a<this.nbinsy;++a){var m=c.getBinContent(p+1,a+1);var r=b.GetBinCoord(a+.5);.001>e/k&&
.001<=(e+m)/k&&(n.whiskerm=r);.25>e/k&&.25<=(e+m)/k&&(n.m25y=r);.5>e/k&&.5<=(e+m)/k&&(n.median=r);.75>e/k&&.75<=(e+m)/k&&(n.p25y=r);.999>e/k&&.999<=(e+m)/k&&(n.whiskerp=r);e+=m;l+=m*r}0<e&&(n.meany=l/e);n.iqr=n.p25y-n.m25y;n.m25y-1.5*n.iqr>n.whsikerm&&(n.whiskerm=n.m25y-1.5*n.iqr);n.p25y+1.5*n.iqr<n.whiskerp&&(n.whiskerp=n.p25y+1.5*n.iqr);if(!(g.logy&&0>=n.whiskerm)){a=d.grx[p+1]-d.grx[p];a*=.66;l=(d.grx[p+1]+d.grx[p])/2+this.options.fBarOffset/1E3*a;0<this.options.fBarWidth&&(a=a*this.options.fBarWidth/
1E3);n.x1=Math.round(l-a/2);n.x2=Math.round(l+a/2);l=Math.round(l);n.y0=Math.round(g.gry(n.median));f+="M"+n.x1+","+n.y0+"h"+(n.x2-n.x1);n.y1=Math.round(g.gry(n.p25y));n.y2=Math.round(g.gry(n.m25y));f+="M"+n.x1+","+n.y1+"v"+(n.y2-n.y1)+"h"+(n.x2-n.x1)+"v-"+(n.y2-n.y1)+"z";n.yy1=Math.round(g.gry(n.whiskerp));n.yy2=Math.round(g.gry(n.whiskerm));f+="M"+l+","+n.y1+"v"+(n.yy1-n.y1);f+="M"+n.x1+","+n.yy1+"h"+(n.x2-n.x1);f+="M"+l+","+n.y2+"v"+(n.yy2-n.y2);f+="M"+n.x1+","+n.yy2+"h"+(n.x2-n.x1);for(a=0;a<
this.nbinsy;++a)m=c.getBinContent(p+1,a+1),r=b.GetBinCoord(a+.5),0<m&&r<n.whiskerm&&(h+=this.markeratt.create(l,r)),0<m&&r>n.whiskerp&&(h+=this.markeratt.create(l,r));d.candle.push(n)}}0<f.length&&this.draw_g.append("svg:path").attr("d",f).call(this.lineatt.func).call(this.fillatt.func);0<h.length&&this.draw_g.append("svg:path").attr("d",h).call(this.markeratt.func);return d};q.prototype.DrawBinsScatter=function(a,c){var b=this.GetHisto();a=this.PrepareColorDraw({rounding:!0,pixel_density:!0});c=
[];var d=[],g=[],f=[],l=[],e,k,q=1;var h=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);m.seed(a.sumz);if(1E5>h*a.sumz){this.createAttMarker({attr:b});this.markeratt.reset_pos();d="";for(e=a.i1;e<a.i2;++e){var n=a.grx[e+1]-a.grx[e];for(k=a.j1;k<a.j2;++k){var u=a.gry[k]-a.gry[k+1];var r=b.getBinContent(e+1,k+1);g=Math.round(h*r);if(!(0>=g))for(c=0;c<g;++c)d+=this.markeratt.create(Math.round(a.grx[e]+n*m.random()),Math.round(a.gry[k+1]+u*m.random()))}}this.draw_g.append("svg:path").attr("d",
d).call(this.markeratt.func);return a}.7<this.maxbin&&(q=.7/this.maxbin);h=Math.round(a.max-a.min);this.CreateContour(50<h?50:h,this.minposbin,this.maxbin,this.minposbin);for(e=a.i1;e<a.i2;++e)for(k=a.j1;k<a.j2;++k)if(r=b.getBinContent(e+1,k+1),!(0>=r||r<this.minbin||(n=a.grx[e+1]-a.grx[e],u=a.gry[k]-a.gry[k+1],0>=n*u||(h=this.getContourIndex(r/n/u),0>h)))){r="M"+a.grx[e]+","+a.gry[k+1];if(void 0===c[h])c[h]=r,f[h]=n,l[h]=u;else{var x="m"+(a.grx[e]-d[h])+","+(a.gry[k+1]-g[h]);c[h]+=x.length<r.length?
x:r;f[h]=Math.max(f[h],n);l[h]=Math.max(l[h],u)}d[h]=a.grx[e];g[h]=a.gry[k+1];c[h]+="v"+u+"h"+n+"v-"+u+"z"}h=this.svg_frame().select(".main_layer");e=h.select("defs");e.empty()&&0<c.length&&(e=h.insert("svg:defs",":first-child"));this.createAttMarker({attr:b});for(h=0;h<c.length;++h)if(void 0!==c[h]&&h<this.fContour.length){d="scatter_"+h;b=e.select("."+d);b.empty()?b=e.append("svg:pattern").attr("class",d).attr("id","jsroot_scatter_pattern_"+m.id_counter++).attr("patternUnits","userSpaceOnUse"):
b.selectAll("*").remove();g=Math.round(q*this.fContour[h]*f[h]*l[h]);1>g&&(g=1);k=new Float32Array(g);n=new Float32Array(g);if(1===g)k[0]=n[0]=.5;else for(u=0;u<g;++u)k[u]=m.random(),n[u]=m.random();this.markeratt.reset_pos();d="";for(u=0;u<g;++u)d+=this.markeratt.create(k[u]*f[h],n[u]*l[h]);b.attr("width",f[h]).attr("height",l[h]).append("svg:path").attr("d",d).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",h).attr("fill","url(#"+b.attr("id")+")").attr("d",c[h])}return a};
q.prototype.DrawBins=function(){if(!this.draw_content)return this.RemoveDrawG();this.CheckHistDrawAttributes();this.CreateG(!0);var a=this.frame_width(),c=this.frame_height(),b=null;this.IsTH2Poly()?b=this.DrawPolyBinsColor(a,c):(this.options.Scat?b=this.DrawBinsScatter(a,c):this.options.Color?b=this.DrawBinsColor(a,c):this.options.Box?b=this.DrawBinsBox(a,c):this.options.Arrow?b=this.DrawBinsArrow(a,c):0<this.options.Contour?b=this.DrawBinsContour(a,c):this.options.Candle&&(b=this.DrawCandle(a,c)),
this.options.Text&&(b=this.DrawBinsText(a,c,b)),b||(b=this.DrawBinsScatter(a,c)));this.tt_handle=b};q.prototype.GetBinTips=function(a,c){var b=[],d=this.frame_painter(),g=this.GetAxis("y"),f=this.GetAxis("y"),l=this.GetHisto(),e=l.getBinContent(a+1,c+1);b.push(this.GetTipName()||"histo<2>");"labels"==d.x_kind?b.push("x = "+d.AxisAsText("x",g.GetBinCoord(a))):b.push("x = ["+d.AxisAsText("x",g.GetBinCoord(a))+", "+d.AxisAsText("x",g.GetBinCoord(a+1))+")");"labels"==d.y_kind?b.push("y = "+d.AxisAsText("y",
f.GetBinCoord(c))):b.push("y = ["+d.AxisAsText("y",f.GetBinCoord(c))+", "+d.AxisAsText("y",f.GetBinCoord(c+1))+")");b.push("bin = "+a+", "+c);l.$baseh&&(e-=l.$baseh.getBinContent(a+1,c+1));e===Math.round(e)?b.push("entries = "+e):b.push("entries = "+m.FFormat(e,m.gStyle.fStatFormat));return b};q.prototype.GetCandleTips=function(a){var c=[],b=this.frame_painter(),d=this.GetAxis("y");c.push(this.GetTipName()||"histo");c.push("x = "+b.AxisAsText("x",d.GetBinCoord(a.bin)));c.push("mean y = "+m.FFormat(a.meany,
m.gStyle.fStatFormat));c.push("m25 = "+m.FFormat(a.m25y,m.gStyle.fStatFormat));c.push("p25 = "+m.FFormat(a.p25y,m.gStyle.fStatFormat));return c};q.prototype.ProvidePolyBinHints=function(a,c,b){a=this.GetHisto().fBins.arr[a];var d=this.frame_painter(),g=a.fPoly.fName,f=[],l=0;"Graph"===g&&(g="");0===g.length&&(g=a.fNumber);if(void 0===c&&void 0===b){c=b=0;var e=a.fPoly,k=1;"TMultiGraph"===e._typename&&(k=a.fPoly.fGraphs.arr.length,e=null);for(var q=0;q<k;++q){if(!e||0<q)e=a.fPoly.fGraphs.arr[q];for(var h=
0;h<e.fNpoints;++h)++l,c+=e.fX[h],b+=e.fY[h]}1<l&&(c/=l,b/=l)}f.push(this.GetTipName()||"histo");f.push("x = "+d.AxisAsText("x",c));f.push("y = "+d.AxisAsText("y",b));0<l&&f.push("npnts = "+l);f.push("bin = "+g);a.fContent===Math.round(a.fContent)?f.push("content = "+a.fContent):f.push("content = "+m.FFormat(a.fContent,m.gStyle.fStatFormat));return f};q.prototype.ProcessTooltip=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return null!==this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),
null;var c=this.GetHisto(),b=this.tt_handle,d,g=this.draw_g.select(".tooltip_bin");if(b.poly){b=this.frame_painter();var f,l,e=-1;b.grx===b.x&&(f=b.x.invert(a.x));b.gry===b.y&&(l=b.y.invert(a.y));if(void 0!==f&&void 0!==l){var k=c.fBins.arr.length;for(d=0;d<k&&0>e;++d){var m=c.fBins.arr[d];if(!(f<m.fXmin||f>m.fXmax||l<m.fYmin||l>m.fYmax||0===m.fContent&&!this.options.Zero)){var h=m.fPoly,n=1;"TMultiGraph"===h._typename&&(n=m.fPoly.fGraphs.arr.length,h=null);for(var q=0;q<n;++q){if(!h||0<q)h=m.fPoly.fGraphs.arr[q];
if(h.IsInside(f,l)){e=d;break}}}}}if(0>e)return g.remove(),null;f={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",exact:!0,menu:!0,lines:this.ProvidePolyBinHints(e,f,l)};a.disabled?(g.remove(),f.changed=!0):(g.empty()&&(g=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),f.changed=g.property("current_bin")!==e,f.changed&&g.attr("d",this.CreatePolyBin(b,
m)).style("opacity","0.7").property("current_bin",e));f.changed&&(f.user_info={obj:c,name:c.fName||"histo",bin:e,cont:m.fContent,grx:a.x,gry:a.y});return f}if(b.candle){for(d=0;d<b.candle.length&&!(e=b.candle[d],e.x1<=a.x&&a.x<=e.x2&&e.yy1<=a.y&&a.y<=e.yy2);++d);if(d>=b.candle.length)return g.remove(),null;f={name:c.fName||"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetCandleTips(e),
exact:!0,menu:!0};a.disabled?(g.remove(),f.changed=!0):(g.empty()&&(g=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),f.changed=g.property("current_bin")!==d,f.changed&&g.attr("x",e.x1).attr("width",e.x2-e.x1).attr("y",e.yy1).attr("height",e.yy2-e.yy1).style("opacity","0.7").property("current_bin",d));f.changed&&(f.user_info={obj:c,name:c.fName||"histo",bin:d+1,cont:e.median,binx:d+1,biny:1,grx:a.x,gry:a.y});return f}l=0;e=null;for(d=b.i1;d<b.i2&&!(a.x>=
b.grx[d]&&a.x<=b.grx[d+1]);++d);for(m=b.j1;m<b.j2&&!(a.y>=b.gry[m+1]&&a.y<=b.gry[m]);++m);d<b.i2&&m<b.j2&&(l=c.getBinContent(d+1,m+1),this.is_projection?e=0:b.hide_only_zeros?e=0!==l||this._show_empty_bins?0:null:(e=this.getContourColor(l,!0),null===e&&0===l&&this._show_empty_bins&&(e=0)));if(null===e)return g.remove(),null;f={name:c.fName||"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.fillcoloralt("blue"):"blue",lines:this.GetBinTips(d,
m),exact:!0,menu:!0};this.options.Color&&(f.color2=this.GetPalette().getColor(e));if(a.disabled&&!this.is_projection)g.remove(),f.changed=!0;else{g.empty()&&(g=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none"));e=d;k=d+1;h=m;n=m+1;q=b.grx[e];var r=b.grx[k],x=b.gry[n],t=b.gry[h],v=1E4*d+m;"X"==this.is_projection?(q=0,r=this.frame_width(),1<this.projection_width&&(v=(this.projection_width-1)/2,n+v>=b.j2?(n=Math.min(Math.round(n+v),b.j2),h=Math.max(n-this.projection_width,
b.j1)):(h=Math.max(Math.round(h-v),b.j1),n=Math.min(h+this.projection_width,b.j2))),x=b.gry[n],t=b.gry[h],v=777*h+333*n):"Y"==this.is_projection&&(x=0,t=this.frame_height(),1<this.projection_width&&(v=(this.projection_width-1)/2,k+v>=b.i2?(k=Math.min(Math.round(k+v),b.i2),e=Math.max(k-this.projection_width,b.i1)):(e=Math.max(Math.round(e-v),b.i1),k=Math.min(e+this.projection_width,b.i2))),q=b.grx[e],r=b.grx[k],v=777*e+333*k);f.changed=g.property("current_bin")!==v;f.changed&&g.attr("x",q).attr("width",
r-q).attr("y",x).attr("height",t-x).style("opacity","0.7").property("current_bin",v);this.is_projection&&f.changed&&this.RedrawProjection(e,k,h,n)}f.changed&&(f.user_info={obj:c,name:c.fName||"histo",bin:c.getBin(d+1,m+1),cont:l,binx:d+1,biny:m+1,grx:a.x,gry:a.y});return f};q.prototype.CanZoomIn=function(a,c,b){if("z"==a)return!0;a=this.GetAxis(a);return 1<a.FindBin(b,.5)-a.FindBin(c,0)};q.prototype.Draw2D=function(a,c){this.mode3d=!1;this.Clear3DScene();this.DrawAxes()&&this.DrawBins();this.AddInteractive();
m.CallBack(a)};q.prototype.Draw3D=function(a,c){this.mode3d=!0;m.AssertPrerequisites("hist3d",function(){this.Draw3D(a,c)}.bind(this))};q.prototype.CallDrawFunc=function(a,c){var b=this.frame_painter();this.options.Mode3D!==b.mode3d&&(this.options.Mode3D=b.mode3d);this[this.options.Mode3D?"Draw3D":"Draw2D"](a,c)};q.prototype.Redraw=function(a){this.CallDrawFunc(null,a)};m.v7.THistPainter=f;m.v7.TH1Painter=y;m.v7.TH2Painter=q;m.v7.drawHist1=function(a,c,b){var d=new y(c);d.PrepareFrame(a);d.options=
{Hist:!0,Bar:!1,Error:!1,ErrorKind:-1,errorX:0,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,fBarOffset:0,fBarWidth:1E3,fMarkerSize:1,BaseLine:!1,Mode3D:!1};d.ScanContent();d.CallDrawFunc(function(){d.DrawingReady()});return d};m.v7.drawHist2=function(a,c,b){var d=new q(c);d.PrepareFrame(a);d.options={Hist:!1,Bar:!1,Error:!1,ErrorKind:-1,errorX:0,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",fBarOffset:0,fBarWidth:1E3,BaseLine:!1,
Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Candle:"",Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0};1==c.fOpts.fStyle.fIdx?d.options.Box=!0:d.options.Color=!0;d.DecodeOptions(b);d.IsTH2Poly()&&(d.options.Mode3D?d.options.Lego=12:d.options.Color||(d.options.Color=!0));d._show_empty_bins=!1;d._can_move_colz=!0;d.ScanContent();d.CallDrawFunc(function(){d.DrawingReady()});return d};return m});
